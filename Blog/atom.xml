<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[æå°äº‰]]></title>
  <link href="http://www.citynight.cn/Blog/atom.xml" rel="self"/>
  <link href="http://www.citynight.cn/Blog/"/>
  <updated>2020-08-20T10:41:54+08:00</updated>
  <id>http://www.citynight.cn/Blog/</id>
  <author>
    <name><![CDATA[]]></name>
    
  </author>
  <generator uri="http://www.coderforart.com/">CoderForArt</generator>

  
  <entry>
    <title type="html"><![CDATA[Javaå¼€å‘ç¯å¢ƒæ­å»ºçš„å‡†å¤‡å·¥ä½œ]]></title>
    <link href="http://www.citynight.cn/Blog/15989690336270.html"/>
    <updated>2020-09-01T22:03:53+08:00</updated>
    <id>http://www.citynight.cn/Blog/15989690336270.html</id>
    <content type="html"><![CDATA[
<h3 id="toc_0">ç½‘ç»œé…ç½®ï¼ˆä¿®æ”¹hostsï¼‰</h3>

<h4 id="toc_1">ä»€ä¹ˆæ—¶å€™éœ€è¦</h4>

<p>æ¯”å¦‚æˆ‘ä»¬åœ¨å®‰è£…<a href="https://brew.sh">homeBrew</a>çš„æ—¶å€™ä¼šé‡åˆ°</p>

<pre><code class="language-text">curl: (7) Failed to connect to raw.githubusercontent.com port 443: Connection refused
</code></pre>

<p>å‘ç°è„šæœ¬éœ€è¦åˆ° <code>raw.githubusercontent.com</code>ä¸Šæ‹‰å–ä»£ç ,ä½†æ˜¯åŸŸåçš„DNSè§£æè¢«æ±¡æŸ“ï¼Œå¯¼è‡´DNSè§£æè¿‡ç¨‹ä¸èƒ½è·å–æ­£ç¡®çš„IPåœ°å€ã€‚</p>

<h4 id="toc_2">æ€æ ·æ‰¾æ›¿æ¢</h4>

<p>æ‰“å¼€ <a href="https://www.ipaddress.com/">https://www.ipaddress.com/</a> è¾“å…¥è®¿é—®ä¸äº†çš„åŸŸå,å³<code>raw.githubusercontent.com</code><br/>
å¯ä»¥çœ‹åˆ°<br/>
<img src="media/15989690336270/15989690890684.jpg" alt=""/><br/>
<img src="media/15989690336270/15989691067248.jpg" alt=""/></p>

<p>æŠŠæ‰¾åˆ°çš„IPç›´æ¥åœ¨<code>hosts</code>ä¸­æ˜ å°„å°±å¥½äº†</p>

<h4 id="toc_3">æ€æ ·è¿›è¡Œhostsæ–‡ä»¶ä¿®æ”¹</h4>

<p>ä¸ºäº†æ–¹ä¾¿è¿›è¡Œç½‘ç»œèµ„æºè®¿é—®æ¯”å¦‚<code>github</code>æˆ‘ä»¬éœ€è¦å¯¹<code>hosts</code>æ–‡ä»¶è¿›è¡Œä¿®æ”¹ï¼Œå¯¹äºMacå¸¸è§„çš„æ–¹å¼æ˜¯åœ¨<code>Finder</code>ä¸­ä½¿ç”¨ å¿«æ·é”®<code>command + shift + G</code>ã€‚<br/>
<img src="media/15989690336270/15989691425407.jpg" alt=""/></p>

<p>è¿™é‡Œæˆ‘æ¨èç”¨ç¬¬äºŒç§<a href="https://github.com/oldj/SwitchHosts">SwitchHosts</a><br/>
<img src="media/15989690336270/15989691528858.jpg" alt=""/></p>

<h3 id="toc_4">å¼€å‘ç¯å¢ƒ</h3>

<h4 id="toc_5">Javaç¯å¢ƒæ­å»º</h4>

<h5 id="toc_6">JDKä¸‹è½½</h5>

<p>Google <code>jdk download</code> æˆ‘ä»¬ä¼šæ‰¾åˆ°Oracleç½‘ç«™ï¼Œé€‰æ‹©<a href="https://www.oracle.com/java/technologies/javase/javase-jdk8-downloads.html">jdk8ç‰ˆæœ¬ä¸‹è½½</a></p>

<h5 id="toc_7">Javaé…ç½®ç¯å¢ƒå˜é‡</h5>

<p>æ‰“å¼€<code>terminal</code>,æˆ‘å–œæ¬¢ç”¨ <a href="https://iterm2.com/">iTerm2</a> æ­é…<a href="https://ohmyz.sh/">Oh My Zsh</a>. è¾“å…¥<code>code .bash_profile</code>(code æ˜¯vscodeå‘½ä»¤,æ€ä¹ˆé…ç½®ç”¨vscodeåœ¨terminalä¸­ä½¿ç”¨è§<a href="https://code.visualstudio.com/docs/setup/mac">Visual Studio Code on macOS<br/>
</a>)</p>

<p><img src="media/15989690336270/15989691773089.jpg" alt=""/></p>

<p>å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡é…ç½®ç¯å¢ƒå˜é‡ï¼Œä½¿ç”¨å‘½ä»¤ <code>touch .bash_profile</code> åˆ›å»ºä¸€ä¸ªåä¸º <strong>.bash_profile</strong> éšè—é…ç½®æ–‡ä»¶(æ€ä¹ˆæŸ¥çœ‹éšè—æ–‡ä»¶(å¿«æ·é”® <code>command + shift + .</code>));</p>

<p>æŸ¥çœ‹å½“å‰å®‰è£…çš„Javaç‰ˆæœ¬å·<br/>
åœ¨<code>terminal</code>ä¸­è¾“å…¥<code>java -version</code><br/>
<img src="media/15989690336270/15989691952963.jpg" alt=""/></p>

<p>åœ¨é…ç½®æ–‡ä»¶ä¸­è¾“å…¥ä¸‹é¢çš„å†…å®¹ï¼š</p>

<pre><code class="language-shell">JAVA_HOME=/Library/Java/JavaVirtualMachines/jdk1.8.0_201.jdk/Contents/Home
PATH=$JAVA_HOME/bin:$PATH:.
CLASSPATH=$JAVA_HOME/lib/tools.jar:$JAVA_HOME/lib/dt.jar:.
export JAVA_HOME
export PATH
export CLASSPATH
</code></pre>

<p>JAVA_Home ä¸­ç‰ˆæœ¬å·å°±æ˜¯ä¸Šé¢terminalä¸­æ˜¾ç¤ºçš„ç‰ˆæœ¬å·,å½“ç„¶è¿™ä¸ªåŠæ³•æ¯”è¾ƒåœŸï¼Œä¹Ÿå¯ä»¥æŒ‰ç…§è‹¹æœå¼€å‘è€…ç½‘ç«™ä¸Šçš„åŠæ³•æ‰¾<a href="https://developer.apple.com/library/archive/qa/qa1170/_index.html">Important Java Directories on Mac OS </a><br/>
åœ¨terminalä¸­è¾“å…¥<code>ls -l /usr/libexec/java_home</code><br/>
<img src="media/15989690336270/15989692092687.jpg" alt=""/></p>

<p>å‡ºç°æ–‡ä»¶çš„æ—¶å€™å¯ä»¥æŒ‰ä½<code>command</code>ç‚¹å‡»ç›®å½•è·³è½¬ä¹Ÿå°±ä¼šæ˜¾ç¤ºå‡ºä¸Šé¢æˆªå›¾ä¸­çš„è·¯å¾„</p>

<h5 id="toc_8">é˜…è¯»å…¬å¸æŠ€æœ¯æ–‡æ¡£</h5>

<p>æ–‡æ¡£åœ°å€ï¼š<a href="http://10.10.70.44:7202/pages/viewpage.action?pageId=13729808">SpringCloudå¾®æœåŠ¡æ¶æ„</a></p>

<p>è¿™ç¯‡æ–‡æ¡£ä¸­è¯´æ˜äº†é¡¹ç›®çš„æ¨¡å—åˆ’åˆ†å’Œç¯å¢ƒä¿¡æ¯ç­‰</p>

<h5 id="toc_9">å¿«é€Ÿå¯¼åŒ…(Maven)</h5>

<p>ç¬¬ä¸€è¿è¡Œä¸‹è½½ä¾èµ–åŒ…éå¸¸æ…¢ï¼Œç„¶ååŒäº‹æŠŠä»–ç”µè„‘ä¸­çš„èµ„æºç›´æ¥æ‰“åŒ…å‘ç»™æˆ‘æ›¿æ¢æ‰åŸæœ‰çš„èµ„æºå°±å®Œæˆäº†ä¾èµ–åŒ…çš„ä¸‹è½½è¿‡ç¨‹ã€‚<br/>
<img src="media/15989690336270/15989692306566.jpg" alt=""/></p>

<p>è¿›å…¥è¯¥æ–‡ä»¶å¤¹ï¼Œç„¶åæ›¿æ¢èµ„æºæ–‡ä»¶<br/>
<img src="media/15989690336270/15989692404224.jpg" alt=""/></p>

<hr/>

<p>åˆ°è¿™é‡Œæ‰€æœ‰çš„å‰æœŸå‡†å¤‡å·¥ä½œéƒ½åšå®Œäº†å¯ä»¥è¿è¡Œé¡¹ç›®äº†ã€‚</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[529. Minesweeperï¼ˆ529. æ‰«é›·æ¸¸æˆï¼‰]]></title>
    <link href="http://www.citynight.cn/Blog/15978901087507.html"/>
    <updated>2020-08-20T10:21:48+08:00</updated>
    <id>http://www.citynight.cn/Blog/15978901087507.html</id>
    <content type="html"><![CDATA[
<p>é¢˜ç›®åœ°å€:<a href="https://leetcode-cn.com/problems/minesweeper/">529. æ‰«é›·æ¸¸æˆ</a></p>

<p>Let&#39;s play the minesweeper game (<a href="https://en.wikipedia.org/wiki/Minesweeper_(video_game)">Wikipedia</a>, <a href="http://minesweeperonline.com/">online game</a>)!</p>

<p>You are given a 2D char matrix representing the game board. <strong>&#39;M&#39;</strong> represents an <strong>unrevealed</strong> mine, <strong>&#39;E&#39;</strong> represents an <strong>unrevealed</strong> empty square, <strong>&#39;B&#39;</strong> represents a ** revealed** blank square that has no adjacent (above, below, left, right, and all 4 diagonals) mines, digit (&#39;1&#39; to &#39;8&#39;) represents how many mines are adjacent to this ** revealed** square, and finally <strong>&#39;X&#39;</strong> represents a ** revealed** mine.</p>

<p>Now given the next click position (row and column indices) among all the <strong>unrevealed</strong> squares (<strong>&#39;M&#39;</strong> or <strong>&#39;E&#39;</strong>), return the board after revealing this position according to the following rules:</p>

<ol>
<li>If a mine (<strong>&#39;M&#39;</strong>) is ** revealed**, then the game is over - change it to <strong>&#39;X&#39;</strong>.</li>
<li>If an empty square (<strong>&#39;E&#39;</strong>) with <strong>no adjacent mines</strong> is revealed, then change it to revealed blank (<strong>&#39;B&#39;</strong>) and all of its adjacent <strong>unrevealed</strong> squares should be revealed recursively.</li>
<li>If an empty square (<strong>&#39;E&#39;</strong>) with <strong>at least one adjacent mine</strong> is revealed, then change it to a digit (&#39;1&#39; to &#39;8&#39;) representing the number of adjacent mines.</li>
<li><p>Return the board when no more squares will be ** revealed**.</p>
<p><strong>Example 1:</strong></p></li>
</ol>

<p><strong>Input:</strong></p>

<pre><code class="language-text">[[&#39;E&#39;, &#39;E&#39;, &#39;E&#39;, &#39;E&#39;, &#39;E&#39;],
 [&#39;E&#39;, &#39;E&#39;, &#39;M&#39;, &#39;E&#39;, &#39;E&#39;],
 [&#39;E&#39;, &#39;E&#39;, &#39;E&#39;, &#39;E&#39;, &#39;E&#39;],
 [&#39;E&#39;, &#39;E&#39;, &#39;E&#39;, &#39;E&#39;, &#39;E&#39;]]

Click : [3,0]
</code></pre>

<p><strong>Output:</strong></p>

<pre><code class="language-text">[[&#39;B&#39;, &#39;1&#39;, &#39;E&#39;, &#39;1&#39;, &#39;B&#39;],
 [&#39;B&#39;, &#39;1&#39;, &#39;M&#39;, &#39;1&#39;, &#39;B&#39;],
 [&#39;B&#39;, &#39;1&#39;, &#39;1&#39;, &#39;1&#39;, &#39;B&#39;],
 [&#39;B&#39;, &#39;B&#39;, &#39;B&#39;, &#39;B&#39;, &#39;B&#39;]]

</code></pre>

<p><strong>Explanation:</strong><br/>
 <img src="media/15978901087507/15978907322780.png" alt="" style="width:532px;"/></p>

<ul>
<li><strong>Example 2:</strong></li>
</ul>

<p><strong>Input:</strong></p>

<pre><code class="language-text">[[&#39;B&#39;, &#39;1&#39;, &#39;E&#39;, &#39;1&#39;, &#39;B&#39;],
 [&#39;B&#39;, &#39;1&#39;, &#39;M&#39;, &#39;1&#39;, &#39;B&#39;],
 [&#39;B&#39;, &#39;1&#39;, &#39;1&#39;, &#39;1&#39;, &#39;B&#39;],
 [&#39;B&#39;, &#39;B&#39;, &#39;B&#39;, &#39;B&#39;, &#39;B&#39;]]

Click : [1,2]
</code></pre>

<p><strong>Output:</strong></p>

<pre><code class="language-text">[[&#39;B&#39;, &#39;1&#39;, &#39;E&#39;, &#39;1&#39;, &#39;B&#39;],
 [&#39;B&#39;, &#39;1&#39;, &#39;X&#39;, &#39;1&#39;, &#39;B&#39;],
 [&#39;B&#39;, &#39;1&#39;, &#39;1&#39;, &#39;1&#39;, &#39;B&#39;],
 [&#39;B&#39;, &#39;B&#39;, &#39;B&#39;, &#39;B&#39;, &#39;B&#39;]]

</code></pre>

<p><strong>Explanation:</strong><br/>
<img src="media/15978901087507/15978909318647.png" alt="" style="width:511px;"/></p>

<p><strong>Note:</strong></p>

<ol>
<li>The range of the input matrix&#39;s height and width is [1,50].</li>
<li>The click position will only be an unrevealed square (&#39;M&#39; or &#39;E&#39;), which also means the input board contains at least one clickable square.</li>
<li>The input board won&#39;t be a stage when game is over (some mines have been revealed).</li>
<li>For simplicity, not mentioned rules should be ignored in this problem. For example, you don&#39;t need to reveal all the unrevealed mines when the game is over, consider any cases that you will win the game or flag any squares.</li>
</ol>

<p>æ€è·¯ï¼š<br/>
æ·±åº¦ä¼˜å…ˆ</p>

<pre><code class="language-java">public class Solution {
    // åæ ‡ç›¸é‚»çš„8ä¸ªæ–¹å‘ ä¸Šï¼Œä¸‹ï¼Œå·¦ï¼Œå³ï¼Œå·¦ä¸Šï¼Œå·¦ä¸‹ï¼Œå³ä¸Šï¼Œå³ä¸‹
    private int[][] dirs = {{0,1},{0,-1},{-1,0},{1,0},{-1,1},{-1,-1},{1,1},{1,-1}};
    public char[][] updateBoard(char[][] board, int[] click) {
        // è·å–å½“å‰åæ ‡
        int row = click[0], col = click[1];
        // è¾¹ç•Œæ¡ä»¶
        int m = board.length, n = board[0].length;

        // å¦‚æœæ‰¾åˆ°Mï¼ˆæœªæŒ–å‡ºçš„é›·ï¼‰æˆ–è€…Xï¼ˆå·²æŒ–å‡ºçš„é›·ï¼‰æ¸¸æˆç»“æŸ
        if (board[row][col] == &#39;M&#39; || board[row][col] == &#39;X&#39;) {
            board[row][col] = &#39;X&#39;;
            return board;
        }

        // æ‰¾å‘¨è¾¹æœ‰å‡ ä¸ªé›·
        int num = 0;
        for (int[] dir : dirs) {
            int newRow = dir[0] + row;
            int newCol = dir[1] + col;
            // å¦‚æœå‘¨å›´æ˜¯æœªè¢«æ­å¼€çš„é›·ï¼Œå‘¨å›´é›·çš„æ•°é‡é€’å¢
            if (newRow &gt;= 0 &amp;&amp; newCol &gt;= 0 &amp;&amp; newRow &lt; m &amp;&amp; newCol &lt; n &amp;&amp; board[newRow][newCol] == &#39;M&#39;) {
                num++;
            }
        }

        // å¦‚æœå‘¨å›´æœ‰é›·
        if (num &gt; 0) {
            board[row][col] = (char) (num + &#39;0&#39;);
            return board;
        }

        // å¦‚æœä¸€ä¸ªæ²¡æœ‰ç›¸é‚»åœ°é›·çš„ç©ºæ–¹å—ï¼ˆ&#39;E&#39;ï¼‰è¢«æŒ–å‡ºï¼Œä¿®æ”¹å®ƒä¸ºï¼ˆ&#39;B&#39;ï¼‰
        board[row][col] = &#39;B&#39;;
        for (int[] dir : dirs) {
            int newRow = dir[0] + row;
            int newCol = dir[1] + col;
            // æ‰€æœ‰å’Œå…¶ç›¸é‚»çš„æœªæŒ–å‡ºæ–¹å—éƒ½åº”è¯¥è¢«é€’å½’åœ°æ­éœ²ã€‚
            if (newRow &gt;= 0 &amp;&amp; newCol &gt;= 0 &amp;&amp; newRow &lt; m &amp;&amp; newCol &lt; n &amp;&amp; board[newRow][newCol] == &#39;E&#39;) {
                updateBoard(board,new int[]{newRow,newCol});
            }
        }

        return board;
    }
}
</code></pre>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[647. Palindromic Substrings]]></title>
    <link href="http://www.citynight.cn/Blog/15978472756793.html"/>
    <updated>2020-08-19T22:27:55+08:00</updated>
    <id>http://www.citynight.cn/Blog/15978472756793.html</id>
    <content type="html"><![CDATA[
<p>é¢˜ç›®åœ°å€:<a href="https://leetcode-cn.com/problems/palindromic-substrings/">647. å›æ–‡å­ä¸²</a><br/>
Given a string, your task is to count how many palindromic substrings in this string.</p>

<p>The substrings with different start indexes or end indexes are counted as different substrings even they consist of same characters.</p>

<ul>
<li><strong>Example 1:</strong></li>
</ul>

<pre><code class="language-text">Input: &quot;abc&quot;
Output: 3
Explanation: Three palindromic strings: &quot;a&quot;, &quot;b&quot;, &quot;c&quot;.
</code></pre>

<ul>
<li><strong>Example 2:</strong></li>
</ul>

<pre><code class="language-text">Input: &quot;aaa&quot;
Output: 6
Explanation: Six palindromic strings: &quot;a&quot;, &quot;a&quot;, &quot;a&quot;, &quot;aa&quot;, &quot;aa&quot;, &quot;aaa&quot;.
</code></pre>

<p><strong>Note:</strong><br/>
The input string length won&#39;t exceed 1000.</p>

<p>è§£é¢˜æ€è·¯ï¼š</p>

<p>ä½¿ç”¨ä¸­å¿ƒæ‰©å±•æ–¹æ³•,æ¯ä¸ªå­—ç¬¦éƒ½æ˜¯ä¸€ä¸ªä¸­å¿ƒï¼Œæˆ–è€…ä¸¤ä¸ªç›¸é‚»ä¸€æ ·çš„å­—ç¬¦æ˜¯ä¸€ä¸ªä¸­å¿ƒï¼Œç„¶åå‘å·¦å³åˆ†åˆ«é€’è¿›åˆ¤æ–­èƒ½å¦å½¢æˆå›æ–‡</p>

<p>ä¸¾ä¸ªğŸŒ°</p>

<pre><code class="language-text">  æ¯”å¦‚å­—ç¬¦ä¸²æ˜¯   a   b   a
  éå†å­—ç¬¦ä¸²   &lt;-â¬†-&gt;             å›æ–‡å­ä¸² a  å·¦è¾¹æ²¡æœ‰æ•°æ®æ‰€ä»¥åªæœ‰è¿™ä¸€ä¸ª
                 &lt;-â¬†-&gt;          å›æ–‡å­ä¸² b  ä¸€ä¸ªæŒ‡é’ˆå‘å·¦èµ°ä¸€ä¸ªæŒ‡é’ˆå‘å³èµ° åˆ¤æ–­æ˜¯å¦è¿˜æœ‰å¯¹åº”çš„å­ä¸²ï¼ˆabaï¼‰ï¼Œ å·¦è¾¹ a å³è¾¹ a èƒ½å½¢æˆå­—ä¸²ï¼Œå†èµ°æ²¡æœ‰æ•°æ®
                     &lt;-â¬†-&gt;     å›æ–‡å­—ä¸² a å³è¾¹æ²¡æœ‰æ•°æ®æ‰€ä»¥ç»“æŸ
  æ ¹æ®ä¸Šé¢çš„æµç¨‹ æœ€ç»ˆçš„å­—ä¸²ä¸º  aï¼Œb, aba, a å…±4ä¸ª
 
  å½“ç„¶è¿˜æœ‰ä¸¤ä¸ªå­—ç¬¦ä¸€æ ·çš„æƒ…å†µ
  æ¯”å¦‚å­—ç¬¦ä¸²æ˜¯   a   b   b   a
  è¿™æ ·å°±éœ€è¦      &lt;-â¬†  â¬†-&gt;      ä»ä¸­é—´ä¸¤ä¸ªå‘å¤–åˆ¤æ–­æ˜¯å¦èƒ½å½¢æˆå›æ–‡å­ä¸²  
</code></pre>

<p>å‚è€ƒä»£ç ï¼š</p>

<pre><code class="language-java">class Solution {
    // å›æ–‡å­—ä¸²æ•°é‡
    int count = 0;
    public int countSubstrings(String s) {
        if (s == null || s.length() == 0) {
            return 0;
        }
        for (int i = 0; i &lt; s.length(); i++) {
            // aba -&gt; i ä¸º bä½ç½®
            helper(s,i,i);
            // abba -&gt; i ä¸ºç¬¬ä¸€ä¸ªbä½ç½®
            helper(s,i,i+1);
        }
        return count;
    }

    private void helper(String s, int left, int right) {
        while (left &gt;= 0 &amp;&amp; right &lt;= s.length() - 1 &amp;&amp; s.charAt(left) == s.charAt(right)) {
            count++;
            left--;
            right++;
        }
    }
}
</code></pre>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[setProperty åº”ç”¨]]></title>
    <link href="http://www.citynight.cn/Blog/15966161528946.html"/>
    <updated>2020-08-05T16:29:12+08:00</updated>
    <id>http://www.citynight.cn/Blog/15966161528946.html</id>
    <content type="html"><![CDATA[
<p>é¡¹ç›®ä¸­ä½¿ç”¨<code>Nacos</code>,æƒ³è¦†ç›–nacosçš„é»˜è®¤é…ç½®,é…ç½®ä¿¡æ¯å¦‚ä¸‹:</p>

<pre><code class="language-text">/**
 * @author cloud
 * @date 2019-10-31
 * &lt;p&gt;
 * è¦†ç›–nacos é»˜è®¤é…ç½®
 */
public interface ConfigConstants {
    /**
     * The System property name of  Standalone mode
     */
    String STANDALONE_MODE = &quot;nacos.standalone&quot;;

    /**
     * tomcat ç›®å½•
     */
    String TOMCAT_DIR = &quot;server.tomcat.basedir&quot;;

    /**
     * tomcat æ—¥å¿—é…ç½®
     */
    String TOMCAT_ACCESS_LOG = &quot;server.tomcat.accesslog.enabled&quot;;

    /**
     * æ˜¯å¦å¼€å¯è®¤è¯
     */
    String AUTH_ENABLED = &quot;nacos.core.auth.enabled&quot;;
}
</code></pre>

<p>åœ¨å¯åŠ¨ç±»ä¸­è®¾ç½®æƒ³è¦è¦†ç›–é…ç½®çš„å€¼</p>

<pre><code class="language-text">/**
 * @author nacos
 * &lt;p&gt;
 * nacos console æºç è¿è¡Œï¼Œæ–¹ä¾¿å¼€å‘
 * ç”Ÿäº§å»ºè®®ä»å®˜ç½‘ä¸‹è½½æœ€æ–°ç‰ˆé…ç½®è¿è¡Œ
 */
@EnableScheduling
@SpringBootApplication
public class CloudNacosApplication {

    public static void main(String[] args) {
        System.setProperty(ConfigConstants.TOMCAT_DIR, &quot;logs&quot;);
        System.setProperty(ConfigConstants.TOMCAT_ACCESS_LOG, &quot;false&quot;);
        System.setProperty(ConfigConstants.STANDALONE_MODE, &quot;true&quot;);
        System.setProperty(ConfigConstants.AUTH_ENABLED, &quot;false&quot;);
        SpringApplication.run(CloudNacosApplication.class, args);
    }
}

</code></pre>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[devtools çƒ­å¯åŠ¨]]></title>
    <link href="http://www.citynight.cn/Blog/15965236438323.html"/>
    <updated>2020-08-04T14:47:23+08:00</updated>
    <id>http://www.citynight.cn/Blog/15965236438323.html</id>
    <content type="html"><![CDATA[
<p>ç¬¬ä¸€æ­¥:æ·»åŠ pom</p>

<pre><code class="language-text">        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;
            &lt;scope&gt;runtime&lt;/scope&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;
</code></pre>

<p>ç¬¬äºŒæ­¥ æ·»åŠ æ’ä»¶åˆ°çˆ¶pomä¸­</p>

<pre><code class="language-text">  &lt;build&gt;
    &lt;plugins&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
        &lt;configuration&gt;
          &lt;fork&gt;true&lt;/fork&gt;
          &lt;addResources&gt;true&lt;/addResources&gt;
        &lt;/configuration&gt;
      &lt;/plugin&gt;
    &lt;/plugins&gt;
  &lt;/build&gt;
</code></pre>

<p>ç¬¬ä¸‰æ­¥ å¼€å¯è‡ªåŠ¨ç¼–è¯‘é€‰é¡¹<br/>
Setting-&gt;Build-&gt;Compiler<br/>
<img src="media/15965236438323/15965240806182.jpg" alt="" style="width:475px;"/></p>

<p>ç¬¬å››æ­¥: ä¿®æ”¹Registry</p>

<p>åŒå‡» Shift é€‰ä¸­Action è¾“å…¥ Registry æ‰“å¼€<br/>
<img src="media/15965236438323/15965244242502.jpg" alt="" style="width:655px;"/><br/>
ä¿®æ”¹ä¸ºé€‰ä¸­<br/>
<img src="media/15965236438323/15965245587023.jpg" alt="" style="width:950px;"/><br/>
ç¬¬äº”æ­¥: é‡å¯IDEA</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[@Slf4jæ³¨è§£å®ç°æ—¥å¿—è¾“å‡º]]></title>
    <link href="http://www.citynight.cn/Blog/15965198984201.html"/>
    <updated>2020-08-04T13:44:58+08:00</updated>
    <id>http://www.citynight.cn/Blog/15965198984201.html</id>
    <content type="html"><![CDATA[
<p>æœ€è¿‘çœ‹åˆ°Bç«™ä¸Šæœ‰äººå†™ä»£ç æ²¡æœ‰å®šä¹‰log(<code>private final Logger log = LoggerFactory.getLogger(XXX.class);</code>)å°±èƒ½ç›´æ¥ç”¨<code>log</code></p>

<p>æŸ¥äº†ä¸‹å¯èƒ½çš„æ–¹æ¡ˆ:</p>

<ol>
<li>pomå¼•å…¥ <code>lombok</code></li>
</ol>

<pre><code class="language-text">            &lt;dependency&gt;
                &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
                &lt;artifactId&gt;lombok&lt;/artifactId&gt;
                &lt;version&gt;${lombok.version}&lt;/version&gt;
                &lt;optional&gt;true&lt;/optional&gt;
            &lt;/dependency&gt;
</code></pre>

<ol>
<li>åœ¨ç›®æ ‡ç±»ä¸Šæ·»åŠ <code>@Slf4j</code>æ³¨è§£</li>
<li>ç„¶åç›´æ¥åœ¨æ–¹æ³•ä¸­ä½¿ç”¨<code>log.info(&quot;*****æ’å…¥ç»“æœï¼š&quot;+result);</code></li>
<li>å¦‚æœä½¿ç”¨çš„æ—¶å€™æ²¡æœ‰æ‰¾åˆ°å˜é‡<code>log</code>,IDEAéœ€è¦å®‰è£…lombokæ’ä»¶</li>
</ol>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[632. Smallest Range Covering Elements from K Lists]]></title>
    <link href="http://www.citynight.cn/Blog/15962945237035.html"/>
    <updated>2020-08-01T23:08:43+08:00</updated>
    <id>http://www.citynight.cn/Blog/15962945237035.html</id>
    <content type="html"><![CDATA[
<p>é¢˜ç›®åœ°å€:<a href="https://leetcode-cn.com/problems/smallest-range-covering-elements-from-k-lists/">632. æœ€å°åŒºé—´</a><br/>
You have <code>k</code> lists of sorted integers in ascending order. Find the smallest range that includes at least one number from each of the <code>k</code> lists. </p>

<p>We define the range <code>[a,b]</code> is smaller than range <code>[c,d]</code> if <code>b-a &lt; d-c</code> or <code>a &lt; c</code> if <code>b-a == d-c</code>.</p>

<ul>
<li><strong>Example 1:</strong></li>
</ul>

<pre><code class="language-text">Input: [[4,10,15,24,26], [0,9,12,20], [5,18,22,30]]
Output: [20,24]
Explanation: 
List 1: [4, 10, 15, 24,26], 24 is in range [20,24].
List 2: [0, 9, 12, 20], 20 is in range [20,24].
List 3: [5, 18, 22, 30], 22 is in range [20,24].
</code></pre>

<p>Note: </p>

<ol>
<li>The given list may contain duplicates, so ascending order means &gt;= here.</li>
<li>1 &lt;= k &lt;= 3500</li>
<li>-10<sup>5</sup> &lt;= value of elements &lt;= 10<sup>5.</sup></li>
</ol>

<p>è§£é¢˜æ€è·¯ï¼š<br/>
å…ˆçœ‹ğŸŒ°</p>

<pre><code class="language-text">4,10,15,24,26
0, 9,12,20
5,18,22,30
</code></pre>

<p>å› ä¸ºæ¯ä¸ªæ•°ç»„ä¸­å¿…é¡»æœ‰ä¸€ä¸ªæ•°å­—åŒ…å«åœ¨å…¶ä¸­ï¼Œä¸€å¼€å§‹æˆ‘ä»¬å–æ¯ä¸ªæ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªæ•°å­—</p>

<pre><code class="language-text">*4*,10,15,24,26
*0*, 9,12,20
*5*,18,22,30
</code></pre>

<p><code>4,0,5</code>æœ€å°çš„æ˜¯<code>0</code>,æœ€å¤§å€¼æ˜¯<code>5</code>åŒºé—´æ˜¯<code>5-0=5</code><br/>
æŠŠç¬¬ä¸€ä¸ªæœ€å°åŒºé—´5çš„åæ ‡è®°å½•ä¸‹æ¥å°±æ˜¯<code>[0,5]</code><br/>
å»æ‰æœ€å°çš„å€¼,ç„¶åæœ€å°å€¼æ‰€åœ¨çš„æ•°ç»„å‘åå–ä¸€ä½å³</p>

<pre><code class="language-text">*4*,10,15,24,26
0, *9*,12,20
*5*,18,22,30
</code></pre>

<p><code>4,9,5</code>æœ€å°çš„æ˜¯<code>4</code>,æœ€å¤§å€¼æ˜¯<code>9</code>åŒºé—´æ˜¯<code>9-4=5</code>æœ€å°åŒºé—´ä¸å˜è¿˜æ˜¯5,æ‰€ä»¥å»æ‰æœ€å°çš„å€¼,ç„¶åæœ€å°å€¼æ‰€åœ¨çš„æ•°ç»„å‘åå–ä¸€ä½å³</p>

<pre><code class="language-text">4,*10*,15,24,26
0, *9*,12,20
*5*,18,22,30
</code></pre>

<p><code>10,9,5</code>æœ€å°çš„æ˜¯<code>5</code>,æœ€å¤§å€¼æ˜¯<code>10</code>åŒºé—´æ˜¯<code>10-5=5</code>æœ€å°åŒºé—´ä¸å˜è¿˜æ˜¯5,æ‰€ä»¥å»æ‰æœ€å°çš„å€¼,ç„¶åæœ€å°å€¼æ‰€åœ¨çš„æ•°ç»„å‘åå–ä¸€ä½å³</p>

<pre><code class="language-text">4,*10*,15,24,26
0, *9*,12,20
5,*18*,22,30
</code></pre>

<p><code>10,9,18</code>æœ€å°çš„æ˜¯<code>9</code>,æœ€å¤§å€¼æ˜¯<code>18</code>åŒºé—´æ˜¯<code>18-9=9</code>,å› ä¸º<code>9&gt;5</code>ä¸ç¬¦åˆè§„åˆ™,æœ€å°åŒºé—´ä¸å˜è¿˜æ˜¯5,æ‰€ä»¥å»æ‰æœ€å°çš„å€¼,ç„¶åæœ€å°å€¼æ‰€åœ¨çš„æ•°ç»„å‘åå–ä¸€ä½å³</p>

<pre><code class="language-text">4,*10*,15,24,26
0, 9,*12*,20
5,*18*,22,30
</code></pre>

<p><code>10,12,18</code>æœ€å°çš„æ˜¯<code>10</code>,æœ€å¤§å€¼æ˜¯<code>18</code>åŒºé—´æ˜¯<code>18-10=8</code>,å› ä¸º<code>8&gt;5</code>ä¸ç¬¦åˆè§„åˆ™,æœ€å°åŒºé—´ä¸å˜è¿˜æ˜¯5,æ‰€ä»¥å»æ‰æœ€å°çš„å€¼,ç„¶åæœ€å°å€¼æ‰€åœ¨çš„æ•°ç»„å‘åå–ä¸€ä½å³</p>

<pre><code class="language-text">4,10,*15*,24,26
0, 9,*12*,20
5,*18*,22,30
</code></pre>

<p><code>15,12,18</code>æœ€å°çš„æ˜¯<code>12</code>,æœ€å¤§å€¼æ˜¯<code>18</code>åŒºé—´æ˜¯<code>18-12=6</code>,å› ä¸º<code>6&gt;5</code>ä¸ç¬¦åˆè§„åˆ™,æœ€å°åŒºé—´ä¸å˜è¿˜æ˜¯5,æ‰€ä»¥å»æ‰æœ€å°çš„å€¼,ç„¶åæœ€å°å€¼æ‰€åœ¨çš„æ•°ç»„å‘åå–ä¸€ä½å³</p>

<pre><code class="language-text">4,10,*15*,24,26
0, 9,12,*20*
5,*18*,22,30
</code></pre>

<p><code>15,20,18</code>æœ€å°çš„æ˜¯<code>15</code>,æœ€å¤§å€¼æ˜¯<code>20</code>åŒºé—´æ˜¯<code>20-15=5</code>,æœ€å°åŒºé—´ä¸å˜è¿˜æ˜¯5,æ‰€ä»¥å»æ‰æœ€å°çš„å€¼,ç„¶åæœ€å°å€¼æ‰€åœ¨çš„æ•°ç»„å‘åå–ä¸€ä½å³</p>

<pre><code class="language-text">4,10,15,*24*,26
0, 9,12,*20*
5,*18*,22,30
</code></pre>

<p><code>24,20,18</code>æœ€å°çš„æ˜¯<code>18</code>,æœ€å¤§å€¼æ˜¯<code>24</code>åŒºé—´æ˜¯<code>24-18=6</code>,å› ä¸º<code>6&gt;5</code>ä¸ç¬¦åˆè§„åˆ™,æœ€å°åŒºé—´ä¸å˜è¿˜æ˜¯5,æ‰€ä»¥å»æ‰æœ€å°çš„å€¼,ç„¶åæœ€å°å€¼æ‰€åœ¨çš„æ•°ç»„å‘åå–ä¸€ä½å³</p>

<pre><code class="language-text">4,10,15,*24*,26
0, 9,12,*20*
5,18,*22*,30
</code></pre>

<p><code>24,20,22</code>æœ€å°çš„æ˜¯<code>20</code>,æœ€å¤§å€¼æ˜¯<code>24</code>åŒºé—´æ˜¯<code>24-20=4</code>,å› ä¸º<code>4&lt;5</code>ç¬¦åˆè§„åˆ™,æœ€å°åŒºé—´å˜æ›´ä¸º4,æŠŠæœ€å°åŒºé—´4çš„åæ ‡è®°å½•ä¸‹æ¥å°±æ˜¯<code>[20,24]</code>,è¿™æ—¶ç»§ç»­å‘åèµ°,ç”±äºæœ€å°å€¼æ˜¯<code>20</code>è€Œ<code>20</code>æ‰€åœ¨çš„æ•°ç»„å·²ç»èµ°åˆ°äº†ç»“å°¾,ä¸èƒ½ç»§ç»­èµ°,å†èµ°å°±ä¸èƒ½æ»¡è¶³æ¯ä¸ªæ•°ç»„ä¸­å¿…é¡»æœ‰ä¸€ä¸ªæ•°åŒ…å«åœ¨å…¶ä¸­.<br/>
æ‰€ä»¥è¿”å›æœ€å°åŒºé—´<code>[20,24</code></p>

<p>å‚è€ƒä»£ç :</p>

<pre><code class="language-java">class Solution {
    public int[] smallestRange(List&lt;List&lt;Integer&gt;&gt; nums) {
        // é‡Œé¢å­˜å‚¨çš„æ˜¯è¡Œåˆ—æ•°æ®ä½ç½®ï¼Œä¼˜å…ˆçº§æ˜¯åˆ—ä¸­æ•°æ®å¤§å°
        PriorityQueue&lt;int[]&gt; q = new PriorityQueue&lt;&gt;(Comparator.comparingInt(o -&gt; nums.get(o[0]).get(o[1])));
        int max = Integer.MIN_VALUE, start = 0, end = Integer.MAX_VALUE;
        // å…ˆè®©æ¯ä¸ªæ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªæ•°è¿›å…¥ q
        for (int i = 0; i &lt; nums.size(); i++) {
            q.offer(new int[]{i, 0});
            max = Math.max(max, nums.get(i).get(0));
        }
        while (q.size() == nums.size()) {
            // å–å‡ºæœ€å°çš„å…ƒç´ è·å¾—åˆ°è¡Œåˆ—ä¿¡æ¯
            int e[] = q.poll(), row = e[0], col = e[1];
            // æ¯”è¾ƒï¼Œå¦‚æœç¬¦åˆæ¡ä»¶å°±æ›´æ–°æœ€å°åŒºé—´ä¿¡æ¯
            if (end - start &gt; max - nums.get(row).get(col)) {
                start = nums.get(row).get(col);
                end = max;
            }
            // é˜²æ­¢è¶Šç•Œ
            if (col + 1 &lt; nums.get(row).size()) {
                q.offer(new int[]{row, col + 1});
                max = Math.max(max, nums.get(row).get(col + 1));
            }
        }
        return new int[]{start, end};
    }
}
</code></pre>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[# æ·±å…¥ç†è§£ iOS äº‹ä»¶æœºåˆ¶]]></title>
    <link href="http://www.citynight.cn/Blog/15654059537017.html"/>
    <updated>2019-08-10T10:59:13+08:00</updated>
    <id>http://www.citynight.cn/Blog/15654059537017.html</id>
    <content type="html"><![CDATA[
<blockquote>
<p>åŸæ–‡æ¥è‡ª<a href="https://juejin.im/post/5d396ef7518825453b605afa">æ˜é‡‘</a></p>
</blockquote>

<h2 id="toc_0">å‰è¨€</h2>

<p>è¿™ç¯‡æ–‡ç« å§‹äºä¸€ä¸ªéœ€æ±‚ï¼šæˆ‘ä»¬åœ¨ SDK æä¾›çš„æŸä¸ª View çš„ Subview ä¸­å®ç°äº†å•å‡»åŒå‡»ç­‰å¤šä¸ª Gesture Recognizerï¼Œè€Œå®¢æˆ·å¸Œæœ›è‡ªå·±åœ¨è¿™ä¸ª View ä¸Šçš„å•å‡»æ‰‹åŠ¿ä¸ä¼šå†²çªï¼ŒåŒæ—¶æ²¡æœ‰å»¶è¿Ÿã€‚</p>

<p>å€Ÿæ­¤æœºä¼šï¼Œæˆ‘ä»¬æ¥é‡æ¸©ä¸‹ iOS çš„äº‹ä»¶æœºåˆ¶å’Œæ‰‹åŠ¿å†²çªï¼Œé‡ç‚¹ä»‹ç»ä¸‹ UIGestureRecognizer ä¹‹é—´ä»¥åŠä¸åŸç”Ÿè§¦æ‘¸äº‹ä»¶çš„ç›¸äº’å…³ç³»ã€‚</p>

<h2 id="toc_1">äº‹ä»¶çš„ç”Ÿå‘½å‘¨æœŸ</h2>

<p>å½“æŒ‡å°–è§¦ç¢°å±å¹•æ—¶ï¼Œä¸€ä¸ªè§¦æ‘¸äº‹ä»¶å°±åœ¨ç³»ç»Ÿä¸­ç”Ÿæˆäº†ã€‚ç»è¿‡ IPC è¿›ç¨‹é—´é€šä¿¡ï¼Œäº‹ä»¶æœ€ç»ˆè¢«ä¼ é€’åˆ°äº†åˆé€‚çš„åº”ç”¨ã€‚åœ¨åº”ç”¨å†…å†ç»å³°å›è·¯è½¬çš„å¥‡å¹»ä¹‹æ—…åï¼Œæœ€ç»ˆè¢«é‡Šæ”¾ã€‚å¤§è‡´ç»è¿‡å¦‚ä¸‹å›¾ï¼š</p>

<p><img src="media/15654059537017/15654060901311.jpg" alt=""/></p>

<h3 id="toc_2">ç³»ç»Ÿå“åº”é˜¶æ®µ</h3>

<ol>
<li><p>æ‰‹æŒ‡è§¦ç¢°å±å¹•ï¼Œå±å¹•æ„Ÿåº”åˆ°è§¦ç¢°åï¼Œå°†äº‹ä»¶äº¤ç”± IOKit å¤„ç†ã€‚</p></li>
<li><p>IOKit å°†è§¦æ‘¸äº‹ä»¶å°è£…æˆä¸€ä¸ª IOHIDEvent å¯¹è±¡ï¼Œå¹¶é€šè¿‡ mach port ä¼ é€’ç»™ SpringBoard è¿›ç¨‹ã€‚</p></li>
</ol>

<blockquote>
<p>mach port è¿›ç¨‹ç«¯å£ï¼Œå„è¿›ç¨‹ä¹‹é—´é€šè¿‡å®ƒè¿›è¡Œé€šä¿¡ã€‚</p>

<p>SpringBoad.app æ˜¯ä¸€ä¸ªç³»ç»Ÿè¿›ç¨‹ï¼Œå¯ä»¥ç†è§£ä¸ºæ¡Œé¢ç³»ç»Ÿï¼Œå¯ä»¥ç»Ÿä¸€ç®¡ç†å’Œåˆ†å‘ç³»ç»Ÿæ¥æ”¶åˆ°çš„è§¦æ‘¸äº‹ä»¶ã€‚</p>
</blockquote>

<ol>
<li>SpringBoard è¿›ç¨‹å› æ¥æ”¶åˆ°è§¦æ‘¸äº‹ä»¶ï¼Œè§¦å‘äº†ä¸»çº¿ç¨‹ runloop çš„ source1 äº‹ä»¶æºçš„å›è°ƒã€‚æ­¤æ—¶ SpringBoard ä¼šæ ¹æ®å½“å‰æ¡Œé¢çš„çŠ¶æ€ï¼Œåˆ¤æ–­åº”è¯¥ç”±è°å¤„ç†æ­¤æ¬¡è§¦æ‘¸äº‹ä»¶ã€‚å› ä¸ºäº‹ä»¶å‘ç”Ÿæ—¶ï¼Œä½ å¯èƒ½æ­£åœ¨æ¡Œé¢ä¸Šç¿»é¡µï¼Œä¹Ÿå¯èƒ½æ­£åœ¨åˆ·å¾®åšã€‚è‹¥æ˜¯å‰è€…ï¼ˆå³å‰å°æ—  APP è¿è¡Œï¼‰ï¼Œåˆ™è§¦å‘ SpringBoard æœ¬èº«ä¸»çº¿ç¨‹ runloop çš„ source0 äº‹ä»¶æºçš„å›è°ƒï¼Œå°†äº‹ä»¶äº¤ç”±æ¡Œé¢ç³»ç»Ÿå»æ¶ˆè€—ï¼›è‹¥æ˜¯åè€…ï¼ˆå³æœ‰ APP æ­£åœ¨å‰å°è¿è¡Œï¼‰ï¼Œåˆ™å°†è§¦æ‘¸äº‹ä»¶é€šè¿‡ IPC ä¼ é€’ç»™å‰å° APP è¿›ç¨‹ï¼Œæ¥ä¸‹æ¥çš„äº‹æƒ…ä¾¿æ˜¯ APP å†…éƒ¨å¯¹äºè§¦æ‘¸äº‹ä»¶çš„å“åº”äº†ã€‚</li>
</ol>

<h3 id="toc_3">APPå“åº”é˜¶æ®µ</h3>

<ol>
<li><p>APP è¿›ç¨‹çš„ mach port æ¥å—åˆ° SpringBoard è¿›ç¨‹ä¼ é€’æ¥çš„è§¦æ‘¸äº‹ä»¶ï¼Œä¸»çº¿ç¨‹çš„ runloop è¢«å”¤é†’ï¼Œè§¦å‘äº† source1 å›è°ƒã€‚</p></li>
<li><p>source1 å›è°ƒåˆè§¦å‘äº†ä¸€ä¸ª source0 å›è°ƒï¼Œå°†æ¥æ”¶åˆ°çš„ IOHIDEvent å¯¹è±¡å°è£…æˆ UIEvent å¯¹è±¡ï¼Œæ­¤æ—¶ APP å°†æ­£å¼å¼€å§‹å¯¹äºè§¦æ‘¸äº‹ä»¶çš„å“åº”ã€‚</p></li>
<li><p>source0 å›è°ƒå†…éƒ¨å°†è§¦æ‘¸äº‹ä»¶æ·»åŠ åˆ° UIApplication å¯¹è±¡çš„äº‹ä»¶é˜Ÿåˆ—ä¸­ã€‚äº‹ä»¶å‡ºé˜Ÿåï¼ŒUIApplication å¼€å§‹ä¸€ä¸ªå¯»æ‰¾æœ€ä½³å“åº”è€…çš„è¿‡ç¨‹ï¼Œè¿™ä¸ªè¿‡ç¨‹åˆç§° Hit-Testingï¼Œç»†èŠ‚å°†åœ¨ä¸‹ä¸€èŠ‚é˜è¿°ã€‚å¦å¤–ï¼Œæ­¤å¤„å¼€å§‹ä¾¿æ˜¯ä¸æˆ‘ä»¬å¹³æ—¶å¼€å‘ç›¸å…³çš„å·¥ä½œäº†ã€‚</p></li>
<li><p>å¯»æ‰¾åˆ°æœ€ä½³å“åº”è€…åï¼Œæ¥ä¸‹æ¥çš„äº‹æƒ…ä¾¿æ˜¯äº‹ä»¶åœ¨å“åº”é“¾ä¸­çš„ä¼ é€’åŠå“åº”äº†ã€‚äº‹å®ä¸Šï¼Œäº‹ä»¶é™¤äº†è¢«å“åº”è€…æ¶ˆè€—ï¼Œè¿˜èƒ½è¢«æ‰‹åŠ¿è¯†åˆ«å™¨æˆ–æ˜¯ Target-Action æ¨¡å¼æ•æ‰å¹¶æ¶ˆè€—æ‰ã€‚å…¶ä¸­æ¶‰åŠå¯¹è§¦æ‘¸äº‹ä»¶çš„å“åº”ä¼˜å…ˆçº§ã€‚</p></li>
<li><p>è§¦æ‘¸äº‹ä»¶å†ç»åå·åè¦ä¹ˆè¢«æŸä¸ªå“åº”å¯¹è±¡æ•è·åé‡Šæ”¾ï¼Œè¦ä¹ˆè‡³æ­»ä¹Ÿæ²¡èƒ½æ‰¾åˆ°èƒ½å¤Ÿå“åº”çš„å¯¹è±¡ï¼Œæœ€ç»ˆé‡Šæ”¾ã€‚è‡³æ­¤ï¼Œè¿™ä¸ªè§¦æ‘¸äº‹ä»¶çš„ä½¿å‘½å°±ç®—ç»ˆç»“äº†ã€‚runloop è‹¥æ²¡æœ‰å…¶ä»–äº‹ä»¶éœ€è¦å¤„ç†ï¼Œä¹Ÿå°†é‡å½’äºçœ ï¼Œç­‰å¾…æ–°çš„äº‹ä»¶åˆ°æ¥åå”¤é†’ã€‚</p></li>
</ol>

<h2 id="toc_4">æ¢æµ‹é“¾ä¸å“åº”é“¾</h2>

<h3 id="toc_5">Hit-Testing</h3>

<p>ä»é€»è¾‘ä¸Šæ¥è¯´ï¼Œæ¢æµ‹é“¾æ˜¯æœ€å…ˆå‘ç”Ÿçš„æœºåˆ¶ï¼Œå½“è§¦æ‘¸äº‹ä»¶å‘ç”Ÿåï¼ŒiOS ç³»ç»Ÿæ ¹æ® Hit-Testing æ¥ç¡®å®šè§¦æ‘¸äº‹ä»¶å‘ç”Ÿåœ¨å“ªä¸ªè§†å›¾å¯¹è±¡ä¸Šã€‚å…¶ä¸­ä¸»è¦ç”¨åˆ°äº†ä¸¤ä¸ª UIView ä¸­çš„æ–¹æ³•ï¼š</p>

<pre><code class="language-text">// recursively calls -pointInside:withEvent:. point is in the receiver&#39;s coordinate system
- (nullable UIView *)hitTest:(CGPoint)point withEvent:(nullable UIEvent *)event;

// default returns YES if point is in bounds
- (BOOL)pointInside:(CGPoint)point withEvent:(nullable UIEvent *)event;
å¤åˆ¶ä»£ç 
</code></pre>

<p>å‰è€…ä¼šé€šè¿‡é€’å½’è°ƒç”¨åè€…æ¥è¿”å›ä¸€ä¸ªé€‚åˆå“åº”è§¦æ‘¸äº‹ä»¶çš„è§†å›¾ï¼Œä¸‹é¢è¿™å¼ å›¾æè¿°äº†è¿™ä¸ªè¿‡ç¨‹ï¼š</p>

<p><img src="media/15654059537017/15654061281073.jpg" alt=""/></p>

<h3 id="toc_6">Responder Chain</h3>

<p>Hit-Testing æ‰¾åˆ°çš„è§†å›¾æ‹¥æœ‰æœ€å…ˆå¯¹è§¦æ‘¸äº‹ä»¶è¿›è¡Œå¤„ç†çš„æœºä¼šï¼Œå¦‚æœè¯¥è§†å›¾æ— æ³•å¤„ç†è¿™ä¸ªäº‹ä»¶ï¼Œé‚£ä¹ˆäº‹ä»¶å¯¹è±¡å°±ä¼šæ²¿ç€å“åº”å™¨çš„è§†å›¾é“¾å‘ä¸Šä¼ é€’ï¼Œç›´åˆ°æ‰¾åˆ°å¯ä»¥å¤„ç†è¯¥äº‹ä»¶çš„å¯¹è±¡ä¸ºæ­¢ã€‚ä¸‹é¢è¿™å¼ å›¾æè¿°äº†è¿™ä¸ªè¿‡ç¨‹ï¼š</p>

<p><img src="media/15654059537017/15654061526891.jpg" alt=""/></p>

<h3 id="toc_7">Demo éªŒè¯</h3>

<p>æ¥ä¸‹æ¥æˆ‘ä»¬é€šè¿‡å®˜æ–¹æ–‡æ¡£çš„ Demo ä»¥ä»£ç çš„æ–¹å¼æ¥è¿›è¡ŒéªŒè¯ï¼š</p>

<p><img src="media/15654059537017/15654061728509.jpg" alt=""/></p>

<p>å¯¹äºæ¯ä¸ª Viewï¼Œæˆ‘ä»¬é‡è½½çˆ¶ç±»çš„æ–¹æ³•ï¼š</p>

<pre><code class="language-text">- (UIView *)hitTest:(CGPoint)point withEvent:(UIEvent *)event
{
    NSLog(@&quot;è¿›å…¥A_View---hitTest withEvent ---&quot;);
    UIView * view = [super hitTest:point withEvent:event];
    NSLog(@&quot;ç¦»å¼€A_View--- hitTest withEvent ---hitTestView:%@&quot;,view);
    return view;
}

- (BOOL)pointInside:(CGPoint)point withEvent:(nullable UIEvent *)event
{
    NSLog(@&quot;A_view--- pointInside withEvent ---&quot;);
    BOOL isInside = [super pointInside:point withEvent:event];
    NSLog(@&quot;A_view--- pointInside withEvent --- isInside:%d&quot;,isInside);
    return isInside;
}

- (void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event
{
    NSLog(@&quot;A_touchesBegan&quot;);
    [super touchesBegan:touches withEvent:event];
}

- (void)touchesMoved:(NSSet&lt;UITouch *&gt; *)touches withEvent:(nullable UIEvent *)event
{
    NSLog(@&quot;A_touchesMoved&quot;);
    [super touchesMoved:touches withEvent:event];
}

- (void)touchesEnded:(NSSet&lt;UITouch *&gt; *)touches withEvent:(nullable UIEvent *)event
{
    NSLog(@&quot;A_touchesEnded&quot;);
    [super touchesEnded:touches withEvent:event];
}

-(void)touchesCancelled:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event
{
    NSLog(@&quot;A_touchesCancelled&quot;);
    [super touchesCancelled:touches withEvent:event];
}
å¤åˆ¶ä»£ç 
</code></pre>

<p>ç‚¹å‡» View Dï¼Œlog æ˜¾ç¤ºå¦‚ä¸‹ï¼Œè¿™ä¸æ¢æµ‹é“¾ä¸å“åº”é“¾çš„æœºåˆ¶çš„æè¿°ç›¸åŒã€‚</p>

<pre><code class="language-text">è¿›å…¥A_View---hitTest withEvent ---
A_view--- pointInside withEvent ---
A_view--- pointInside withEvent --- isInside:1
è¿›å…¥C_View---hitTest withEvent ---
C_view---pointInside withEvent ---
C_view---pointInside withEvent --- isInside:1
è¿›å…¥E_View---hitTest withEvent ---
E_view---pointInside withEvent ---
E_view---pointInside withEvent --- isInside:0
ç¦»å¼€E_View---hitTest withEvent ---hitTestView:(null)
è¿›å…¥D_View---hitTest withEvent ---
D_view---pointInside withEvent ---
D_view---pointInside withEvent --- isInside:1
ç¦»å¼€D_View---hitTest withEvent ---hitTestView:&lt;DView: 0x12dd11e50; frame = (0 37; 240 61); autoresize = RM+BM; layer = &lt;CALayer: 0x283f87b40&gt;&gt;
ç¦»å¼€C_View---hitTest withEvent ---hitTestView:&lt;DView: 0x12dd11e50; frame = (0 37; 240 61); autoresize = RM+BM; layer = &lt;CALayer: 0x283f87b40&gt;&gt;
ç¦»å¼€A_View--- hitTest withEvent ---hitTestView:&lt;DView: 0x12dd11e50; frame = (0 37; 240 61); autoresize = RM+BM; layer = &lt;CALayer: 0x283f87b40&gt;&gt;
è¿›å…¥A_View---hitTest withEvent ---
A_view--- pointInside withEvent ---
A_view--- pointInside withEvent --- isInside:1
è¿›å…¥C_View---hitTest withEvent ---
C_view---pointInside withEvent ---
C_view---pointInside withEvent --- isInside:1
è¿›å…¥E_View---hitTest withEvent ---
E_view---pointInside withEvent ---
E_view---pointInside withEvent --- isInside:0
ç¦»å¼€E_View---hitTest withEvent ---hitTestView:(null)
è¿›å…¥D_View---hitTest withEvent ---
D_view---pointInside withEvent ---
D_view---pointInside withEvent --- isInside:1
ç¦»å¼€D_View---hitTest withEvent ---hitTestView:&lt;DView: 0x12dd11e50; frame = (0 37; 240 61); autoresize = RM+BM; layer = &lt;CALayer: 0x283f87b40&gt;&gt;
ç¦»å¼€C_View---hitTest withEvent ---hitTestView:&lt;DView: 0x12dd11e50; frame = (0 37; 240 61); autoresize = RM+BM; layer = &lt;CALayer: 0x283f87b40&gt;&gt;
ç¦»å¼€A_View--- hitTest withEvent ---hitTestView:&lt;DView: 0x12dd11e50; frame = (0 37; 240 61); autoresize = RM+BM; layer = &lt;CALayer: 0x283f87b40&gt;&gt;
D_touchesBegan
C_touchesBegan
A_touchesBegan
D_touchesEnded
C_touchesEnded
A_touchesEnded
å¤åˆ¶ä»£ç 
</code></pre>

<p>ï¼ˆè¿™é‡Œå…¶å® Hit-Testing è¿›è¡Œäº†ä¸¤æ¬¡ï¼Œå…³äºè¿™ä¸ªé—®é¢˜ï¼Œè‹¹æœå®˜æ–¹æœ‰ç›¸åº”çš„å›å¤ï¼‰</p>

<blockquote>
<p>Yes, itâ€™s normal. The system may tweak the point being hit tested between the calls. Since hitTest should be a pure function with no side-effects, this should be fine.</p>
</blockquote>

<h3 id="toc_8">å°ç»“</h3>

<p><strong>1. ç³»ç»Ÿé€šè¿‡Â <code>hitTest:withEvent:</code>Â æ–¹æ³•æ²¿è§†å›¾å±‚çº§æ ‘ä»åº•å‘ä¸Šï¼ˆä»æ ¹è§†å›¾å¼€å§‹ï¼‰ä»åå‘å‰ï¼ˆä»é€»è¾‘ä¸Šæ›´é è¿‘å±å¹•çš„è§†å›¾å¼€å§‹ï¼‰è¿›è¡Œéå†ï¼Œæœ€ç»ˆè¿”å›ä¸€ä¸ªé€‚åˆå“åº”è§¦æ‘¸äº‹ä»¶çš„ Viewã€‚</strong></p>

<p><strong>2. åŸç”Ÿè§¦æ‘¸äº‹ä»¶ä» Hit-Testing è¿”å›çš„ View å¼€å§‹ï¼Œæ²¿ç€å“åº”é“¾ä»ä¸Šå‘ä¸‹è¿›è¡Œä¼ é€’ã€‚</strong></p>

<p>æ¢æµ‹é“¾ä¸å“åº”é“¾çš„æœºåˆ¶æ€»ä½“æ¯”è¾ƒæ¸…æ™°ï¼Œä¸å†èµ˜è¿°ï¼Œä½†ç†Ÿæ‚‰è¿™ä¸¤ä¸ªæœºåˆ¶å¹¶ä¸èƒ½å¸®æˆ‘ä»¬è§£å†³ä»»ä½•é—®é¢˜ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ç»§ç»­æ·±å…¥æ¢ç©¶ä¸‹æ‰‹åŠ¿è¯†åˆ«å™¨ã€‚</p>

<h2 id="toc_9">æ‰‹åŠ¿è¯†åˆ«å™¨</h2>

<p>æˆ‘ä»¬é¦–å…ˆæ€è€ƒä¸€ä¸ªé—®é¢˜ï¼Œå¯¹äºå®˜æ–¹æ–‡æ¡£é‡Œçš„ Demoï¼Œæˆ‘ä»¬åœ¨æ¯ä¸ª View ä¸Šæ·»åŠ ä¸€ä¸ª UITapGestureRecognizerï¼Œå½“ç‚¹å‡» View D æ—¶ï¼ŒUITapGestureRecognizer ä¹‹é—´çš„å“åº”é¡ºåºæ˜¯ä»€ä¹ˆæ ·çš„ï¼Œå“ªä¸ª View ä¸Šçš„ UITapGestureRecognizer åˆä¼šæœ€ç»ˆå“åº”è¿™ä¸ªäº‹ä»¶ï¼Ÿ</p>

<h3 id="toc_10">å®˜æ–¹æ–‡æ¡£</h3>

<p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹å®˜æ–¹æ–‡æ¡£æ˜¯æ€ä¹ˆè¯´çš„ï¼š</p>

<blockquote>
<p>When a view has multiple gesture recognizers attached to it, you may want to alter how the competing gesture recognizers receive and analyze touch events. By default, there is no set order for which gesture recognizers receive a touch first, and for this reason touches can be passed to gesture recognizers in a different order each time. You can override this default behavior to:</p>

<ul>
<li><p>Specify that one gesture recognizer should analyze a touch before another gesture recognizer.</p></li>
<li><p>Allow two gesture recognizers to operate simultaneously.</p></li>
<li><p>Prevent a gesture recognizer from analyzing a touch.</p></li>
</ul>

<p>Use the UIGestureRecognizer class methods, delegate methods, and methods overridden by subclasses to effect these behaviors.</p>
</blockquote>

<p>æ ¹æ®æ–‡æ¡£çš„è¯´æ³•ï¼Œå½“è§¦æ‘¸äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œå“ªä¸ª UIGestureRecognizer å…ˆæ”¶åˆ°è¿™ä¸ªäº‹ä»¶å¹¶æ²¡æœ‰å›ºå®šçš„é¡ºåºï¼Œå¹¶ä¸”æ–‡æ¡£å»ºè®®æˆ‘ä»¬ä½¿ç”¨ UIGestureRecognizer æä¾›çš„æ–¹æ³•æ¥æ§åˆ¶å®ƒä»¬ä¹‹é—´çš„é¡ºåºå’Œç›¸äº’å…³ç³»ã€‚</p>

<h3 id="toc_11">UIGestureRecognizer Methods</h3>

<p>æ‰€ä»¥æˆ‘ä»¬ä¾æ¬¡çœ‹ä¸‹ç³»ç»Ÿçš„ UIGestureRecognizer éƒ½æä¾›äº†å“ªäº›ä¸å®ƒä»¬ä¹‹é—´ç›¸äº’å…³ç³»æœ‰å…³çš„æ–¹æ³•ï¼š</p>

<pre><code class="language-text">// create a relationship with another gesture recognizer that will prevent this gesture&#39;s actions from being called until otherGestureRecognizer transitions to UIGestureRecognizerStateFailed
// if otherGestureRecognizer transitions to UIGestureRecognizerStateRecognized or UIGestureRecognizerStateBegan then this recognizer will instead transition to UIGestureRecognizerStateFailed
// example usage: a single tap may require a double tap to fail
- (void)requireGestureRecognizerToFail:(UIGestureRecognizer *)otherGestureRecognizer;

// called once per attempt to recognize, so failure requirements can be determined lazily and may be set up between recognizers across view hierarchies
// return YES to set up a dynamic failure requirement between gestureRecognizer and otherGestureRecognizer
//
// note: returning YES is guaranteed to set up the failure requirement. returning NO does not guarantee that there will not be a failure requirement as the other gesture&#39;s counterpart delegate or subclass methods may return YES
- (BOOL)gestureRecognizer:(UIGestureRecognizer *)gestureRecognizer shouldRequireFailureOfGestureRecognizer:(UIGestureRecognizer *)otherGestureRecognizer NS_AVAILABLE_IOS(7_0);
- (BOOL)gestureRecognizer:(UIGestureRecognizer *)gestureRecognizer shouldBeRequiredToFailByGestureRecognizer:(UIGestureRecognizer *)otherGestureRecognizer NS_AVAILABLE_IOS(7_0);
å¤åˆ¶ä»£ç 
</code></pre>

<p>è¿™ä¸‰ä¸ªæ–¹æ³•æ¯”è¾ƒå¸¸ç”¨ï¼Œå®ƒä»¬å¯ä»¥æŒ‡å®š UIGestureRecognizer ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼ŒåŒºåˆ«åœ¨äºç¬¬ä¸€ä¸ªä¸€èˆ¬é€‚ç”¨äºåœ¨åŒä¸€ä¸ª View ä¸­åˆ›å»ºçš„å¤šä¸ª UIGestureRecognizer çš„åœºæ™¯ï¼Œå½“ View å±‚çº§æ¯”è¾ƒå¤æ‚æˆ–è€… UIGestureRecognizer å¤„äº Framework å†…éƒ¨æ—¶å¯ä»¥ç”¨åä¸¤ä¸ªæ–¹æ³•åŠ¨æ€æŒ‡å®šã€‚</p>

<pre><code class="language-text">// called when the recognition of one of gestureRecognizer or otherGestureRecognizer would be blocked by the other
// return YES to allow both to recognize simultaneously. the default implementation returns NO (by default no two gestures can be recognized simultaneously)
//
// note: returning YES is guaranteed to allow simultaneous recognition. returning NO is not guaranteed to prevent simultaneous recognition, as the other gesture&#39;s delegate may return YES
- (BOOL)gestureRecognizer:(UIGestureRecognizer *)gestureRecognizer shouldRecognizeSimultaneouslyWithGestureRecognizer:(UIGestureRecognizer *)otherGestureRecognizer;
å¤åˆ¶ä»£ç 
</code></pre>

<p>è¿™ä¸ªæ–¹æ³•å¯ä»¥æ§åˆ¶ä¸¤ä¸ª UIGestureRecognizer ä¹‹é—´æ˜¯å¦å¯ä»¥åŒæ—¶å¼‚æ­¥è¿›è¡Œï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå‡è®¾å­˜åœ¨ä¸¤ä¸ªå¯èƒ½ä¼šäº’ç›¸ block çš„ UIGestureRecognizerï¼Œç³»ç»Ÿä¼šåˆ†åˆ«å¯¹å®ƒä»¬çš„ delegate è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œåªè¦æœ‰ä¸€ä¸ªè¿”å› YESï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ª UIGestureRecognizer å°±å¯ä»¥åŒæ—¶è¿›è¡Œè¯†åˆ«ï¼Œè¿™ä¸Â <code>shouldRequireFailureOfGestureRecognizer</code>Â æ˜¯ç±»ä¼¼çš„ã€‚</p>

<pre><code class="language-text">// called before touchesBegan:withEvent: is called on the gesture recognizer for a new touch. return NO to prevent the gesture recognizer from seeing this touch
- (BOOL)gestureRecognizer:(UIGestureRecognizer *)gestureRecognizer shouldReceiveTouch:(UITouch *)touch;

// called when a gesture recognizer attempts to transition out of UIGestureRecognizerStatePossible. returning NO causes it to transition to UIGestureRecognizerStateFailed
- (BOOL)gestureRecognizerShouldBegin:(UIGestureRecognizer *)gestureRecognizer;
å¤åˆ¶ä»£ç 
</code></pre>

<p>è¿™ä¸¤ä¸ªæ–¹æ³•éƒ½æ˜¯ç”¨æ¥ç¦æ­¢ UIGestureRecognizer å“åº”è§¦æ‘¸äº‹ä»¶çš„ï¼ŒåŒºåˆ«åœ¨äºï¼Œå½“è§¦æ‘¸äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œä½¿ç”¨ç¬¬ä¸€ä¸ªæ–¹æ³•å¯ä»¥ç«‹å³æ§åˆ¶ UIGestureRecognizer æ˜¯å¦å¯¹å…¶å¤„ç†ï¼Œä¸”ä¸ä¼šä¿®æ”¹ UIGestureRecognizer çš„çŠ¶æ€æœºï¼ˆå› ä¸ºåœ¨è°ƒç”¨è‡ªèº«çš„Â <code>touchesBegan:withEvent:</code>Â ä¹‹å‰ï¼Œè¯¦è§ä¸‹ï¼‰ï¼Œè€Œç¬¬äºŒä¸ªæ–¹æ³•ä¼šç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œåœ¨ UIGestureRecognizer è¯†åˆ«æ‰‹åŠ¿è½¬æ¢çŠ¶æ€æ—¶è°ƒç”¨ï¼Œè¿”å› NO ä¼šæ”¹å˜å…¶çŠ¶æ€æœºï¼Œä½¿å…¶ state å˜ä¸ºÂ <code>UIGestureRecognizerStateFailed</code>ã€‚</p>

<p>æˆ‘ä»¬çœ‹ä¸‹å®˜æ–¹æ–‡æ¡£å¯¹è¿™ä¸¤ä¸ªæ–¹æ³•çš„è¯´æ˜ï¼š</p>

<blockquote>
<p>When a touch begins, if you can immediately determine whether or not your gesture recognizer should consider that touch, use thegestureRecognizer:shouldReceiveTouch: method. This method is called every time there is a new touch. Returning NO prevents the gesture recognizer from being notified that a touch occurred. The default value is YES. This method does not alter the state of the gesture recognizer.</p>

<p>If you need to wait as long as possible before deciding whether or not a gesture recognizer should analyze a touch, use thegestureRecognizerShouldBegin: delegate method. Generally, you use this method if you have a UIView or UIControl subclass with custom touch-event handling that competes with a gesture recognizer. Returning NO causes the gesture recognizer to immediately fail, which allows the other touch handling to proceed. This method is called when a gesture recognizer attempts to transition out of the Possible state, if the gesture recognition would prevent a view or control from receiving a touch.</p>

<p>You can use the gestureRecognizerShouldBegin:UIView method if your view or view controller cannot be the gesture recognizerâ€™s delegate. The method signature and implementation is the same.</p>
</blockquote>

<p>ç¬¬äºŒæ®µä»‹ç»äº†é€šå¸¸æƒ…å†µä¸‹ï¼Œå½“æˆ‘ä»¬çš„å­ç±» UIView æˆ– UIControl æœ‰å’Œ UIGestureRecognizer å†²çªçš„è‡ªå®šä¹‰è§¦æ‘¸äº‹ä»¶æ—¶ï¼Œå¯ä»¥ä½¿ç”¨Â <code>gestureRecognizerShouldBegin:</code>Â æ–¹æ³•è®© UIGestureRecognizer å¤±æ•ˆæ¥ä½¿è‡ªå®šä¹‰çš„è§¦æ‘¸äº‹ä»¶è¿›è¡Œå“åº”ã€‚ç¬¬ä¸‰æ®µè¯´æ˜äº†å½“æˆ‘ä»¬çš„ View ä¸æ˜¯ UIGestureRecognizer çš„ delegate æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ UIView ä¸­çš„Â <code>gestureRecognizerShouldBegin:</code>Â æ–¹æ³•ã€‚å…³äºè¿™ä¸¤æ®µçš„æ„æ€æˆ‘ä»¬ä¼šåœ¨åä¸¤èŠ‚å»è¯¦ç»†è§£é‡Šã€‚</p>

<pre><code class="language-text">// mirror of the touch-delivery methods on UIResponder
// UIGestureRecognizers aren&#39;t in the responder chain, but observe touches hit-tested to their view and their view&#39;s subviews
// UIGestureRecognizers receive touches before the view to which the touch was hit-tested
- (void)touchesBegan:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event;
- (void)touchesMoved:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event;
- (void)touchesEnded:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event;
- (void)touchesCancelled:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event;
- (void)touchesEstimatedPropertiesUpdated:(NSSet&lt;UITouch *&gt; *)touches NS_AVAILABLE_IOS(9_1);
å¤åˆ¶ä»£ç 
</code></pre>

<p>ä¸ UIResponder ä¸­çš„è§¦æ‘¸äº‹ä»¶ç›¸å…³çš„æ–¹æ³•ç›¸åŒï¼ŒUIGestureRecognizer æœ‰ä¸€å¥—è‡ªå·±çš„è§¦æ‘¸äº‹ä»¶çš„æ–¹æ³•ï¼ŒåŒºåˆ«åœ¨äºï¼ŒUIGestureRecognizer å¹¶ä¸åœ¨å“åº”é“¾ä¸­ï¼Œè¿™äº›æ–¹æ³•ä¸€èˆ¬æ˜¯å†™ç”¨æ¥å¯¹ç‰¹å®šçš„æ‰‹åŠ¿è¿›è¡Œåˆ¤æ–­å’Œè¯†åˆ«çš„é€»è¾‘ï¼Œä¾‹å¦‚æˆ‘ä»¬å¯ä»¥åœ¨å­ç±»ä¸­é‡å†™è¿™äº›æ–¹æ³•æ¥åˆ›å»ºè‡ªå·±çš„ UIGestureRecognizerã€‚ä½¿ç”¨Â <code>gestureRecognizer:shouldReceiveTouch:</code>Â å¯ä»¥è®©è¿™äº›æ–¹æ³•ä¸è¢«è°ƒç”¨ã€‚</p>

<p>è‡³æ­¤ï¼ŒUIGestureRecognizer å·²ç»ä¸ºæˆ‘ä»¬æä¾›äº†è¶³å¤Ÿå¤šçš„æ–¹æ³•æ¥æ§åˆ¶å®ƒä»¬ä¹‹é—´çš„ç›¸äº’å…³ç³»äº†ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥åœ¨ Demo ä¸­è¯•è¯•çœ‹ã€‚</p>

<h3 id="toc_12">Demo éªŒè¯</h3>

<p>å¯¹äºå®˜æ–¹æ–‡æ¡£ä¸­çš„ Demo çš„æ¯ä¸ª Viewï¼Œæˆ‘ä»¬å¢åŠ ä¸€ä¸ªç»§æ‰¿è‡ª UITapGestureRecognizer çš„ ZTTapGestureRecognizer å¹¶å®ç°ç›¸åº”çš„å›è°ƒï¼š</p>

<pre><code class="language-text">- (void)singleTapGesture
{
    NSLog(@&quot;A_singleTapGesture&quot;);
}

- (BOOL)gestureRecognizerShouldBegin:(UIGestureRecognizer *)gestureRecognizer
{
    NSLog(@&quot;A_view--- gestureRecognizerShouldBegin: %@ ---&quot;, gestureRecognizer.name);
    return YES;
}

- (BOOL)gestureRecognizer:(UIGestureRecognizer *)gestureRecognizer shouldReceiveTouch:(UITouch *)touch
{
    NSLog(@&quot;A_view--- gestureRecognizer shouldReceiveTouch: %@ ---&quot;, gestureRecognizer.name);
    return YES;
}

- (BOOL)gestureRecognizer:(UIGestureRecognizer *)gestureRecognizer shouldRecognizeSimultaneouslyWithGestureRecognizer:(UIGestureRecognizer *)otherGestureRecognizer
{
    NSLog(@&quot;A_view--- gestureRecognizer: %@ otherGestureRecognizer: %@ ---&quot;, gestureRecognizer.name, otherGestureRecognizer.name);
    return YES;
}

- (instancetype)initWithCoder:(NSCoder *)coder
{
    self = [super initWithCoder:coder];

    if (self)
    {
        ZTTapGestureRecognizer *tapGestureRecognizer = [[ZTTapGestureRecognizer alloc] initWithTarget:self action:@selector(singleTapGesture)];
        tapGestureRecognizer.name = @&quot;A_view_tapGestureRecognizer&quot;;
        tapGestureRecognizer.delegate = self;
        [self addGestureRecognizer:tapGestureRecognizer];
    }

    return self;
}
å¤åˆ¶ä»£ç 
</code></pre>

<p>åœ¨æˆ‘ä»¬å­ç±» ZTTapGestureRecognizer ä¸­é‡å†™çˆ¶ç±»å…³äºè§¦æ‘¸äº‹ä»¶çš„æ–¹æ³•ï¼š</p>

<pre><code class="language-text">@implementation ZTTapGestureRecognizer

- (void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event
{
    NSLog(@&quot;%@_touchesBegan&quot;, self.name);
    [super touchesBegan:touches withEvent:event];
}

- (void)touchesMoved:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event
{
    NSLog(@&quot;%@_touchesMoved&quot;, self.name);
    [super touchesMoved:touches withEvent:event];
}

// NSLog è¦å†™åœ¨ super åé¢æ¥è¯»å– state
- (void)touchesEnded:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event
{
    [super touchesEnded:touches withEvent:event];
    NSLog(@&quot;%@_touchesEndedWithState: %d&quot;, self.name, (int)self.state);
}

// NSLog è¦å†™åœ¨ super åé¢æ¥è¯»å– state
-(void)touchesCancelled:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event
{
    [super touchesCancelled:touches withEvent:event];
    NSLog(@&quot;%@_touchesCancelledWithState: %d&quot;, self.name, (int)self.state);
}

@end
å¤åˆ¶ä»£ç 
</code></pre>

<p>ç‚¹å‡» View Dï¼Œlog æ˜¾ç¤ºå¦‚ä¸‹ï¼š</p>

<pre><code class="language-text">è¿›å…¥A_View---hitTest withEvent ---
A_view--- pointInside withEvent ---
A_view--- pointInside withEvent --- isInside:1
è¿›å…¥C_View---hitTest withEvent ---
C_view---pointInside withEvent ---
C_view---pointInside withEvent --- isInside:1
è¿›å…¥E_View---hitTest withEvent ---
E_view---pointInside withEvent ---
E_view---pointInside withEvent --- isInside:0
ç¦»å¼€E_View---hitTest withEvent ---hitTestView:(null)
è¿›å…¥D_View---hitTest withEvent ---
D_view---pointInside withEvent ---
D_view---pointInside withEvent --- isInside:1
ç¦»å¼€D_View---hitTest withEvent ---hitTestView:&lt;DView: 0x104d31050; frame = (0 37; 240 61); autoresize = RM+BM; gestureRecognizers = &lt;NSArray: 0x281b77fc0&gt;; layer = &lt;CALayer: 0x2815e6ca0&gt;&gt;
ç¦»å¼€C_View---hitTest withEvent ---hitTestView:&lt;DView: 0x104d31050; frame = (0 37; 240 61); autoresize = RM+BM; gestureRecognizers = &lt;NSArray: 0x281b77fc0&gt;; layer = &lt;CALayer: 0x2815e6ca0&gt;&gt;
ç¦»å¼€A_View--- hitTest withEvent ---hitTestView:&lt;DView: 0x104d31050; frame = (0 37; 240 61); autoresize = RM+BM; gestureRecognizers = &lt;NSArray: 0x281b77fc0&gt;; layer = &lt;CALayer: 0x2815e6ca0&gt;&gt;
è¿›å…¥A_View---hitTest withEvent ---
A_view--- pointInside withEvent ---
A_view--- pointInside withEvent --- isInside:1
è¿›å…¥C_View---hitTest withEvent ---
C_view---pointInside withEvent ---
C_view---pointInside withEvent --- isInside:1
è¿›å…¥E_View---hitTest withEvent ---
E_view---pointInside withEvent ---
E_view---pointInside withEvent --- isInside:0
ç¦»å¼€E_View---hitTest withEvent ---hitTestView:(null)
è¿›å…¥D_View---hitTest withEvent ---
D_view---pointInside withEvent ---
D_view---pointInside withEvent --- isInside:1
ç¦»å¼€D_View---hitTest withEvent ---hitTestView:&lt;DView: 0x104d31050; frame = (0 37; 240 61); autoresize = RM+BM; gestureRecognizers = &lt;NSArray: 0x281b77fc0&gt;; layer = &lt;CALayer: 0x2815e6ca0&gt;&gt;
ç¦»å¼€C_View---hitTest withEvent ---hitTestView:&lt;DView: 0x104d31050; frame = (0 37; 240 61); autoresize = RM+BM; gestureRecognizers = &lt;NSArray: 0x281b77fc0&gt;; layer = &lt;CALayer: 0x2815e6ca0&gt;&gt;
ç¦»å¼€A_View--- hitTest withEvent ---hitTestView:&lt;DView: 0x104d31050; frame = (0 37; 240 61); autoresize = RM+BM; gestureRecognizers = &lt;NSArray: 0x281b77fc0&gt;; layer = &lt;CALayer: 0x2815e6ca0&gt;&gt;
D_view--- gestureRecognizer shouldReceiveTouch: D_view_tapGestureRecognizer ---
C_view--- gestureRecognizer shouldReceiveTouch: C_view_tapGestureRecognizer ---
A_view--- gestureRecognizer shouldReceiveTouch: A_view_tapGestureRecognizer ---
D_view_tapGestureRecognizer_touchesBegan
A_view_tapGestureRecognizer_touchesBegan
C_view_tapGestureRecognizer_touchesBegan
D_touchesBegan
C_touchesBegan
A_touchesBegan
D_view--- gestureRecognizerShouldBegin: D_view_tapGestureRecognizer ---
D_view_tapGestureRecognizer_touchesEndedWithState: 3
D_view--- gestureRecognizerShouldBegin: A_view_tapGestureRecognizer ---
A_view--- gestureRecognizerShouldBegin: A_view_tapGestureRecognizer ---
A_view_tapGestureRecognizer_touchesEndedWithState: 3
D_view--- gestureRecognizerShouldBegin: C_view_tapGestureRecognizer ---
C_view--- gestureRecognizerShouldBegin: C_view_tapGestureRecognizer ---
C_view_tapGestureRecognizer_touchesEndedWithState: 3
A_view--- gestureRecognizer: A_view_tapGestureRecognizer otherGestureRecognizer: (null) ---
C_view--- gestureRecognizer: C_view_tapGestureRecognizer otherGestureRecognizer: (null) ---
D_view--- gestureRecognizer: D_view_tapGestureRecognizer otherGestureRecognizer: (null) ---
A_view--- gestureRecognizer: A_view_tapGestureRecognizer otherGestureRecognizer: C_view_tapGestureRecognizer ---
A_view--- gestureRecognizer: A_view_tapGestureRecognizer otherGestureRecognizer: D_view_tapGestureRecognizer ---
C_view--- gestureRecognizer: C_view_tapGestureRecognizer otherGestureRecognizer: A_view_tapGestureRecognizer ---
C_view--- gestureRecognizer: C_view_tapGestureRecognizer otherGestureRecognizer: D_view_tapGestureRecognizer ---
D_view--- gestureRecognizer: D_view_tapGestureRecognizer otherGestureRecognizer: A_view_tapGestureRecognizer ---
D_view--- gestureRecognizer: D_view_tapGestureRecognizer otherGestureRecognizer: C_view_tapGestureRecognizer ---
A_singleTapGesture
D_touchesCancelled
C_touchesCancelled
A_touchesCancelled
C_singleTapGesture
D_singleTapGesture
å¤åˆ¶ä»£ç 
</code></pre>

<p>ä¿¡æ¯é‡æœ‰ç‚¹å¤§ï¼Œæˆ‘ä»¬ä¸€ç‚¹ä¸€ç‚¹æ¥åˆ†æï¼ˆ<strong>å…ˆå¿½ç•¥ View å“åº”é“¾é‡Œ UIResponder ç›¸å…³çš„è§¦æ‘¸äº‹ä»¶æ–¹æ³•ï¼Œè¿™äº›ä¼šåœ¨ä¸‹ä¸€èŠ‚è¿›è¡Œæ¢è®¨</strong>ï¼‰ï¼Œé¦–å…ˆç³»ç»Ÿé€šè¿‡ Hit-Testing æœºåˆ¶æ‰¾åˆ°äº†é€‚åˆå“åº”çš„ View Dï¼Œæ¥ä¸‹æ¥è°ƒç”¨äº†æ–¹æ³•ï¼š</p>

<pre><code class="language-text">D_view--- gestureRecognizer shouldReceiveTouch: D_view_tapGestureRecognizer ---
C_view--- gestureRecognizer shouldReceiveTouch: C_view_tapGestureRecognizer ---
A_view--- gestureRecognizer shouldReceiveTouch: A_view_tapGestureRecognizer ---
å¤åˆ¶ä»£ç 
</code></pre>

<p>ä¸Šæ–‡å·²ç»å¯¹Â <code>gestureRecognizer:shouldReceiveTouch:</code>Â è§£é‡Šè¿‡ï¼Œå…ˆè°ƒç”¨å®ƒæ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œä½†æ˜¯åœ¨å¤šæ¬¡å®éªŒä¸­ï¼Œä¸€ç›´éƒ½æ˜¯ D C A çš„é¡ºåºï¼Œè€Œ UIGestureRecognizer å…¶ä»–çš„ Delegate Method å´æœ‰å¯èƒ½æ˜¯ä¸åŒçš„é¡ºåºï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p>

<p>æˆ‘ä»¬æ¥çœ‹ä¸‹ View D è¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨æ ˆï¼š</p>

<p><img src="media/15654059537017/15654062505074.jpg" alt=""/></p>

<p>å¯ä»¥çœ‹åˆ°ï¼ŒUITouchesEvent éå†äº†ä¸€ä¸ª View æ•°ç»„ï¼Œç³»ç»Ÿé€šè¿‡ Hit-Testing è¿‡ç¨‹å¾—åˆ°äº†é€‚åˆå“åº”è§¦æ‘¸äº‹ä»¶çš„ View Dï¼Œéšåä¼šæ ¹æ®è¿™ä¸ª View çš„å±‚çº§å…³ç³»å¾—åˆ°ä¸€ä¸ªå“åº”é“¾ View æ•°ç»„ [D_view, C_view, A_view, ..., ZTWindow] ç„¶åéå†è¿™ä¸ªæ•°ç»„å»ä¾æ¬¡åˆ¤æ–­æ¯ä¸ª View ä¸Šçš„ UIGestureRecognizer æ˜¯å¦è¦æ¥æ”¶è§¦æ‘¸äº‹ä»¶ï¼Œæ²¡æœ‰ç»‘å®šåˆ°è¿™ä¸ªå“åº”é“¾ View æ•°ç»„ä¸Šçš„ UIGestureRecognizer ä¸å†æœ‰æœºä¼šå»å¤„ç†è§¦æ‘¸äº‹ä»¶ï¼Œå…³äºåŸå› åé¢ä¼šè§£é‡Šã€‚</p>

<p>æ¥ä¸‹æ¥è°ƒç”¨äº†æ–¹æ³•ï¼š</p>

<pre><code class="language-text">D_view_tapGestureRecognizer_touchesBegan
A_view_tapGestureRecognizer_touchesBegan
C_view_tapGestureRecognizer_touchesBegan

D_view--- gestureRecognizerShouldBegin: D_view_tapGestureRecognizer ---
D_view_tapGestureRecognizer_touchesEndedWithState: 3
D_view--- gestureRecognizerShouldBegin: A_view_tapGestureRecognizer ---
A_view--- gestureRecognizerShouldBegin: A_view_tapGestureRecognizer ---
A_view_tapGestureRecognizer_touchesEndedWithState: 3
D_view--- gestureRecognizerShouldBegin: C_view_tapGestureRecognizer ---
C_view--- gestureRecognizerShouldBegin: C_view_tapGestureRecognizer ---
C_view_tapGestureRecognizer_touchesEndedWithState: 3
å¤åˆ¶ä»£ç 
</code></pre>

<p>View A ä¸­Â <code>gestureRecognizerShouldBegin:</code>Â æ–¹æ³•çš„è°ƒç”¨æ ˆï¼š</p>

<p><img src="media/15654059537017/15654062776619.jpg" alt=""/></p>

<p>ç”±äºæˆ‘ä»¬çš„Â <code>gestureRecognizer:shouldReceiveTouch:</code>Â éƒ½è¿”å›äº† YESï¼Œ3ä¸ª View ä¸Šçš„ UIGestureRecognizer åˆ†åˆ«æ”¶åˆ°äº†Â <code>touchesBegan</code>Â å’ŒÂ <code>touchesEnd</code>Â ç­‰è§¦æ‘¸äº‹ä»¶ç›¸å…³çš„ æ–¹æ³•å¹¶å¼€å§‹å¯¹è§¦æ‘¸æ‰‹åŠ¿è¿›è¡Œè¯†åˆ«ã€‚ä»è°ƒç”¨æ ˆä¸­å¯ä»¥çœ‹å‡ºï¼Œåœ¨Â <code>touchesEnd</code>Â æ–¹æ³•ä¸­æ‰‹åŠ¿è¯†åˆ«å®Œæˆä¹‹åå³å°†è¿›è¡ŒçŠ¶æ€è½¬æ¢ä¹‹å‰è°ƒç”¨äº†Â <code>gestureRecognizerShouldBegin:</code>Â æ–¹æ³•åˆ¤æ–­æ˜¯å¦åº”è¯¥è¿›è¡Œæ‰‹åŠ¿è¯†åˆ«æˆåŠŸçš„çŠ¶æ€è½¬æ¢ï¼Œç”±äºæˆ‘ä»¬çš„æ–¹æ³•éƒ½è¿”å›äº† YESï¼Œå¯ä»¥çœ‹åˆ°åœ¨Â <code>touchesEnd</code>Â æ–¹æ³•å®Œæˆä¹‹å3ä¸ª UIGestureRecognizer éƒ½æˆåŠŸè¯†åˆ«äº†æ‰‹åŠ¿å¹¶ä¸”è‡ªèº«çš„ state éƒ½å˜æˆäº†Â <code>UIGestureRecognizerStateEnded</code>ï¼Œè¿™äº›ä¸æˆ‘ä»¬ä¸Šä¸€å°èŠ‚çš„æè¿°æ˜¯ç›¸ç¬¦çš„ã€‚</p>

<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¯¹äº A_view_tapGestureRecognizer å’Œ C_view_tapGestureRecognizer æ¥è¯´ï¼Œé™¤äº†å®ƒä»¬å„è‡ªçš„ delegateï¼Œæœ€ä¸Šå±‚çš„ View D ä¹Ÿæ”¶åˆ°äº†ä»–ä»¬çš„Â <code>gestureRecognizerShouldBegin:</code>Â å›è°ƒï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå›é¡¾ä¸Šä¸€å°èŠ‚å…³äºè¿™ä¸ªæ–¹æ³•å®˜æ–¹æ–‡æ¡£çš„è§£é‡Šï¼ŒUIView è‡ªèº«ä¹Ÿæœ‰ä¸€ä¸ªÂ <code>gestureRecognizerShouldBegin:</code>Â æ–¹æ³•ï¼Œå½“ View ä¸æ˜¯ UIGestureRecognizer çš„ delegate æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–¹æ³•æ¥ä½¿ UIGestureRecognizer å¤±æ•ˆã€‚å¯¹äºæ‰€æœ‰ç»‘å®šåˆ°çˆ¶ View ä¸Šçš„ UIGestureRecognizerï¼Œé™¤äº†å®ƒä»¬æœ¬èº«çš„ delegate ä¹‹å¤–ï¼ŒHit-Testing è¿”å›çš„ View ä¹Ÿä¼šæ”¶åˆ°è¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨ï¼Œå…³äºåŸå› æˆ‘ä»¬ä¼šåœ¨ä¸‹ä¸€èŠ‚è¿›è¡Œè§£é‡Šã€‚</p>

<p>æ¥ä¸‹æ¥çš„ log æ˜¯ UIGestureRecognizer æ˜¯å¦å¯ä»¥åŒæ—¶å¤„ç†è§¦æ‘¸äº‹ä»¶çš„å›è°ƒæ–¹æ³•ï¼Œå…¶ä¸­çš„ null æ˜¯ç³»ç»Ÿçš„æ‰‹åŠ¿ UIScreenEdgePanGestureRecognizerï¼Œç”±äº Demo ä½¿ç”¨äº† UINavigationController ç³»ç»Ÿä¼šé¦–å…ˆåˆ¤æ–­è¿™ä¸ªæ‰‹åŠ¿æ³•æ˜¯å¦èƒ½åŒæ—¶å“åº”ã€‚å¯ä»¥çœ‹åˆ°ï¼Œç”±äºè¿™3ä¸ª View ä¸Šä¸€å…±å­˜åœ¨3ä¸ª UIGestureRecognizerï¼Œç³»ç»Ÿä¸€å…±è°ƒç”¨äº†6æ¬¡å›è°ƒæ–¹æ³•æ‰å¯ä»¥ç¡®å®šå®ƒä»¬ä¹‹é—´çš„å…³ç³»ï¼Œè¿™å’Œæˆ‘ä»¬ä¸Šæ–‡å¯¹è¯¥æ–¹æ³•çš„æè¿°ç›¸ç¬¦ã€‚</p>

<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒUIGestureRecognizer è§¦æ‘¸äº‹ä»¶ç›¸å…³çš„æ–¹æ³•Â <code>touchesBegan</code>Â ç­‰å’ŒÂ <code>gestureRecognizerShouldBegin:</code>Â å¯¹äº View A C D æ¥è¯´æ¯æ¬¡è¿è¡Œé¡ºåºæ˜¯ä¸ä¸€æ ·çš„ï¼ˆ<code>gestureRecognizer:shouldReceiveTouch:</code>Â æ¯æ¬¡éƒ½æ˜¯ D C Aï¼‰ï¼Œä½†æœ€ç»ˆ UIGestureRecognizer çš„ Action Method çš„é¡ºåºå´ä¸€å®šæ˜¯ A C Dï¼š</p>

<pre><code class="language-text">A_singleTapGesture
C_singleTapGesture
D_singleTapGesture
å¤åˆ¶ä»£ç 
</code></pre>

<p>åŒæ—¶ï¼Œå½“Â <code>shouldRecognizeSimultaneouslyWithGestureRecognizer</code>Â éƒ½è¿”å› NO æ—¶ï¼ŒView D ä¸Šçš„ UIGestureRecognizer å¯ä»¥å“åº”æˆåŠŸã€‚è¿™åˆæ˜¯ä»€ä¹ˆåŸå› å‘¢ï¼Ÿ</p>

<p>æˆ‘ä»¬åœ¨ä¸Šä¸€æ­¥ UITouchesEvent éå†å“åº”é“¾ View æ•°ç»„çš„è¿‡ç¨‹ä¸­å¾—åˆ°äº†ä¸€ä¸ª UIGestureRecognizer æ•°ç»„ [D_view_tapGestureRecognizer, C_view_tapGestureRecognizer, A_view_tapGestureRecognizer] éšåç³»ç»Ÿéå†äº†è¿™ä¸ªæ•°ç»„æ¥è¿›è¡Œå¤„ç†ï¼Œè¿™é‡ŒçŒœæµ‹å®ƒä»¬çš„Â <code>touchesBegan</code>Â ç­‰æ–¹æ³•çš„é¡ºåºåº”è¯¥ä¸å…·ä½“çš„å®ç°æœ‰å…³ï¼ˆä¸ªäººçŒœæµ‹å¯èƒ½ä¸ UIGestureEnvironment é‡Œä¿å­˜çš„ UIGestureRecognizer çš„æ•°æ®ç»“æ„å®é™…ä¸Šä¸æ˜¯æ•°ç»„è€Œæ˜¯å›¾æœ‰å…³ç³»ï¼‰ï¼Œè€Œ Action Method çš„é¡ºåºä»¥åŠæœ€åç¡®ä¿ View D ä¸Šçš„ UIGestureRecognizer èƒ½å¤Ÿå“åº”æˆåŠŸåº”è¯¥ä¹Ÿæ˜¯ç›®å‰å®˜æ–¹æœªè¯´æ˜çš„æŸç§æœºåˆ¶ã€‚</p>

<p>è¿˜æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>gestureRecognizer:shouldReceiveTouch:</code>Â ä¸å…¶ä»–çš„æ–¹æ³•ä¸å±äºç›¸åŒçš„è°ƒç”¨æ ˆï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹å…¶ä»–æ–¹æ³•çš„è°ƒç”¨æ ˆï¼š</p>

<p><img src="media/15654059537017/15654062975213.jpg" alt=""/></p>

<p><img src="media/15654059537017/15654063204292.jpg" alt=""/></p>

<p>å¯ä»¥çœ‹åˆ°ï¼Œæœ€å…ˆç”± UIApplication é€šè¿‡Â <code>sendEvent:</code>Â å‘é€äº† UIEvent äº‹ä»¶ï¼Œç„¶åè¢« UIWindow è½¬å‘ç»™äº† UIGestureEnvironmentï¼Œè€Œ UIGestureEnvironment é€šè¿‡éå†ä¸€ä¸ª UIGestureRecognizer æ•°ç»„æ¥è°ƒèµ·ç›¸å…³çš„ UIGestureRecognizer æ–¹æ³•ã€‚</p>

<p>åˆ°æ­¤ä¸ºæ­¢ï¼Œæ•´ä¸ªè¿‡ç¨‹ä»ç„¶æœ‰å¾ˆå¤šç–‘ç‚¹ï¼Œæˆ‘ä»¬é‡æ–°è¿›è¡Œä¸‹æ¢³ç†ã€‚</p>

<h3 id="toc_13">UIEvent ä¸ UIGestureEnvironment</h3>

<p>å®é™…ä¸Šï¼Œç³»ç»Ÿæœ€å…ˆé€šè¿‡ Hit-Testing æœºåˆ¶æ¥å¯¹ UIEvent è¿›è¡Œäº†åŒ…è£…ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸‹ UIEvent è¿™ä¸ªç±»ï¼š</p>

<pre><code class="language-text">NS_CLASS_AVAILABLE_IOS(2_0) @interface UIEvent : NSObject

@property(nonatomic,readonly) UIEventType     type NS_AVAILABLE_IOS(3_0);
@property(nonatomic,readonly) UIEventSubtype  subtype NS_AVAILABLE_IOS(3_0);

@property(nonatomic,readonly) NSTimeInterval  timestamp;

#if UIKIT_DEFINE_AS_PROPERTIES
@property(nonatomic, readonly, nullable) NSSet &lt;UITouch *&gt; *allTouches;
#else
- (nullable NSSet &lt;UITouch *&gt; *)allTouches;
#endif
- (nullable NSSet &lt;UITouch *&gt; *)touchesForWindow:(UIWindow *)window;
- (nullable NSSet &lt;UITouch *&gt; *)touchesForView:(UIView *)view;
- (nullable NSSet &lt;UITouch *&gt; *)touchesForGestureRecognizer:(UIGestureRecognizer *)gesture NS_AVAILABLE_IOS(3_2);

@end
å¤åˆ¶ä»£ç 
</code></pre>

<p>å¯ä»¥çœ‹åˆ° UIEvent æ‰€æœ‰çš„å±æ€§éƒ½æ˜¯åªè¯»ä»¥é˜²æ­¢è¢«ä¿®æ”¹ï¼Œåœ¨ View A çš„Â <code>hitTest:withEvent:</code>Â æ–¹æ³•ä¸­ï¼Œå®é™…ä¼ é€’çš„æ˜¯å®ƒçš„å­ç±» UITouchesEventï¼š</p>

<p><img src="media/15654059537017/15654063416976.jpg" alt=""/></p>

<p>åœ¨ Hit-Testing é˜¶æ®µï¼ŒUIEvent åªåŒ…å«äº†ä¸€ä¸ªæ—¶é—´æˆ³ä¿¡æ¯ï¼Œæˆ‘ä»¬åœ¨ View A çš„Â <code>hitTest:withEvent:</code>æ–¹æ³•ä¸­æ‰“æ–­ç‚¹æ¥æŸ¥çœ‹ä¸‹ UITouchesEvent çš„å†…å®¹ï¼š</p>

<p><img src="media/15654059537017/15654063597676.jpg" alt=""/></p>

<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç»§æ‰¿ UIWindow æ¥æˆªè·Â <code>sendEvent:</code>Â äº‹ä»¶ï¼Œå¹¶æ‰“æ–­ç‚¹æ¥æŸ¥çœ‹æ­¤æ—¶ UIEvent çš„ä¿¡æ¯ï¼Œæ­¤æ—¶ UIEvent ä¸­å¤šäº† UITouchï¼š</p>

<p><img src="media/15654059537017/15654063714528.jpg" alt=""/></p>

<pre><code class="language-text">Printing description of event:
&lt;UITouchesEvent: 0x2819a8120&gt; timestamp: 875742 touches: {(
    &lt;UITouch: 0x11bd35960&gt; phase: Began tap count: 1 force: 0.000 window: &lt;UIWindow: 0x11bd1c610; frame = (0 0; 414 736); gestureRecognizers = &lt;NSArray: 0x2825c94d0&gt;; layer = &lt;UIWindowLayer: 0x282bb5900&gt;&gt; view: &lt;DView: 0x11be2faa0; frame = (0 37; 240 61); autoresize = RM+BM; gestureRecognizers = &lt;NSArray: 0x2825f2a60&gt;; layer = &lt;CALayer: 0x282b894a0&gt;&gt; location in window: {234.66665649414062, 482.66665649414062} previous location in window: {234.66665649414062, 482.66665649414062} location in view: {147.66665649414062, 35.666656494140625} previous location in view: {147.66665649414062, 35.666656494140625}
)}
å¤åˆ¶ä»£ç 
</code></pre>

<p>æ ¹æ® UIEvent å’Œ UITouchesEvent çš„ API å’Œä»¥ä¸Šä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥æ¨æ–­ï¼Œç³»ç»Ÿé€šè¿‡ Hit-Testing è®°å½•äº†é€‚åˆå“åº”è§¦æ‘¸äº‹ä»¶çš„ View ä¸ Window ç­‰ä¿¡æ¯ï¼Œåœ¨ Hit-Testing å®Œæˆä¹‹åï¼Œåˆ›å»ºäº† UITouch å¹¶å°†å…¶ä¿å­˜åœ¨ UIEvent ä¸­è¿›è¡Œå‘é€ã€‚UIApplication èƒ½å¤Ÿé€šè¿‡Â <code>sendEvent:</code>Â æ–¹æ³•å‘é€äº‹ä»¶ç»™æ­£ç¡®çš„ UIWindow æ­£æ˜¯ç”±äºåœ¨ Hit-Testing è¿‡ç¨‹ä¸­ç³»ç»Ÿè®°å½•äº†èƒ½å¤Ÿå“åº”è§¦æ‘¸äº‹ä»¶çš„ Windowã€‚</p>

<p>è€Œ UITouch ä¸­çš„ UIGestureRecognizer æ•°ç»„æ­£æ˜¯é€šè¿‡å‰é¢æåˆ°çš„Â <code>gestureRecognizer:shouldReceiveTouch:</code>Â æ¥ç”Ÿæˆçš„ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹åœ¨ Hit-Testing å®Œæˆä¹‹åï¼Œ<code>sendEvent:</code>Â è°ƒç”¨ä¹‹å‰ï¼ŒView D çš„Â <code>gestureRecognizer:shouldReceiveTouch:</code>Â æ–¹æ³•ä¸­çš„ UITouchï¼š</p>

<p><img src="media/15654059537017/15654063890469.jpg" alt=""/></p>

<p>æ­¤æ—¶ï¼ŒWindow å’Œ DView å·²ç»é€šè¿‡ Hit-Testing æ‰¾åˆ°ï¼Œä½†æ˜¯Â <code>_gestureRecognizers</code>Â ä»ç„¶ä¸ºç©ºï¼Œè€Œåœ¨è¯¥æ–¹æ³•è¿”å› YES ä¹‹åï¼Œæˆ‘ä»¬åœ¨ View C çš„Â <code>gestureRecognizer:shouldReceiveTouch:</code>Â æ–¹æ³•ä¸­å¯ä»¥çœ‹åˆ°ï¼š</p>

<p><img src="media/15654059537017/15654064024881.jpg" alt=""/></p>

<p>æ­¤æ—¶ D_view_tapGestureRecognizer å·²ç»è¢«æ·»åŠ åˆ°äº†æ•°ç»„ä¸­ï¼ŒåŒæ ·çš„ï¼Œåœ¨ View A çš„æ–¹æ³•ä¸­ï¼ŒC_view_tapGestureRecognizer è¢«æ·»åŠ åˆ°äº†æ•°ç»„ä¸­ï¼Œåœ¨æœ€ç»ˆçš„ UIEvent ä¸­çš„ UITouch é‡Œï¼Œ3ä¸ª UIGestureRecognizer éƒ½è¢«ä¿å­˜äº†èµ·æ¥ï¼Œæ‰€ä»¥ UIApplication æ‰çŸ¥é“å¦‚ä½•å‘æ­£ç¡®çš„ UIGestureRecognizer å‘é€è§¦æ‘¸äº‹ä»¶ã€‚</p>

<p>æ¥ä¸‹æ¥è¯´ä¸‹ UIGestureEnvironmentï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºå®ƒæ˜¯ç®¡ç†æ‰€æœ‰æ‰‹åŠ¿çš„ä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œå½“è°ƒç”¨Â <code>addGestureRecognizer:</code>Â æ–¹æ³•æ—¶ä¼šå°† UIGestureRecognizer åŠ å…¥åˆ°å…¶ä¸­ã€‚ä¸‹é¢æ˜¯ UIGestureEnvironment çš„ç»“æ„ï¼š</p>

<pre><code class="language-text">@interface UIApplication : UIResponder  {
    UIGestureEnvironment * __gestureEnvironment;
    }
@end

@interface UIGestureRecognizer : NSObject {
    UIGestureEnvironment * _gestureEnvironment;
    }
@end

@interface UIGestureEnvironment : NSObject {

    CFRunLoopObserverRef _gestureEnvironmentUpdateObserver;
    NSMutableSet* _gestureRecognizersNeedingUpdate;
    NSMutableSet* _gestureRecognizersNeedingReset;
    NSMutableSet* _gestureRecognizersNeedingRemoval;
    NSMutableArray* _dirtyGestureRecognizers;
    NSMutableArray* _delayedTouches;
    NSMutableArray* _delayedTouchesToSend;
    NSMutableArray* _delayedPresses;
    NSMutableArray* _delayedPressesToSend;
    NSMutableArray* _preUpdateActions;
    bool _dirtyGestureRecognizersUnsorted;
    bool _updateExclusivity;
    UIGestureGraph* _dependencyGraph;
    NSMapTable* _nodesByGestureRecognizer;

}

-(void)addGestureRecognizer:(id)arg1 ;
-(void)removeGestureRecognizer:(id)arg1 ;
-(void)_cancelGestureRecognizers:(id)arg1 ;
-(void)_updateGesturesForEvent:(id)arg1 window:(id)arg2 ;
ï¼ˆçœç•¥äº†å¾ˆå¤š APIï¼‰
-(void)_cancelTouches:(id)arg1 event:(id)arg2 ;
-(void)_cancelPresses:(id)arg1 event:(id)arg2 ;
@end
å¤åˆ¶ä»£ç 
</code></pre>

<p>UIApplication å’Œ UIGestureRecognizer ä¸­ä¿å­˜äº†åŒä¸€ä¸ª UIGestureEnvironment å¯¹è±¡ï¼Œæ ¹æ®ä¸Šé¢ UIGestureRecognizer çš„ Action Method çš„è°ƒç”¨æ ˆï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒUIWindow é€šè¿‡Â <code>sendEvent:</code>å‘é€äº‹ä»¶ä¹‹åï¼ŒUIGestureEnvironment æ¥æ”¶äº†è¿™ä¸ªäº‹ä»¶å¹¶ä¸”æœ€ç»ˆé€šè¿‡æ–¹æ³•ï¼š</p>

<pre><code class="language-text">-[UIGestureEnvironment _updateForEvent:window:] ()
-[UIGestureEnvironment _deliverEvent:toGestureRecognizers:usingBlock:] ()
å¤åˆ¶ä»£ç 
</code></pre>

<p>æ¥å¯¹ UIGestureRecognizer ç›¸å…³æ–¹æ³•è¿›è¡Œè°ƒç”¨ï¼š</p>

<ol>
<li>å¯¹èƒ½å¤Ÿå¤„ç†äº‹ä»¶çš„ UIGestureRecognizer å‘é€Â <code>touchesBegan:withEvent:</code>Â ç­‰è§¦æ‘¸äº‹ä»¶çš„æ–¹æ³•</li>
<li>é€šè¿‡Â <code>gestureRecognizerShouldBegin</code>Â æ–¹æ³•åˆ¤æ–­æ˜¯å¦åº”è¯¥è¿›è¡ŒçŠ¶æ€è½¬æ¢</li>
<li>è¯¢é—® UIGestureRecognizer çš„ delegate æ˜¯å¦åº”è¯¥å¤±æ•ˆæˆ–è€…æ˜¯å¦èƒ½å¤ŸåŒæ—¶å¤„ç†äº‹ä»¶<code>gestureRecognizer:shouldRequireFailureOfGestureRecognizer:</code><code>gestureRecognizer:shouldRecognizeSimultaneouslyWithGestureRecognizer:</code></li>
<li>UIGestureRecognizer è¯†åˆ«äº‹ä»¶ä¹‹åæœ€ç»ˆè°ƒç”¨äº† Action Method</li>
</ol>

<h3 id="toc_14">å°ç»“</h3>

<p><strong>1. ç³»ç»Ÿåœ¨æ¢æµ‹é˜¶æ®µç»“æŸååˆ›å»ºäº† UITouchï¼Œå¹¶å°è£…äº† UIEvent å°†å…¶ä¼ é€’ã€‚</strong></p>

<p><strong>2. æ‰‹åŠ¿ä¸Šä¸‹æ–‡ UIGestureEnvironment æœ€å…ˆæ”¶åˆ° UIEventï¼Œå¹¶è´Ÿè´£é€šçŸ¥ç»™ç›¸å…³çš„ UIGestureRecognizerã€‚</strong></p>

<p><strong>3. UIGestureEnvironment æ ¹æ® UIGestureRecognizer çš„ delegate æ–¹æ³•æ¥åˆ¤æ–­å…¶æ˜¯å¦èƒ½å¤Ÿå¯¹è§¦æ‘¸äº‹ä»¶è¿›è¡Œå“åº”ã€‚</strong></p>

<p>è‡³æ­¤ï¼ŒUIGestureRecognizer å¯¹äº‹ä»¶çš„å¤„ç†ä»¥åŠå®ƒä»¬ä¹‹é—´çš„ç›¸äº’å…³ç³»å‘Šä¸€æ®µè½ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå»ºè®®æœ€å¥½ä½¿ç”¨å®˜æ–¹æ–‡æ¡£æ¨èçš„æ–¹æ³•å¯¹ UIGestureRecognizer è¿›è¡Œæ§åˆ¶ï¼Œè€Œä¸è¦ä¾èµ–ä¸Šæ–‡ä¸­æ²¡æœ‰å­˜åœ¨äºæ–‡æ¡£ä¸­çš„å…·ä½“å®ç°ç»†èŠ‚å’Œç»“è®ºï¼Œè‹¹æœæ²¡æœ‰å¯¹å¤–æš´éœ²è¿™äº›ï¼Œæœ‰å¯èƒ½ä¼šåœ¨æ¥ä¸‹æ¥çš„ç‰ˆæœ¬ä¸­ä¿®æ”¹å…·ä½“å®ç°ã€‚</p>

<h2 id="toc_15">æ‰‹åŠ¿è¯†åˆ«å™¨ä¸åŸç”Ÿè§¦æ‘¸äº‹ä»¶</h2>

<p>æ¥ä¸‹æ¥æˆ‘ä»¬ç»ˆäºå¯ä»¥å¯¹ä¸Šä¸€èŠ‚ä¸­ UIResponder ç›¸å…³çš„ç³»ç»ŸåŸç”Ÿè§¦æ‘¸äº‹ä»¶æ–¹æ³•è¿›è¡Œæ¢è®¨äº†ï¼Œæˆ‘ä»¬å»æ‰ Hit-Testing ä¸ UIGestureRecognizer çš„ delegate ç­‰ç›¸å…³æ–¹æ³•ï¼Œé‡æ–°è¿è¡Œ Demoï¼Œç‚¹å‡» View Dï¼Œlog æ˜¾ç¤ºå¦‚ä¸‹ï¼š</p>

<pre><code class="language-text">A_view_tapGestureRecognizer_touchesBegan
D_view_tapGestureRecognizer_touchesBegan
C_view_tapGestureRecognizer_touchesBegan
D_touchesBegan
C_touchesBegan
A_touchesBegan
A_singleTapGesture
D_touchesCancelled
C_touchesCancelled
A_touchesCancelled
C_singleTapGesture
D_singleTapGesture
å¤åˆ¶ä»£ç 
</code></pre>

<h3 id="toc_16">å®˜æ–¹æ–‡æ¡£</h3>

<p>æŒ‰ç…§æƒ¯ä¾‹ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹å®˜æ–¹æ–‡æ¡£æ˜¯æ€ä¹ˆè¯´çš„ï¼š</p>

<blockquote>
<p>There may be times when you want a view to receive a touch before a gesture recognizer. But, before you can alter the delivery path of touches to views, you need to understand the default behavior. In the simple case, when a touch occurs, the touch object is passed from the UIApplication object to the UIWindow object. Then, the window first sends touches to any gesture recognizers attached the view where the touches occurred (or to that viewâ€™s superviews), before it passes the touch to the view object itself.</p>

<p>Gesture Recognizers Get the First Opportunity to Recognize a Touch</p>

<p>A window delays the delivery of touch objects to the view so that the gesture recognizer can analyze the touch first. During the delay, if the gesture recognizer recognizes a touch gesture, then the window never delivers the touch object to the view, and also cancels any touch objects it previously sent to the view that were part of that recognized sequence.</p>
</blockquote>

<p><img src="media/15654059537017/15654064332119.jpg" alt=""/></p>

<p>æ–‡æ¡£å®é™…ä¸Šè¯´çš„æ¯”è¾ƒæ¸…æ¥šï¼šUIWindow ä¼šå…ˆå°†è§¦æ‘¸äº‹ä»¶å‘é€ç»™ Hit-Testing è¿”å›çš„ View å’Œå®ƒçš„çˆ¶ View ä¸Šçš„ UIGestureRecognizerï¼Œç„¶åæ‰ä¼šå‘é€ç»™è¿™ä¸ª View æœ¬èº«ï¼Œå¦‚æœ UIGestureRecognizer æˆåŠŸè¯†åˆ«äº†è¿™ä¸ªæ‰‹åŠ¿ï¼Œä¹‹å UIWindow ä¸ä¼šå†å‘ View å‘é€è§¦æ‘¸äº‹ä»¶ï¼Œå¹¶ä¸”ä¼šå–æ¶ˆä¹‹å‰å‘é€çš„è§¦æ‘¸äº‹ä»¶ã€‚</p>

<p>ä¸‹é¢è®©æˆ‘ä»¬å›åˆ° Demo æ¥è¿›è¡ŒéªŒè¯ã€‚</p>

<h3 id="toc_17">Demo éªŒè¯</h3>

<p>ä» log ä¸Šçœ‹ï¼Œç°è±¡ä¸å®˜æ–¹æ–‡æ¡£çš„è¯´æ³•å»åˆï¼Œæˆ‘ä»¬ç”¨å‡ ä¸ªè°ƒç”¨æ ˆæ¥å¯¹å…¶è¿›è¡Œè¿›ä¸€æ­¥è¯æ˜ï¼š</p>

<p>ZTTapGestureRecognizer çš„Â <code>touchesBegan:withEvent:</code>Â çš„è°ƒç”¨æ ˆ:</p>

<p><img src="media/15654059537017/15654064509943.jpg" alt=""/></p>

<p>View D çš„Â <code>touchesBegan:withEvent:</code>Â çš„è°ƒç”¨æ ˆï¼š</p>

<p><img src="media/15654059537017/15654064661803.jpg" alt=""/></p>

<p>View D çš„Â <code>touchesCancelled:withEvent:</code>Â çš„è°ƒç”¨æ ˆï¼š</p>

<p><img src="media/15654059537017/15654064771703.jpg" alt=""/></p>

<p>å¯ä»¥çœ‹åˆ°ï¼ŒUIWindow é¦–å…ˆé€šè¿‡Â <code>sendEvent:</code>Â æ–¹æ³•ç»è¿‡ UIGestureEnvironment å‘é€è§¦æ‘¸äº‹ä»¶ç»™äº† ZTTapGestureRecognizerï¼Œéšåé€šè¿‡Â <code>sendTouchesForEvent:</code>Â æ–¹æ³•å‘é€è§¦æ‘¸äº‹ä»¶ç»™ View D å¹¶æ²¿ç€å“åº”é“¾ä¼ é€’ï¼Œè€Œå½“ A_view_tapGestureRecognizer ç¬¬ä¸€ä¸ªæˆåŠŸè¯†åˆ«æ‰‹åŠ¿ä¹‹åï¼ŒUIGestureEnvironment å‘èµ·å“åº”é“¾çš„ cancel å¹¶ç»è¿‡ UIApplication å‘é€ç»™ View D å¹¶æ²¿ç€å“åº”é“¾å–æ¶ˆã€‚</p>

<h3 id="toc_18">UIGestureRecognizer Properties</h3>

<p>UIGestureRecognizer æœ‰ä¸€äº›ä¸å“åº”é“¾è§¦æ‘¸äº‹ä»¶ç›¸å…³çš„å±æ€§ï¼Œè¿™é‡Œç®€å•è¯´æ˜ä¸€ä¸‹ï¼š</p>

<pre><code class="language-text">// default is YES. causes touchesCancelled:withEvent: or pressesCancelled:withEvent: to be sent to the view for all touches or presses recognized as part of this gesture immediately before the action method is called.
@property(nonatomic) BOOL cancelsTouchesInView;
å¤åˆ¶ä»£ç 
</code></pre>

<p>è¿™ä¸ªå±æ€§å¯ä»¥æ§åˆ¶å½“ UIGestureRecognizer æˆåŠŸè¯†åˆ«æ‰‹åŠ¿ä¹‹åæ˜¯å¦è¦å–æ¶ˆå“åº”é“¾å¯¹è§¦æ‘¸äº‹ä»¶çš„å“åº”ï¼Œé»˜è®¤ä¸º YESï¼Œè®¾ç½®ä¸º NO ä¹‹åï¼Œå³ä½¿ UIGestureRecognizer è¯†åˆ«äº†æ‰‹åŠ¿ï¼ŒUIGestureEnvironment ä¹Ÿä¸ä¼šå‘èµ·å¯¹å“åº”é“¾çš„ cancelã€‚</p>

<pre><code class="language-text">// default is NO.  causes all touch or press events to be delivered to the target view only after this gesture has failed recognition. set to YES to prevent views from processing any touches or presses that may be recognized as part of this gesture
@property(nonatomic) BOOL delaysTouchesBegan;
å¤åˆ¶ä»£ç 
</code></pre>

<p>è®¾ç½®ä¸º YES æ—¶ï¼Œè¿™ä¸ªå±æ€§å¯ä»¥æ§åˆ¶åœ¨ UIGestureRecognizer è¯†åˆ«æ‰‹åŠ¿æœŸé—´æˆªæ–­äº‹ä»¶ï¼Œè¯†åˆ«å¤±è´¥åå“åº”é“¾æ‰èƒ½æ”¶åˆ°è§¦æ‘¸äº‹ä»¶ã€‚</p>

<pre><code class="language-text">// default is YES. causes touchesEnded or pressesEnded events to be delivered to the target view only after this gesture has failed recognition. this ensures that a touch or press that is part of the gesture can be cancelled if the gesture is recognized
@property(nonatomic) BOOL delaysTouchesEnded;
å¤åˆ¶ä»£ç 
</code></pre>

<p>é»˜è®¤ä¸º YESï¼Œå½“æ‰‹åŠ¿è¯†åˆ«å¤±è´¥æ—¶ï¼Œè‹¥æ­¤æ—¶è§¦æ‘¸äº‹ä»¶å·²ç»ç»“æŸï¼Œä¼šå»¶è¿Ÿä¸€å°æ®µæ—¶é—´ï¼ˆ0.15sï¼‰å†è°ƒç”¨å“åº”è€…çš„Â <code>touchesEnded:withEvent:</code>ï¼Œè‹¥è®¾ç½®æˆNOï¼Œåˆ™åœ¨æ‰‹åŠ¿è¯†åˆ«å¤±è´¥æ—¶ä¼šç«‹å³é€šçŸ¥ UIApplication å‘é€çŠ¶æ€ä¸º end çš„ è§¦æ‘¸äº‹ä»¶ç»™ Hit-Testing è¿”å›çš„ View ä»¥è°ƒç”¨Â <code>touchesEnded:withEvent:</code>Â ç»“æŸäº‹ä»¶å“åº”ã€‚</p>

<h3 id="toc_19">å°ç»“</h3>

<p><strong>1. UIGestureRecognizer é¦–å…ˆæ”¶åˆ°è§¦æ‘¸äº‹ä»¶ï¼ŒHit-Testing è¿”å›çš„ View å»¶è¿Ÿæ”¶åˆ°ï¼Œä¸¤è€…çš„è°ƒèµ·æ–¹æ³•ä¸åŒã€‚</strong></p>

<p><strong>2. ç¬¬ä¸€ä¸ª UIGestureRecognizer è¯†åˆ«æˆåŠŸåï¼ŒUIGestureEnvironment ä¼šå‘èµ·å“åº”é“¾çš„ cancelã€‚</strong></p>

<p><strong>3. å¯ä»¥é€šè¿‡è®¾ç½® UIGestureRecognizer çš„ Properties æ¥æ§åˆ¶å¯¹å“åº”é“¾çš„å½±å“ã€‚</strong></p>

<h2 id="toc_20">UIControl ç‰¹ä¾‹</h2>

<p>æˆ‘ä»¬ç°åœ¨ç»™ Demo ä¸­çš„ View D ä¸ŠåŠ ä¸€ä¸ª UIButtonï¼š</p>

<p><img src="media/15654059537017/15654064977862.jpg" alt=""/></p>

<pre><code class="language-text">- (void)buttonTapped
{
    NSLog(@&quot;D_buttonTapped&quot;);
}

- (instancetype)initWithCoder:(NSCoder *)coder
{
    self = [super initWithCoder:coder];

    if (self)
    {
        ZTTapGestureRecognizer *tapGestureRecognizer = [[ZTTapGestureRecognizer alloc] initWithTarget:self action:@selector(singleTapGesture)];
        tapGestureRecognizer.name = @&quot;D_view_tapGestureRecognizer&quot;;
        tapGestureRecognizer.delegate = self;
        [self addGestureRecognizer:tapGestureRecognizer];

        FButton *button = [[FButton alloc] initWithFrame:CGRectMake(80, 10, 100, 40)];
        button.backgroundColor = [UIColor blueColor];
        [button addTarget:self action:@selector(buttonTapped) forControlEvents:UIControlEventTouchUpInside];
        [self addSubview:button];
    }

    return self;
}
å¤åˆ¶ä»£ç 
</code></pre>

<p>ç‚¹å‡» Buttonï¼Œlog æ˜¾ç¤ºå¦‚ä¸‹ï¼š</p>

<pre><code class="language-text">D_view--- gestureRecognizer shouldReceiveTouch: D_view_tapGestureRecognizer ---
C_view--- gestureRecognizer shouldReceiveTouch: C_view_tapGestureRecognizer ---
A_view--- gestureRecognizer shouldReceiveTouch: A_view_tapGestureRecognizer ---
C_view_tapGestureRecognizer_touchesBegan
A_view_tapGestureRecognizer_touchesBegan
D_view_tapGestureRecognizer_touchesBegan
C_view_tapGestureRecognizer_touchesEndedWithState: 5
A_view_tapGestureRecognizer_touchesEndedWithState: 5
D_view_tapGestureRecognizer_touchesEndedWithState: 5
D_buttonTapped
å¤åˆ¶ä»£ç 
</code></pre>

<p>è¿™ä¸æˆ‘ä»¬æƒ³è±¡çš„å®Œå…¨ä¸åŒï¼š</p>

<ol>
<li>UIGestureRecognizer æ²¡æœ‰å“åº”è§¦æ‘¸äº‹ä»¶ä¸”é™¤äº†Â <code>shouldReceiveTouch</code>Â ä¹‹å¤–çš„å›è°ƒæ²¡æœ‰è¢«è°ƒç”¨ã€‚</li>
<li>è§¦æ‘¸äº‹ä»¶æ²¡æœ‰æ²¿ç€å“åº”é“¾è¿›è¡Œä¼ é€’ã€‚</li>
<li>UIButton æˆåŠŸçš„å“åº”äº†è§¦æ‘¸äº‹ä»¶ã€‚</li>
</ol>

<p>è¿™åˆæ˜¯ä»€ä¹ˆåŸå› å¯¼è‡´çš„å‘¢ï¼Ÿ</p>

<h3 id="toc_21">å®˜æ–¹æ–‡æ¡£</h3>

<p>æƒ¯ä¾‹ï¼Œå…ˆçœ‹å®˜æ–¹æ–‡æ¡£ï¼š</p>

<blockquote>
<p>Interacting with Other User Interface Controls</p>

<p>In iOS 6.0 and later, default control actions prevent overlapping gesture recognizer behavior. For example, the default action for a button is a single tap. If you have a single tap gesture recognizer attached to a buttonâ€™s parent view, and the user taps the button, then the buttonâ€™s action method receives the touch event instead of the gesture recognizer. This applies only to gesture recognition that overlaps the default action for a control, which includes:</p>

<ul>
<li><p>A single finger single tap on a UIButton, UISwitch, UIStepper, UISegmentedControl, and UIPageControl.</p></li>
<li><p>A single finger swipe on the knob of a UISlider, in a direction parallel to the slider.</p></li>
<li><p>A single finger pan gesture on the knob of a UISwitch, in a direction parallel to the switch.</p></li>
</ul>

<p>If you have a custom subclass of one of these controls and you want to change the default action, attach a gesture recognizer directly to the control instead of to the parent view. Then, the gesture recognizer receives the touch event first. As always, be sure to read the iOS Human Interface Guidelines to ensure that your app offers an intuitive user experience, especially when overriding the default behavior of a standard control.</p>
</blockquote>

<p>è¿™æ¬¡æ–‡æ¡£è§£é‡Šæ¸…æ¥šäº†æ‰€æœ‰çš„åŸå› ï¼šå¯¹äºÂ <strong>éƒ¨åˆ† UIControl</strong>Â æ¥è¯´ï¼ˆè‡ªå·±å®ç°çš„ä¸è¡Œï¼‰ï¼Œä¸ºäº†é˜²æ­¢ UIControl é»˜è®¤çš„æ‰‹åŠ¿ä¸å…¶çˆ¶ View ä¸Šçš„ UIGestureRecognizer çš„å†²çªï¼ŒUIControl æœ€åä¼šå“åº”è§¦æ‘¸äº‹ä»¶ï¼Œå¦‚æœæƒ³è¦ UIGestureRecognizer å¤„ç†è§¦æ‘¸äº‹ä»¶ï¼Œåˆ™éœ€è¦å°†å…¶ç›´æ¥ä¸ UIControl è¿›è¡Œç»‘å®šã€‚</p>

<p>åŸå› æ¸…æ¥šäº†ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯å›åˆ° Demo ä¹‹ä¸­æ¥çœ‹çœ‹ç³»ç»Ÿå…·ä½“æ˜¯æ€ä¹ˆåšçš„ã€‚</p>

<h3 id="toc_22">Demo éªŒè¯</h3>

<p>æˆ‘ä»¬å»æ‰ View A C D ä¸­çš„ logï¼Œå®ç°ä¸€ä¸ª UIButton çš„å­ç±» FButtonï¼Œå¯¹ FButton æ·»åŠ ä¸€ä¸ª ZTTapGestureRecognizerï¼Œå¹¶ä¸”å®ç°æ–¹æ³•Â <code>gestureRecognizerShouldBeginï¼š</code>ï¼š</p>

<pre><code class="language-text">@implementation FButton

- (void)singleTapGesture
{
    NSLog(@&quot;F_singleTapGesture&quot;);
}

- (BOOL)gestureRecognizerShouldBegin:(UIGestureRecognizer *)gestureRecognizer
{
    if ([super gestureRecognizerShouldBegin:gestureRecognizer])
    {
        NSLog(@&quot;F_Button--- gestureRecognizerShouldBegin: %@ YES ---&quot;, gestureRecognizer.name);
    }
    else
    {
        NSLog(@&quot;F_Button--- gestureRecognizerShouldBegin: %@ NO ---&quot;, gestureRecognizer.name);
    }

    return [super gestureRecognizerShouldBegin:gestureRecognizer];
}

- (instancetype)initWithFrame:(CGRect)frame
{
    self = [super initWithFrame:frame];

    if (self)
    {
        ZTTapGestureRecognizer *tapGestureRecognizer = [[ZTTapGestureRecognizer alloc] initWithTarget:self action:@selector(singleTapGesture)];
        tapGestureRecognizer.name = @&quot;F_Button_tapGestureRecognizer&quot;;
        tapGestureRecognizer.delegate = self;
        [self addGestureRecognizer:tapGestureRecognizer];
    }

    return self;
}

@end
å¤åˆ¶ä»£ç 
</code></pre>

<p>è¿è¡Œ Demoï¼Œç‚¹å‡» Buttonï¼Œlog å¦‚ä¸‹æ‰€ç¤ºï¼š</p>

<pre><code class="language-text">D_view_tapGestureRecognizer_touchesBegan
F_Button_tapGestureRecognizer_touchesBegan
C_view_tapGestureRecognizer_touchesBegan
A_view_tapGestureRecognizer_touchesBegan

F_Button--- gestureRecognizerShouldBegin: D_view_tapGestureRecognizer NO ---
D_view_tapGestureRecognizer_touchesEndedWithState: 5
F_Button--- gestureRecognizerShouldBegin: F_Button_tapGestureRecognizer YES ---
F_Button_tapGestureRecognizer_touchesEndedWithState: 3
F_Button--- gestureRecognizerShouldBegin: C_view_tapGestureRecognizer NO ---
C_view_tapGestureRecognizer_touchesEndedWithState: 5
F_Button--- gestureRecognizerShouldBegin: A_view_tapGestureRecognizer NO ---
A_view_tapGestureRecognizer_touchesEndedWithState: 5

F_singleTapGesture
å¤åˆ¶ä»£ç 
</code></pre>

<p>å¯ä»¥çœ‹åˆ° View A C D å’Œ Button F ä¸Šçš„ ZTTapGestureRecognizer éƒ½æ”¶åˆ°äº†Â <code>touchesBegan</code>Â æ–¹æ³•ï¼Œä½†æ˜¯æœ€ååªæœ‰ F_Button_tapGestureRecognizer æœ€ç»ˆæˆåŠŸè¿›è¡Œäº†çŠ¶æ€è½¬æ¢ï¼Œå…¶åŸå› å°±åœ¨äºæ–¹æ³•Â <code>gestureRecognizerShouldBegin:</code>ã€‚</p>

<p>è¿˜è®°å¾—å‰ä¸¤èŠ‚æˆ‘ä»¬å¯¹äºÂ <code>gestureRecognizerShouldBegin:</code>Â çš„æ¢è®¨å—ï¼Œæˆ‘ä»¬ç»ˆäºèƒ½å¤Ÿè¿›ä¸€æ­¥å¯¹å…¶è¿›è¡Œè§£é‡Šäº†ï¼Œè¿™ä¸ªæœºä¼šè¿˜æ˜¯ç•™ç»™å®˜æ–¹æ–‡æ¡£ï¼š</p>

<blockquote>
<p>Subclasses may override this method and use it to prevent the recognition of particular gestures. For example, the UISlider class uses this method to prevent swipes parallel to the sliderâ€™s travel direction and that start in the thumb.</p>

<p>At the time this method is called, the gesture recognizer is in the UIGestureRecognizerStatePossible state and thinks it has the events needed to move to the UIGestureRecognizerStateBegan state.</p>

<p>The default implementation of this method returns YES.</p>
</blockquote>

<p>æ‰€ä»¥ï¼Œä¸Šæ–‡æåˆ°çš„éƒ¨åˆ† UIControl é‡å†™äº†è¯¥æ–¹æ³•ï¼Œè™½ç„¶ UIGestureRecognizer ä¼šé¦–å…ˆå—åˆ°è§¦æ‘¸äº‹ä»¶ï¼Œä½†æ˜¯åœ¨çŠ¶æ€è½¬æ¢ä¹‹å‰ï¼Œè°ƒç”¨äº† Hit-Testing è¿”å›çš„ View ä¹Ÿå°±æ˜¯ UIControl çš„Â <code>gestureRecognizerShouldBegin:</code>Â æ–¹æ³•ï¼ŒUIControl ä¼šä½¿çˆ¶ View ä¸Šçš„ UIGestureRecognizer å¤±æ•ˆï¼Œè€Œè‡ªå·±çš„ UIGestureRecognizer å´ä¸ä¼šå¤±æ•ˆï¼Œè¿™å°±æ˜¯ç³»ç»Ÿå®ç°è¿™ä¸ªæœºåˆ¶çš„æ–¹æ³•ã€‚</p>

<p>è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œä¸ºä»€ä¹ˆè§¦æ‘¸æ²¡æœ‰æ²¿ç€å“åº”é“¾è¿›è¡Œä¼ é€’å‘¢ï¼Ÿæƒ¯ä¾‹ï¼Œå…ˆçœ‹æ–‡æ¡£ï¼š</p>

<blockquote>
<p>Controls communicate directly with their associated target object using action messages. When the user interacts with a control, the control sends an action message to its target object. Action messages are not events, but they may still take advantage of the responder chain. When the target object of a control is nil, UIKit starts from the target object and traverses the responder chain until it finds an object that implements the appropriate action method. For example, the UIKit editing menu uses this behavior to search for responder objects that implement methods with names like cut:, copy:, or paste:.</p>
</blockquote>

<p>ç„¶åæˆ‘ä»¬çœ‹ä¸‹ FButton çš„å“åº”æ–¹æ³•çš„è°ƒç”¨æ ˆï¼ˆå»æ‰ FButton ä¸Šçš„ UIGestureRecognizerï¼‰ï¼š</p>

<p><img src="media/15654059537017/15654065324630.jpg" alt=""/></p>

<p>è¿™é‡Œæ–‡æ¡£æ²¡æœ‰è¯´å…¨ï¼Œå®é™…ä¸Šï¼ŒFButton é‡å†™äº†Â <code>touchesBegan:withEvent:</code>Â æ–¹æ³•ï¼Œåœ¨æ”¶åˆ°è§¦æ‘¸äº‹ä»¶åå°†å…¶æˆªæ–­ä¸å†æ²¿å“åº”é“¾è¿›è¡Œä¼ é€’ï¼›åœ¨å“åº”è§¦æ‘¸äº‹ä»¶æ—¶ï¼ŒFButton ä½¿ç”¨ Target-Action æœºåˆ¶é€šè¿‡Â <code>sendAction:to:forEvent:</code>Â æ–¹æ³•é€šçŸ¥ UIApplicationï¼ŒUIApplication åœ¨é€šè¿‡Â <code>sendAction:to:from:forEvent:</code>Â æ–¹æ³•å‘ target å‘é€ actionï¼Œè€Œå½“ target ä¸º nil æ—¶å°±ä¼šæ²¿ç€å“åº”é“¾è¿›è¡Œå¯»æ‰¾ï¼ŒçŸ¥é“æ‰¾åˆ°äº†å®ç°äº†ç›¸åº”æ–¹æ³•çš„å¯¹è±¡ã€‚</p>

<h3 id="toc_23">å°ç»“</h3>

<p><strong>1. UIGestureRecognizer ä»ç„¶ä¼šå…ˆäº UIControl æ¥æ”¶åˆ°è§¦æ‘¸äº‹ä»¶ã€‚</strong></p>

<p><strong>2. UIButton ç­‰éƒ¨åˆ† UIControl ä¼šæ‹¦æˆªå…¶çˆ¶ View ä¸Šçš„ UIGestureRecognizerï¼Œä½†ä¸ä¼šæ‹¦æˆªè‡ªå·±å’Œå­ View ä¸Šçš„ UIGestureRecognizerã€‚</strong></p>

<p><strong>3. UIButton ä¼šæˆªæ–­å“åº”é“¾çš„äº‹ä»¶ä¼ é€’ï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨å“åº”é“¾æ¥å¯»æ‰¾ Action Methodã€‚</strong></p>

<h2 id="toc_24">UITableView ä¸ UIScrollView</h2>

<p>å½“åœºæ™¯ä¸­å­˜åœ¨ UITableView å’Œ UIScrollView æ—¶ï¼Œåˆä¼šæœ‰ä¸ä¸€æ ·çš„æƒ…å†µï¼Œæ„Ÿå…´è¶£çš„è¯»è€…å¯ä»¥è¯•ç€è‡ªå·±ç ”ç©¶ä¸€ä¸‹ã€‚</p>

<h2 id="toc_25">é—®é¢˜è§£å†³</h2>

<p>ç°åœ¨ï¼Œæˆ‘ä»¬å›è¿‡å¤´çœ‹çœ‹æœ€åˆçš„é—®é¢˜ï¼Œè§£å†³èµ·æ¥åº”è¯¥å°±æ¯”è¾ƒç®€å•äº†ã€‚</p>

<p>é¦–å…ˆåœ¨æˆ‘ä»¬å¯¹å¤–çš„ View ä¸Šæ·»åŠ ä¸€ä¸ª UITapGestureRecognizerï¼Œé€šè¿‡å›è°ƒä½¿å…¶èƒ½ä¸å†…éƒ¨çš„ UIGestureRecognizer åŒæ—¶å¤„ç†è§¦æ‘¸äº‹ä»¶ï¼Œå¹¶ä¸”ä¸å†…éƒ¨åŒå‡»æ‰‹åŠ¿ä¸ä¼šå†²çªï¼š</p>

<pre><code class="language-text">- (BOOL)gestureRecognizer:(UIGestureRecognizer *)gestureRecognizer shouldRecognizeSimultaneouslyWithGestureRecognizer:(UIGestureRecognizer *)otherGestureRecognizer
{
    if (gestureRecognizer == self.tapGestureRecognizer)
    {
        return YES;
    }

    return NO;
}

- (BOOL)gestureRecognizer:(UIGestureRecognizer *)gestureRecognizer shouldRequireFailureOfGestureRecognizer:(UIGestureRecognizer *)otherGestureRecognizer
{
    if (gestureRecognizer == self.tapGestureRecognizer &amp;&amp; [otherGestureRecognizer isKindOfClass:[UITapGestureRecognizer class]] &amp;&amp; ((UITapGestureRecognizer *)otherGestureRecognizer).numberOfTapsRequired == 2)
    {
        return YES;
    }

    return NO;
}
å¤åˆ¶ä»£ç 
</code></pre>

<p>ç”±äºå•å‡»æ‰‹åŠ¿è¦åœ¨åŒå‡»æ‰‹åŠ¿åˆ¤æ–­å¤±è´¥åæ‰èƒ½è§¦å‘ï¼Œæ‰€ä»¥ä¼šæœ‰ä¸€å®šçš„å»¶è¿Ÿï¼Œè¿™é‡Œæœ€å¥½çš„åŠæ³•æ˜¯åœ¨å†…éƒ¨è‡ªå®šä¹‰ä¸€ä¸ª UIGestureRecognizer æ¥å®ç°åŒå‡»æ‰‹åŠ¿ä»¥ç¼©çŸ­ç­‰å¾…æ—¶é—´ï¼š</p>

<pre><code class="language-text">#import &lt;UIKit/UIGestureRecognizerSubclass.h&gt;

#define UISHORT_TAP_MAX_DELAY 0.2
@interface UIShortTapGestureRecognizer : UITapGestureRecognizer

@end

@implementation UIShortTapGestureRecognizer

- (void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event
{
    [super touchesBegan:touches withEvent:event];
    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(UISHORT_TAP_MAX_DELAY * NSEC_PER_SEC)), dispatch_get_main_queue(), ^
    {
        // Enough time has passed and the gesture was not recognized -&gt; It has failed.
        if  (self.state != UIGestureRecognizerStateRecognized)
        {
            self.state = UIGestureRecognizerStateFailed;
        }
    });
}
@end
å¤åˆ¶ä»£ç 
</code></pre>

<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹Â <code>UISHORT_TAP_MAX_DELAY</code>Â å‚æ•°æ¥æ§åˆ¶ç­‰å¾…çš„æ—¶é—´ã€‚</p>

<h2 id="toc_26">æ€»ç»“</h2>

<p><strong>1. è§¦æ‘¸äº‹ä»¶å‘ç”Ÿåï¼ŒIOKit ä¼šé€šè¿‡ mach port ä¼ é€’ç»™ SpringBoad è¿›ç¨‹ï¼Œå¹¶æœ€ç»ˆä¼ é€’ç»™äº† UIApplicationã€‚</strong></p>

<p><strong>2. UIApplication é€šè¿‡ Hit-Testing å¯»æ‰¾åˆ°äº†æœ€ä½³å“åº”è€…ï¼Œéå†å¾—åˆ°æ‰€æœ‰çš„ UIGestureRecognizerï¼Œç„¶åæ ¹æ®æœ€ä½³å“åº”è€…ã€UIGestureRecognizerã€Window åˆ›å»º UITouch å¹¶å°†å…¶ä¿å­˜åœ¨ UIEvent ä¸­ã€‚</strong></p>

<p><strong>3. UIApplication å°† UIEvent å‘é€ç»™ UIWindowï¼ŒUIWindow é¦–å…ˆå‘é€äº‹ä»¶ç»™ UIGestureRecognizerï¼Œç„¶åå‘é€ç»™æœ€ä½³å“åº”è€…ï¼Œäº‹ä»¶æ²¿å“åº”é“¾ä¼ é€’ã€‚</strong></p>

<p><strong>4. UIGestureRecognizer æ ¹æ® Delegate ä»¥åŠæœ€ä½³å“åº”è€…æ¥åˆ¤æ–­æ˜¯å¦èƒ½å¤ŸæˆåŠŸè¿›è¡ŒçŠ¶æ€è½¬æ¢å¹¶å–æ¶ˆå“åº”é“¾çš„è§¦æ‘¸äº‹ä»¶ã€‚</strong></p>

<p><strong>5. ç³»ç»Ÿå®ç°çš„éƒ¨åˆ† UIControl ä¼šæˆªæ–­å“åº”é“¾ï¼Œå¹¶ä½¿çˆ¶ View ä¸Šçš„ UIGestureRecognizer å¤±æ•ˆã€‚</strong></p>

<h2 id="toc_27">å‚è€ƒèµ„æ–™</h2>

<p><a href="https://link.juejin.im/?target=https%3A%2F%2Fgithub.com%2FBladeTail%2FEvent-Handling-Guide-for-iOS%2Fblob%2Fmaster%2FEvent%2520Handling%2520Guide%2520for%2520iOS.pdf">Event Handling Guide for iOS</a></p>

<p><a href="https://link.juejin.im/?target=https%3A%2F%2Fwww.jianshu.com%2Fp%2Fd8512dff2b3e">iOS äº‹ä»¶å“åº”é“¾ä¸­ Hit-Test View çš„åº”ç”¨</a></p>

<p><a href="https://link.juejin.im/?target=https%3A%2F%2Fwww.jianshu.com%2Fp%2Fc294d1bd963d">iOS è§¦æ‘¸äº‹ä»¶å…¨å®¶æ¡¶</a></p>

<p><a href="https://link.juejin.im/?target=https%3A%2F%2Fwww.jianshu.com%2Fp%2F53e03e558cbd">iOS ç‚¹å‡»äº‹ä»¶å’Œæ‰‹åŠ¿å†²çª</a></p>

<p><a href="https://link.juejin.im/?target=http%3A%2F%2Fzhoon.github.io%2Fios%2F2015%2F04%2F12%2Fios-event.html">æ·±å…¥æµ…å‡ºiOSäº‹ä»¶æœºåˆ¶</a></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[å›¾åƒæ˜¾ç¤ºåŸç†]]></title>
    <link href="http://www.citynight.cn/Blog/15653483390225.html"/>
    <updated>2019-08-09T18:58:59+08:00</updated>
    <id>http://www.citynight.cn/Blog/15653483390225.html</id>
    <content type="html"><![CDATA[
<p><img src="media/15653483390225/WX20190809-201518@2x.png" alt="WX20190809-201518@2x"/></p>

<p><img src="media/15653483390225/15656069984426.jpg" alt="" style="width:979px;"/><br/>
<img src="media/15653483390225/15656070181148.jpg" alt="" style="width:677px;"/></p>

<p><img src="media/15653483390225/15666279613682.jpg" alt="" style="width:755px;"/></p>

<p>ç³»ç»Ÿç»˜åˆ¶æµç¨‹<br/>
<img src="media/15653483390225/%E6%9C%AA%E5%91%BD%E5%90%8D%E6%96%87%E4%BB%B6%20-4-.jpg" alt="æœªå‘½åæ–‡ä»¶ -4-"/></p>

<p>å¼‚æ­¥ç»˜åˆ¶æµç¨‹(æ—¶åºå›¾)<br/>
<img src="media/15653483390225/Jietu20190824-150035.jpg" alt="Jietu20190824-150035"/></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[äº‹ä»¶ä¼ é€’]]></title>
    <link href="http://www.citynight.cn/Blog/15653376209289.html"/>
    <updated>2019-08-09T16:00:20+08:00</updated>
    <id>http://www.citynight.cn/Blog/15653376209289.html</id>
    <content type="html"><![CDATA[
<p>æ•´ä½“çš„äº‹ä»¶ä¼ é€’æµç¨‹<br/>
<img src="media/15653376209289/15653376299374.jpg" alt="" style="width:687px;"/></p>

<p>è¯¦ç»†çš„<code>hitTset:withEvent:</code>ç³»ç»Ÿå®ç°<br/>
<img src="media/15653376209289/15653413218867.jpg" alt=""/></p>

<p>æ³¨ï¼šå…ˆåˆ¤æ–­è§†å›¾æ˜¯å¦éšè—å¯äº¤äº’ï¼Œä¸æ»¡è¶³æ¡ä»¶è¿”å›nil, å¦‚æœä¸åœ¨ç‚¹å‡»èŒƒå›´å†…å°±è¿”å›nil,åœ¨ç‚¹å‡»èŒƒå›´å†…å°±éå†å­è§†å›¾ã€‚éå†å­è§†å›¾çš„æ—¶å€™å¦‚æœéƒ½æ²¡æœ‰å­è§†å›¾å“åº”äº‹ä»¶ï¼Œé‚£ä¹ˆå°±æŠŠè§†å›¾æœ¬èº«<code>v</code>è¿”å›ï¼Œå¦‚æœæœ‰å­è§†å›¾å“åº”å°±è¿”å›å½“å‰å­è§†å›¾ã€‚</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[æµ·åº•æç‚¹é¤Pad ä¼˜åŒ–]]></title>
    <link href="http://www.citynight.cn/Blog/15653325472073.html"/>
    <updated>2019-08-09T14:35:47+08:00</updated>
    <id>http://www.citynight.cn/Blog/15653325472073.html</id>
    <content type="html"><![CDATA[
<h2 id="toc_0">1. cell æ˜¾ç¤ºä¼˜åŒ–</h2>

<p>æµ·åº•æçš„æ¯ä¸ªèœå“éƒ½æœ‰å¾ˆå¤šæ ‡ç­¾ï¼Œæ¯”å¦‚æ¸…çœŸï¼Œæ¨èï¼Œéº»è¾£ç­‰ç­‰<br/>
è¿™äº›æ ‡ç­¾æ˜¯æœ‰è§„å¾‹çš„ï¼Œæœ€å¤šæ˜¾ç¤º6ä¸ªã€‚æ²¡æœ‰ä¼˜åŒ–å‰é‡‡ç”¨çš„æ˜¯å­˜åœ¨å°±åˆ›å»ºï¼Œè¿™æ ·åœ¨iPad Airä¸Šé¢æ»‘åŠ¨æ„Ÿè§‰ä¸å‡ºå¡é¡¿ä½†æ˜¯åœ¨ä¸€äº›è€pad æ¯”å¦‚ iPad mini ä¸Šå°±ä¼šå‡ºç°å¡é¡¿ç°è±¡ã€‚<br/>
è§£å†³æ–¹æ¡ˆï¼š<br/>
æå‰åˆ›å»ºå¥½6ä¸ªæ ‡ç­¾ï¼Œç„¶åæ ¹æ®æ•°æ®è®¾ç½®æ˜¾ç¤ºå†…å®¹å¹¶æ§åˆ¶æ˜¾éš</p>

<p>è¿™æ ·åšèƒ½æœ‰æ•ˆçš„æé«˜è€padçš„æ˜¾ç¤ºæ•ˆæœã€‚</p>

<h2 id="toc_1">2. æ•°æ®å¤„ç†ä¼˜åŒ–</h2>

<p>æ•°æ®æºåŒæ­¥é—®é¢˜ï¼Œé—®é¢˜æè¿°ï¼š padå¯ä»¥æ›´æ–°æ•°æ®ï¼Œå®šæ—¶å™¨æ‹‰å–æ•°æ®ï¼Œæ¨é€è¿‡æ¥çš„æ•°æ®</p>

<p><img src="media/15653325472073/15653335091232.jpg" alt="" style="width:500px;"/></p>

<p>è§£å†³æ–¹æ¡ˆä¸€ï¼š å¹¶å‘è®¿é—®æ•°æ®æ‹·è´<br/>
ä¸»çº¿ç¨‹å’Œå­çº¿ç¨‹éƒ½æ“ä½œæ•°æ®æºçš„æ—¶å€™ï¼Œå¯ä»¥æŠŠæ•°æ®æºç»™å­çº¿ç¨‹æ‹·è´ä¸€ä»½è®©å­çº¿ç¨‹æ“ä½œï¼Œå½“å­çº¿ç¨‹æ“ä½œå®Œè¿”å›ç»™ä¸»çº¿ç¨‹çš„æ—¶å€™æŠŠä¸»çº¿ç¨‹æ“ä½œçš„è¿‡ç¨‹åœ¨æ•°æ®æºä¸­å†æ¬¡æ‰§è¡Œä¸€æ¬¡ç„¶åæ›´æ–°æ•°æ®æ˜¾ç¤ºã€‚<br/>
ä¸»è¦çš„æŠ€æœ¯ç‚¹æ˜¯è®°å½•ä¸»çº¿ç¨‹æ“ä½œæ­¥éª¤</p>

<p>è§£å†³æ–¹æ¡ˆäºŒï¼š ä¸²è¡Œè®¿é—®<br/>
æ“ä½œè®¿é—®çš„éƒ½æ˜¯åŒä¸€æ•°æ®æºï¼Œèƒ½å¤Ÿä¿è¯æ“ä½œæ•°æ®ä¸å‡ºé”™ã€‚ä½†æ˜¯æœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯å¦‚æœå­çº¿ç¨‹æ­£åœ¨æ“ä½œæ•°æ®è¿™ä¸ªæ—¶å€™ä¸»çº¿ç¨‹æœ‰ä¸€ä¸ªä¿®æ”¹æ“ä½œä¼šå¯¼è‡´ä¸»çº¿ç¨‹ç­‰å¾…ï¼Œç”¨æˆ·ä¼šæœ‰å¡çš„æ„Ÿè§‰ã€‚</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Texture  ä¸­ASButtonNodeè®¾ç½®å›¾ç‰‡å´©æºƒ]]></title>
    <link href="http://www.citynight.cn/Blog/15585883897383.html"/>
    <updated>2019-05-23T13:13:09+08:00</updated>
    <id>http://www.citynight.cn/Blog/15585883897383.html</id>
    <content type="html"><![CDATA[
<p>è§£å†³æ–¹æ¡ˆï¼š<img src="media/15585883897383/WX20190523-110605@2x.png" alt="WX20190523-110605@2x"/></p>

<p>Assetsä¸­çš„å›¾ç‰‡Slicing è®¾ç½®<code>Center</code>ä¸º<code>Stretches</code></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[é™æ€æ–¹æ³•å’Œå®ä¾‹æ–¹æ³•ä¸åŒç‚¹]]></title>
    <link href="http://www.citynight.cn/Blog/15465912048942.html"/>
    <updated>2019-01-04T16:40:04+08:00</updated>
    <id>http://www.citynight.cn/Blog/15465912048942.html</id>
    <content type="html"><![CDATA[
<ol>
<li><p>åœ¨å¤–éƒ¨è°ƒç”¨é™æ€æ–¹æ³•æ—¶ï¼Œå¯ä»¥ä½¿ç”¨&quot;ç±»å.æ–¹æ³•å&quot;çš„æ–¹å¼ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨&quot;å¯¹è±¡å.æ–¹æ³•å&quot;çš„æ–¹å¼ã€‚è€Œå®ä¾‹æ–¹æ³•åªæœ‰åé¢è¿™ç§æ–¹å¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè°ƒç”¨é™æ€æ–¹æ³•å¯ä»¥æ— éœ€åˆ›å»ºå¯¹è±¡ã€‚</p></li>
<li><p>é™æ€æ–¹æ³•åœ¨è®¿é—®æœ¬ç±»çš„æˆå‘˜æ—¶ï¼Œåªå…è®¸è®¿é—®é™æ€æˆå‘˜ï¼ˆå³é™æ€æˆå‘˜å˜é‡å’Œé™æ€æ–¹æ³•ï¼‰ï¼Œè€Œä¸å…è®¸è®¿é—®å®ä¾‹æˆå‘˜å˜é‡å’Œå®ä¾‹æ–¹æ³•ï¼›å®ä¾‹æ–¹æ³•åˆ™æ— æ­¤é™åˆ¶.</p></li>
</ol>

<blockquote>
<p>æ³¨æ„: åœ¨Swiftä¸­ï¼Œé™æ€æ–¹æ³•ä¸èƒ½é€šè¿‡ <code>å¯¹è±¡å.æ–¹æ³•å</code> çš„æ–¹å¼è°ƒç”¨ã€‚</p>
</blockquote>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[å¦‚ä½•åˆ¤ç­‰equals]]></title>
    <link href="http://www.citynight.cn/Blog/15465714658370.html"/>
    <updated>2019-01-04T11:11:05+08:00</updated>
    <id>http://www.citynight.cn/Blog/15465714658370.html</id>
    <content type="html"><![CDATA[
<blockquote>
<p><a href="https://stackoverflow.com/questions/9506303/public-boolean-equalsobject-other">Stackoverflow</a> ä¸­æœ‰å…¶ä»–äººæçš„å†™æ³•ï¼Œæˆ‘æ„Ÿè§‰å…¬å¸é¡¹ç›®ä¸­çš„å†™æ³•ä¸é”™è®°å½•ä¸‹</p>
</blockquote>

<pre><code class="language-text">    public boolean equals(Object o) {
        if (this == o) return true;
        if (!(o instanceof CreateOrderDTO)) return false;
        CreateOrderDTO that = (CreateOrderDTO) o;
        return Objects.equal(getBusiId(), that.getBusiId()) &amp;&amp;
                Objects.equal(getBusiType(), that.getBusiType()) &amp;&amp;
                Objects.equal(getOrderAmount(), that.getOrderAmount());
    }
</code></pre>

<p>é‡å†™<a href="https://kapeli.com/dash_share?docset_file=Java&amp;docset_name=Java%20SE10&amp;path=java/lang/Object.html%23equals(java.lang.Object)&amp;platform=java&amp;repo=Main&amp;version=SE10">equals</a>éœ€è¦æ»¡è¶³ è‡ªåæ€§ï¼Œå¯¹ç§°æ€§ï¼Œä¼ é€’æ€§ï¼Œä¸€è‡´æ€§ï¼Œéç©º</p>

<p><img src="media/15465714658370/15465935663846.jpg" alt="" style="width:588px;"/></p>

<h2 id="toc_0">== ä¸ equals</h2>

<p><strong><em>==</em></strong> : å®ƒçš„ä½œç”¨æ˜¯åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡çš„åœ°å€æ˜¯ä¸æ˜¯ç›¸ç­‰ã€‚å³ï¼Œåˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æ˜¯ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚(åŸºæœ¬æ•°æ®ç±»å‹ == æ¯”è¾ƒçš„æ˜¯å€¼ï¼Œå¼•ç”¨æ•°æ®ç±»å‹ == æ¯”è¾ƒçš„æ˜¯å†…å­˜åœ°å€)</p>

<p><strong><em>equals()</em></strong> : å®ƒçš„ä½œç”¨ä¹Ÿæ˜¯åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰ã€‚ä½†å®ƒä¸€èˆ¬æœ‰ä¸¤ç§ä½¿ç”¨æƒ…å†µï¼š</p>

<p>æƒ…å†µ1ï¼šç±»æ²¡æœ‰è¦†ç›– equals() æ–¹æ³•ã€‚åˆ™é€šè¿‡ equals() æ¯”è¾ƒè¯¥ç±»çš„ä¸¤ä¸ªå¯¹è±¡æ—¶ï¼Œç­‰ä»·äºé€šè¿‡â€œ==â€æ¯”è¾ƒè¿™ä¸¤ä¸ªå¯¹è±¡ã€‚<br/>
æƒ…å†µ2ï¼šç±»è¦†ç›–äº† equals() æ–¹æ³•ã€‚ä¸€èˆ¬ï¼Œæˆ‘ä»¬éƒ½è¦†ç›– equals() æ–¹æ³•æ¥ä¸¤ä¸ªå¯¹è±¡çš„å†…å®¹ç›¸ç­‰ï¼›è‹¥å®ƒä»¬çš„å†…å®¹ç›¸ç­‰ï¼Œåˆ™è¿”å› true (å³ï¼Œè®¤ä¸ºè¿™ä¸¤ä¸ªå¯¹è±¡ç›¸ç­‰)ã€‚</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[æ•°æ®åˆ·æ–°å´©æºƒ]]></title>
    <link href="http://www.citynight.cn/Blog/15460677821989.html"/>
    <updated>2018-12-29T15:16:22+08:00</updated>
    <id>http://www.citynight.cn/Blog/15460677821989.html</id>
    <content type="html"><![CDATA[
<p><img src="media/15460677821989/15460678427638.jpg" alt="" style="width:531px;"/><br/>
<img src="media/15460677821989/15460678670280.jpg" alt="" style="width:1054px;"/></p>

<p>å‘ç”Ÿå´©æºƒçš„åŸå› æ˜¯<code>tableView</code> <code>reloadData</code> çš„æ—¶å€™ç›´æ¥è®¾ç½®<code>tableView</code> çš„ <code>scrollRectToVisible</code> è§£å†³æ–¹æ¡ˆ</p>

<pre><code class="language-text">        UIView.animate(withDuration: 0, animations: {
            self.tableView.reloadData()
        }) { (finish) in
            let rect = self.tableView.rect(forSection: section)
            self.tableView.scrollRectToVisible(rect, animated: true)
        }
</code></pre>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ä½¿ç”¨Swiftè·å–åº”ç”¨ç¨‹åºçš„CPUä½¿ç”¨ç‡å’Œå†…å­˜ä½¿ç”¨é‡]]></title>
    <link href="http://www.citynight.cn/Blog/15398626891772.html"/>
    <updated>2018-10-18T19:38:09+08:00</updated>
    <id>http://www.citynight.cn/Blog/15398626891772.html</id>
    <content type="html"><![CDATA[
<p>åŸæ–‡<a href="https://qiita.com/rinov/items/f30d386fb7b8b12278a5">Swiftã§ã‚¢ãƒ—ãƒªã®CPUä½¿ç”¨ç‡ã¨ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã‚’å–å¾—ã™ã‚‹</a></p>

<h2 id="toc_0">ä»‹ç»</h2>

<p>åœ¨ä¸€ä¸ªè·å–ç³»ç»Ÿä¿¡æ¯çš„æ–¹æ³•ä¸­ï¼Œä¸€ä¸ªæè¿°CPUå’Œå†…å­˜çŠ¶æ€çš„åº“å­˜åœ¨äºä¸€ä¸ªè·å–ç³»ç»Ÿä¿¡æ¯çš„æ–¹æ³•ä¸­ï¼Œå…¶ä¸­Debugé™„å¸¦äº†æ¥è‡ªXCodeçš„CustomFlagç­‰ã€‚</p>

<p>å½“ç„¶ï¼Œè¿˜æœ‰ä¸€äº›æ–¹æ³•å¯ä»¥è·å–ä¸é™äºDebugç‰ˆæœ¬çš„ç³»ç»Ÿä¿¡æ¯ï¼Œä½†å¤§å¤šæ•°éƒ½æ˜¯åœ¨Objective-Cä¸­ç¼–å†™çš„ã€‚ä¹Ÿåœ¨AppleDeveloperå®˜æ–¹è®ºå›ä¸Š</p>

<blockquote>
<p>å°½ç®¡ä½¿ç”¨Swiftæ˜¯ä¸å¯èƒ½çš„ï¼Œä½†å¯¹äºé‚£äº›ä½¿ç”¨Objective-C çš„äººæ¥è¯´å¯èƒ½å¾ˆéš¾</p>
</blockquote>

<p>è¿˜æœ‰ç­”æ¡ˆè¯´ã€‚<br/>
ä½†æ˜¯ï¼Œæ²¡æœ‰ä»»ä½•ä¼˜ç‚¹ï¼Œä½ å¯ä»¥æˆ–æ ¹æœ¬ä¸èƒ½ä½¿ç”¨Swiftã€‚æˆ‘ä¸ªäººè®¤ä¸ºä½å±‚å®ç°ä¹Ÿæœ‰ä»¥ä¸‹ä¼˜ç‚¹ã€‚</p>

<ul>
<li>å—ç›Šäºå¯é€‰</li>
<li>æé«˜å¯è¯»æ€§</li>
<li>æ›´å®¹æ˜“å…±äº«ä»£ç ï¼ˆæ˜“äºç»´æŠ¤ç»´æŠ¤ï¼‰</li>
</ul>

<p>æ‰€ä»¥æˆ‘è¿™æ¬¡å†™äº†å¦‚ä½•åœ¨Swiftä¸­è·å¾—CPUåˆ©ç”¨ç‡å’Œå†…å­˜ä½¿ç”¨é‡ã€‚ï¼ˆè¿˜æœ‰å…³äºç£ç›˜ä½¿ç”¨æƒ…å†µçš„å¥–åŠ±ï¼‰</p>

<h2 id="toc_1">åŠ¨ä½œç¡®è®¤ç¯å¢ƒ</h2>

<p>XCode8.3.3Â <br/>
Swift3.1</p>

<h2 id="toc_2">CPUä½¿ç”¨ç‡</h2>

<pre><code class="language-text">// å¿…é ˆ
import Foundation

// CPUä½¿ç”¨ç‡ã‚’0%~100%ã§å–å¾—
private func getCPUUsage() -&gt; Float {
    // ã‚«ãƒ¼ãƒãƒ«å‡¦ç†ã®çµæœ
    var result: Int32
    var threadList = UnsafeMutablePointer&lt;UInt32&gt;.allocate(capacity: 1)
    var threadCount = UInt32(MemoryLayout&lt;mach_task_basic_info_data_t&gt;.size / MemoryLayout&lt;natural_t&gt;.size)
    var threadInfo = thread_basic_info()

    // ã‚¹ãƒ¬ãƒƒãƒ‰æƒ…å ±ã‚’å–å¾—
    result = withUnsafeMutablePointer(to: &amp;threadList) {
        $0.withMemoryRebound(to: thread_act_array_t?.self, capacity: 1) {
            task_threads(mach_task_self_, $0, &amp;threadCount)
        }
    }

    if result != KERN_SUCCESS { return 0 }

    // å„ã‚¹ãƒ¬ãƒƒãƒ‰ã‹ã‚‰CPUä½¿ç”¨ç‡ã‚’ç®—å‡ºã—åˆè¨ˆã‚’å…¨ä½“ã®CPUä½¿ç”¨ç‡ã¨ã™ã‚‹
    return (0 ..&lt; Int(threadCount))
        // ã‚¹ãƒ¬ãƒƒãƒ‰ã®CPUä½¿ç”¨ç‡ã‚’å–å¾—
        .flatMap { index -&gt; Float? in
            var threadInfoCount = UInt32(THREAD_INFO_MAX)
            result = withUnsafeMutablePointer(to: &amp;threadInfo) {
                $0.withMemoryRebound(to: integer_t.self, capacity: 1) {
                    thread_info(threadList[index], UInt32(THREAD_BASIC_INFO), $0, &amp;threadInfoCount)
                }
            }
            // ã‚¹ãƒ¬ãƒƒãƒ‰æƒ…å ±ãŒå–ã‚Œãªã„ = è©²å½“ã‚¹ãƒ¬ãƒƒãƒ‰ã®CPUä½¿ç”¨ç‡ã‚’0ã¨ã¿ãªã™(åŸºæœ¬nilãŒè¿”ã‚‹ã“ã¨ã¯ãªã„)
            if result != KERN_SUCCESS { return nil }
            let isIdle = threadInfo.flags == TH_FLAGS_IDLE
            // CPUä½¿ç”¨ç‡ãŒã‚¹ã‚±ãƒ¼ãƒ«èª¿æ•´æ¸ˆã¿ã®ãŸã‚`TH_USAGE_SCALE`ã§é™¤ç®—ã—æˆ»ã™
            return !isIdle ? (Float(threadInfo.cpu_usage) / Float(TH_USAGE_SCALE)) * 100 : nil
        }
        // åˆè¨ˆç®—å‡º
        .reduce(0, +)
}
</code></pre>

<p><code>Float(threadInfo.cpu_usage) / Float(TH_USAGE_SCALE)</code>å·²ç»å®Œæˆäº†åˆ’åˆ†ä»¥ç¡®ä¿å€¼çš„ç²¾ç¡®æ€§ï¼Œå› æ­¤æœ‰å¿…è¦è¿›è¡Œåˆ’åˆ†ã€‚<br/>
è¿™<code>CPUä½¿ç”¨ç‡ / ã‚¹ã‚±ãƒ¼ãƒ«</code>æ˜¯å› ä¸ºå¦‚æœä½ æŠŠè¿™ä¸ªè¡¨è¾¾å¼æ”¾å…¥ï¼Œåˆæ­¥å®Œæˆäº†ä¸‹é¢çš„å¤„ç†ã€‚</p>

<p><code>CPUä½¿ç”¨ç‡ = 0.216</code>å¦‚æœå­˜åœ¨ - &gt; 21.6ï¼…çš„å€¼ï¼Œåˆ™ç¼©æ”¾å› å­è·å¾—10çš„å¹‚ï¼Œä½¿å¾—CPUä½¿ç”¨ç‡æ˜¯æ•´æ•°ã€‚å› æ­¤ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ¯”ä¾‹å› å­æ˜¯1000ã€‚ï¼ˆ<code>0.216 * 1000 = 216</code>ï¼‰<br/>
å› æ­¤ï¼Œç”±äºè¿™äº›ç³»æ•°ç³»æ•°æ ¹æ®å€¼çš„ç²¾åº¦è€Œä¸åŒï¼Œå› æ­¤å®ƒä»¬å¿…é¡»ç”¨äºæ¯ä¸ªçº¿ç¨‹çš„é™¤æ³•ã€‚</p>

<h2 id="toc_3">å†…å­˜ä½¿ç”¨æƒ…å†µ</h2>

<pre><code class="language-text">// å¿…é ˆ
import Foundation

// ä½¿ç”¨è€…ãŒå˜ä½ã‚’æŠŠæ¡ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚
typealias MegaByte = UInt64

// å¼•æ•°ã«enumã§ä»»æ„ã®å˜ä½ã‚’æŒ‡å®šã§ãã‚‹ã®ãŒå¥½ã¾ã—ã„ e.g. unit = .auto (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå¼•æ•°)
func getMemoryUsed() -&gt; MegaByte? {
    // ã‚¿ã‚¹ã‚¯æƒ…å ±ã‚’å–å¾—
    var info = mach_task_basic_info()
    // `info`ã®å€¤ã‹ã‚‰ãã®å‹ã«å¿…è¦ãªãƒ¡ãƒ¢ãƒªã‚’å–å¾—
    var count = UInt32(MemoryLayout.size(ofValue: info) / MemoryLayout&lt;integer_t&gt;.size)
    let result = withUnsafeMutablePointer(to: &amp;info) {
        task_info(mach_task_self_,
                  task_flavor_t(MACH_TASK_BASIC_INFO),
                  // `task_info`ã®å¼•æ•°ã«ã™ã‚‹ãŸã‚ã«Int32ã®ãƒ¡ãƒ¢ãƒªé…ç½®ã¨è§£é‡ˆã•ã›ã‚‹å¿…è¦ãŒã‚ã‚‹
                  $0.withMemoryRebound(to: Int32.self, capacity: 1) { pointer in
                    UnsafeMutablePointer&lt;Int32&gt;(pointer)
                  }, &amp;count)
    }
    // MBè¡¨è¨˜ã«å¤‰æ›ã—ã¦è¿”å´
    return result == KERN_SUCCESS ? info.resident_size / 1024 / 1024 : nil
}
</code></pre>

<p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå®ƒæ˜¯MBå•ä½ï¼Œä½†åœ¨è¿™ç§æƒ…å†µä¸‹<code>ByteCountFormatter</code>æœ€å¥½ä½¿ç”¨ä¸‹é¢çš„ã€‚<br/>
<code>return</code>ï¼Œ<code>resident_size</code>è·å–åœ¨è¯¥ç‚¹ä½¿ç”¨çš„å®é™…å†…å­˜ä½¿ç”¨é‡ã€‚*ä¹Ÿå¯ä»¥åœ¨XCodeä¸­ç¡®è®¤å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œä½†å®é™…å†…å­˜ä½¿ç”¨é‡é€šå¸¸ä¼šå¤§äºè¯¥å€¼ã€‚æˆ‘ä¸çŸ¥é“å®ƒæ¶ˆè€—äº†ä»€ä¹ˆï¼Œä½†ç”±äºåˆå§‹å€¼åªæ˜¯ä¸åŒï¼Œä¼¼ä¹é€šè¿‡ç›¸å¯¹è§‚å¯Ÿæ²¡æœ‰é—®é¢˜<img src="media/15398626891772/1f646.png" alt="ï¼šok_womanï¼š" title="ï¼šok_womanï¼š"/></p>

<h2 id="toc_4"><a href="https://qiita.com/rinov/items/f30d386fb7b8b12278a5#%E3%83%87%E3%82%A3%E3%82%B9%E3%82%AF%E4%BD%BF%E7%94%A8%E9%87%8F"></a>ç£ç›˜ä½¿ç”¨æƒ…å†µ</h2>

<pre><code class="language-text">// å¿…é ˆ(ByteCountFormatterã¨FileAttributeKeyã§ä½¿ç”¨)
import UIKit

// ãƒ‡ã‚£ã‚¹ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ç¨®åˆ¥
enum DiskSpaceType {
    case total
    case free
    case used
}

func getDiskSpace(_ type: DiskSpaceType) -&gt; String {
    // GB,MB,KBè¡¨è¨˜ã®æ–‡å­—åˆ—ã«å¤‰æ›
    let byteUnitStringConverted: (Int64) -&gt; String = { size in
        ByteCountFormatter.string(fromByteCount: size,countStyle: ByteCountFormatter.CountStyle.binary)
    }
    switch type {
    case .total:
        // ãƒ‡ã‚£ã‚¹ã‚¯åˆè¨ˆå®¹é‡
        return byteUnitStringConverted(totalSpace)
    case .free:
        // ãƒ‡ã‚£ã‚¹ã‚¯ç©ºãå®¹é‡
        return byteUnitStringConverted(freeSpace)
    case .used:
        // ãƒ‡ã‚£ã‚¹ã‚¯ä½¿ç”¨é‡
        return byteUnitStringConverted(usedSpace)
    }
}

var totalSpace: Int64 {
    guard let attributes = systemAttributes,
        let size = (attributes[FileAttributeKey.systemSize] as? NSNumber)?.int64Value
        else { return 0 }
    return size
}

var freeSpace: Int64 {
    guard let attributes = systemAttributes,
        let size = (attributes[FileAttributeKey.systemFreeSize] as? NSNumber)?.int64Value
        else { return 0 }
    return size
}

var usedSpace: Int64 {
    return totalSpace - freeSpace
}

private var systemAttributes: [FileAttributeKey: Any]? {
    return try? FileManager.default.attributesOfFileSystem(forPath: NSHomeDirectory())
}
</code></pre>

<p>å…³äºç£ç›˜ä½¿ç”¨æƒ…å†µï¼Œ<code>FileAttributeKey</code>æ‚¨å¯ä»¥ä»é“¾æ¥çš„ä¿¡æ¯ä¸­è·å–ã€‚<code>computed property</code>æˆ‘è®¤ä¸ºè®¾ç½®å®ƒæ˜¯å®‰å…¨çš„ï¼Œä»¥ä¾¿æ€»ç£ç›˜å®¹é‡ä¹Ÿä¼šæ³¢åŠ¨ã€‚</p>

<h2 id="toc_5">æ‘˜è¦</h2>

<ul>
<li>Swiftè¿˜å…·æœ‰é«˜æŒ‡é’ˆå…¼å®¹æ€§ï¼Œå› æ­¤æ‚¨å¯ä»¥å®ç°ä¸Objective-Cç›¸å½“çš„å±‚ä»£ç ï¼ˆæœ‰æ—¶æ‚¨ä¸èƒ½<img src="media/15398626891772/1f914.png" alt="ï¼šæ€ç»´ï¼š" title="ï¼šæ€ç»´ï¼š"/>ï¼‰</li>
<li>æ¯•ç«Ÿæˆ‘ä»¬ç”¨Swiftå†™äº†å®ƒï¼Œè¿‡ç¨‹å‰æ™¯æ›´å¥½Â <img src="media/15398626891772/1f60e.png" alt="ï¼šå¢¨é•œï¼š" title="ï¼šå¢¨é•œï¼š"/></li>
<li>å†™å®ƒåƒSwiftä¸€æ ·å¾ˆéš¾ã€‚Â <img src="media/15398626891772/2639.png" alt="ï¼šfrowning2ï¼š" title="ï¼šfrowning2ï¼š"/></li>
</ul>

<h2 id="toc_6"><a href="https://qiita.com/rinov/items/f30d386fb7b8b12278a5#%E5%8F%82%E8%80%83"></a>å‚è€ƒ</h2>

<p><a href="https://www.gnu.org/software/hurd/gnumach-doc/Thread-Information.html">https://www.gnu.org/software/hurd/gnumach-doc/Thread-Information.html</a></p>

<p><a href="https://forums.developer.apple.com/thread/64665">https://forums.developer.apple.com/thread/64665</a></p>

<p><a href="https://stackoverflow.com/questions/8223348/ios-get-cpu-usage-from-application">https://stackoverflow.com/questions/8223348/ios-get-cpu-usage-from-application</a></p>

<p><a href="https://stackoverflow.com/questions/787160/programmatically-retrieve-memory-usage-on-iphone">https://stackoverflow.com/questions/787160/programmatically-retrieve-memory-usage-on-iphone</a></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[å…³äºæ›´æ¢ä¸»é¢˜]]></title>
    <link href="http://www.citynight.cn/Blog/15393255857280.html"/>
    <updated>2018-10-12T14:26:25+08:00</updated>
    <id>http://www.citynight.cn/Blog/15393255857280.html</id>
    <content type="html"><![CDATA[
<p>ä»Šå¤©åˆ·Githubï¼Œçœ‹åˆ°ä¸€ä¸ªå¼€æºApp <a href="https://github.com/weiran/Hackers">Hackers</a>æºç é‡Œé¢å…³äºæ›´æ¢ä¸»é¢˜å†™çš„æŒºå¥½çš„ã€‚</p>

<p>åŸå…ˆæˆ‘çš„æƒ³æ³•å°±æ˜¯åˆ‡æ¢è¯­è¨€å’Œæ›´æ–°ä¸»é¢˜å‘é€ä¸ªé€šçŸ¥å°±å¥½äº†ï¼Œç„¶åæ¯ä¸ªé¡µé¢éƒ½ç›‘å¬ä¸‹è¿™ä¸ªé€šçŸ¥ã€‚<br/>
ä½†æ˜¯è¿™ä¸ªé¡¹ç›®é‡Œé¢é‡‡ç”¨çš„æ˜¯æ¯ä¸ªæ§åˆ¶å™¨éƒ½æ³¨å†Œä¸‹ï¼Œç„¶åå½“æ›´æ¢ä¸»é¢˜æ—¶æŠŠæ‰€æœ‰æ³¨å†Œçš„æ§åˆ¶å™¨éƒ½æ›´æ–°ä¸‹ä¸»é¢˜<br/>
å¯ä»¥çœ‹ä¸‹<a href="https://github.com/weiran/Hackers/tree/master/Client/Themes">è¿™éƒ¨åˆ†ä»£ç </a><br/>
åœ¨<code>Theming.swift</code>æ–‡ä»¶ä¸­å®šä¹‰äº†<code>ThemeProvider</code> å’Œ <code>Themed</code>åè®®</p>

<pre><code class="language-text">/// Describes a type that holds a current `Theme` and allows
/// an object to be notified when the theme is changed.
protocol ThemeProvider {
    /// Placeholder for the theme type that the app will use
    associatedtype Theme
    
    /// The current theme that is active
    var currentTheme: Theme { get }
    
    /// Subscribe to be notified when the theme changes. Handler will be
    /// remove from subscription when `object` is deallocated.
    func subscribeToChanges(_ object: AnyObject, handler: @escaping (Theme) -&gt; Void)
}

/// Describes a type that can have a theme applied to it
protocol Themed {
    /// A Themed type needs to know about what concrete type the
    /// ThemeProvider is. So we don&#39;t clash with the protocol,
    /// let&#39;s call this associated type _ThemeProvider
    associatedtype _ThemeProvider: ThemeProvider
    
    /// Return the current app-wide theme provider
    var themeProvider: _ThemeProvider { get }
    
    /// This will be called whenever the current theme changes
    func applyTheme(_ theme: _ThemeProvider.Theme)
}

extension Themed where Self: AnyObject {
    /// This is to be called once when Self wants to start listening for
    /// theme changes. This immediately triggers `applyTheme()` with the
    /// current theme.
    func setupTheming() {
        applyTheme(themeProvider.currentTheme)
        themeProvider.subscribeToChanges(self) { [weak self] newTheme in
            self?.applyTheme(newTheme)
        }
    }
}
</code></pre>

<p>æ ¹æ®åè®®å¯ä»¥å¦‚ä¸‹æ“ä½œï¼š</p>

<pre><code class="language-text">final class AppThemeProvider: ThemeProvider {
    static let shared: AppThemeProvider = .init()
    
    private var theme: SubscribableValue&lt;AppTheme&gt;
    private var availableThemes: [AppTheme] = [.light, .dark]
    
    var currentTheme: AppTheme {
        get {
            return theme.value
        }
        set {
            setNewTheme(newValue)
        }
    }
    
    init() {
        theme = SubscribableValue&lt;AppTheme&gt;(value: .light)
    }
    
    private func setNewTheme(_ newTheme: AppTheme) {
        let window = UIApplication.shared.delegate!.window!!
        UIView.transition(
            with: window,
            duration: 0.3,
            options: [UIView.AnimationOptions.transitionCrossDissolve],
            animations: {
                self.theme.value = newTheme
        },
            completion: nil
        )
    }
    
    func subscribeToChanges(_ object: AnyObject, handler: @escaping (AppTheme) -&gt; Void) {
        theme.subscribe(object, using: handler)
    }
    
    func nextTheme() {
        guard let nextTheme = availableThemes.rotate() else {
            return
        }
        currentTheme = nextTheme
    }
}

extension Themed where Self: AnyObject {
    var themeProvider: AppThemeProvider {
        return AppThemeProvider.shared
    }
}
</code></pre>

<p>å…·ä½“ä¸»é¢˜çš„é¢œè‰²è§<code>Theme.swift</code></p>

<p>ç”±ä¸Šé¢çš„å®ä¾‹æˆ‘ä»¬çŸ¥é“æ‰€æœ‰é¡µé¢éƒ½æ˜¯è¢«æš‚å­˜çš„ï¼Œæš‚å­˜æ“ä½œä¸º</p>

<pre><code class="language-text">private var theme: SubscribableValue&lt;AppTheme&gt;
</code></pre>

<p>SubscribableValueçš„å…·ä½“å®ç°è§<code>SubscribableValue.swift</code>ï¼Œè¿™ä¸ªç»“æ„æ˜¯ä¸€ä¸ªç»“æ„ä½“,å¦‚ä¸‹ï¼š</p>

<pre><code class="language-text">/// Stores a value of type T, and allows objects to subscribe to
/// be notified with this value is changed.
struct SubscribableValue&lt;T&gt; {
    private typealias Subscription = (object: Weak&lt;AnyObject&gt;, handler: (T) -&gt; Void)

    private var subscriptions: [Subscription] = []

    var value: T {
        didSet {
            for (object, handler) in subscriptions where object.value != nil {
                handler(value)
            }
        }
    }

    init(value: T) {
        self.value = value
    }

    mutating func subscribe(_ object: AnyObject, using handler: @escaping (T) -&gt; Void) {
        subscriptions.append((Weak(value: object), handler))
        cleanupSubscriptions()
    }

    /// Removes any subscriptions where the object has been deallocated
    /// and no longer exists
    private mutating func cleanupSubscriptions() {
        subscriptions = subscriptions.filter({ entry in
            return entry.object.value != nil
        })
    }
}
</code></pre>

<p>ä¸Šé¢çš„weakçš„å®ç°ä¸º</p>

<pre><code class="language-text">/// A box that allows us to weakly hold on to an object
struct Weak&lt;Object: AnyObject&gt; {
    weak var value: Object?
}
</code></pre>

<p>æ¯ä¸ªéœ€è¦æ›´æ¢ä¸»é¢˜çš„æ§åˆ¶å™¨æˆ–è€…è§†å›¾éƒ½ä¼šæ³¨å†Œä¸€ä¸‹ï¼Œ<br/>
<img src="media/15393255857280/15394143263288.jpg" alt="" style="width:1680px;"/></p>

<p><img src="media/15393255857280/15394143483076.jpg" alt="" style="width:1680px;"/></p>

<p><img src="media/15393255857280/15394143927777.jpg" alt="" style="width:1680px;"/></p>

<p>è¿™ä¸ªå°±æ˜¯åè®®çš„é»˜è®¤å®ç°ï¼Œç„¶åä¼šæŠŠå½“å‰å¯¹è±¡æ³¨å†Œä¸€ä¸‹ã€‚<br/>
æ¯æ¬¡èµ‹å€¼çš„æ—¶å€™éƒ½ä¼šæ›´æ–°ä¸€ä¸‹æ‰€æœ‰æ³¨å†Œçš„è§†å›¾ã€‚</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[å…¬å¸è§„èŒƒ]]></title>
    <link href="http://www.citynight.cn/Blog/15380500153174.html"/>
    <updated>2018-09-27T20:06:55+08:00</updated>
    <id>http://www.citynight.cn/Blog/15380500153174.html</id>
    <content type="html"><![CDATA[
<h2 id="toc_0">Gitåˆ†æ”¯å»ºè®®</h2>

<blockquote>
<p>å¼€å‘å¿…è¯»<a href="http://www.ruanyifeng.com/blog/2012/07/git.html">http://www.ruanyifeng.com/blog/2012/07/git.html</a></p>

<p>å¤šæäº¤ï¼Œå°‘æ¨é€ã€‚</p>

<h5 id="toc_1">ä¸¥æ ¼éµå®ˆï¼š</h5>

<p>å¡«å†™æœ¬æ¬¡ä¿®æ”¹å†…å®¹</p>

<p>ä»£ç åˆå¹¶å¿…é¡»å‘½ä»¤è¡Œåˆå¹¶ï¼Œå¹¶ä¸”åŠ ä¸Š--no-ffå‚æ•°ã€‚ï¼ˆæ–‡ç« ä¸­æœ‰è¯¦ç»†ä»‹ç»ï¼‰</p>

<p>å°†Â <strong>feature/develop_wangchao_æ‰“å°bug</strong>Â åˆ†æ”¯åˆå¹¶åˆ°å½“å‰åˆ†æ”¯å‘½ä»¤å¦‚ä¸‹ï¼š</p>

<p>git merge --no-ff feature/develop_wangchao_æ‰“å°bug</p>
</blockquote>

<h5 id="toc_2">ä¸æ–‡ç« ä¸­çš„å·®å¼‚ï¼š</h5>

<blockquote>
<p>æ‰€æœ‰é—®é¢˜ç”±ç»„é•¿æ¥å®šå±äºç´§æ€¥é—®é¢˜ï¼Œè¿˜æ˜¯ç‰¹æ€§é—®é¢˜ã€‚</p>

<blockquote>
<p>ç´§æ€¥é—®é¢˜ä¸Šçº¿æµç¨‹ï¼šé¢„å‘å¸ƒåˆ†æ”¯--&gt;ç”Ÿäº§åˆ†æ”¯ã€‚</p>

<p>ç‰¹æ€§é—®é¢˜ä¸Šçº¿æµç¨‹ï¼šå¼€å‘åˆ†æ”¯--&gt;é¢„å‘å¸ƒåˆ†æ”¯--&gt;ç”Ÿäº§åˆ†æ”¯ã€‚ï¼ˆ<strong>é¢„å‘å¸ƒåˆ†æ”¯</strong>Â ä»Â <strong>ç”Ÿäº§åˆ†æ”¯</strong>Â æ‹‰å–ï¼‰</p>
</blockquote>

<p><strong>é¢„å‘å¸ƒåˆ†æ”¯</strong>Â çš„çš„é—®é¢˜æŒ‰ç…§bugåˆ†æ”¯å¤„ç†ã€‚</p>

<blockquote>
<p>æ­¥éª¤ï¼šä»Â <strong>é¢„å‘å¸ƒåˆ†æ”¯</strong>Â æ‹‰å–bugåˆ†æ”¯ï¼Œä¿®æ”¹å®Œæˆååˆå¹¶åˆ°Â <strong>é¢„å‘å¸ƒåˆ†æ”¯</strong>Â ï¼Œæµ‹è¯•é€šè¿‡åÂ <strong>é¢„å‘å¸ƒåˆ†æ”¯</strong>Â åˆå¹¶åˆ°Â <strong>ç”Ÿäº§åˆ†æ”¯</strong>Â ï¼Œåœ¨ç”Ÿäº§åˆ†æ”¯æ‰“ä¸Šå’ŒÂ <strong>é¢„å‘å¸ƒåˆ†æ”¯</strong>Â åç§°ä¸€æ ·çš„æ ‡ç­¾ï¼ŒÂ <strong>é¢„å‘å¸ƒåˆ†æ”¯</strong>Â åˆ é™¤ï¼Œ<strong>bugåˆ†æ”¯</strong>Â åˆ é™¤ã€‚</p>
</blockquote>

<p>ç”Ÿäº§ç¯å¢ƒç´§æ€¥é—®é¢˜å’Œbugï¼ŒæŒ‰ç…§bugåˆ†æ”¯å¤„ç†ï¼Œæ­¥éª¤å‚è€ƒÂ <strong>é¢„å‘å¸ƒåˆ†æ”¯</strong>Â bugå¤„ç†æ–¹å¼ã€‚</p>

<p>æ¨ègitå›¾å½¢ç•Œé¢macç”¨sourcetreeï¼Œwindowsç”¨git tortoiseï¼Œå¯ä»¥æ¸…æ™°çœ‹åˆ°æäº¤è®°å½•å›¾å’Œæäº¤äººã€‚</p>

<p>æ³¨æ„ï¼šç”Ÿäº§åˆ†æ”¯ã€é¢„å‘å¸ƒåˆ†æ”¯åˆ†åˆ«2äººæœ‰ä¿®æ”¹æƒé™ï¼Œè´Ÿè´£ä»£ç åˆå¹¶ï¼Œé¢„å‘å¸ƒåˆ†æ”¯åˆå¹¶åˆ°ç”Ÿäº§åˆ†æ”¯æ—¶ï¼Œéœ€è¦çœ‹gitæäº¤è®°å½•å›¾ï¼Œæ‰€æœ‰ä¿®æ”¹äººå‘˜å¿…é¡»ç­¾å­—ï¼Œè¯´æ˜ä¿®æ”¹éƒ¨åˆ†å…³è”çš„é¡¹ç›®ï¼Œåˆ†æ”¯æƒé™å®šæœŸæŠ½æŸ¥ã€‚</p>
</blockquote>

<h5 id="toc_3">å»ºè®®åˆ†æ”¯å‘½åï¼š</h5>

<blockquote>
<p>äº‘ç«¯ï¼š</p>

<blockquote>
<pre><code class="language-text">|----master                                         ç”Ÿäº§åˆ†æ”¯
|----release                                        é¢„å‘å¸ƒåˆ†æ”¯æ–‡ä»¶å¤¹
        |----master20180915                         é¢„å‘å¸ƒåˆ†æ”¯
|----develop                                        å¼€å‘åˆ†æ”¯
|----feature                                        ä¸ªäººåˆ†æ”¯æ–‡ä»¶å¤¹
        |----develop_wangchao_ä¼šå‘˜ç»“è´¦               å…·ä½“ä¸ªäººåˆ†æ”¯
        |----develop_shaochuanjun_å¾®ä¿¡ç»“è´¦           å…·ä½“ä¸ªäººåˆ†æ”¯
|----fixbug                                         bugåˆ†æ”¯æ–‡ä»¶å¤¹
        |----master20180915_wangchao_æ‰«ç ç‚¹é¤bug     å…·ä½“ä¸ªäººbugåˆ†æ”¯
        |----master20180915_shaochuanjun_ç‚¹èœbug     å…·ä½“ä¸ªäººbugåˆ†æ”¯
</code></pre>

<p>èƒ½å¤Ÿç›´è§‚çœ‹åˆ°ä¸ªäººåˆ†æ”¯çš„æºåˆ†æ”¯ï¼ˆä»å“ªä¸ªåˆ†æ”¯æ‹‰å–çš„ï¼‰ã€‚</p>

<p>featureã€fixbugä¸‹çš„åˆ†æ”¯ä¸å…è®¸è·¨æºåˆå¹¶ã€è·¨æºæ‹‰å–ï¼ˆdevelop_å¼€å¤´çš„åˆ†æ”¯åªèƒ½åˆå¹¶åˆ°developï¼Œåªèƒ½æ‹‰å–developåˆ†æ”¯ï¼‰ï¼Œreleaseä¸‹çš„åˆ†æ”¯é™¤å¤–ã€‚</p>

<p>å®é™…ä¸Šbugåˆ†æ”¯å¯ä»¥å¾€é¢„å‘å¸ƒã€å¼€å‘åˆ†æ”¯åˆå¹¶ï¼Œç®€å•èµ·è§æˆ‘ä»¬ç¦æ­¢è·¨æºåˆå¹¶</p>

<p>releaseä¸‹çš„åˆ†æ”¯æ¯æ¬¡åˆå¹¶åˆ°masteræ—¶è¦å¹¶è¡Œåˆå¹¶åˆ°developåˆ†æ”¯ã€‚</p>
</blockquote>

<p>é—¨åº—ï¼šï¼ˆç”±äºshopã€shop-printå’Œæµ·åº•æä¸€å¥—ä»£ç æ¯”è¾ƒç‰¹æ®Šï¼Œå»ºè®®å’Œäº‘ç«¯å‘½åæ–¹å¼ä¸€æ ·ï¼ŒåŠ ä¸Šå‰ç¼€æ–‡ä»¶å¤¹huoguoæˆ–haidilaoï¼‰</p>

<blockquote>
<p>hht-manageå±äºæ–°ç«é”…ç‰¹æœ‰é¡¹ç›®ï¼Œå»ºè®®æŒ‰ç…§äº‘ç«¯å‘½ååŸºç¡€ä¸Šå¢åŠ ç‰ˆæœ¬å·ã€‚</p>

<pre><code class="language-text">|----master_v1                                         ç”Ÿäº§åˆ†æ”¯
|----master_v2                                         ç”Ÿäº§åˆ†æ”¯
|----release                                        é¢„å‘å¸ƒåˆ†æ”¯æ–‡ä»¶å¤¹
        |----master_v1_20180915                         é¢„å‘å¸ƒåˆ†æ”¯
        |----master_v2_20180915                         é¢„å‘å¸ƒåˆ†æ”¯
|----develop                                        å¼€å‘åˆ†æ”¯
|----feature                                        ä¸ªäººåˆ†æ”¯æ–‡ä»¶å¤¹
        |----develop_wangchao_ä¼šå‘˜ç»“è´¦               å…·ä½“ä¸ªäººåˆ†æ”¯
        |----develop_shaochuanjun_å¾®ä¿¡ç»“è´¦           å…·ä½“ä¸ªäººåˆ†æ”¯
|----fixbug                                         bugåˆ†æ”¯æ–‡ä»¶å¤¹
        |----master20180915_wangchao_æ‰«ç ç‚¹é¤bug     å…·ä½“ä¸ªäººbugåˆ†æ”¯
        |----master20180915_shaochuanjun_ç‚¹èœbug     å…·ä½“ä¸ªäººbugåˆ†æ”¯
</code></pre>
</blockquote>

<p><strong>ä¸¾ä¾‹ï¼š</strong></p>

<blockquote>
<p>å°Aè¦åšä¸€ä¸ªæ–°åŠŸèƒ½çš„æ­¥éª¤ï¼š</p>

<p>1ã€æ‰¾ç»„é•¿ç¡®è®¤å±äºä»€ä¹ˆç±»å‹é—®é¢˜ ----&gt; 2ã€å±äºç‰¹æ€§é—®é¢˜ ----&gt; 3ã€ä»Â <strong>develop</strong>Â æ‹‰å–åˆ†æ”¯Â <strong>feature/develop_A_æ‰“å°åŠŸèƒ½</strong>Â ----&gt; 4ã€ä¿®æ”¹å®Œæˆå--no-ffåˆå¹¶åˆ°Â <strong>develop</strong>Â åˆ†æ”¯æµ‹è¯• ----&gt; 5ã€æµ‹è¯•é€šè¿‡åæ‰¾ç»„é•¿ä»ç”Ÿäº§åˆ†æ”¯æ‹‰å–é¢„å‘å¸ƒåˆ†æ”¯Â <strong>release/master20180919</strong>Â ï¼ŒæŠŠç”Ÿäº§ç¯å¢ƒçš„æ•°æ®åº“å¤‡ä»½åˆ°é¢„å‘å¸ƒç¯å¢ƒ ----&gt; 6ã€ç»„é•¿æŠŠÂ <strong>feature/develop</strong>Â åˆå¹¶åˆ°Â <strong>release/master20180919</strong>Â ----&gt; 7ã€å¼€å‘æ•´ç†æ‰€æœ‰é¢„å‘å¸ƒç¯å¢ƒæ²¡æœ‰çš„è„šæœ¬äº¤ç»™ç»„é•¿ ----&gt; 8ã€ç»„é•¿å­˜æ¡£Â <strong>master20180919.sql</strong>Â åäº¤ç»™è¿ç»´æ‰§è¡Œ ----&gt; 9ã€æµ‹è¯•é€šè¿‡åç»„é•¿æŠŠÂ <strong>master20180919.sql</strong>Â æ–‡ä»¶ä¸Šä¼ åˆ°Â <strong>release/master20180919</strong>Â åˆ†æ”¯ï¼Œå¹¶åˆå¹¶åˆ°ç”Ÿäº§ã€æµ‹è¯•ç¯å¢ƒï¼Œæ­£å¼ç¯å¢ƒæ‰“ä¸Šæ ‡ç­¾Â <strong>master20180919</strong>Â ï¼Œåˆ é™¤Â <strong>release/master20180919</strong>Â åˆ†æ”¯ ----&gt; 10ã€è¿ç»´æ­£å¼ç¯å¢ƒæ‰§è¡Œç›®å½•ä¸‹çš„Â <strong>master20180919.sql</strong>Â ã€æ‰“ç‰ˆã€‚</p>

<p>æ³¨æ„ï¼šè„šæœ¬åˆ†é¢„åˆ¶è„šæœ¬ï¼ˆinsertï¼‰ã€å»ºåº“è„šæœ¬ï¼ˆcreateã€alterï¼‰</p>
</blockquote>
</blockquote>

<h2 id="toc_4">DBå»ºè®®</h2>

<blockquote>
<p>æµ‹è¯•ç¯å¢ƒå¼€æ”¾è¯»å†™æƒé™ï¼Œå…¬å¸ç™½åå•ã€‚</p>

<p>ç”Ÿäº§ç¯å¢ƒäº‘ç«¯ã€é—¨åº—æ•°æ®åº“ï¼Œç™½åå•è®¿é—®ã€‚</p>

<p>é¢„å‘å¸ƒç¯å¢ƒåªå¼€æ”¾è¯»æƒé™ï¼Œè„šæœ¬éœ€äº¤ç»™ç»„é•¿å¤‡ä»½ï¼Œç»„é•¿äº¤ç»™è¿ç»´æ‰§è¡Œã€‚å»ºè®®å¤‡ä»½æ–‡ä»¶åå’ŒÂ <strong>é¢„å‘å¸ƒåˆ†æ”¯</strong>Â åä¿æŒä¸€è‡´ï¼Œ<strong>é¢„å‘å¸ƒåˆ†æ”¯</strong>Â åˆå¹¶åˆ°Â <strong>ç”Ÿäº§åˆ†æ”¯</strong>Â æ—¶æ·»åŠ åˆ°Â <strong>é¢„å‘å¸ƒåˆ†æ”¯</strong>Â çš„SQLæ–‡ä»¶å¤¹ä¸‹ï¼Œå¹¶æ‰§è¡Œç›¸åŒåç§°çš„sqlæ–‡ä»¶ã€‚</p>

<p>ç¼ºï¼šå¹³å°å‡ºå·¥å…·æ ¹æ®æ—¶é—´æ®µæŠ½å–äº‘ç«¯æŒ‡å®šå•†æˆ·ã€é—¨åº—çš„æ•°æ®ï¼Œå¹¶åšè„±æ•å¤„ç†ã€‚</p>
</blockquote>

<h2 id="toc_5">Configå»ºè®®</h2>

<blockquote>
<p>é¡¹ç›®åªç•™address.confï¼Œlocal.confä¸¤ä¸ªé…ç½®æ–‡ä»¶ï¼Œlocal.confå¼•ç”¨address.confã€‚æ‰€æœ‰å­˜åœ¨ç¯å¢ƒå·®å¼‚çš„é…ç½®ï¼Œéƒ½æ”¾åˆ°address.confé‡Œï¼Œä¸è¦å•ç‹¬åˆ›å»ºredis.confã€‚</p>

<p>1ã€address.confä¸­åŒ…å«æ‰€æœ‰é¡¹ç›®çš„ipã€ç«¯å£ã€‚</p>

<p>2ã€æ‰“ç‰ˆåçº¿ä¸Šé€šè¿‡å›ºå®šç›®å½•çš„address.confæ¥è¦†ç›–æ‰“ç‰ˆé¡¹ç›®çš„address.confï¼Œæ‰€æœ‰é¡¹ç›®å…±ç”¨ä¸€ä¸ªã€‚</p>

<p>3ã€address.confçš„ä¿®æ”¹åªèƒ½é€šè¿‡è¿ç»´</p>

<p><strong>ä¾‹å¦‚:</strong></p>

<p>address.confé…ç½®å¦‚ä¸‹ï¼š</p>

<p>Markup</p>

<pre><code class="language-text">#åœ¨æ–‡ä»¶ä¸­ä½¿ç”¨æ–¹å¼ä¸ºï¼šother.var1 = &quot;https://&quot;${address.db1.host}&quot;:&quot;${address.db1.port}&quot;/app/somefunction&quot;
address {
  #æ•°æ®è¿æ¥ åœ°å€/ç«¯å£/æ•°æ®åº“/ç”¨æˆ·å/å¯†ç 
  db {
    host = &quot;10.170.195.16&quot;
    port = &quot;3306&quot;
    db_name = &quot;canyin_saas&quot;
    db_user = &quot;huoguo&quot;
    db_password = &quot;12312300&quot;
  }
  #æœ¬åœ°ç™»å½•åŠæƒé™æœåŠ¡éƒ¨ç½²åœ°å€
  loginServer{
    host=&quot;http://test-canyinsaas.honghuotai.com&quot;
    port=&quot;8001&quot;
    path=&quot;/login&quot;
  }
  #å¾®ä¿¡appid
  wechat{
      appid=&quot;aaaaaaaaaaaa&quot;
      #å¾®ä¿¡appsecret
      appsecret=&quot;bbbbbbbbbbbbbbb&quot;
  }
  # Redisç›¸å…³é…ç½®
  redis{
      ip = 127.0.0.1
      port = 6379
      passwd = 345555
      number = 0
      defaultDBNum = 0
      maxDBNum = 16
      maxActive = 1024
      maxIdle = 200
      maxWait = 1000
      testOnBorrow = false
      testOnReturn = true
  }
}
</code></pre>

<p>dev.confé…ç½®å¦‚ä¸‹</p>

<p>Markup</p>

<pre><code class="language-text">    include &quot;../application.conf&quot;
    include &quot;./address.conf&quot;
    db {
      default.driver = com.mysql.jdbc.Driver
      default.url = &quot;jdbc:mysql://&quot;${address.db.host}&quot;:&quot;${address.db.port}&quot;/&quot;${address.db.db_name}&quot;?useUnicode=true&amp;characterEncoding=UTF-8&amp;allowMultiQueries=true&quot;
      default.username = ${address.db.db_user}
      default.password = ${address.db.db_password}
      default.logSql = true
    }
    # äº‘ç«¯shopæœåŠ¡
    cloudServerSocketService=${address.cloudServerSocket.host}&quot;:&quot;${address.cloudServerSocket.port}${address.loginServer.path}
    #è·å–æ‰€æœ‰æ”¯ä»˜æ–¹å¼
    user.payway.getall=${loginService}&quot;/position/businesspower/getEmpPowerList&quot;
</code></pre>
</blockquote>

<h2 id="toc_6">åç«¯æ’ä»¶å»ºè®®</h2>

<blockquote>
<p>æ’ä»¶åï¼šAlibaba Java Coding Guidelines</p>

<p>githubåœ°å€ï¼š<a href="https://github.com/alibaba/p3c/">https://github.com/alibaba/p3c/</a></p>

<blockquote>
<p>å®‰è£…æ­¥éª¤å¦‚ä¸‹ï¼š</p>

<p>æ‰“å¼€idea--&gt;Preference--&gt;Plugins--&gt;Browse Repositoriesã€‚</p>

<p>æœAlibaba Java Coding Guidelinesï¼Œç‚¹å‡»å®‰è£…ï¼Œé‡å¯ã€‚</p>

<p>æœ‰é—®é¢˜çš„ä»£ç ä¼šä»¥çº¢è‰²/é»‘è‰²æ³¢æµªçº¿æ ‡è®°å‡ºæ¥ï¼Œéœ€è¦æŒ‰ç…§æç¤ºä¿®æ”¹ä»£ç ã€‚</p>
</blockquote>
</blockquote>

<h2 id="toc_7">ä»£ç å»ºè®®</h2>

<blockquote>
<p>1ã€ æ¥å£å…¥å‚é¿å…ä½¿ç”¨ç±»å‹å¼ºè½¬</p>

<p>2ã€å°æ•°ç¦æ­¢ç›´æ¥å‚ä¸è¿ç®—ï¼Œç”¨BigDecimal</p>

<p>3ã€ç¦æ­¢ç›´æ¥å¾€ç¼“å­˜ä¸­å­˜æ”¾æ•°æ®ï¼ˆå‰ç«¯åŒæ ·é€‚ç”¨ï¼‰</p>
</blockquote>

<p>Java</p>

<pre><code class="language-text">//é—®é¢˜ä»£ç ï¼Œæ— æ³•è¿½è¸ªåˆ°userInfoçš„æ•°æ®åœ¨å“ªé‡Œè¢«ä¿®æ”¹ã€‚
public void doProblem(JSONObject userInfo){
    //do something
    if(RedisUtil.get(&quot;userInfo&quot;)!=null){
        //do something
        RedisUtil.del(&quot;userInfo&quot;);
    }else{
        //do something
        RedisUtil.set(&quot;userInfo&quot;,userInfo);
    }
}
//æ”¹è¿›ä»£ç ï¼Œå¯ä»¥åœ¨addUserInfoã€deleteUserInfoæ–¹æ³•ä¸­ç›‘æ§åˆ°userInfoæ·»åŠ ã€é”€æ¯ã€‚
public void doRight(JSONObject userInfo){
    //do something
    if(RedisUtil.getUserInfo()!=null){
        //do something
        RedisUtil.deleteUserInfo(&quot;userInfo&quot;);
    }else{
        //do something
        RedisUtil.addUserInfo(&quot;userInfo&quot;,userInfo);
    }
}
</code></pre>

<blockquote>
<p>4ã€æ•°æ®åº“è®¾è®¡ï¼Œä¸‹åˆ—å­—æ®µå¿…é¡»æœ‰ï¼Œmodelç»§æ‰¿com.hht.common.base.model.BaseModelã€‚</p>

<p>æ¶‰åŠåˆ°å­˜æ“ä½œå‘˜idçš„å­—æ®µï¼Œå…¨éƒ¨å­˜äººå‘˜idï¼Œç¦æ­¢å­˜ç”¨æˆ·idï¼ˆemployId(äººå‘˜id)æ¥è‡ªpro_employeeè¡¨ï¼ŒuserIdï¼ˆç”¨æˆ·idï¼‰æ¥è‡ªhht_memberè¡¨ï¼‰</p>
</blockquote>

<p>Java</p>

<pre><code class="language-text">    //ä¸»é”®
    private String id;
    //åˆ é™¤çŠ¶æ€Y,N
    private String dr;
    //æ—¶é—´æˆ³ï¼Œæ¯æ¬¡updateæ“ä½œéƒ½è¦æ›´æ–°
    private Long ts;
    //åˆ›å»ºæ—¶é—´ï¼Œåªåœ¨insertæ—¶æ›´æ–°
    private Long createTime;
    //åˆ›å»ºäººid
    private String creatorId;
    //ä¿®æ”¹æ—¶é—´ï¼Œupdateæ—¶æ›´æ–°æ­¤å­—æ®µ
    private Long modifyTime;
    //ä¿®æ”¹äººï¼Œupdateæ—¶ä¿®æ”¹
    private String modifierId;
    //å•†æˆ·idï¼ŒéæŠ¥è¡¨æŸ¥è¯¢å¿…é¡»åŠ æ­¤æ¡ä»¶
    private String companyId;
    //é—¨åº—idï¼Œé—¨åº—æŸ¥è¯¢å¿…é¡»åŠ æ­¤æ¡ä»¶
    private String shopId;
    //æ˜¯å¦å¯ç”¨ï¼Œé¢„ç•™ï¼ŒN,Y
    private String enable;
</code></pre>

<blockquote>
<p>5ã€æ›´å¤šå»ºè®®å‚è€ƒ<a href="http://www.ruanyifeng.com/blog/2012/07/git.html">http://www.ruanyifeng.com/blog/2012/07/git.html</a>é‡Œé¢çš„ã€Šé˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œï¼ˆè¯¦å°½ç‰ˆï¼‰.pdfã€‹</p>
</blockquote>

<h2 id="toc_8">æ¥å£å»ºè®®</h2>

<blockquote>
<p>rapä¸Šçš„å‚æ•°å¿…é¡»å’Œå®é™…æ¥å£ä¸­çš„å‚æ•°ä¸€è‡´ï¼Œå‰åç«¯å¹¶è¡Œå¼€å‘æ—¶ï¼Œå…ˆçº¦å®šå¥½mockæ•°æ®ã€‚</p>

<p>ä¸¥æ ¼æŒ‰ç…§restfulè§„èŒƒï¼Œå¤–éƒ¨æ¥å£èµ°tokenï¼ŒæœåŠ¡ä¹‹é—´èƒ½èµ°tokenèµ°tokenï¼Œèµ°ä¸äº†tokenèµ°ç­¾åï¼Œä¸å…è®¸å…è®¤è¯ï¼ˆç‰¹æ®Šæ¥å£é™¤å¤–ï¼‰ã€‚</p>
</blockquote>

<h2 id="toc_9">æ‰“ç‰ˆå»ºè®®</h2>

<blockquote>
<p>é¢„å‘å¸ƒã€æ­£å¼ç¯å¢ƒæ‰“ç‰ˆéœ€å¡«ç”³è¯·å•</p>

<blockquote>
<p>1ã€ç»„é•¿åˆå¹¶ä»£ç ï¼Œæ ¹æ®æäº¤è®°å½•å›¾æ‰¾åˆ°æ‰€æœ‰æäº¤äººã€‚</p>

<p>2ã€æ‰€æœ‰æäº¤äººç­¾å­—ï¼Œå†™ä¸Šè‡ªå·±ä¿®æ”¹éƒ¨åˆ†çš„å…³è”é¡¹ç›®ï¼Œæµ‹è¯•ç¯å¢ƒæµ‹è¯•äººå‘˜ç­¾å­—ã€‚ï¼ˆæŠ½æŸ¥ï¼‰</p>

<p>3ã€é¢„å‘å¸ƒç¯å¢ƒæµ‹è¯•å®Œæˆï¼ŒæœŸé—´æ‰€æœ‰è„šæœ¬ç»è¿‡ç»„é•¿å¤‡ä»½åäº¤ç»™è¿ç»´æ‰§è¡Œã€‚</p>

<p>4ã€é¢„å‘å¸ƒåˆ†æ”¯åˆå¹¶åˆ°ç”Ÿäº§ç¯å¢ƒåˆ†æ”¯ï¼Œè¿è¡Œå’Œé¢„å‘å¸ƒåˆ†æ”¯åç§°ä¸€æ ·çš„æ•°æ®åº“è„šæœ¬æ–‡ä»¶ï¼Œæµ‹è¯•äººå‘˜ç­¾å­—ã€‚</p>

<p>5ã€å®æ–½éªŒè¯é—®é¢˜ï¼Œå¡«å†™æˆ–é‚®ä»¶ç¡®è®¤éªŒè¯æƒ…å†µã€‚</p>

<p>6ã€ç”³è¯·å•å®Œæˆï¼Œäº¤ç»™äº§å“å­˜æ¡£ã€‚</p>
</blockquote>

<h2 id="toc_10">æ—¥å¿—å»ºè®®</h2>

<p>å…ˆæŒ‰ç…§å„ç»„éœ€æ±‚è¾“å‡ºï¼Œè§„èŒƒå¾…æ•´ç†</p>
</blockquote>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[å„ç§é˜Ÿåˆ—çš„æ‰§è¡Œæ•ˆæœ]]></title>
    <link href="http://www.citynight.cn/Blog/15375346728525.html"/>
    <updated>2018-09-21T20:57:52+08:00</updated>
    <id>http://www.citynight.cn/Blog/15375346728525.html</id>
    <content type="html"><![CDATA[
<table>
<thead>
<tr>
<th style="text-align: left"></th>
<th style="text-align: left">å¹¶å‘é˜Ÿåˆ—</th>
<th style="text-align: left">æ‰‹åŠ¨åˆ›å»ºçš„ä¸²è¡Œé˜Ÿåˆ—</th>
<th style="text-align: left">ä¸»é˜Ÿåˆ—</th>
</tr>
</thead>

<tbody>
<tr>
<td style="text-align: left">åŒæ­¥ï¼ˆsyncï¼‰</td>
<td style="text-align: left">*æ²¡æœ‰å¼€å¯æ–°çº¿ç¨‹ *ä¸²è¡Œæ‰§è¡Œä»»åŠ¡</td>
<td style="text-align: left">*æ²¡æœ‰å¼€å¯æ–°çº¿ç¨‹ *ä¸²è¡Œæ‰§è¡Œä»»åŠ¡</td>
<td style="text-align: left">*æ²¡æœ‰å¼€å¯æ–°çº¿ç¨‹ *ä¸²è¡Œæ‰§è¡Œä»»åŠ¡</td>
</tr>
<tr>
<td style="text-align: left">å¼‚æ­¥ï¼ˆasyncï¼‰</td>
<td style="text-align: left">*æœ‰å¼€å¯æ–°çº¿ç¨‹ *å¹¶å‘æ‰§è¡Œä»»åŠ¡</td>
<td style="text-align: left">*æœ‰å¼€å¯æ–°çº¿ç¨‹ *ä¸²è¡Œæ‰§è¡Œä»»åŠ¡</td>
<td style="text-align: left">*æ²¡æœ‰å¼€å¯æ–°çº¿ç¨‹ *ä¸²è¡Œæ‰§è¡Œä»»åŠ¡</td>
</tr>
</tbody>
</table>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[CocaPods æ·»åŠ å¤´æ–‡ä»¶çš„æŠ¥é”™  çš„è§£å†³åŠæ³•]]></title>
    <link href="http://www.citynight.cn/Blog/15374224515215.html"/>
    <updated>2018-09-20T13:47:31+08:00</updated>
    <id>http://www.citynight.cn/Blog/15374224515215.html</id>
    <content type="html"><![CDATA[
<p>åœ¨buildsettingä¸­çš„ä»¥ä¸‹ä¸¤ä¸ªè·¯å¾„ä¸­æ·»åŠ å¯¹åº”çš„è®¾ç½®ï¼Œé‡ç°ç¼–è¯‘å³å¯è§£å†³ï¼Œstackoverflowåœ°å€ï¼š<a href="https://stackoverflow.com/questions/45779591/failed-to-emit-precompiled-header-for-bridging-header?answertab=votes#tab-top">Failed to emit precompiled header for bridging header</a></p>

<pre><code class="language-text">Solution:
1 I added $(inherited) non-recursive to Search Path -&gt; Header Search Paths
2 Then added ${PODS_ROOT} recursive to Search Path -&gt; User Header Search Paths
Both the above in my projects&#39; target build settings.
</code></pre>

<p><img src="media/15374224515215/15374225919741.jpg" alt="" style="width:794px;"/></p>

]]></content>
  </entry>
  
</feed>
