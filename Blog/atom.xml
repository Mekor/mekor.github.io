<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[æå°äº‰]]></title>
  <link href="http://www.citynight.cn/Blog/atom.xml" rel="self"/>
  <link href="http://www.citynight.cn/Blog/"/>
  <updated>2016-09-07T09:55:42+08:00</updated>
  <id>http://www.citynight.cn/Blog/</id>
  <author>
    <name><![CDATA[]]></name>
    
  </author>
  <generator uri="http://www.mweb.im">MWeb</generator>

  
  <entry>
    <title type="html"><![CDATA[è½¬å‘æœºåˆ¶]]></title>
    <link href="http://www.citynight.cn/Blog/14733118707964.html"/>
    <updated>2016-09-08T13:17:50+08:00</updated>
    <id>http://www.citynight.cn/Blog/14733118707964.html</id>
    <content type="html"><![CDATA[
<blockquote>
<p>åŸºæœ¬é€»è¾‘æ¥æºè‡ªå®˜æ–¹æ–‡æ¡£ <a href="https://developer.apple.com/library/prerelease/content/documentation/Cocoa/Conceptual/ObjCRuntimeGuide/Articles/ocrtForwarding.html">Message Forwarding</a> ,è¿™é‡Œåªåšç›¸å…³ä¾‹å­çš„è§£æ.</p>
</blockquote>

<p>å½“ä¸€ä¸ªå¯¹è±¡èƒ½æ¥æ”¶ä¸€ä¸ªæ¶ˆæ¯æ—¶ï¼Œå°±ä¼šèµ°æ­£å¸¸çš„æ–¹æ³•è°ƒç”¨æµç¨‹ã€‚ä½†å¦‚æœä¸€ä¸ªå¯¹è±¡æ— æ³•æ¥æ”¶æŒ‡å®šæ¶ˆæ¯æ—¶ï¼Œåˆä¼šå‘ç”Ÿä»€ä¹ˆäº‹å‘¢ï¼Ÿé»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœæ˜¯ä»¥ [object message]çš„æ–¹å¼è°ƒç”¨æ–¹æ³•ï¼Œå¦‚æœobjectæ— æ³•å“åº”messageæ¶ˆæ¯æ—¶ï¼Œç¼–è¯‘å™¨ä¼šæŠ¥é”™ã€‚ä½†å¦‚æœæ˜¯ä»¥performâ€¦çš„å½¢å¼æ¥è°ƒç”¨ï¼Œåˆ™éœ€è¦ç­‰åˆ°è¿ è¡Œæ—¶æ‰èƒ½ç¡®å®šobjectæ˜¯å¦èƒ½æ¥æ”¶messageæ¶ˆæ¯ã€‚å¦‚æœä¸èƒ½ï¼Œåˆ™ç¨‹åºå´©æºƒã€‚<br/>
é€šå¸¸ï¼Œå½“æˆ‘ä»¬ä¸èƒ½ç¡®å®šä¸€ä¸ªå¯¹è±¡æ˜¯å¦èƒ½æ¥æ”¶æŸä¸ªæ¶ˆæ¯æ—¶ï¼Œä¼šå…ˆè°ƒç”¨<code>respondsToSelector:</code>æ¥åˆ¤æ–­ä¸€ä¸‹ã€‚å¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š</p>

<pre><code>if ([self respondsToSelector:@selector(method)]) {
    [self performSelector:@selector(method)];
}
</code></pre>

<p>å½“ä¸ä½¿ç”¨<code>respondsToSelector:</code>åˆ¤æ–­æ—¶,å°±ä¼šå¯åŠ¨&#39;æ¶ˆæ¯è½¬å‘(message forwarding)&lsquo;æœºåˆ¶,é€šè¿‡è¿™ä¸€æœºåˆ¶æˆ‘ä»¬å¯ä»¥å‘Šè¯‰å¯¹è±¡å¦‚ä½•å¤„ç†æœªçŸ¥çš„æ¶ˆæ¯.å¦‚æœä¸åšä»»ä½•å¤„ç†ä¼šå¯¼è‡´ç¨‹åºå´©æºƒ,æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¼‚å¸¸ä¿¡æ¯å¦‚ä¸‹:</p>

<pre><code>2016-09-08 13:26:53.094 selfsuper[65176:7154658] -[Student eat]: unrecognized selector sent to instance 0x7ff1b9f9f690
2016-09-08 13:26:53.103 selfsuper[65176:7154658] *** Terminating app due to uncaught exception &#39;NSInvalidArgumentException&#39;, reason: &#39;-[Student eat]: unrecognized selector sent to instance 0x7ff1b9f9f690&#39;
</code></pre>

<p>è¿™æ®µå¼‚å¸¸ä¿¡æ¯å®é™…ä¸Šæ˜¯ç”±NSObjectçš„<code>doesNotRecognizeSelector</code>æ–¹æ³•æŠ›å‡ºçš„ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡å–ä¸€äº›æªæ–½ï¼Œè®©æˆ‘ä»¬çš„ç¨‹åºæ‰§è¡Œç‰¹å®šçš„é€»è¾‘ï¼Œè€Œé¿å…ç¨‹åºçš„å´©æºƒã€‚</p>

<p>æ¶ˆæ¯è½¬å‘æœºåˆ¶åŸºæœ¬ä¸Šåˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼š</p>

<ol>
<li><p>åŠ¨æ€æ–¹æ³•è§£æ</p></li>
<li><p>å¤‡ç”¨æ¥æ”¶è€…</p></li>
<li><p>å®Œæ•´è½¬å‘</p></li>
</ol>

<h2 id="toc_0">åŠ¨æ€æ–¹æ³•è§£æ</h2>

<p>å¯¹è±¡åœ¨æ¥æ”¶åˆ°æœªçŸ¥çš„æ¶ˆæ¯æ—¶ï¼Œé¦–å…ˆä¼šè°ƒç”¨æ‰€å±ç±»çš„ç±»æ–¹æ³•+resolveInstanceMethod:(å®ä¾‹æ–¹æ³•)æˆ– è€…+resolveClassMethod:(ç±»æ–¹æ³•)ã€‚åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬æœ‰æœºä¼šä¸ºè¯¥æœªçŸ¥æ¶ˆæ¯æ–°å¢ä¸€ä¸ªâ€å¤„ç†æ–¹æ³•â€â€œã€‚ä¸è¿‡ä½¿ç”¨è¯¥æ–¹æ³•çš„å‰ææ˜¯æˆ‘ä»¬å·²ç» å®ç°äº†è¯¥â€å¤„ç†æ–¹æ³•â€ï¼Œåªéœ€è¦åœ¨è¿è¡Œæ—¶é€šè¿‡class_addMethodå‡½æ•°åŠ¨æ€æ·»åŠ åˆ°ç±»é‡Œé¢å°±å¯ä»¥äº†ã€‚å¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š</p>

<pre><code>// void(*)()
// é»˜è®¤æ–¹æ³•éƒ½æœ‰ä¸¤ä¸ªéšå¼å‚æ•°ï¼Œ
void eat(id self,SEL sel)
{
    NSLog(@&quot;%@ %@&quot;,self,NSStringFromSelector(sel));
}

// å½“ä¸€ä¸ªå¯¹è±¡è°ƒç”¨æœªå®ç°çš„æ–¹æ³•ï¼Œä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•å¤„ç†,å¹¶ä¸”ä¼šæŠŠå¯¹åº”çš„æ–¹æ³•åˆ—è¡¨ä¼ è¿‡æ¥.
// åˆšå¥½å¯ä»¥ç”¨æ¥åˆ¤æ–­ï¼Œæœªå®ç°çš„æ–¹æ³•æ˜¯ä¸æ˜¯æˆ‘ä»¬æƒ³è¦åŠ¨æ€æ·»åŠ çš„æ–¹æ³•
+ (BOOL)resolveInstanceMethod:(SEL)sel
{
    if (sel == NSSelectorFromString(@&quot;eat&quot;)) {
        // åŠ¨æ€æ·»åŠ eatæ–¹æ³•
        
        // ç¬¬ä¸€ä¸ªå‚æ•°ï¼šç»™å“ªä¸ªç±»æ·»åŠ æ–¹æ³•
        // ç¬¬äºŒä¸ªå‚æ•°ï¼šæ·»åŠ æ–¹æ³•çš„æ–¹æ³•ç¼–å·
        // ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šæ·»åŠ æ–¹æ³•çš„å‡½æ•°å®ç°ï¼ˆå‡½æ•°åœ°å€ï¼‰
        // ç¬¬å››ä¸ªå‚æ•°ï¼šå‡½æ•°çš„ç±»å‹ï¼Œ(è¿”å›å€¼+å‚æ•°ç±»å‹) v:void @:å¯¹è±¡-&gt;self :è¡¨ç¤ºSEL-&gt;_cmd
        class_addMethod(self, NSSelectorFromString(@&quot;eat&quot;), (IMP)eat, &quot;v@:&quot;);
        
    }
    
    return [super resolveInstanceMethod:sel];
}

</code></pre>

<p>ä¸è¿‡è¿™ç§æ–¹æ¡ˆæ›´å¤šçš„æ˜¯ä¸ºäº†å®ç°@dynamicå±æ€§ã€‚</p>

<h2 id="toc_1">å¤‡ç”¨æ¥æ”¶è€…</h2>

<p>å¦‚æœåœ¨ä¸Šä¸€æ­¥æ— æ³•å¤„ç†æ¶ˆæ¯ï¼Œåˆ™Runtimeä¼šç»§ç»­è°ƒä»¥ä¸‹æ–¹æ³•ï¼š</p>

<pre><code>- (id)forwardingTargetForSelector:(SEL)aSelector
</code></pre>

<p>å¦‚æœä¸€ä¸ªå¯¹è±¡å®ç°äº†è¿™ä¸ªæ–¹æ³•ï¼Œå¹¶è¿”å›ä¸€ä¸ªénilçš„ç»“æœï¼Œåˆ™è¿™ä¸ªå¯¹è±¡ä¼šä½œä¸ºæ¶ˆæ¯çš„æ–°æ¥æ”¶è€…ï¼Œä¸”æ¶ˆæ¯ä¼šè¢«åˆ†å‘åˆ°è¿™ä¸ªå¯¹è±¡ã€‚å½“ç„¶è¿™ä¸ªå¯¹è±¡ä¸èƒ½æ˜¯selfè‡ªèº«ï¼Œå¦åˆ™å°±æ˜¯å‡ºç°æ— é™å¾ªç¯ã€‚å½“ç„¶ï¼Œå¦‚æœæˆ‘ä»¬æ²¡æœ‰æŒ‡å®šç›¸åº”çš„å¯¹è±¡æ¥å¤„ç†aSelectorï¼Œåˆ™åº”è¯¥è°ƒç”¨çˆ¶ç±»çš„å®ç°æ¥è¿”å›ç»“æœã€‚</p>

<p>ä½¿ç”¨è¿™ä¸ªæ–¹æ³•é€šå¸¸æ˜¯åœ¨å¯¹è±¡å†…éƒ¨ï¼Œå¯èƒ½è¿˜æœ‰ä¸€ç³»åˆ—å…¶å®ƒå¯¹è±¡èƒ½å¤„ç†è¯¥æ¶ˆæ¯ï¼Œæˆ‘ä»¬ä¾¿å¯å€Ÿè¿™äº›å¯¹è±¡æ¥å¤„ç†æ¶ˆæ¯å¹¶è¿”å›ï¼Œè¿™æ ·åœ¨å¯¹è±¡å¤–éƒ¨çœ‹æ¥ï¼Œè¿˜æ˜¯ç”±è¯¥å¯¹è±¡äº²è‡ªå¤„ç†äº†è¿™ä¸€æ¶ˆæ¯ã€‚å¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š</p>

<pre><code>/**
 * æµ‹è¯•æ¶ˆæ¯è½¬å‘
 */
-(id)forwardingTargetForSelector:(SEL)aSelector {
    NSLog(@&quot;æ¶ˆæ¯è½¬å‘&quot;);
    NSString *selectorString = NSStringFromSelector(aSelector);
    if ([selectorString isEqualToString:@&quot;eat2&quot;]){
        // å°†æ¶ˆæ¯è½¬ç»™ RuntimeHelper å¯¹è±¡,è®©ä»–æ¥å¤„ç†
        return [RuntimeHelper new];
    }
    return [super forwardingTargetForSelector:aSelector];
}

</code></pre>

<p>è¿™ä¸€æ­¥åˆé€‚äºæˆ‘ä»¬åªæƒ³å°†æ¶ˆæ¯è½¬å‘åˆ°å¦ä¸€ä¸ªèƒ½å¤„ç†è¯¥æ¶ˆæ¯çš„å¯¹è±¡ä¸Šã€‚ä½†è¿™ä¸€æ­¥æ— æ³•å¯¹æ¶ˆæ¯è¿›è¡Œå¤„ç†ï¼Œå¦‚æ“ä½œæ¶ˆæ¯çš„å‚æ•°å’Œè¿”å›å€¼ã€‚å¦‚æœéœ€è¦ä¿®æ”¹å‚æ•°å’Œè¿”å›å€¼,å¯ä»¥ä½¿ç”¨å®Œæ•´æ¶ˆæ¯è½¬å‘.</p>

<h2 id="toc_2">å®Œæ•´æ¶ˆæ¯è½¬å‘</h2>

<p>å¦‚æœåœ¨ä¸Šä¸€æ­¥è¿˜ä¸èƒ½å¤„ç†æœªçŸ¥æ¶ˆæ¯ï¼Œåˆ™å”¯ä¸€èƒ½åšçš„å°±æ˜¯å¯ç”¨å®Œæ•´çš„æ¶ˆæ¯è½¬å‘æœºåˆ¶äº†ã€‚æ­¤æ—¶ä¼šè°ƒç”¨ä»¥ä¸‹æ–¹æ³•:</p>

<pre><code>-Â (void)forwardInvocation:(NSInvocationÂ *)anInvocation
</code></pre>

<p>å®Œæ•´ä»£ç :</p>

<pre><code>/**
 *  å®Œæ•´çš„æ¶ˆæ¯è½¬å‘
 */

/* å¿…é¡»é‡å†™ (NSMethodSignature *)methodSignatureForSelector:(SEL)aSelector
 * æ¶ˆæ¯è½¬å‘æœºåˆ¶ä½¿ç”¨ä»è¿™ä¸ªæ–¹æ³•ä¸­è·å–çš„ä¿¡æ¯æ¥åˆ›å»ºNSInvocationå¯¹è±¡ã€‚å› æ­¤æˆ‘ä»¬å¿…é¡»é‡å†™è¿™ä¸ªæ–¹æ³•ï¼Œä¸ºç»™å®šçš„selectoræä¾›ä¸€ä¸ªåˆé€‚çš„æ–¹æ³•ç­¾åã€‚
 */
- (NSMethodSignature *)methodSignatureForSelector:(SEL)aSelector {
    NSMethodSignature *signature = [super methodSignatureForSelector:aSelector];
    
    if (!signature) {
        if ([RuntimeHelper instancesRespondToSelector:aSelector]) {
            signature = [RuntimeHelper instanceMethodSignatureForSelector:aSelector];
        }
    }
    
    return signature;
}

-(void)forwardInvocation:(NSInvocation *)anInvocation {
    if ([RuntimeHelper instanceMethodSignatureForSelector:anInvocation.selector]) {
        [anInvocation invokeWithTarget:[RuntimeHelper new]];
    }
}
</code></pre>

<p>å…³äº NSInvocation å¯ä»¥å‚è§<a href="https://github.com/Mekor/MKExtension">MKExtension</a>ä¸­<code>NSObject+SEL</code>,é‡Œé¢æœ‰å…³äº NSInvocation çš„åº”ç”¨.</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[RunLoop]]></title>
    <link href="http://www.citynight.cn/Blog/14731740142157.html"/>
    <updated>2016-09-06T23:00:14+08:00</updated>
    <id>http://www.citynight.cn/Blog/14731740142157.html</id>
    <content type="html"><![CDATA[
<h2 id="toc_0">1. ä»€ä¹ˆæ˜¯runloop</h2>

<p>runloopå°±æ˜¯è¿è¡Œå¾ªç¯,å®ƒçš„åŸºæœ¬ä½œç”¨å°±æ˜¯è®©ç¨‹åºæŒç»­è¿è¡Œ,å¤„ç†Appä¸­çš„å„ç§äº‹ä»¶(è§¦æ‘¸,å®šæ—¶å™¨,Selector).<br/>
mainå‡½æ•°ä¸­UIApplicationMainå†…éƒ¨å°±å¯åŠ¨äº†ä¸€ä¸ªrunloop,è¿™æ ·UIApplicationMainå°±ä¼šä¸€ç›´æ²¡æœ‰è¿”å›å€¼,ä¿æŒäº†ç¨‹åºçš„æŒç»­è¿è¡Œ.è¿™ä¸ªé»˜è®¤çš„runloopæ˜¯è·Ÿä¸»çº¿ç¨‹ç›¸å…³è”çš„.</p>

<h2 id="toc_1">2. RunLoopä¸çº¿ç¨‹</h2>

<p>æ¯æ¡çº¿ç¨‹éƒ½æœ‰å”¯ä¸€çš„ä¸€ä¸ªä¸ä¹‹å¯¹åº”çš„RunLoopå¯¹è±¡,ä¸»çº¿ç¨‹çš„RunLoopå¯åŠ¨çš„æ—¶å€™å·²ç»é»˜è®¤åˆ›å»ºå¥½äº†,å…¶ä»–çº¿ç¨‹çš„RunLoopéœ€è¦ä¸»åŠ¨åˆ›å»º(RunLoopåœ¨ç¬¬ä¸€æ¬¡è·å–çš„æ—¶å€™åˆ›å»º,åœ¨çº¿ç¨‹ç»“æŸçš„æ—¶å€™é”€æ¯)</p>

<h2 id="toc_2">3. RunLoopå¯¹è±¡</h2>

<h4 id="toc_3">iOSä¸­æœ‰2å¥—APIæ¥è®¿é—®å’Œä½¿ç”¨runloop</h4>

<ul>
<li> Foundation -&gt; NSRunLoop</li>
<li> Core Foundation -&gt; CFRunLoopRef</li>
</ul>

<p>NSRunLoopå’ŒCFRunLoopReféƒ½æ˜¯runloopå¯¹è±¡.NSRunLoopæ˜¯åŸºäºCFRunLoopRefçš„ä¸€å±‚OCå°è£…</p>

<h4 id="toc_4">è·å¾—RunLoopå¯¹è±¡</h4>

<ul>
<li><p>Foundation </p>

<pre><code class="language-objc">[NSRunLoop currentRunLoop]; // è·å¾—å½“å‰çº¿ç¨‹çš„RunLoopå¯¹è±¡
[NSRunLoop mainRunLoop]; // è·å¾—ä¸»çº¿ç¨‹çš„RunLoopå¯¹è±¡
</code></pre></li>
<li><p>Core Foundation </p>

<pre><code class="language-objc">CFRunLoopGetCurrent(): // è·å¾—å½“å‰çº¿ç¨‹çš„RunLoopå¯¹è±¡
CFRunLoopGetMain(): //è·å¾—ä¸»çº¿ç¨‹çš„RunLoopå¯¹è±¡
</code></pre></li>
</ul>

<h2 id="toc_5">4. RunLoopç›¸å…³ç±»</h2>

<h3 id="toc_6">Core Foundationä¸­å…³äºRunLoopçš„5ä¸ªç±»</h3>

<ul>
<li>CFRunLoopRef</li>
<li>CFRunLoopModeRef</li>
<li>CFRunLoopSourceRef</li>
<li>CFRunLoopTimerRef</li>
<li>CFRunLoopObserverRef</li>
</ul>

<p>ç½‘ä¸Šå…¶ä»–äººåšå®¢æ€»ç»“:<br/>
<img src="media/14731740142157/14731758243846.jpg" alt=""/></p>

<h3 id="toc_7">CFRunLoopModeRef</h3>

<p><strong>CFRunLoopModeRefä»£è¡¨RunLoopçš„è¿è¡Œæ¨¡å¼</strong>  ä¸€ä¸ªRunLoopåŒ…å«è‹¥å¹²ä¸ªMode,æ¯ä¸ªModeåˆåŒ…å«è‹¥å¹²ä¸ªSource/Timer/Observer. æ¯æ¬¡RunLoopå¯åŠ¨æ—¶,åªèƒ½æŒ‡å®šå…¶ä¸­ä¸€ä¸ªMode,è¿™ä¸ªModeè¢«ç§°ä¹‹ä¸ºCurrentMode. å¦‚æœéœ€è¦åˆ‡æ¢Mode,åªèƒ½é€€å‡ºLoop,å†é‡æ–°æŒ‡å®šä¸€ä¸ªModeè¿›å…¥. è¿™æ ·åšä¸»è¦æ˜¯ä¸ºäº†åˆ†éš”å¼€ä¸åŒç»„çš„Source/Timer/Observer,è®©ä»–ä»¬äº’ä¸å½±å“.</p>

<h3 id="toc_8">CFRunLoopModeRef</h3>

<p><strong>ç³»ç»Ÿé»˜è®¤æ³¨å†Œäº†5ä¸ªMode:</strong></p>

<ul>
<li><p><strong>kCFRunLoopDefaultMode:</strong> Appçš„é»˜è®¤Modeï¼Œé€šå¸¸ä¸»çº¿ç¨‹æ˜¯åœ¨è¿™ä¸ªModeä¸‹è¿è¡Œ</p></li>
<li><p><strong>UITrackingRunLoopMode:</strong> ç•Œé¢è·Ÿè¸ª Modeï¼Œç”¨äº ScrollView è¿½è¸ªè§¦æ‘¸æ»‘åŠ¨ï¼Œä¿è¯ç•Œé¢æ»‘åŠ¨æ—¶ä¸å—å…¶ä»– Mode å½±å“</p></li>
<li><p><strong>UIInitializationRunLoopMode:</strong> åœ¨åˆšå¯åŠ¨ App æ—¶ç¬¬è¿›å…¥çš„ç¬¬ä¸€ä¸ª Modeï¼Œå¯åŠ¨å®Œæˆåå°±ä¸å†ä½¿ç”¨</p></li>
<li><p><strong>GSEventReceiveRunLoopMode:</strong> æ¥å—ç³»ç»Ÿäº‹ä»¶çš„å†…éƒ¨ Modeï¼Œé€šå¸¸ç”¨ä¸åˆ°</p></li>
<li><p><strong>kCFRunLoopCommonModes:</strong> è¿™æ˜¯ä¸€ä¸ªå ä½ç”¨çš„Modeï¼Œä¸æ˜¯ä¸€ç§çœŸæ­£çš„Mode</p></li>
</ul>

<h3 id="toc_9">CFRunLoopSourceRef</h3>

<p><strong>CFRunLoopSourceRefæ˜¯äº‹ä»¶æºï¼ˆè¾“å…¥æºï¼‰</strong></p>

<p>ä»¥å‰çš„åˆ†æ³•:<br/>
Port-Based Sources<br/>
Custom Input Sources<br/>
Cocoa Perform Selector Sources</p>

<p>ç°åœ¨çš„åˆ†æ³•:<br/>
Source0ï¼šéåŸºäºPortçš„<br/>
Source1ï¼šåŸºäºPortçš„</p>

<h3 id="toc_10">CFRunLoopTimerRef</h3>

<p><strong>CFRunLoopTimerRefæ˜¯åŸºäºæ—¶é—´çš„è§¦å‘å™¨</strong></p>

<p>åŸºæœ¬ä¸Šè¯´çš„å°±æ˜¯NSTimer</p>

<h3 id="toc_11">CFRunLoopObserverRef</h3>

<p><strong>CFRunLoopObserverRefæ˜¯è§‚å¯Ÿè€…ï¼Œèƒ½å¤Ÿç›‘å¬RunLoopçš„çŠ¶æ€æ”¹å˜</strong></p>

<p>å¯ä»¥ç›‘å¬çš„æ—¶é—´ç‚¹æœ‰ä»¥ä¸‹å‡ ä¸ª</p>

<pre><code>/* Run Loop Observer Activities */
typedef CF_OPTIONS(CFOptionFlags, CFRunLoopActivity) {
    kCFRunLoopEntry = (1UL &lt;&lt; 0),           // å³å°†è¿›å…¥ Loop
    kCFRunLoopBeforeTimers = (1UL &lt;&lt; 1),    // å³å°†å¤„ç† Timer
    kCFRunLoopBeforeSources = (1UL &lt;&lt; 2),   // å³å°†å¤„ç† Source
    kCFRunLoopBeforeWaiting = (1UL &lt;&lt; 5),   // å³å°†è¿›å…¥ä¼‘çœ 
    kCFRunLoopAfterWaiting = (1UL &lt;&lt; 6),    // åˆšä»ä¼‘çœ ä¸­å”¤é†’
    kCFRunLoopExit = (1UL &lt;&lt; 7),            // åˆšä»ä¼‘çœ ä¸­å”¤é†’
    kCFRunLoopAllActivities = 0x0FFFFFFFU   // æ‰€æœ‰æ—¶é—´ç‚¹
};
</code></pre>

<h2 id="toc_12">5. RunLoopå¤„ç†é€»è¾‘</h2>

<p><img src="media/14731740142157/14732109138343.jpg" alt=""/><br/>
<img src="media/14731740142157/14732110397325.jpg" alt=""/></p>

<p>ç½‘å‹æ•´ç†å¦‚ä¸‹:<br/>
<img src="media/14731740142157/14732111027007.jpg" alt=""/></p>

<h2 id="toc_13">6.RunLoopåº”ç”¨</h2>

<ul>
<li>NSTimer</li>
<li>ImageViewæ˜¾ç¤º</li>
<li>PerformSelector</li>
<li>å¸¸é©»çº¿ç¨‹</li>
<li>è‡ªåŠ¨é‡Šæ”¾æ± </li>
</ul>

<h3 id="toc_14">å‚è€ƒèµ„æ–™:</h3>

<hr/>

<p>å®˜æ–¹æ–‡æ¡£ <a href="https://developer.apple.com/library/mac/documentation/Cocoa/Conceptual/Multithreading/RunLoopManagement/RunLoopManagement.html">Threading Programming Guide</a><br/><br/>
CFRunLoopRef<a href="http://opensource.apple.com/source/CF/CF-1151.16/">æºä»£ç </a></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[runtime(å†…éƒ¨åˆ†äº«è‰ç¨¿)]]></title>
    <link href="http://www.citynight.cn/Blog/14727863232294.html"/>
    <updated>2016-09-02T11:18:43+08:00</updated>
    <id>http://www.citynight.cn/Blog/14727863232294.html</id>
    <content type="html"><![CDATA[
<h2 id="toc_0">ç†è§£self,super,class,superclass</h2>

<p>åˆ›å»ºä¸€ä¸ªPersoné‡Œé¢æœ‰ä¸€ä¸ªç±»æ–¹æ³•:</p>

<pre><code class="language-objc">#import &quot;Person.h&quot;

@implementation Person
+(void)study {
    NSLog(@&quot;%@ %@ %@ %@&quot;,[self class],[self superclass],[super class],[super superclass]);
}
@end
</code></pre>

<p>Studentç»§æ‰¿è‡ªPerson,é‡å†™çˆ¶ç±»æ–¹æ³•</p>

<pre><code class="language-objc">#import &quot;Student.h&quot;

@implementation Student
+(void)study {
    NSLog(@&quot;%@ %@ %@ %@&quot;,[self class],[self superclass],[super class],[super superclass]);
}
@end
</code></pre>

<!--more-->

<p>è¿™ä¸¤ä¸ªè¾“å‡ºçš„éƒ½æ˜¯ä»€ä¹ˆ?<br/>
<img src="media/14727863232294/14729913552743.jpg" alt=""/></p>

<p>è¿™æ—¶,æˆ‘ä»¬åœ¨Studentä¸­ç”¨è¿™æ ·å†™:</p>

<pre><code class="language-objc">#import &quot;Student.h&quot;

@implementation Student
+(void)study {
//    NSLog(@&quot;%@ %@ %@ %@&quot;,[self class],[self superclass],[super class],[super superclass]);
    
    [super study];
}
@end
</code></pre>

<p>æ‰“æ–­ç‚¹æˆ‘ä»¬å¯ä»¥çœ‹åˆ°:<br/>
<img src="media/14727863232294/14729934417192.jpg" alt=""/></p>

<p>å¯ä»¥çœ‹å‡º:</p>

<pre><code class="language-objc">superï¼šæ˜¯ç¼–è¯‘å™¨æŒ‡ç¤ºç¬¦ï¼Œä»…ä»…æ˜¯ä¸€ä¸ªæ ‡å¿—,å¹¶ä¸æ˜¯æŒ‡é’ˆï¼Œä»…ä»…æ˜¯æ ‡å¿—çš„å½“å‰å¯¹è±¡å»è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•ï¼Œæœ¬è´¨è¿˜æ˜¯å½“å‰å¯¹è±¡è°ƒç”¨
super:å¹¶ä¸æ˜¯è®©çˆ¶ç±»å¯¹è±¡è°ƒç”¨æ–¹æ³•ï¼Œè°ƒç”¨è€…è¿˜æ˜¯æœ¬èº«
classï¼šè·å–æ–¹æ³•è°ƒç”¨è€…çš„ç±»
superclass:è·å–æ–¹æ³•è°ƒç”¨è€…çš„çˆ¶ç±»
</code></pre>

<p>æ¶ˆæ¯æœºåˆ¶:(æ¥è‡ª:<a href="https://developer.apple.com/library/prerelease/content/documentation/Cocoa/Conceptual/ObjCRuntimeGuide/Articles/ocrtHowMessagingWorks.html">å®˜æ–¹æ–‡æ¡£</a>)<br/>
<img src="media/14727863232294/messaging1.gif" alt="æ¶ˆæ¯æ¡†æ¶"/></p>

<p>å½“å¯¹è±¡æ”¶åˆ°æ¶ˆæ¯æ—¶,æ¶ˆæ¯å‡½æ•°é¦–å…ˆæ ¹æ®è¯¥å¯¹è±¡çš„ isa æŒ‡é’ˆæ‰¾åˆ°è¯¥å¯¹è±¡æ‰€å¯¹åº”çš„ç±»çš„æ–¹æ³•è¡¨,å¹¶ä»è¡¨ä¸­å¯»æ‰¾ è¯¥æ¶ˆæ¯å¯¹åº”çš„æ–¹æ³•é€‰æ ‡ã€‚å¦‚æœæ‰¾ä¸åˆ°,objc_msgSend å°†ç»§ç»­ä»çˆ¶ç±»ä¸­å¯»æ‰¾,ç›´åˆ° NSObject ç±»ã€‚ä¸€æ—¦æ‰¾åˆ°äº†æ–¹æ³•é€‰æ ‡, objc_msgSend åˆ™ä»¥æ¶ˆæ¯æ¥æ”¶è€…å¯¹è±¡ä¸ºå‚æ•°è°ƒç”¨,è°ƒç”¨è¯¥é€‰æ ‡å¯¹åº”çš„æ–¹æ³•å®ç°ã€‚</p>

<h2 id="toc_1">selfæ˜¯ä»å“ªé‡Œæ¥çš„?</h2>

<blockquote>
<p>å®˜æ–¹è§£é‡Š:<a href="https://developer.apple.com/library/prerelease/content/documentation/Cocoa/Conceptual/ObjCRuntimeGuide/Articles/ocrtHowMessagingWorks.html">Objective-C Runtime Programming Guide</a><img src="media/14727863232294/14729941396965.jpg" alt=""/></p>
</blockquote>

<p>ç®€å•è¯´æ¯ä¸ªæ–¹æ³•éƒ½å­˜åœ¨å¹¶ä¸”éšè—çš„ä¸¤ä¸ªå‚æ•°(self,_cmd),éšä¾¿å†™ä¸ªæ–¹æ³•çœ‹ä¸‹:<br/>
Studentä¸­å†™ä¸ªtextæ–¹æ³•,ç„¶åæ‰“å°ä¸‹è¿™ä¸¤ä¸ªéšè—å‚æ•°.<br/>
<img src="media/14727863232294/14729960900273.jpg" alt=""/><br/>
<img src="media/14727863232294/14729961142923.jpg" alt=""/></p>

<h2 id="toc_2">åŠ¨æ€æ·»åŠ æ–¹æ³•</h2>

<p>ä¸Šé¢è¯´äº†ä¸€äº›è²Œä¼¼å’Œruntimeæ²¡æœ‰ä»€ä¹ˆå…³ç³»,runtimeåŸºç¡€çŸ¥è¯†ç±»ä¼¼ç±»çš„æ„æˆ,å¯¹è±¡çš„æ„æˆè¿™é‡Œä¸å†ä»‹ç»,å¯ä»¥è‡ªå·±å»çœ‹å®šä¹‰.å½“ç„¶ä¹Ÿå¯ä»¥å»<a href="http://opensource.apple.com/source/objc4/objc4-680/runtime/">è‹¹æœçš„å¼€æºç½‘ç«™</a>æŸ¥çœ‹,å¦‚æœç½‘ç«™ä¸æ–¹ä¾¿å¯ä»¥å»è‹¹æœçš„<a href="https://github.com/opensource-apple/objc4">github</a>ä¸‹è½½å¼€æºä»£ç ç ”ç©¶&hellip;  &hellip;ç»§ç»­&hellip;é‚£ä¹ˆæ ¹æ®ä¸Šé¢æ‰€è¯´çš„æ–¹æ³•è¯´ä¸‹åŠ¨æ€æ·»åŠ æ–¹æ³•.</p>

<blockquote>
<p>æ€è€ƒä¸€ä¸‹,å’±ä»¬newé¡¹ç›®ä¸­å°†é‡‡ç”¨è·¯ç”±æ¨¡å¼è¿›è¡Œé¡µé¢è·³è½¬,ä»ç½‘é¡µè·³è½¬è¿›å…¥appè°ƒç”¨ä¸€ä¸ªæ–¹æ³•,ä¸€èˆ¬æƒ…å†µä¸‹éƒ½æ˜¯ç§»åŠ¨ç«¯å’Œåå°åè®®å¥½çš„å†…å®¹,è¿™æ ·è·³è½¬ä¸ä¼šå‡ºç°é—®é¢˜.ä½†æ˜¯å¦‚æœåå°å†™é”™äº†æˆ–è€…ä¼ è¾“ä¸­å‡ºç°é—®é¢˜å¯¼è‡´urlä¸­åŒ…å«çš„æ–¹æ³•åä¸æ˜¯è§„å®šçš„æ–¹æ³•å.è¿™æ—¶æ€ä¹ˆåŠ?</p>
</blockquote>

<pre><code class="language-objc">    Student *s = [Student new];
    
    // 1. æ¯”å¦‚æˆ‘ä»¬è¦è°ƒç”¨ Studentä¸­çš„eatæ–¹æ³•, é»˜è®¤è¿™æ ·å†™[s eat]; ä½†æ˜¯ä¸è¡Œ,å› ä¸ºæˆ‘ä»¬æ²¡æœ‰å®šä¹‰.
//    [s eat];
    // 2. ä¹Ÿå¯ä»¥è¿™æ ·è°ƒç”¨[s performSelector:@selector(eat)];è¿™æ ·æ²¡æœ‰é—®é¢˜,@selectorä¸­å‚æ•°æ˜¯å­—ç¬¦ä¸²,è¿™ä¸ªå‚è€ƒswift
//    [s performSelector:@selector(eat)];
    // 3. ä½¿ç”¨stringåˆ›å»ºSEL
    
#pragma clang diagnostic push
#pragma clang diagnostic ignored&quot;-Warc-performSelector-leaks&quot;
    [s performSelector:NSSelectorFromString(@&quot;eat&quot;)];
#pragma clang diagnostic pop
    
    // ä¸Šé¢è¿™æ ·è°ƒç”¨ä¼šæŠ¥é”™,æˆ‘ä»¬åœ¨å¯¹è±¡è°ƒç”¨æœªå®ç°æ–¹æ³•çš„æ—¶å€™åŠ¨æ€çš„åˆ›å»ºä¸€ä¸ªæ–¹æ³•,é¿å…æŠ›å‡ºå¼‚å¸¸.
</code></pre>

<p>æ€ä¹ˆå¿½ç•¥ç¼–è¯‘å™¨è­¦å‘Šå·²ç»åˆ†äº«è¿‡,å¯ä»¥å‚è€ƒ:<a href="http://www.citynight.cn/Blog/14676105703423.html">http://www.citynight.cn/Blog/14676105703423.html</a></p>

<h3 id="toc_3">æ€ä¹ˆåŠ¨æ€æ·»åŠ æ–¹æ³•å‘¢?</h3>

<p><img src="media/14727863232294/14729983827897.jpg" alt=""/><br/>
ä¸Šé¢æ˜¯åŠ¨æ€æ·»åŠ å¯¹è±¡æ–¹æ³•çš„ä¾‹å­,åŠ¨æ€æ·»åŠ ç±»æ–¹æ³•ä¹Ÿæ˜¯ä¸€æ ·çš„<code>+(BOOL)resolveClassMethod:(SEL)sel</code><br/>
<strong>æ³¨æ„</strong>ä¸Šé¢å‡½æ•°ç±»å‹,æœ‰äººå¯èƒ½å¥½å¥‡è¿™å—ä¸ºä»€ä¹ˆå†™æˆ&quot;v@:&ldquo;  ?å‚è§:å‡½æ•°ç±»å‹</p>

<h3 id="toc_4">å…³äºå‡½æ•°ç±»å‹</h3>

<p>å…ˆçœ‹æ–‡æ¡£:<br/>
<img src="media/14727863232294/14730056768742.jpg" alt=""/><br/>
æŸ¥çœ‹<code>Objective-C type encodings</code> <img src="media/14727863232294/14730058881001.jpg" alt=""/><br/>
æ‰€ä»¥ä¸Šé¢void eat(&hellip;)åº”è¯¥è¡¨è¿°æˆ <code>&quot;v@:&quot;</code></p>

<p><strong>è¡¥å……:</strong> åŠ¨æ€è°ƒç”¨æ–¹æ³•ç³»ç»Ÿé»˜è®¤æä¾›ä¸€åˆ°ä¸¤ä¸ªå‚æ•°çš„æ–¹æ³•è°ƒç”¨, <del>è¿™é‡Œå°è£…äº†ä¸€ä¸ªæ— é™å‚æ•°çš„æ–¹æ³•è°ƒç”¨.<a href="https://github.com/Mekor/NSObject-SEL">NSObject-SEL****</a></del>  æˆ‘æŠŠä¸€äº›æ‰©å±•è¿›è¡Œäº†æ€»ç»“,è¿˜ä¸å®Œå–„,åœ°å€<a href="https://github.com/Mekor/MKExtension">MKExtension</a></p>

<h3 id="toc_5">å…³äºIMP(å‡½æ•°æŒ‡é’ˆ)</h3>

<pre><code class="language-objc">/// A pointer to the function of a method implementation. 
#if !OBJC_OLD_DISPATCH_PROTOTYPES
typedef void (*IMP)(void /* id, SEL, ... */ ); 
#else
typedef id (*IMP)(id, SEL, ...); 
#endif
</code></pre>

<p>å½“å‰ç‰ˆæœ¬Xcodeå¦‚æœä½¿ç”¨IMPçš„è¯,é»˜è®¤æ˜¯é€‰æ‹©ç¬¬ä¸€ä¸ªä¹Ÿå°±æ˜¯æ— å‚æ— è¿”å›å€¼.å¦‚æœéœ€è¦å‚æ•°æœ‰è¿”å›å€¼çš„è¯,éœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶.å¦‚ä¸‹:</p>

<h2 id="toc_6">æ–¹æ³•äº¤æ¢(Method Swizzling:ä¼ è¯´ä¸­çš„é»‘é­”æ³•)</h2>

<p>ä¸€èˆ¬ä½¿ç”¨æ–¹æ³•äº¤æ¢éƒ½æ˜¯æƒ³ç»™ç³»ç»Ÿæä¾›çš„æ–¹æ³•æ·»åŠ ä¸€äº›å…¶ä»–çš„åŠŸèƒ½çš„æ—¶å€™ä½¿ç”¨.newä¸­ä½¿ç”¨æ–¹æ³•äº¤æ¢çš„ä¾‹å­:</p>

<pre><code class="language-objc">#import &quot;UIActionSheet+Front.h&quot;

#import &lt;objc/runtime.h&gt;

@implementation UIActionSheet (Front)
- (void)customShowInView:(UIView *)view{
    for(UIWindow * tmpWin in [[UIApplication sharedApplication] windows]){
        [tmpWin endEditing:NO];
    }
    [self customShowInView:view];
}
+ (void)load{
    swizzleAllActionSheet();
}
@end

void swizzleAllActionSheet(){
    Class c = [UIActionSheet class];
    SEL origSEL = @selector(showInView:);
    SEL newSEL = @selector(customShowInView:);
    Method origMethod = class_getInstanceMethod(c, origSEL);
    Method newMethod = class_getInstanceMethod(c, newSEL);
    method_exchangeImplementations(origMethod, newMethod);
}
</code></pre>

<p>å…³äºæ–¹æ³•äº¤æ¢,åœ¨newé¡¹ç›®ä¸­å·²ç»å°è£…å¥½äº†,ä»£ç å¦‚ä¸‹:</p>

<pre><code class="language-objc">// ObjcRuntime.hæ–‡ä»¶
void Swizzle(Class c, SEL origSEL, SEL newSEL);

//ObjcRuntime.mæ–‡ä»¶
//é™æ€å°±äº¤æ¢é™æ€ï¼Œå®ä¾‹æ–¹æ³•å°±äº¤æ¢å®ä¾‹æ–¹æ³•
void Swizzle(Class c, SEL origSEL, SEL newSEL)
{
    Method origMethod = class_getInstanceMethod(c, origSEL);
    Method newMethod = nil;
    if (!origMethod) {
        origMethod = class_getClassMethod(c, origSEL);
        if (!origMethod) {
            return;
        }
        newMethod = class_getClassMethod(c, newSEL);
        if (!newMethod) {
            return;
        }
    }else{
        newMethod = class_getInstanceMethod(c, newSEL);
        if (!newMethod) {
            return;
        }
    }
    
    //è‡ªèº«å·²ç»æœ‰äº†å°±æ·»åŠ ä¸æˆåŠŸï¼Œç›´æ¥äº¤æ¢å³å¯
    if(class_addMethod(c, origSEL, method_getImplementation(newMethod), method_getTypeEncoding(newMethod))){
        class_replaceMethod(c, newSEL, method_getImplementation(origMethod), method_getTypeEncoding(origMethod));
    }else{
        method_exchangeImplementations(origMethod, newMethod);
    }
}
</code></pre>

<p>ç”¨æ³•(è¿˜æ˜¯ä»¥Studentä¸ºä¾‹):<br/>
Studentä¸­æ·»åŠ ä¸¤ä¸ªå¯¹è±¡æ–¹æ³•,ä¸€ä¸ªrun,ä¸€ä¸ªsleep.æˆ‘ä»¬çš„ç›®çš„æ˜¯äº¤æ¢ä¸¤ä¸ªæ–¹æ³•çš„å®ç°</p>

<pre><code class="language-objc">-(void)run {
    NSLog(@&quot;è·‘ğŸƒ&quot;);
}
-(void)sleep {
    NSLog(@&quot;ç¡è§‰ğŸ˜´&quot;);
}
+(void)load {
    Swizzle(self, @selector(run), @selector(sleep));
}
</code></pre>

<p>æ§åˆ¶å™¨è°ƒç”¨çš„ç»“æœ:<br/>
<img src="media/14727863232294/14730042652865.jpg" alt=""/></p>

<h2 id="toc_7">æ·»åŠ å±æ€§</h2>

<p>åŠ¨æ€æ·»åŠ å±æ€§ç”¨çš„æœ€å¤šçš„åœ°æ–¹åº”è¯¥æ˜¯ç»™åˆ†ç±»æ·»åŠ å±æ€§.  <del>æˆ‘åœ¨é¡¹ç›®ä¸­æ·»åŠ è¿‡ä¸€ä¸ªåˆ†ç±»<code>UIView+Tap</code>è¿™ä¸ªä¹Ÿå¯ä»¥åœ¨è¿™é‡ŒæŸ¥çœ‹<a href="https://github.com/Mekor/UIView-Tap">UIView-Tap</a></del>  æˆ‘æŠŠä¸€äº›æ‰©å±•è¿›è¡Œäº†æ€»ç»“,è¿˜ä¸å®Œå–„,åœ°å€<a href="https://github.com/Mekor/MKExtension">MKExtension</a></p>

<pre><code class="language-objc">#import &quot;UIView+Tap.h&quot;
#import &lt;objc/runtime.h&gt;

static const void* tagValue = &amp;tagValue;

@interface UIView ()
@property (nonatomic, copy) void(^tapAction)(id);
@end

@implementation UIView (Tap)
- (void)tap{
    if (self.tapAction) {
        self.tapAction(self);
    }
}
- (void)addTapBlock:(void(^)(id obj))tapAction{
    self.tapAction = tapAction;
    if (![self gestureRecognizers]) {
        self.userInteractionEnabled = YES;
        UITapGestureRecognizer *tap = [[UITapGestureRecognizer alloc] initWithTarget:self action:@selector(tap)];
        [self addGestureRecognizer:tap];
    }
}

-(void)setTapAction:(void (^)(id))tapAction {
    objc_setAssociatedObject(self, tagValue, tapAction, OBJC_ASSOCIATION_COPY_NONATOMIC);
}
-(void (^)(id))tapAction {
    return objc_getAssociatedObject(self, tagValue);
}
@end
</code></pre>

<p>ä¸»è¦æ˜¯set&amp;getæ–¹æ³•,è¿™ç‚¹æ³¨æ„äº†ä¹Ÿå°±æ²¡å•¥äº†..</p>

<h2 id="toc_8">å…¶ä»–</h2>

<ol>
<li>ç³»ç»Ÿä¸­å¸¸è§çš„ä½¿ç”¨åˆ°runtimeçš„åœ°æ–¹:
<a href="http://www.citynight.cn/Blog/14726525723684.html">KVOå†…éƒ¨å®ç°åŸç†</a></li>
<li>æ—¥å¸¸å¼€å‘ä¸­ä½¿ç”¨åˆ°runtimeçš„åœ°æ–¹:</li>
<li>å­—å…¸è½¬æ¨¡å‹: å¯ä»¥å‚çœ‹<code>MJExtension</code> å®ƒçš„æ ¸å¿ƒä»£ç åœ¨:<code>NSObject+MJProperty.m</code>ç¬¬150è¡Œå¼€å§‹</li>
</ol>

<pre><code class="language-objc">#pragma mark - å…¬å…±æ–¹æ³•
+ (NSMutableArray *)properties
{
    NSMutableArray *cachedProperties = [self dictForKey:&amp;MJCachedPropertiesKey][NSStringFromClass(self)];
    
    if (cachedProperties == nil) {
        cachedProperties = [NSMutableArray array];
        
        [self mj_enumerateClasses:^(__unsafe_unretained Class c, BOOL *stop) {
            // 1.è·å¾—æ‰€æœ‰çš„æˆå‘˜å˜é‡
            unsigned int outCount = 0;
            objc_property_t *properties = class_copyPropertyList(c, &amp;outCount);
            
            // 2.éå†æ¯ä¸€ä¸ªæˆå‘˜å˜é‡
            for (unsigned int i = 0; i&lt;outCount; i++) {
                MJProperty *property = [MJProperty cachedPropertyWithProperty:properties[i]];
                // è¿‡æ»¤æ‰Foundationæ¡†æ¶ç±»é‡Œé¢çš„å±æ€§
                if ([MJFoundation isClassFromFoundation:property.srcClass]) continue;
                property.srcClass = c;
                [property setOriginKey:[self propertyKey:property.name] forClass:self];
                [property setObjectClassInArray:[self propertyObjectClassInArray:property.name] forClass:self];
                [cachedProperties addObject:property];
            }
            
            // 3.é‡Šæ”¾å†…å­˜
            free(properties);
        }];
        
        [self dictForKey:&amp;MJCachedPropertiesKey][NSStringFromClass(self)] = cachedProperties;
    }
    
    return cachedProperties;
}
</code></pre>

<p>è‡ªå®šä¹‰å­—å…¸è½¬æ¨¡å‹ä¸­logçš„è¾“å‡ºå¯ä»¥å‚è§Xcodeæ’ä»¶<code>ESJsonFormat</code>ä¸­<code>ESJsonFormatManager.m</code>ç¬¬47è¡Œ:</p>

<pre><code class="language-objc">/**
 *  æ ¼å¼åŒ–OCå±æ€§å­—ç¬¦ä¸²
 *
 *  @param key       JSONé‡Œé¢keyå­—æ®µ
 *  @param value     JSONé‡Œé¢keyå¯¹åº”çš„NSDictionæˆ–è€…NSArray
 *  @param classInfo ç±»ä¿¡æ¯
 *
 *  @return
 */
+ (NSString *)formatObjcWithKey:(NSString *)key value:(NSObject *)value classInfo:(ESClassInfo *)classInfo{
    NSString *qualifierStr = @&quot;copy&quot;;
    NSString *typeStr = @&quot;NSString&quot;;
    //åˆ¤æ–­å¤§å°å†™
    if ([ESUppercaseKeyWords containsObject:key] &amp;&amp; [ESJsonFormatSetting defaultSetting].uppercaseKeyWordForId) {
        key = [key uppercaseString];
    }
    if ([value isKindOfClass:[NSString class]]) {
        return [NSString stringWithFormat:@&quot;@property (nonatomic, %@) %@ *%@;&quot;,qualifierStr,typeStr,key];
    }else if([value isKindOfClass:[@(YES) class]]){
        //the &#39;NSCFBoolean&#39; is private subclass of &#39;NSNumber&#39;
        qualifierStr = @&quot;assign&quot;;
        typeStr = @&quot;BOOL&quot;;
        return [NSString stringWithFormat:@&quot;@property (nonatomic, %@) %@ %@;&quot;,qualifierStr,typeStr,key];
    }else if([value isKindOfClass:[NSNumber class]]){
        qualifierStr = @&quot;assign&quot;;
        NSString *valueStr = [NSString stringWithFormat:@&quot;%@&quot;,value];
        if ([valueStr rangeOfString:@&quot;.&quot;].location!=NSNotFound){
            typeStr = @&quot;CGFloat&quot;;
        }else{
            NSNumber *valueNumber = (NSNumber *)value;
            if ([valueNumber longValue]&lt;2147483648) {
                typeStr = @&quot;NSInteger&quot;;
            }else{
                typeStr = @&quot;long long&quot;;
            }
        }
        return [NSString stringWithFormat:@&quot;@property (nonatomic, %@) %@ %@;&quot;,qualifierStr,typeStr,key];
    }else if([value isKindOfClass:[NSArray class]]){
        NSArray *array = (NSArray *)value;
        
        //May be &#39;NSString&#39;ï¼Œwill crash
        NSString *genericTypeStr = @&quot;&quot;;
        NSObject *firstObj = [array firstObject];
        if ([firstObj isKindOfClass:[NSDictionary class]]) {
            ESClassInfo *childInfo = classInfo.propertyArrayDic[key];
            genericTypeStr = [NSString stringWithFormat:@&quot;&lt;%@ *&gt;&quot;,childInfo.className];
        }else if ([firstObj isKindOfClass:[NSString class]]){
            genericTypeStr = @&quot;&lt;NSString *&gt;&quot;;
        }else if ([firstObj isKindOfClass:[NSNumber class]]){
            genericTypeStr = @&quot;&lt;NSNumber *&gt;&quot;;
        }
        
        qualifierStr = @&quot;strong&quot;;
        typeStr = @&quot;NSArray&quot;;
        if ([ESJsonFormatSetting defaultSetting].useGeneric &amp;&amp; [ESUtils isXcode7AndLater]) {
            return [NSString stringWithFormat:@&quot;@property (nonatomic, %@) %@%@ *%@;&quot;,qualifierStr,typeStr,genericTypeStr,key];
        }
        return [NSString stringWithFormat:@&quot;@property (nonatomic, %@) %@ *%@;&quot;,qualifierStr,typeStr,key];
    }else if ([value isKindOfClass:[NSDictionary class]]){
        qualifierStr = @&quot;strong&quot;;
        ESClassInfo *childInfo = classInfo.propertyClassDic[key];
        typeStr = childInfo.className;
        if (!typeStr) {
            typeStr = [key capitalizedString];
        }
        return [NSString stringWithFormat:@&quot;@property (nonatomic, %@) %@ *%@;&quot;,qualifierStr,typeStr,key];
    }
    return [NSString stringWithFormat:@&quot;@property (nonatomic, %@) %@ *%@;&quot;,qualifierStr,typeStr,key];
}

</code></pre>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[åŸºç¡€æ‹¾é—]]></title>
    <link href="http://www.citynight.cn/Blog/14727432716172.html"/>
    <updated>2016-09-01T23:21:11+08:00</updated>
    <id>http://www.citynight.cn/Blog/14727432716172.html</id>
    <content type="html"><![CDATA[
<p><img src="media/14727432716172/14727432899236.jpg" alt=""/></p>

<h2 id="toc_0">selfå’ŒsuperåŒºåˆ«</h2>

<p>è¦ç‚¹ï¼š</p>

<ol>
<li>selfè°ƒç”¨è‡ªå·±æ–¹æ³•ï¼Œsuperè°ƒç”¨çˆ¶ç±»æ–¹æ³•</li>
<li>selfæ˜¯ç±»ï¼Œsuperæ˜¯é¢„ç¼–è¯‘æŒ‡ä»¤</li>
<li>ã€self classã€‘å’Œã€super classã€‘è¾“å‡ºæ˜¯ä¸€æ ·çš„</li>
</ol>

<p>selfå’Œsuperåº•å±‚å®ç°åŸç†ï¼š</p>

<ol>
<li>å½“ä½¿ç”¨ self è°ƒç”¨æ–¹æ³•æ—¶ï¼Œä¼šä»å½“å‰ç±»çš„æ–¹æ³•åˆ—è¡¨ä¸­å¼€å§‹æ‰¾ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå°±ä»çˆ¶ç±»ä¸­å†æ‰¾ï¼›è€Œå½“ä½¿ç”¨ super æ—¶ï¼Œåˆ™ä»çˆ¶ç±»çš„æ–¹æ³•åˆ—è¡¨ä¸­å¼€å§‹æ‰¾ï¼Œç„¶åè°ƒç”¨çˆ¶ç±»çš„è¿™ä¸ªæ–¹æ³•ã€‚</li>
<li>å½“ä½¿ç”¨ self è°ƒç”¨æ—¶ï¼Œä¼šä½¿ç”¨ <code>objc_msgSend</code> å‡½æ•°ï¼š<code>id objc_msgSend(id theReceiver, SEL theSelector, ...)</code>ã€‚ç¬¬ ä¸€ä¸ªå‚æ•°æ˜¯æ¶ˆæ¯æ¥æ”¶è€…ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯è°ƒç”¨çš„å…·ä½“ç±»æ–¹æ³•çš„ <code>selector</code>ï¼Œåé¢æ˜¯ <code>selector</code> æ–¹æ³•çš„å¯å˜å‚æ•°ã€‚ä»¥ <code>[self setName:]</code> ä¸ºä¾‹ï¼Œç¼–è¯‘å™¨ä¼šæ›¿æ¢æˆè°ƒç”¨ <code>objc_msgSend</code> çš„å‡½æ•°è°ƒç”¨ï¼Œå…¶ä¸­ <code>theReceiver</code> æ˜¯ <code>self</code>ï¼Œ<code>theSelector</code> æ˜¯ <code>@selector(setName:)</code>ï¼Œè¿™ä¸ª <code>selector</code> æ˜¯ä»å½“å‰ <code>self</code> çš„ <code>class</code> çš„æ–¹æ³•åˆ—è¡¨å¼€å§‹æ‰¾çš„ <code>setName</code>ï¼Œå½“æ‰¾åˆ°åæŠŠå¯¹åº”çš„ <code>selector</code> ä¼ é€’è¿‡å»ã€‚</li>
<li>å½“ä½¿ç”¨ <code>super</code> è°ƒç”¨æ—¶ï¼Œä¼šä½¿ç”¨ <code>objc_msgSendSuper</code> å‡½æ•°ï¼š<code>id objc_msgSendSuper(struct objc_super *super, SEL op, ...)</code>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸ª<code>objc_super</code>çš„ç»“æ„ä½“ï¼Œç¬¬äºŒä¸ªå‚æ•°è¿˜æ˜¯ç±»ä¼¼ä¸Šé¢çš„ç±»æ–¹æ³•çš„<code>selector</code>ï¼Œ</li>
</ol>

<pre><code>struct objc_super {
Â  Â  Â  id receiver;
Â  Â  Â  Class superClass;
};
</code></pre>

<p>å½“ç¼–è¯‘å™¨é‡åˆ°Â  <code>[super setName:]</code> æ—¶ï¼Œå¼€å§‹åšè¿™å‡ ä¸ªäº‹ï¼š</p>

<p>1ï¼‰æ„å»º <code>objc_super</code> çš„ç»“æ„ä½“ï¼Œæ­¤æ—¶è¿™ä¸ªç»“æ„ä½“çš„ç¬¬ä¸€ä¸ªæˆå‘˜å˜é‡ <code>receiver</code> å°±æ˜¯å­ç±»ï¼Œå’Œ <code>self</code> ç›¸åŒã€‚è€Œç¬¬äºŒä¸ªæˆå‘˜å˜é‡ <code>superClass</code> å°±æ˜¯æŒ‡çˆ¶ç±»<br/>
è°ƒç”¨ <code>objc_msgSendSuper</code> çš„æ–¹æ³•ï¼Œå°†è¿™ä¸ªç»“æ„ä½“å’Œ <code>setName</code> çš„ <code>sel</code> ä¼ é€’è¿‡å»ã€‚</p>

<p>2ï¼‰å‡½æ•°é‡Œé¢åœ¨åšçš„äº‹æƒ…ç±»ä¼¼è¿™æ ·ï¼šä» <code>objc_super</code> ç»“æ„ä½“æŒ‡å‘çš„ <code>superClass</code> çš„æ–¹æ³•åˆ—è¡¨å¼€å§‹æ‰¾ <code>setName</code> çš„ <code>selector</code>ï¼Œæ‰¾åˆ°åå†ä»¥ <code>objc_super-&gt;receiver</code> å»è°ƒç”¨è¿™ä¸ª <code>selector</code></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[KVOå†…éƒ¨å®ç°åŸç†]]></title>
    <link href="http://www.citynight.cn/Blog/14726525723684.html"/>
    <updated>2016-08-31T22:09:32+08:00</updated>
    <id>http://www.citynight.cn/Blog/14726525723684.html</id>
    <content type="html"><![CDATA[
<ol>
<li>KVOæ˜¯åŸºäºruntimeæœºåˆ¶å®ç°çš„</li>
<li>å½“æŸä¸ªç±»çš„å¯¹è±¡ç¬¬ä¸€æ¬¡è¢«è§‚å¯Ÿæ—¶,ç³»ç»Ÿå°±ä¼šåœ¨è¿è¡ŒæœŸåŠ¨æ€åœ°åˆ›å»ºè¯¥ç±»çš„ä¸€ä¸ªæ´¾ç”Ÿç±»,åœ¨è¿™ä¸ªæ´¾ç”Ÿç±»ä¸­é‡å†™åŸºç±»ä¸­ä»»ä½•è¢«è§‚å¯Ÿå±æ€§çš„setteræ–¹æ³•.æ´¾ç”Ÿç±»åœ¨è¢«é‡å†™çš„setteræ–¹æ³•å®ç°çœŸæ­£çš„é€šçŸ¥æœºåˆ¶.</li>
</ol>

<p>æ·»åŠ ç›‘å¬å‰:<br/>
<img src="media/14726525723684/14726530320712.jpg" alt=""/></p>

<p>æ·»åŠ ç›‘å¬å:(æ´¾ç”Ÿå‡º:NSKVONotifying_Person)<br/>
<img src="media/14726525723684/14726532061641.jpg" alt=""/></p>

<p>æŠŠå‰åä¸¤ä»½ä»£ç å…¨éƒ¨è½¬æ¢æˆcppæ–‡ä»¶,è¿™æ—¶æˆ‘ä»¬æŸ¥æ‰¾ä¸¤ä¸ªæ–‡ä»¶ä¸åŒçš„åœ°æ–¹.</p>

<p><img src="media/14726525723684/14726564797185.jpg" alt=""/></p>

<p>ç»è¿‡ç®€å•æ•´ç†çš„ä¸¤ä»½ä»£ç :<br/>
<img src="media/14726525723684/14726568603743.jpg" alt=""/></p>

<p>å¯ä»¥çœ‹å‡ºmi_0 &amp; mi_1ä¹‹é—´å°±æ˜¯Person &amp; NSKVONotifying_Personä¹‹é—´çš„å…³ç³».</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[è½¬è½½iOS MJè®²è§£é¢è¯•é¢˜,å¹¶ä¿®æ”¹é‡Œé¢é”™è¯¯]]></title>
    <link href="http://www.citynight.cn/Blog/14726092302553.html"/>
    <updated>2016-08-31T10:07:10+08:00</updated>
    <id>http://www.citynight.cn/Blog/14726092302553.html</id>
    <content type="html"><![CDATA[
<blockquote>
<p>åŸæ–‡é“¾æ¥:<a href="http://www.jianshu.com/p/9050e523e278">http://www.jianshu.com/p/9050e523e278</a></p>
</blockquote>

<h4 id="toc_0">1ã€KVOå†…éƒ¨å®ç°åŸç†</h4>

<ul>
<li>1.KVOæ˜¯åŸºäºruntimeæœºåˆ¶å®ç°çš„</li>
<li>2.å½“æŸä¸ªç±»çš„å¯¹è±¡ç¬¬ä¸€æ¬¡è¢«è§‚å¯Ÿæ—¶ï¼Œç³»ç»Ÿå°±ä¼šåœ¨è¿è¡ŒæœŸåŠ¨æ€åœ°åˆ›å»ºè¯¥ç±»çš„ä¸€ä¸ªæ´¾ç”Ÿç±»ï¼Œåœ¨è¿™ä¸ªæ´¾ç”Ÿç±»ä¸­é‡å†™åŸºç±»ä¸­ä»»ä½•è¢«è§‚å¯Ÿå±æ€§çš„setteræ–¹æ³•ã€‚
æ´¾ç”Ÿç±»åœ¨è¢«é‡å†™çš„setteræ–¹æ³•å®ç°çœŸæ­£çš„é€šçŸ¥æœºåˆ¶ï¼ˆPerson-&gt;NSKVONotifying_Personï¼‰</li>
</ul>

<h4 id="toc_1">2ã€æ˜¯å¦å¯ä»¥æŠŠæ¯”è¾ƒè€—æ—¶çš„æ“ä½œæ”¾åœ¨NSNotificationCenterä¸­</h4>

<ul>
<li>é€šçŸ¥ä¸­å¿ƒæ‰€åšçš„æ“ä½œåœ¨ä¸»çº¿ç¨‹ï¼Œæ¯”è¾ƒè€—æ—¶çš„ä¸€èˆ¬å¼€å¯ä¸€ä¸ªçº¿ç¨‹å•ç‹¬å»è·‘</li>
</ul>

<h4 id="toc_2">3ã€KVOã€NSNotificationã€ä»£ç†çš„åŒºåˆ«å’Œç”¨æ³•æ˜¯ä»€ä¹ˆï¼Ÿä»€ä¹ˆæ—¶å€™è¯¥ç”¨é‚£ä¸ªï¼Ÿå¦‚æœç”¨protocolå’Œdelegateï¼ˆæˆ–è€…delegateçš„Arrayï¼‰æ¥å®ç°ç±»ä¼¼çš„åŠŸèƒ½å¯èƒ½å—ï¼Ÿå¦‚æœèƒ½ï¼Œä¼šæœ‰ä»€ä¹ˆæ½œåœ¨çš„é—®é¢˜ï¼Ÿå¦‚æœä¸èƒ½ï¼Œä¸ºä»€ä¹ˆï¼Ÿ</h4>

<h5 id="toc_3">ç­”æ¡ˆï¼š</h5>

<p>å‚è€ƒï¼š<a href="http://blog.csdn.net/dqjyong/article/details/7685933">http://blog.csdn.net/dqjyong/article/details/7685933</a></p>

<h6 id="toc_4">é€šçŸ¥ï¼ˆNSNotificationï¼‰ï¼š</h6>

<ul>
<li>æ¯”è¾ƒçµæ´»ï¼ˆ1ä¸ªé€šçŸ¥èƒ½è¢«å¤šä¸ªå¯¹è±¡æ¥å—ï¼Œå¤šä¸ªå¯¹è±¡èƒ½æ¥å—å¤šä¸ªé€šçŸ¥ï¼‰</li>
<li>æ²¡æœ‰è€¦åˆæ€§ï¼ˆï¼¡å‘å‡ºçš„é€šçŸ¥ï¼Œè°å»æ¥æ”¶å¹¶ä¸çŸ¥é“ï¼‰</li>
<li>ç¼ºç‚¹é€šçŸ¥çš„Keyå®¹æ˜“è¢«å†™é”™</li>
</ul>

<h6 id="toc_5">KVO</h6>

<ul>
<li>æ€§èƒ½ä¸å¥½ï¼ˆåº•å±‚å¯¹ä¼šRuntimeåŠ¨æ€äº§æˆæ–°çš„ç±»NSNotifying_xxï¼‰</li>
<li>å±€é™æ€§ï¼ˆåªèƒ½ç›‘å¬æŸä¸ªå¯¹è±¡å±æ€§çš„æ”¹å˜ï¼Œä¸æ¨èå®ç”¨ï¼‰</li>
<li>1ä¸ªå¯¹è±¡çš„å±æ€§èƒ½è¢«å¤šä¸ªå¯¹è±¡ç›‘å¬ï¼Œ1ä¸ªå¯¹è±¡èƒ½ç›‘å¬å¤šä¸ªå¯¹è±¡çš„å…¶ä»–å±æ€§</li>
</ul>

<h6 id="toc_6">ä»£ç†</h6>

<ul>
<li>æ¯”è¾ƒè§„èŒƒï¼Œæ‰€ä»¥å®‰å…¨æ€§é«˜</li>
<li>é»˜è®¤æ˜¯1å¯¹1ç›‘å¬ï¼Œå¯ä»¥ç”¨ä»£ç†æ•°ç»„ a.delegates = @[b, c, d];(åƒä¸‡åˆ«è¿™æ ·å†™ï¼Œè¿èƒŒçš„è®¾è®¡æ¨¡å¼ï¼Œè¿™æ ·å†™è¿˜ä¸å¦‚åŒæ¶ˆæ¯é€šçŸ¥)</li>
</ul>

<h4 id="toc_7">4ã€Runtimeå®ç°çš„æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Œæ€ä¹ˆç”¨ï¼Œä¸€èˆ¬ç”¨äºå¹²å˜›ï¼Œä½ è¿˜è®°å¾—ä½ æ‰€ä½¿ç”¨çš„ç›¸å…³çš„å¤´æ–‡ä»¶æˆ–è€…æŸäº›æ–¹æ³•çš„åç§°å—ï¼Ÿ</h4>

<p>è¿è¡Œæ—¶æœºåˆ¶ï¼Œruntimeåº“é‡Œé¢åŒ…å«äº†è·Ÿç±»ã€æˆå‘˜å˜é‡ã€æ–¹æ³•ç›¸å…³çš„APIï¼Œæ¯”å¦‚è·å–ç±»é‡Œé¢çš„æ‰€æœ‰æˆå‘˜å˜é‡ï¼Œä¸ºç±»åŠ¨æ€æ·»åŠ æˆå‘˜å˜é‡ï¼ŒåŠ¨æ€æ”¹å˜ç±»çš„æ–¹æ³•å®ç°ï¼Œä¸ºç±»åŠ¨æ€æ·»åŠ æ–°çš„æ–¹æ³•ç­‰ï¼Œéœ€è¦å¯¼å…¥</p>

<h5 id="toc_8">1.ä»€ä¹ˆæ˜¯Runtime</h5>

<ul>
<li>runtimeæ˜¯ä¸€å¥—æ¯”è¾ƒä½å±‚çš„çº¯Cè¯­è¨€APIï¼Œå±äº1ä¸ªCè¯­è¨€åº“ï¼ŒåŒ…å«è®¸å¤šCåº•å±‚çš„Cè¯­è¨€çš„API</li>
<li>å¹³æ—¶ç¼–å†™çš„OCä»£ç ï¼Œåœ¨ç¨‹åº è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå…¶å®æœ€ç»ˆéƒ½è½¬æ¢æˆäº†runtimeçš„Cè¯­è¨€ä»£ç ï¼Œruntimeç®—æ˜¯OCçš„å¹•åå·¥ä½œè€…
ä¸¾ä¾‹ï¼š
OC:
<code>[MJPerson alloc]init];</code>
runtimeï¼š
<code>objc_msgSend(objc_msgSend(&quot;MJPerson&quot;, &quot;alloc&quot;), &quot;init&quot;)</code></li>
</ul>

<h5 id="toc_9">2.ç”¨è¿‡ä¹ˆï¼Ÿæ€ä¹ˆç”¨ï¼Ÿ</h5>

<ul>
<li>1.runtimeæ˜¯å±äºOCåº•å±‚ï¼Œå¯ä»¥è¿›è¡Œ ä¸€äº›éå¸¸çš„æ“ä½œï¼ˆOCæ— æ³•å®ç°çš„ï¼Œä¸å®¹æ˜“å®ç°çš„ï¼‰

<ul>
<li>åœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼ŒåŠ¨æ€åˆ›å»ºä¸€ä¸ªç±»ï¼ˆæ¯”å¦‚KVOåº•å±‚å®ç°ï¼‰</li>
<li>åœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼ŒåŠ¨æ€åœ°ä¸ºæŸä¸ªç±» æ·»åŠ å±æ€§ã€æ–¹æ³•ï¼Œä¿®æ”¹å±æ€§å€¼ã€æ–¹æ³•</li>
<li>ä¾¿åˆ©ä¸€ä¸ªç±»çš„ æ‰€ä»¥æˆå‘˜å˜é‡ï¼ˆå±æ€§ï¼‰ã€æ–¹æ³•</li>
</ul></li>
</ul>

<h5 id="toc_10">3.ç›¸å…³åº”ç”¨</h5>

<ul>
<li><p>1.å¤´æ–‡ä»¶</p>

<p>è°ƒç”¨åº•å±‚çš„æ¶ˆæ¯å‘é€æ–¹æ³•</p></li>
<li><p>2.ç›¸å…³åº”ç”¨</p>

<ul>
<li>NSCodingï¼ˆå½’æ¡£å’Œè§£æ¡£ï¼Œåˆ©ç”¨runtimeéå†æ¨¡å‹å¯¹è±¡çš„æ‰€æœ‰å±æ€§ï¼‰</li>
<li>å­—å…¸ -&gt;æ¨¡å‹ ï¼ˆåˆ©ç”¨runtimeéå†æ¨¡å‹å¯¹è±¡çš„æ‰€æœ‰å±æ€§ï¼Œæ ¹æ®å±æ€§åä»å­—å…¸ä¸­å–å‡ºå¯¹åº”çš„å€¼ï¼Œè®¾ç½®åˆ°æ¨¡å‹çš„å±æ€§ä¸Šï¼‰</li>
<li>KVOï¼ˆåˆ©ç”¨runtimeåŠ¨æ€äº§ç”Ÿä¸€ä¸ªç±»ï¼‰</li>
<li>ç”¨äºå°è£…æ¡†æ¶ï¼ˆæƒ³æ€ä¹ˆæ”¹ï¼Œå°±æ€ä¹ˆæ”¹ï¼‰</li>
</ul></li>
<li><p>3.ç›¸å…³å‡½æ•°</p>

<ul>
<li>objc_msgSend ï¼š ç»™å¯¹è±¡å‘é€æ¶ˆæ¯</li>
<li>class_copyMethodList ï¼š éå†æŸä¸ªæ‰€æœ‰æ–¹æ³•</li>
<li>class_copyIvarList ï¼š éå†æŸä¸ªç±»æ‰€ä»¥çš„æˆå‘˜å˜é‡</li>
<li>class_addMethod ï¼š åŠ¨æ€æ·»åŠ æ–¹æ³•</li>
<li>class_addIval ï¼šåŠ¨æ€æ·»åŠ æˆå‘˜å˜é‡</li>
<li>class_&hellip;. class_å¼€å¤´çš„æ–¹æ³•,æ˜¯æ“ä½œç±»çš„</li>
</ul></li>
</ul>

<h6 id="toc_11">ä¾‹ï¼šåˆ©ç”¨Runtimeå½’æ¡£å’Œè§£æ¡£</h6>

<pre><code>//  MJPerson.m
//  runtimeè¿›è¡Œå½’æ¡£å’Œè§£æ¡£
//
//  Created by Zhanbo on 16/7/7.
//  Copyright Â© 2016å¹´ Zhanbo. All rights reserved.
//

#import &quot;MJPerson.h&quot;
#import &lt;objc/runtime.h&gt;
@implementation MJPerson

- (void)encodeWithCoder:(NSCoder *)aCoder {

   unsigned int count = 0;
  //å‚æ•°1ï¼šé‚£ä¸ªç±»
  //å‚æ•°2ï¼šæœ‰å‡ ä¸ªæˆå‘˜å˜é‡
   Ivar *ivars = class_copyIvarList([MJPerson class], &amp;count);

    for (int i = 0; i &lt;count; i++) {
        //å–å‡ºiä½ç½®å¯¹åº”çš„æˆå‘˜å˜é‡
        Ivar ivar = ivars[i];

        //æŸ¥çœ‹æˆå‘˜å˜é‡
        const char *name = ivar_getName(ivar);
        NSLog(@&quot;%s&quot;, name);

        //å½’æ¡£
        NSString *key = [NSString stringWithUTF8String:name];
        id value = [self valueForKey:key];
        [aCoder encodeObject:value forKey:key];

    }
    //åœ¨Cè¯­è¨€ä¸­ä½¿ç”¨copyè¦é‡Šæ”¾
    free(ivars);
}

- (instancetype)initWithCoder:(NSCoder *)aDecoder {

    if (self = [super init]) {

        unsigned int count = 0;
        Ivar *ivars = class_copyIvarList([MJPerson class], &amp;count);

        for (int i = 0; i &lt;count; i++) {
            //å–å‡ºiä½ç½®å¯¹åº”çš„æˆå‘˜å˜é‡
            Ivar ivar = ivars[i];

            //æŸ¥çœ‹æˆå‘˜å˜é‡
            const char *name = ivar_getName(ivar);
            NSLog(@&quot;%s&quot;, name);

            //è§£æ¡£
            NSString *key = [NSString stringWithUTF8String:name];
            id value = [aDecoder decodeObjectForKey:key];

            //è®¾ç½®åˆ°æˆå‘˜å˜é‡èº«ä¸Š
            [self setValue:value forKey:key];

        }
        //åœ¨Cè¯­è¨€ä¸­ä½¿ç”¨copyè¦é‡Šæ”¾
        free(ivars);
    }
    return self;
}

@end
</code></pre>

<h5 id="toc_12">4.å¿…å¤‡å¸¸è¯†</h5>

<ul>
<li>1.Ivar ï¼š æˆå‘˜å˜é‡</li>
<li>1. Method ï¼š æˆå‘˜æ–¹æ³•</li>
</ul>

<h4 id="toc_13">5ã€Foundationå¯¹è±¡ä¸Core Foundationå¯¹è±¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h4>

<ul>
<li>1.Foundationå¯¹è±¡æ˜¯OCçš„ï¼ŒCore Foundationå¯¹è±¡æ˜¯Cå¯¹è±¡</li>
<li><p>2.æ•°æ®ç±»å‹ä¹‹é—´çš„è½¬æ¢(æ¡¥æ¥)</p>

<ul>
<li><p>ARCï¼šbridge_retainedã€ <u>bridge</u>transfer</p>

<pre><code>CFArrayRef array3 = CFArrayCreate(NULL, NULL, 10, NULL);

//Foundetion -&gt; Core Fountdation
(__bridge_retained )

//Core Fountdation -&gt; Foundetion
(__bridge_transfer )
NSArray *array4 = (__bridge_transfer NSArray *)array3);
</code></pre></li>
<li><p>MRC: _bridge</p>

<pre><code>Foundation -&gt; Core Foundation
NSArray *array1 = [NSArray array];
CFArrayRef array2 = (__bridge CFArrayRef)array1;
//è®°å¾—é‡Šæ”¾å†…å­˜
[array1 release];
</code></pre></li>
</ul></li>
</ul>

<h4 id="toc_14">6ã€ä¸ç”¨ä¸­é—´å˜é‡ï¼Œç”¨ä¸¤ç§æ–¹æ³•äº¤æ¢Aå’ŒBçš„å€¼</h4>

<ul>
<li>1. A = A + B
    B = A - B
    A = A- B</li>
<li>2.ä½¿ç”¨ä½è¿ç®—<sup>èƒ½äº¤æ¢ä¸¤ä¸ªå˜é‡çš„å€¼</sup></li>
</ul>

<h4 id="toc_15">7ã€ ä»€ä¹ˆæ˜¯åŠ¨æ€ï¼Œä¸¾ä¾‹è¯´å</h4>

<ul>
<li>1.åœ¨çº¿ç¨‹è¿è¡Œè¿‡ç¨‹æ‰æ‰§è¡Œçš„æ“ä½œï¼Œå¦‚RuntimeåŠ¨æ€åˆ›å»ºæˆå‘˜å˜é‡å’Œæ–¹æ³•</li>
</ul>

<h4 id="toc_16">8ã€ä»€ä¹ˆæ˜¯å¤šæ€</h4>

<ul>
<li><p>1.çˆ¶ç±»æŒ‡é’ˆæŒ‡å‘å­ç±»å¯¹è±¡</p>

<pre><code>NSObject *obj = [NSArray array];
</code></pre></li>
</ul>

<h4 id="toc_17">9ã€æ€ä¹ˆè§£å†³ç¼“å­˜æ± æ»¡çš„é—®é¢˜ï¼ˆcellï¼‰</h4>

<ul>
<li>iOSä¸­ä¸å­˜åœ¨ç¼“å­˜æ± æ»¡çš„æƒ…å†µï¼Œåº”ä¸ºé€šå¸¸æˆ‘ä»¬åœ¨iOSå¼€å‘ï¼Œå¯¹è±¡éƒ½æ˜¯åœ¨éœ€è¦çš„æ—¶å€™æ‰ä¼šåˆ›å»ºï¼Œæœ‰ç§å¸¸ç”¨çš„è¯´æ³•å«æ‡’åŠ è½½ï¼Œè¿˜æœ‰åœ¨UITableViewä¸­ä¸€èˆ¬åªä¼šåˆ›å»ºåˆšå¼€å§‹å‡ºç°åœ¨å±å¹•ä¸­çš„cellï¼Œä¹‹åéƒ½æ˜¯ä»ç¼“å­˜æ± é‡Œå–ï¼Œä¸ä¼šåˆ›å»ºæ–°å¯¹è±¡ï¼Œç¼“å­˜æ± é‡Œæœ€å¤šå°±ä¸€ä¸¤ä¸ªå¯¹è±¡ï¼Œç¼“å­˜æ± æ»¡çš„è¿™ä¸­æƒ…å†µä¸€èˆ¬åœ¨å¼€å‘Javaä¸­æ¯”è¾ƒå¸¸è§ï¼ŒJavaä¸­ä¸€èˆ¬æŠŠæœ€è¿‘æœ€å°‘ä½¿ç”¨çš„å¯¹è±¡å…ˆé‡Šæ”¾</li>
<li>å¦‚æœç¼“å­˜æ± æ»¡äº†ï¼Œåˆ¤æ–­å“ªä¸ªä½ç½®çš„cellæ˜¯ä¸ç»å¸¸ä½¿ç”¨çš„ï¼Œå…ˆé‡Šæ”¾æ‰</li>
</ul>

<h3 id="toc_18">10ã€å¦‚ä½•æ¸²æŸ“è‡ªå®šä¹‰æ ¼å¼å­—ç¬¦ä¸²çš„UILabel</h3>

<ul>
<li><p>1.é€šè¿‡NSAttributedStringç±»</p>

<pre><code>  //1ç§å†™æ³•ï¼Œä¹Ÿå¯ä»¥ç”¨å­—å…¸
NSMutableAttributedString *str = [[NSMutableAttributedString alloc]initWithString:@&quot;å“ˆå“ˆå“ˆå•¦å•¦å•¦å“‡å“‡å“‡&quot;];
  //è®¾ç½®æ–‡å­—é¢œè‰²
  [str addAttribute:NSForegroundColorAttributeName value:[UIColor redColor] range:NSMakeRange(0, 3)];
  [str addAttribute:NSForegroundColorAttributeName value:[UIColor blueColor] range:NSMakeRange(6, 3)];
  //è®¾ç½®å­—ä½“
  [str addAttribute:NSFontAttributeName value:[UIFont systemFontOfSize:30] range:NSMakeRange(3, 3)];

  _label.attributedText = str;
</code></pre></li>
</ul>

<p><img src="media/14726092302553/1240." alt=""/></p>

<p>æ•ˆæœ</p>

<h4 id="toc_19">11ã€scrollViewçš„contentSizeèƒ½åœ¨ViewDidLoadé‡Œè®¾ç½®å—ï¼Œä¸ºä»€ä¹ˆï¼Ÿ</h4>

<ul>
<li>1.èƒ½ï¼Œåœ¨å“ªé‡Œéƒ½èƒ½è®¾ç½®</li>
<li>2.ä½†æ˜¯æœ€å¥½ä¸è¦åœ¨viewDidLoadé‡Œè®¾ç½®ï¼Œå› ä¸ºè§†å›¾åˆšåˆ›å»ºä¸ä¸€å®šæ˜¯æˆ‘ä»¬æƒ³è¦çš„å°ºå¯¸ï¼Œåœ¨iPadå¼€å‘ä¸­æ¨ªç«–å±æ˜¯å¾ˆå¥½çš„ä¾‹å­</li>
</ul>

<h4 id="toc_20">12ã€æ§åˆ¶å™¨Viewçš„ç”Ÿå‘½å‘¨æœŸåŠç›¸å…³å‡½æ•°ä»€ä¹ˆï¼Ÿä½ åœ¨å¼€å‘ä¸­æ˜¯å¦‚ä½•ç”¨çš„ï¼Ÿ</h4>

<ul>
<li>1.é¦–å…ˆåˆ¤æ–­æ§åˆ¶å™¨æ˜¯å¦æœ‰è§†å›¾ï¼Œå¦‚æœæ²¡æœ‰å°±è°ƒç”¨<strong>loadView</strong>æ–¹æ³•åˆ›å»ºï¼šé€šè¿‡storyboardæˆ–è€…ä»£ç </li>
<li>2.éšåè°ƒç”¨<strong>viewDidLoad</strong>ï¼Œå¯ä»¥è¿›è¡Œä¸‹ä¸€æ­¥çš„åˆå§‹åŒ–æ“ä½œï¼šåªä¼šè¢«è°ƒç”¨ä¸€æ¬¡</li>
<li>3.åœ¨è§†å›¾æ˜¾ç¤ºä¹‹å‰ï¼ˆå³å°†æ˜¾ç¤ºï¼‰è°ƒç”¨<strong>viewWillAppear</strong>ï¼Œè¯¥å‡½æ•°å¯ä»¥å¤šæ¬¡è°ƒç”¨</li>
<li>4.åœ¨è§†å›¾æ˜¾ç¤ºï¼Œä¼šè°ƒç”¨<strong>viewDidAppear</strong></li>
<li>5.è§†å›¾å³å°†æ¶ˆå¤±ï¼Œè°ƒç”¨<strong>viewWillDisappear</strong></li>
<li>6.è§†å›¾å·²ç»æ¶ˆå¤±ï¼Œè°ƒç”¨<strong>viewDidDisappear</strong></li>
<li>7.åœ¨å¸ƒå±€å˜åŒ–å‰åï¼Œè°ƒç”¨<strong>viewWillDidLayoutSubviews</strong>å¤„ç†ç›¸å…³ä¿¡æ¯</li>
</ul>

<h4 id="toc_21">13ã€Blockçš„å†…å­˜ç®¡ç†</h4>

<ul>
<li>1.é»˜è®¤æƒ…å†µä¸‹ï¼Œblockçš„å†…å­˜æ˜¯åœ¨æ ˆä¸­

<ul>
<li>å®ƒä¸ä¼šå¯¹æ‰€å¼•ç”¨çš„å¯¹è±¡è¿›è¡Œä»»ä½•æ“ä½œ</li>
</ul></li>
<li>2.å¦‚æœå¯¹blockåšä¸€æ¬¡copyæ“ä½œï¼Œblockçš„å†…å­˜å°±ä¼šåœ¨å †ä¸­

<ul>
<li>å®ƒä¼šå¯¹æ‰€å¼•ç”¨çš„å¯¹è±¡åšä¸€æ¬¡retainæ“ä½œ</li>
<li>ARC ï¼šå¦‚æœæ‰€å¼•ç”¨çš„å¯¹è±¡ç”¨äº†<strong>__unsafe_unretained</strong>æˆ–è€…<strong>__weak</strong>ä¿®é¥°ï¼Œå°±ä¸ä¼šåšretainæ“ä½œ</li>
<li>éARC(MRC) ï¼š å¦‚æœæ‰€å¼•ç”¨çš„å¯¹è±¡ç”¨<strong>__block</strong>ä¿®é¥°ï¼Œå°±ä¸ä¼šåšretainæ“ä½œï¼›MRCè®°å¾—é‡Šæ”¾blockBlock_release(_block);</li>
</ul></li>
</ul>

<pre><code>- (void)dealloc {
    //MRCè®°å¾—åœ¨deallocé‡Šæ”¾blcokï¼Œ[super dealloc];è¦å†™æœ€å
    Block_release(_block);
    [super dealloc];
}
</code></pre>

<h4 id="toc_22">14ã€MRCä¸­å¦‚ä½•åšå¼€å‘</h4>

<p>1.MRCä¸­retainç›¸å½“äºARCä¸­strong<br/>
assignç›¸å½“äºARCä¸­weak<br/>
2.åªè¦å£°æ˜å¯¹è±¡å±æ€§å°±è¦å†™retain</p>

<pre><code>@property (nonatomic, retain)NSArray *array; +1(è®¡æ•°å™¨ = 1)
</code></pre>

<p>3.å£°æ˜æ§ä»¶ã€åè®®ç”¨assgin</p>

<p>4.MRCçš„å†…å­˜ç®¡ç†åŸåˆ™</p>

<ul>
<li>å¦‚æœè°ƒç”¨äº†allocã€newã€copyäº§ç”Ÿäº†ä¸€ä¸ªæ–°å¯¹è±¡ï¼Œæœ€åè‚¯å®šè¦è°ƒç”¨1æ¬¡releaceæˆ–è€…autorelease</li>
<li>å¦‚æœè®©ä¸€ä¸ªå¯¹è±¡åšäº†retainæ“ä½œï¼ˆè®¡æ•°å™¨+1ï¼‰ï¼Œæœ€åè‚¯å®šè¦è°ƒç”¨1æ¬¡releaseæˆ–è€…autorelease</li>
<li>åŸåˆ™ï¼šæœ‰+ å°±æœ‰-</li>
</ul>

<pre><code>self.array = [NSArray alloc]init]autorelease];
allocå +1(è®¡æ•°å™¨ = 2)ï¼› autoreleaseå -1(è®¡æ•°å™¨ = 1)
//æˆ–è€…è¿™æ ·å†™ï¼Œå°±ä¸éœ€è¦å†™autoreleaseï¼Œç³»ç»Ÿå†…éƒ¨è‡ªåŠ¨å†™å¥½
self.array = [NSArray array];
</code></pre>

<ul>
<li>æœ€åè¦åœ¨deallocé‡Šæ”¾å†…å­˜</li>
</ul>

<pre><code>//å½“æ§åˆ¶å™¨å°†è¢«é‡Šæ”¾çš„æ—¶å€™å¯¹è°ƒç”¨
- (void)dealloc {
//æœ€å¥½è¿™æ ·å†™
self.array = nil;
-1(è®¡æ•°å™¨ = 0)

//ä¹Ÿå¯ä»¥è¿™æ ·å†™
self.array = [array release];
//æœ€åè°ƒç”¨
[supe dealloc];
}
</code></pre>

<p>å¦‚æœæ˜¯iOSç‰ˆæœ¬åœ¨5.0ä¹‹å‰è¦åœ¨3ä¸ªåœ°æ–¹é‡Šæ”¾å†…å­˜</p>

<pre><code>//æ§åˆ¶å™¨çš„Viewè¢«å¸è½½ï¼Œä¼šè°ƒç”¨
- (void)viewDidUnload {

    [super viewDidUnload];
    self.array = nil;
}

//æ¥æ”¶åˆ°å†…å­˜è­¦å‘Šï¼Œä¼šè°ƒç”¨
- (void)didReceiveMemoryWarning {

    [super didReceiveMemoryWarning];
    self.array = nil;
}

- (void)dealloc {

    self.array = nil;

    [super dealloc];
}
</code></pre>

<h4 id="toc_23">15ã€å¤šçº¿ç¨‹å¦‚ä½•è¿›è¡Œçº¿ä¹‹é—´é€šè®¯ï¼Ÿ</h4>

<pre><code>//åœ¨ä¸»çº¿ç¨‹æ‰§è¡ŒæŸä¸ªæ–¹æ³•ï¼Œä¼ å‚ï¼ˆè¯¥æ–¹æ³•ç”¨äºå­çº¿ç¨‹å¯¹ä¸»çº¿ç¨‹è¿›è¡Œé€šè®¯ï¼‰
[self performSelectorOnMainThread: withObject: waitUntilDone:]

//æŒ‡å®šçº¿ç¨‹ï¼Œè°ƒç”¨æ–¹æ³•ï¼Œä¼ å‚
[self performSelector: onThread: withObject: waitUntilDone: modes: *)#&gt;

//GCDåœ¨å¼‚æ­¥çº¿ç¨‹åšäº‹æƒ…
dispatch_async(, )
</code></pre>

<h4 id="toc_24">16ã€ç”¨NSOperationå’ŒNSOperationQueueå¤„ç†A,B,Cä¸‰ä¸ªçº¿ç¨‹ï¼Œè¦æ±‚æ‰§è¡Œå®ŒA,Bæ‰èƒ½æ‰§è¡ŒCï¼Œæ€ä¹ˆåšï¼Ÿ</h4>

<ul>
<li>1.ç¬¬ä¸€ç§æ–¹æ³•æ·»åŠ ä¾èµ–</li>
</ul>

<pre><code>//åˆ›å»ºåˆ—é˜Ÿ
NSOperationQueue *queue = [NSOperationQueue alloc]init];
//åˆ›å»º3ä¸ªæ“ä½œ
NSOperation *a = [NSBlockOperation blockOperationWithBlock:^{
    NSLog(@&quot;operation1....&quot;);
}];

NSOperation *c = [NSBlockOperation blockOperationWithBlock:^{
    NSLog(@&quot;operation2....&quot;);
}];

NSOperation *b = [NSBlockOperation blockOperationWithBlock:^{
    NSLog(@&quot;operation3....&quot;);
}];
//======æ·»åŠ ä¾èµ–=======
//åªæœ‰å½“aæ“ä½œæ‰§è¡Œå®Œæ¯•åï¼Œæ‰ä¼šæ‰§è¡Œcæ“ä½œ
[c addDependency:a];
//åªæœ‰å½“bæ“ä½œæ‰§è¡Œå®Œæ¯•åï¼Œæ‰ä¼šæ‰§è¡Œcæ“ä½œ
[c addDependency:b];

[queue addOperation:a];
[queue addOperation:b];
[queue addOperation:c];
</code></pre>

<ul>
<li>2.ç¬¬äºŒç§æ–¹æ³• å¯ ä»¥è®¾ç½®ä¼˜å…ˆçº§</li>
</ul>

<pre><code>- (NSOperationQueuePriority)queuePriority;
</code></pre>

<h4 id="toc_25">17ã€GCDå†…éƒ¨æ€ä¹ˆå®ç°çš„</h4>

<ul>
<li>1.iSOå’ŒOS Xçš„æ ¸å¿ƒæ˜¯XNUå†…æ ¸ï¼ŒGCDæ˜¯åŸºäºXNUå†…æ ¸å®ç°çš„</li>
<li>2.GCDçš„APIå…¨éƒ¨åœ¨libdispatchåº“ä¸­</li>
<li>3.GCDçš„åº•å±‚å®ç°ä¸»è¦æœ‰Dispatch Queueå’Œ Dispatch Source

<ul>
<li>Disatch Queue ï¼šç®¡ç†blockï¼ˆæ“ä½œï¼Œblocké‡Œçš„ä»£ç å—ï¼Œæ ¹æ®ç±»å‹åœ¨å“ªä¸ªçº¿ç¨‹æ‰§è¡Œï¼‰</li>
<li>Disatch Source ï¼š å¤„ç†äº‹ä»¶ï¼ˆåº•å±‚å®ç°ï¼Œå¤„ç†çº¿ç¨‹ä¹‹é—´çš„äº‹ä»¶ï¼Œå¦‚ä¸»çº¿ç¨‹ä¼šåˆ°ä»€ä¹ˆçº¿ç¨‹ï¼Œå¼‚æ­¥çº¿ç¨‹å›åˆ°ä»€ä¹ˆçº¿ç¨‹ï¼‰</li>
</ul></li>
</ul>

<h4 id="toc_26">18ã€NSOperatinQueueå’ŒCGDçš„åŒºåˆ«ï¼Œä»€ä¹ˆæƒ…å†µä¸‹ç”¨NSOperationQueueï¼Œä»€ä¹ˆæƒ…å†µä¸‹ç”¨GCD</h4>

<ul>
<li>1.GCDæ˜¯çº¯Cè¯­è¨€çš„APIï¼ŒNSOperationQueueæ˜¯åŸºäºGCDçš„OCç‰ˆæœ¬å°è£…</li>
<li>2.GCDåªæ”¯æŒFIFOçš„åˆ—é˜Ÿï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰ï¼ŒNSOperationQueueå¯ä»¥å¾ˆæ–¹ä¾¿åœ°è°ƒæ•´æ‰§è¡Œé¡ºåºï¼ˆè®¾ç½®ä¼˜å…ˆçº§ ï¼‰ï¼Œè®¾ç½®æœ€å¤§å¹¶å‘æ•°é‡</li>
<li>3.NSOperatinQueueå¯ä»¥è½»æ¾åœ¨Operationé—´è®¾ç½®ä¾èµ–å…³ç³»ï¼Œè€ŒGCDéœ€è¦äº›å¾ˆå¤šä»£ç æ‰èƒ½å®ç°</li>
<li>4.NSOperationQueueæ”¯æŒKVOï¼Œå¯ä»¥ç›‘å¬operationæ˜¯å¦æ­£åœ¨æ‰§è¡Œï¼ˆisExecutedï¼‰ã€æ˜¯å¦ç»“æŸï¼ˆisFinishedï¼‰ï¼Œæ˜¯å¦å–æ¶ˆï¼ˆisCanceldï¼‰ï¼›ç³»ç»Ÿå†…éƒ¨å·²ç»åšå¥½çš„KVO</li>
<li>5.GCDçš„æ‰§è¡Œé€Ÿåº¦æ¯”NSOperationQueueå¿«</li>
<li>ä»€ä¹ˆæ—¶å€™ï¼Œç”¨å“ªä¸ª

<ul>
<li>1.ä»»åŠ¡ä¹‹é—´æœ‰ä¾èµ–/æˆ–è€…è¦ç›‘å¬ä»»åŠ¡çš„æ‰§è¡Œæƒ…å†µï¼šNSOperatinQueueï¼ˆä»»åŠ¡éœ€è¦æ—¶åˆ»ç›‘å¬ï¼›ä»»åŠ¡ä¸¥æ ¼éœ€è¦æŒ‰é¡ºåºæ‰§è¡Œï¼‰</li>
<li>2.ä»»åŠ¡ä¹‹é—´ä¸å¤ªç›¸äº’ä¾èµ–å°±ç”¨ï¼šCGD</li>
</ul></li>
</ul>

<h4 id="toc_27">19ã€æ—¢ç„¶è¯´åˆ°GCDï¼Œé‚£ä¹ˆé—®ä¸‹åœ¨ä½¿ç”¨GCDå·²ç»blockéœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ</h4>

<ul>
<li>1.GCDçš„æ³¨æ„18é¢˜å·²æœ‰è¯´æ˜</li>
<li>2.Blockçš„ä½¿ç”¨æ³¨æ„

<ul>
<li>1.blockçš„å†…å­˜ç®¡ç†(13é¢˜å·²æœ‰è¯´æ˜)</li>
<li>2.é˜²æ­¢å¾ªç¯retain

<ul>
<li>ARCï¼š<strong>weak/</strong>unsafe_unretained</li>
<li>MRC: __block 0</li>
</ul></li>
</ul></li>
</ul>

<h4 id="toc_28">20ã€å¦‚æœåæœŸéœ€è¦å¢åŠ æ•°æ®åº“ä¸­çš„å­—æ®µæ€ä¹ˆå®ç°ï¼Œå¦‚æœä¸ä½¿ç”¨CoreDataå‘¢ï¼Ÿ</h4>

<p>ç¼–å†™SQLè¯­å¥æ¥æ“ä½œåŸæ¥è¡¨ä¸­çš„å­—æ®µ</p>

<ul>
<li>1.å¢åŠ è¡¨å­—æ®µ
ALTER TABLE è¡¨å DROP COLUMN å­—æ®µå å­—æ®µç±»å‹</li>
<li>2.åˆ é™¤è¡¨å­—æ®µ
ALTER TABLE è¡¨å DROP COLUMN å­—æ®µå</li>
<li>3.ä¿®æ”¹è¡¨å­—æ®µ
ALTER TABLE è¡¨å RENAME COLUMN æ—§å­—æ®µå TO æ–°å­—æ®µå</li>
</ul>

<h4 id="toc_29">21ã€ç®€å•æè¿°ä¸‹å®¢æˆ·ç«¯çš„ç¼“å­˜æœºåˆ¶</h4>

<ul>
<li>1.ç¼“å­˜å¯ä»¥åˆ†ä¸ºï¼šå†…å­˜æ•°æ®ç¼“å­˜ã€æ•°æ®åº“ç¼“å­˜ã€æ–‡ä»¶ç¼“å­˜</li>
<li>2.æ¯æ¬¡æƒ³è·å–æ•°æ®çš„æ—¶å€™

<ul>
<li>å…ˆæ£€æµ‹å†…å­˜ä¸­æœ‰æ— ç¼“å­˜</li>
<li>åœ¨æ£€æµ‹æœ¬åœ°æœ‰æ— ç¼“å­˜ï¼ˆæ•°æ®åº“/æ–‡ä»¶ï¼‰</li>
<li>æœ€ç»ˆå‘é€ç½‘ç»œè¯·æ±‚</li>
<li>å°†æœåŠ¡å™¨è¿”å›çš„ç½‘ç»œæ•°æ®è¿›è¡Œç¼“å­˜ï¼ˆå†…å­˜ã€æ•°æ®åº“ã€æ–‡ä»¶ï¼‰ï¼Œå·²ä¾¿ä¸‹æ¬¡è¯»å–</li>
</ul></li>
</ul>

<h4 id="toc_30">22ã€æœ‰äº›å›¾ç‰‡åŠ è½½çš„æ¯”è¾ƒæ…¢æ€ä¹ˆå¤„ç†ï¼Ÿä½ æ˜¯æ€ä¹ˆä¼˜åŒ–ç¨‹åºçš„æ€§èƒ½çš„ï¼Ÿ</h4>

<ul>
<li>1.å›¾ç‰‡ä¸‹è½½æ”¾åœ¨å¼‚æ­¥çº¿ç¨‹</li>
<li>2.å›¾ç‰‡ä¸‹è½½è¿‡ç¨‹ä¸­ä½¿ç”¨å ä½å›¾ï¼Œæé«˜ç”¨æˆ·çš„å¤©</li>
<li>3.å¦‚æœå›¾ç‰‡æ¯”è¾ƒå¤§ï¼Œå¯ä»¥è€ƒè™‘å¤šçº¿ç¨‹æ–­ç‚¹ä¸‹è½½ï¼ˆå¼€è¾Ÿå¤šä¸ªçº¿ç¨‹ä¸‹è½½ä¸€å¼ å›¾ç‰‡ï¼Œéœ€è¦æœåŠ¡å™¨è®¾ç½®è¯·æ±‚ä½“ä¿¡æ¯ï¼‰</li>
</ul>

<h4 id="toc_31">23ã€ä½ å®ç°è¿‡ä¸€ä¸ªæ¡†æ¶æˆ–è€…åº“ä»¥ä¾›åˆ«äººä½¿ç”¨å—ï¼Ÿå¦‚æœæœ‰ï¼Œè¯·è°ˆä¸€è°ˆæ„å»ºæ¡†æ¶æˆ–è€…åº“æ—¶å€™çš„ç»éªŒï¼›å¦‚æœæ²¡æœ‰ï¼Œè¯·è®¾æƒ³å’Œè®¾è®¡æ¡†æ¶çš„publicçš„APIï¼Œå¹¶æŒ‡å‡ºå¤§æ¦‚éœ€è¦å¦‚ä½•åšã€éœ€è¦æ³¨æ„ä¸€äº›ä»€ä¹ˆæ–¹é¢ï¼Œæ¥ä½¿åˆ«äººå®¹æ˜“åœ°ä½¿ç”¨ä½ çš„æ¡†æ¶ã€‚</h4>

<ul>
<li>1.æä¾›ç»™å¤–ç•Œçš„æ¥å£åŠŸèƒ½æ˜¯å¦å®ç”¨ã€å¤Ÿç”¨</li>
<li>2.åˆ«äººä½¿ç”¨æˆ‘çš„æ¡†æ¶æ—¶ï¼Œèƒ½ä¸èƒ½æ ¹æ®ç±»åã€æ–¹æ³•åå°±çŒœå‡ºæ¥å£çš„å…·ä½“ä½œç”¨</li>
<li>3.åˆ«äººè°ƒç”¨æ¥å£æ—¶ï¼Œæä¾›çš„å‚æ•°æ˜¯å¦å¤Ÿç”¨ã€è°ƒç”¨èµ·æ¥æ˜¯å¦ç®€å•</li>
<li>4.åˆ«äººä½¿ç”¨æˆ‘çš„æ¡†æ¶æ—¶ï¼Œè¦ä¸è¦å†å¯¼å…¥ä¾èµ–å…¶ä»–çš„æ¡†æ¶</li>
</ul>

<h4 id="toc_32">24ã€æ˜¯å¦å¯ä»¥æŠŠæ¯”è¾ƒè€—æ—¶çš„æ“ä½œæ”¾åœ¨NSNotificationCenterä¸­ï¼Ÿ</h4>

<ul>
<li>1.å¦‚æœåœ¨å¼‚æ­¥çº¿ç¨‹å‘çš„é€šçŸ¥ï¼Œé‚£ä¹ˆå¯ä»¥æ‰§è¡Œæ¯”è¾ƒè€—æ—¶çš„æ“ä½œ</li>
<li>2.å¦‚æœåœ¨ä¸»çº¿ç¨‹å‘çš„é€šçŸ¥ï¼Œé‚£ä¹ˆå°±ä¸å¯ä»¥æ‰§è¡Œæ¯”è¾ƒè€—æ—¶çš„æ“ä½œ
è¡¥å……ï¼šNSNotificationCenteré»˜è®¤æ˜¯ä¸»çº¿ç¨‹çš„ï¼Œä½†æ˜¯åœ¨å¼‚æ­¥çº¿ç¨‹å‘é€šçŸ¥ï¼Œé‚£ä¹ˆNSNotificationCenterå°±ä¼šå˜æˆå¼‚æ­¥çº¿ç¨‹</li>
</ul>

<h4 id="toc_33">25ã€SDWebImageå…·ä½“å¦‚ä½•å®ç°</h4>

<ul>
<li>1.åˆ©ç”¨NSOperationQueueå’ŒNSOperationä¸‹è½½å›¾ç‰‡ï¼Œè¿˜ä½¿ç”¨äº†GCDçš„ä¸€äº›å‡½æ•°ï¼ˆè§£ç GIFå›¾ç‰‡ï¼‰</li>
<li>2.åˆ©ç”¨URLä½œä¸ºkeyï¼ŒNSOperationä½œä¸ºvalue</li>
<li>3.åˆ©ç”¨URLä½œä¸ºkeyï¼ŒUIImageä½œä¸ºvalue</li>
</ul>

<h4 id="toc_34">26ã€æ€ä¹ˆè§£å†³sqliteé”å®šçš„é—®é¢˜</h4>

<ul>
<li>1.è®¾ç½®æ•°æ®åº“é”å®šçš„å¤„ç†å‡½æ•°</li>
</ul>

<pre><code>å½“æ•°æ®åº“è¢«é”æ—¶ï¼Œä¼šè°ƒç”¨è¯¥æ–¹æ³•
//å‚æ•°1ä¼ å…¥æ•°æ®åº“ï¼Œ
//å‚æ•°2ä¼ å…¥å‡½æ•°å(åœ¨è¯¥å‡½æ•°ä¸­åšæ“ä½œ)
int sqlite3_busy_handler(sqlite3*, test);
</code></pre>

<ul>
<li><p>2.è®¾ç½®é”å®šæ—¶çš„ç­‰å¾…æ—¶é—´</p>

<pre><code>int sqlite3_busy_timeout(sqlite3*, int ms);
</code></pre></li>
</ul>

<h4 id="toc_35">27ã€cocoaä¸­å¸¸è§å¯¹å‡ ç§å¤šçº¿ç¨‹çš„å®ç°ï¼Œå¹¶è°ˆè°ˆå¤šçº¿ç¨‹å®‰å…¨çš„å‡ ç§è§£å†³åŠæ³•åŠå¤šçº¿ç¨‹å®‰å…¨æ€ä¹ˆæ§åˆ¶ï¼Ÿ</h4>

<ul>
<li>1.åªåœ¨ä¸»çº¿ç¨‹åˆ·æ–°è®¿é—®UI</li>
<li>2.å¦‚æœè¦é˜²æ­¢èµ„æºæŠ¢å¤ºï¼Œå¾—ç”¨synchroizedè¿›è¡ŒåŠ é”ä¿æŠ¤</li>
<li>3.å¦‚æœå¼‚æ­¥æ“ä½œè¦ä¿è¯çº¿ç¨‹å®‰å…¨ç­‰é—®é¢˜ï¼Œå°½é‡ä½¿ç”¨GCDï¼ˆæœ‰äº›å‡½æ•°é»˜è®¤å°±æ˜¯å®‰å…¨çš„ï¼‰</li>
</ul>

<h4 id="toc_36">28ã€ä»€ä¹ˆæ˜¯run loopï¼Ÿ</h4>

<ul>
<li>1.runloopæ˜¯æ¶ˆæ¯å¾ªç¯ï¼Œå†…éƒ¨æœ‰å®šæ—¶æºå’Œè¾“å…¥æºæ¥è¿ä½œ</li>
<li>2.åœ¨åˆ›å»ºçš„ç¨‹åºä¸éœ€è¦æ˜¾ç¤ºçš„åˆ›å»ºrun loopï¼›æ¯ä¸ªçº¿ç¨‹ï¼ŒåŒ…æ‹¬ç¨‹åºçš„ä¸»çº¿ç¨‹ï¼ˆmain threadï¼‰éƒ½æœ‰ä¸ä¹‹ç›¸åº”çš„run loopå¯¹è±¡ï¼Œä¸»çº¿ç¨‹ä¼šè‡ªè¡Œåˆ›å»ºå¹¶è¿è¡Œrun loop</li>
<li>3.run loopå¤„ç†çš„è¾“å…¥äº‹ä»¶æœ‰ä¸¤ç§ä¸åŒçš„æ¥æºï¼šè¾“å…¥æºï¼ˆinput sourceï¼‰å’Œå®šæ—¶æºï¼ˆtimer sourceï¼‰</li>
<li>4.è¾“å…¥æºå¤„ç†ä¼ é€’å¼‚æ­¥æ¶ˆæ¯ï¼Œé€šå¸¸æ¥è‡ªäºå…¶ä»–çº¿ç¨‹æˆ–è€…ç¨‹åºã€‚å®šæ—¶æºåˆ™å¤„ç†ä¼ é€’åŒæ­¥æ¶ˆæ¯ï¼Œåœ¨ç‰¹å®šæ—¶é—´æˆ–è€…ä¸€å®šçš„æ—¶é—´é—´éš”å‘ç”Ÿ</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[MKNetWorkç®€ä»‹]]></title>
    <link href="http://www.citynight.cn/Blog/14719458588528.html"/>
    <updated>2016-08-23T17:50:58+08:00</updated>
    <id>http://www.citynight.cn/Blog/14719458588528.html</id>
    <content type="html"><![CDATA[
<p>ç”¨æˆ·ç‰ˆæœ€æ–°ç‰ˆæœ¬æˆ‘å°†æ›¿æ¢æˆæœ€æ–°çš„ç½‘ç»œè¯·æ±‚å°è£…,è¿™æ¬¡æˆ‘å°†å°è£…ä¸€äº›å¸¸ç”¨çš„ä¸œè¥¿åˆ°ç½‘ç»œè¯·æ±‚ä¸­,è®©ç½‘ç»œè¯·æ±‚ç‹¬ç«‹å‡ºä¸€å±‚,é¿å…æ‰€æœ‰ç½‘ç»œè¯·æ±‚éƒ½å†™åœ¨æ§åˆ¶å™¨ä¸­.<br/>
ç›®å½•ç»“æ„:</p>

<ul>
<li><strong>MKBaseRequest</strong>     :æ‰€æœ‰çš„ç½‘ç»œè¯·æ±‚ç±»éœ€è¦ç»§æ‰¿äº <code>MKBaseRequest</code> ç±»ï¼Œæ¯ä¸€ä¸ª<code>MKBaseRequest</code> ç±»çš„å­ç±»ä»£è¡¨ä¸€ç§ä¸“é—¨çš„ç½‘ç»œè¯·æ±‚ã€‚
MKBaseRequest çš„åŸºæœ¬çš„æ€æƒ³æ˜¯æŠŠæ¯ä¸€ä¸ªç½‘ç»œè¯·æ±‚å°è£…æˆå¯¹è±¡ã€‚æ‰€ä»¥ä½¿ç”¨ MKNetWorkï¼Œä½ çš„æ¯ä¸€ç§è¯·æ±‚éƒ½éœ€è¦ç»§æ‰¿ MKBaseRequestç±»ï¼Œé€šè¿‡è¦†ç›–çˆ¶ç±»çš„ä¸€äº›æ–¹æ³•æ¥æ„é€ æŒ‡å®šçš„ç½‘ç»œè¯·æ±‚ã€‚æŠŠæ¯ä¸€ä¸ªç½‘ç»œè¯·æ±‚å°è£…æˆå¯¹è±¡å…¶å®æ˜¯ä½¿ç”¨äº†è®¾è®¡æ¨¡å¼ä¸­çš„ Command æ¨¡å¼ã€‚
æ¯ä¸€ç§ç½‘ç»œè¯·æ±‚ç»§æ‰¿ MKBaseRequest ç±»åï¼Œéœ€è¦ç”¨æ–¹æ³•è¦†ç›–ï¼ˆoverwriteï¼‰çš„æ–¹å¼ï¼Œæ¥æŒ‡å®šç½‘ç»œè¯·æ±‚çš„å…·ä½“ä¿¡æ¯ã€‚ä¾‹å¦‚:</li>
</ul>

<pre><code>// é‡å†™æ¥å£åç§°
-(NSString *)requestUrl {
    return @&quot;geocode/regeo&quot;;
}
// é‡å†™è¯·æ±‚æ–¹å¼
-(MKRequestMethod)requestMethod {
    return MKRequestMethodGet;
}
// é‡å†™æƒ³è¦çš„æ”¾å›æ•°æ®è§£ææ–¹å¼
-(MKRequestSerializerType)requestSerializerType {
    return MKRequestSerializerTypeHTTP;
}
</code></pre>

<p>ç›®å‰æ²¡æœ‰æ·»åŠ è¿”å›å‚æ•°æ ¼å¼éªŒè¯,å¦‚æœ‰éœ€è¦å¯ä»¥åœ¨baseä¸­æ·»åŠ ,è®©ç»§æ‰¿è€…é‡å†™.</p>

<ul>
<li><strong>MKNetWorkAgent</strong>    :MKNetWorkAgentæœ€åŸºç¡€çš„ç½‘ç»œè¯·æ±‚å°è£…,ç›®å‰å°è£…çš„AFN,å¦‚æœ‰å¿…è¦å¯ä»¥æ›¿æ¢</li>
<li><strong>MKNetworkConfig</strong>   :ç”¨äºç»Ÿä¸€è®¾ç½®ç½‘ç»œè¯·æ±‚çš„æœåŠ¡å™¨å’Œ CDN çš„åœ°å€ã€‚åœ¨å®é™…ä¸šåŠ¡ä¸­ï¼Œæˆ‘ä»¬çš„æµ‹è¯•éœ€è¦åˆ‡æ¢ä¸åŒçš„æœåŠ¡å™¨åœ°å€æ¥æµ‹è¯•ã€‚ç»Ÿä¸€è®¾ç½®æœåŠ¡å™¨åœ°å€åˆ° MKNetworkConfig ç±»ä¸­ï¼Œä¹Ÿä¾¿äºæˆ‘ä»¬ç»Ÿä¸€åˆ‡æ¢æœåŠ¡å™¨åœ°å€ã€‚</li>
</ul>

<pre><code> - (void)setupRequestFilters {
    // è¿™é‡Œç”¨é«˜å¾·Apiè¿›è¡Œæµ‹è¯•
    NSString *appVersion = [[[NSBundle mainBundle] infoDictionary] objectForKey:@&quot;CFBundleShortVersionString&quot;];
    MKNetworkConfig *config = [MKNetworkConfig sharedInstance];
    config.baseUrl = @&quot;http://restapi.amap.com/v3/&quot;;
    MKUrlArgumentsFilter *urlFilter = [MKUrlArgumentsFilter filterWithArguments:@{@&quot;version&quot;: appVersion}];
    [config addUrlFilter:urlFilter];
}


- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions {
    
    [self setupRequestFilters];
    
    return YES;
} 
</code></pre>

<ul>
<li><strong>MKChainRequest</strong>    :ç”¨äºç®¡ç†æœ‰ç›¸äº’ä¾èµ–çš„ç½‘ç»œè¯·æ±‚ï¼Œå®ƒå®é™…ä¸Šæœ€ç»ˆå¯ä»¥ç”¨æ¥ç®¡ç†å¤šä¸ªæ‹“æ‰‘æ’åºåçš„ç½‘ç»œè¯·æ±‚ã€‚</li>
</ul>

<p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªéœ€æ±‚ï¼Œéœ€è¦ç”¨æˆ·åœ¨æ³¨å†Œæ—¶ï¼Œå…ˆå‘é€æ³¨å†Œçš„Apiï¼Œç„¶å:<br/>
1. å¦‚æœæ³¨å†ŒæˆåŠŸï¼Œå†å‘é€è¯»å–ç”¨æˆ·ä¿¡æ¯çš„Apiã€‚å¹¶ä¸”ï¼Œè¯»å–ç”¨æˆ·ä¿¡æ¯çš„Apiéœ€è¦ä½¿ç”¨æ³¨å†ŒæˆåŠŸè¿”å›çš„ç”¨æˆ·idå·ã€‚<br/>
2. å¦‚æœæ³¨å†Œå¤±è´¥ï¼Œåˆ™ä¸å‘é€è¯»å–ç”¨æˆ·ä¿¡æ¯çš„Apiäº†ã€‚</p>

<p><strong>ä¸è¶³:</strong><br/>
1. ç›®å‰æ²¡æœ‰åšç¼“å­˜,ç”±äºé¡¹ç›®ä¸­urlæ˜¯æ ¹æ®æ—¶é—´æˆ³,å¯ä»¥ä½¿ç”¨å·²æœ‰çš„ç¼“å­˜ä½œä¸ºè¡¥å…….ä¹Ÿå¯ä»¥å†™åˆ°ç½‘ç»œå±‚å°è£…ä¸­.<br/>
2. ä¸²è¡Œç½‘ç»œè¯·æ±‚å°è£…äº†,ä½†æ˜¯ç”±äºé»˜è®¤å°±æ˜¯å¹¶è¡Œç½‘ç»œè¯·æ±‚,æ‰€ä»¥æ²¡æœ‰å°è£….å¦‚æœéœ€è¦é™åˆ¶æœ€å¤§å¹¶å‘æ•°é‡,å¯ä»¥åœ¨<code>MKNetWorkAgent</code>ä¸­è®¾ç½®.<br/>
3. æœ¨æœ‰å¤§é‡æµ‹è¯•,å¯èƒ½å­˜åœ¨bug</p>

<p><strong>æ³¨æ„äº‹é¡¹:</strong><br/>
åŸºæœ¬æ²¡æœ‰å•¥éœ€è¦æ³¨æ„çš„&hellip;,å…·ä½“ä½¿ç”¨æ–¹æ³•å¯ä»¥å‚è§Demo,å…³äºå‚æ•°å¯ä»¥å®ç°ä»£ç†æ–¹æ³•,ä¹Ÿå¯ä»¥ç›´æ¥ä¼ å‚.å¦‚æœç›´æ¥ä¼ å‚,ä¼šè¦†ç›–æ‰ä»£ç†ä¸­çš„æ•°æ®æº.  Demoä¸­å®ç°äº†ç®€å•çš„ä¸‹æ‹‰åŠ è½½ä¸­å…³äºpageçš„å°è£….æ‰©å±•åŠŸèƒ½æˆ‘éƒ½å†™æˆä»£ç†,ç„¶åéœ€è¦ä»€ä¹ˆåŠŸèƒ½å®ç°ä»¥ä¸‹å°±å¯ä»¥äº†,é¿å…<code>MKBaseRequest</code>ä¸­åŒ…å«å¤ªå¤šåŠŸèƒ½,è¿™æ ·å¯ä»¥å®ç°è‡ªå®šä¹‰ç»„æˆè‡ªå·±éœ€è¦çš„åŠŸèƒ½.</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[const,static,externç®€ä»‹]]></title>
    <link href="http://www.citynight.cn/Blog/14718293013293.html"/>
    <updated>2016-08-22T09:28:21+08:00</updated>
    <id>http://www.citynight.cn/Blog/14718293013293.html</id>
    <content type="html"><![CDATA[
<h3 id="toc_0">ä¸€ã€constä¸å®çš„åŒºåˆ«ï¼ˆé¢è¯•é¢˜ï¼‰:</h3>

<ul>
<li><p><code>constç®€ä»‹</code>:ä¹‹å‰å¸¸ç”¨çš„å­—ç¬¦ä¸²å¸¸é‡ï¼Œä¸€èˆ¬æ˜¯æŠ½æˆå®ï¼Œä½†æ˜¯è‹¹æœä¸æ¨èæˆ‘ä»¬æŠ½æˆå®ï¼Œæ¨èæˆ‘ä»¬ä½¿ç”¨constå¸¸é‡ã€‚</p>

<ul>
<li><code>ç¼–è¯‘æ—¶åˆ»</code>:å®æ˜¯é¢„ç¼–è¯‘ï¼ˆç¼–è¯‘ä¹‹å‰å¤„ç†ï¼‰ï¼Œconstæ˜¯ç¼–è¯‘é˜¶æ®µã€‚</li>
<li><code>ç¼–è¯‘æ£€æŸ¥</code>:å®ä¸åšæ£€æŸ¥ï¼Œä¸ä¼šæŠ¥ç¼–è¯‘é”™è¯¯ï¼Œåªæ˜¯æ›¿æ¢ï¼Œconstä¼šç¼–è¯‘æ£€æŸ¥ï¼Œä¼šæŠ¥ç¼–è¯‘é”™è¯¯ã€‚</li>
<li><code>å®çš„å¥½å¤„</code>:å®èƒ½å®šä¹‰ä¸€äº›å‡½æ•°ï¼Œæ–¹æ³•ã€‚ constä¸èƒ½ã€‚</li>
<li><code>å®çš„åå¤„</code>:ä½¿ç”¨å¤§é‡å®ï¼Œå®¹æ˜“é€ æˆç¼–è¯‘æ—¶é—´ä¹…ï¼Œæ¯æ¬¡éƒ½éœ€è¦é‡æ–°æ›¿æ¢ã€‚</li>
</ul>

<p>æ³¨æ„:å¾ˆå¤šBlogéƒ½è¯´ä½¿ç”¨å®ï¼Œä¼šæ¶ˆè€—å¾ˆå¤šå†…å­˜. defineå®ä»…ä»…æ˜¯å±•å¼€ï¼Œæœ‰å¤šå°‘åœ°æ–¹ä½¿ç”¨ï¼Œå°±å±•å¼€å¤šå°‘æ¬¡ï¼Œä¸ä¼šåˆ†é…å†…å­˜ã€‚ï¼ˆå®å®šä¹‰ä¸åˆ†é…å†…å­˜ï¼Œ<strong>å˜é‡å®šä¹‰</strong>åˆ†é…å†…å­˜ã€‚ï¼‰<br/>
 <img src="media/14718293013293/14719323806994.jpg" alt=""/></p>

<p><img src="media/14718293013293/14719331536266.jpg" alt=""/></p></li>
</ul>

<p>äº§ç”Ÿä¸Šè¿°é—®é¢˜çš„åŸå› :å¯ä»¥æŸ¥çœ‹<a href="https://www.zhihu.com/question/29662431">çŸ¥ä¹</a>ä¸Šé¢çš„å›ç­”,å¯ä»¥ç®€å•ç†è§£ä¸ºç¼–è¯‘å™¨ä¼˜åŒ–.</p>

<pre><code>// å¸¸è§çš„å¸¸é‡ï¼šæŠ½æˆå®
#define MKAccount @&quot;account&quot;

#define MKUserDefault [NSUserDefaults standardUserDefaults]

// å­—ç¬¦ä¸²å¸¸é‡
static NSString * const account = @&quot;account&quot;;

- (void)viewDidLoad {
    [super viewDidLoad];

    // åå¥½è®¾ç½®å­˜å‚¨
    // ä½¿ç”¨å®
    [MKUserDefault setValue:@&quot;123&quot; forKey:MKAccount];

    // ä½¿ç”¨constå¸¸é‡
    [[NSUserDefaults standardUserDefaults] setValue:@&quot;123&quot; forKey:account];

}

</code></pre>

<h3 id="toc_1">äºŒã€constä½œç”¨ï¼šé™åˆ¶ç±»å‹</h3>

<ul>
<li>1.constä»…ä»…ç”¨æ¥ä¿®é¥°å³è¾¹çš„å˜é‡ï¼ˆåŸºæœ¬æ•°æ®å˜é‡pï¼ŒæŒ‡é’ˆå˜é‡*pï¼‰</li>
<li><p>2.è¢«constä¿®é¥°çš„å˜é‡æ˜¯åªè¯»çš„ã€‚</p></li>
<li><p><code>conståŸºæœ¬ä½¿ç”¨</code></p></li>
</ul>

<pre><code>- (void)viewDidLoad {
    [super viewDidLoad];

    // å®šä¹‰å˜é‡
    int a = 1;

    // å…è®¸ä¿®æ”¹å€¼
    a = 20;

    // constä¸¤ç§ç”¨æ³•
    // const:ä¿®é¥°åŸºæœ¬å˜é‡p
    // è¿™ä¸¤ç§å†™æ³•æ˜¯ä¸€æ ·çš„ï¼Œconståªä¿®é¥°å³è¾¹çš„åŸºæœ¬å˜é‡b
    const int b = 20; // b:åªè¯»å˜é‡
    int const b = 20; // b:åªè¯»å˜é‡

    // ä¸å…è®¸ä¿®æ”¹å€¼
    b = 1;

    // const:ä¿®é¥°æŒ‡é’ˆå˜é‡*pï¼Œå¸¦*çš„å˜é‡ï¼Œå°±æ˜¯æŒ‡é’ˆå˜é‡.
    // å®šä¹‰ä¸€ä¸ªæŒ‡å‘intç±»å‹çš„æŒ‡é’ˆå˜é‡ï¼ŒæŒ‡å‘açš„åœ°å€
    int *p = &amp;a;

    int c = 10;

    p = &amp;c;

    // å…è®¸ä¿®æ”¹pæŒ‡å‘çš„åœ°å€ï¼Œ
    // å…è®¸ä¿®æ”¹pè®¿é—®å†…å­˜ç©ºé—´çš„å€¼
    *p = 20;

    // constä¿®é¥°æŒ‡é’ˆå˜é‡è®¿é—®çš„å†…å­˜ç©ºé—´ï¼Œä¿®é¥°çš„æ˜¯å³è¾¹*p1ï¼Œ
    // ä¸¤ç§æ–¹å¼ä¸€æ ·
    const int *p1; // *p1ï¼šå¸¸é‡ p1:å˜é‡
    int const *p1; // *p1ï¼šå¸¸é‡ p1:å˜é‡

    // constä¿®é¥°æŒ‡é’ˆå˜é‡p1
    int * const p1; // *p1:å˜é‡ p1:å¸¸é‡

    // ç¬¬ä¸€ä¸ªconstä¿®é¥°*p1 ç¬¬äºŒä¸ªconstä¿®é¥° p1
    // ä¸¤ç§æ–¹å¼ä¸€æ ·
    const int * const p1; // *p1ï¼šå¸¸é‡ p1ï¼šå¸¸é‡

    int const * const p1;  // *p1ï¼šå¸¸é‡ p1ï¼šå¸¸é‡

}

</code></pre>

<h3 id="toc_2">ä¸‰ã€constå¼€å‘ä¸­ä½¿ç”¨åœºæ™¯:</h3>

<ul>
<li>1.å½“ä¸€ä¸ªæ–¹æ³•å‚æ•°åªè¯»</li>
<li>2.å®šä¹‰åªè¯»å…¨å±€å˜é‡</li>
</ul>

<pre><code>@implementation ViewController

// å®šä¹‰åªè¯»å…¨å±€å¸¸é‡
NSString * const str  = @&quot;123&quot;;

// å½“ä¸€ä¸ªæ–¹æ³•çš„å‚æ•°ï¼Œåªè¯».
- (void)test:(NSString * const)name
{

}

// æŒ‡é’ˆåªè¯»,ä¸èƒ½é€šè¿‡æŒ‡é’ˆä¿®æ”¹å€¼
- (void)test1:(int const *)a{

//    *a = 10;
}

// åŸºæœ¬æ•°æ®ç±»å‹åªè¯»
- (void)test2:(int const)a{

}

@end

</code></pre>

<h3 id="toc_3">å››ã€staticå’Œexternç®€å•ä½¿ç”¨(è¦ä½¿ç”¨ä¸€ä¸ªä¸œè¥¿ï¼Œå…ˆäº†è§£å…¶ä½œç”¨)</h3>

<ul>
<li><p><code>staticä½œç”¨</code>:</p>

<ul>
<li><p>ä¿®é¥°å±€éƒ¨å˜é‡ï¼š</p>

<p>1.å»¶é•¿å±€éƒ¨å˜é‡çš„ç”Ÿå‘½å‘¨æœŸ,ç¨‹åºç»“æŸæ‰ä¼šé”€æ¯ã€‚</p>

<p>2.å±€éƒ¨å˜é‡åªä¼šç”Ÿæˆä¸€ä»½å†…å­˜,åªä¼šåˆå§‹åŒ–ä¸€æ¬¡ã€‚</p></li>
<li><p>ä¿®é¥°å…¨å±€å˜é‡</p>

<p>1.åªèƒ½åœ¨æœ¬æ–‡ä»¶ä¸­è®¿é—®,ä¿®æ”¹å…¨å±€å˜é‡çš„ä½œç”¨åŸŸ,ç”Ÿå‘½å‘¨æœŸä¸ä¼šæ”¹</p></li>
</ul></li>
<li><p><code>externä½œç”¨</code>:</p>

<ul>
<li>åªæ˜¯ç”¨æ¥è·å–å…¨å±€å˜é‡(åŒ…æ‹¬å…¨å±€é™æ€å˜é‡)çš„å€¼ï¼Œä¸èƒ½ç”¨äºå®šä¹‰å˜é‡</li>
</ul></li>
<li><p><code>externå·¥ä½œåŸç†</code>:</p>

<ul>
<li>å…ˆåœ¨å½“å‰æ–‡ä»¶æŸ¥æ‰¾æœ‰æ²¡æœ‰å…¨å±€å˜é‡ï¼Œæ²¡æœ‰æ‰¾åˆ°ï¼Œæ‰ä¼šå»å…¶ä»–æ–‡ä»¶æŸ¥æ‰¾ã€‚</li>
</ul></li>
</ul>

<pre><code>// å…¨å±€å˜é‡ï¼šåªæœ‰ä¸€ä»½å†…å­˜ï¼Œæ‰€æœ‰æ–‡ä»¶å…±äº«ï¼Œä¸externè”åˆä½¿ç”¨ã€‚
int a = 20;

// staticä¿®é¥°å…¨å±€å˜é‡
static int age = 20;

- (void)test
{
    // staticä¿®é¥°å±€éƒ¨å˜é‡
    static int age = 0;
    age++;
    NSLog(@&quot;%d&quot;,age);
}

- (void)viewDidLoad {
    [super viewDidLoad];
    // Do any additional setup after loading the view, typically from a nib.

    [self test];
    [self test];

    extern int age;
    NSLog(@&quot;%d&quot;,age);
}
I

</code></pre>

<h3 id="toc_4">äº”ã€staticä¸constè”åˆä½¿ç”¨</h3>

<ul>
<li>staticä¸constä½œç”¨:å£°æ˜ä¸€ä¸ªåªè¯»çš„é™æ€å˜é‡</li>
<li>å¼€å‘ä½¿ç”¨åœºæ™¯:åœ¨<code>ä¸€ä¸ªæ–‡ä»¶ä¸­</code>ç»å¸¸ä½¿ç”¨çš„å­—ç¬¦ä¸²å¸¸é‡ï¼Œå¯ä»¥ä½¿ç”¨staticä¸constç»„åˆ</li>
</ul>

<pre><code>// å¼€å‘ä¸­å¸¸ç”¨staticä¿®é¥°å…¨å±€å˜é‡,åªæ”¹å˜ä½œç”¨åŸŸ

// ä¸ºä»€ä¹ˆè¦æ”¹å˜å…¨å±€å˜é‡ä½œç”¨åŸŸï¼Œé˜²æ­¢é‡å¤å£°æ˜å…¨å±€å˜é‡ã€‚

// å¼€å‘ä¸­å£°æ˜çš„å…¨å±€å˜é‡ï¼Œæœ‰äº›ä¸å¸Œæœ›å¤–ç•Œæ”¹åŠ¨ï¼Œåªå…è®¸è¯»å–ã€‚

// æ¯”å¦‚ä¸€ä¸ªåŸºæœ¬æ•°æ®ç±»å‹ä¸å¸Œæœ›åˆ«äººæ”¹åŠ¨

// å£°æ˜ä¸€ä¸ªé™æ€çš„å…¨å±€åªè¯»å¸¸é‡
static const int a = 20;

// staicå’Œconstè”åˆçš„ä½œç”¨:å£°æ˜ä¸€ä¸ªé™æ€çš„å…¨å±€åªè¯»å¸¸é‡

// iOSä¸­staicå’Œconstå¸¸ç”¨ä½¿ç”¨åœºæ™¯ï¼Œæ˜¯ç”¨æ¥ä»£æ›¿å®ï¼ŒæŠŠä¸€ä¸ªç»å¸¸ä½¿ç”¨çš„å­—ç¬¦ä¸²å¸¸é‡ï¼Œå®šä¹‰æˆé™æ€å…¨å±€åªè¯»å˜é‡.

// å¼€å‘ä¸­ç»å¸¸æ‹¿åˆ°keyä¿®æ”¹å€¼ï¼Œå› æ­¤ç”¨constä¿®é¥°key,è¡¨ç¤ºkeyåªè¯»ï¼Œä¸å…è®¸ä¿®æ”¹ã€‚
static  NSString * const key = @&quot;name&quot;;

// å¦‚æœ constä¿®é¥° *key1,è¡¨ç¤º*key1åªè¯»ï¼Œkey1è¿˜æ˜¯èƒ½æ”¹å˜ã€‚

static  NSString const *key1 = @&quot;name&quot;;

</code></pre>

<h3 id="toc_5">å…­ã€externä¸constè”åˆä½¿ç”¨</h3>

<ul>
<li>å¼€å‘ä¸­ä½¿ç”¨åœºæ™¯:åœ¨<code>å¤šä¸ªæ–‡ä»¶ä¸­</code>ç»å¸¸ä½¿ç”¨çš„åŒä¸€ä¸ªå­—ç¬¦ä¸²å¸¸é‡ï¼Œå¯ä»¥ä½¿ç”¨externä¸constç»„åˆã€‚</li>
<li>åŸå› :

<ul>
<li>staticä¸constç»„åˆï¼šåœ¨æ¯ä¸ªæ–‡ä»¶éƒ½éœ€è¦å®šä¹‰ä¸€ä»½é™æ€å…¨å±€å˜é‡ã€‚</li>
<li>externä¸constç»„åˆ:åªéœ€è¦å®šä¹‰ä¸€ä»½å…¨å±€å˜é‡ï¼Œå¤šä¸ªæ–‡ä»¶å…±äº«ã€‚</li>
</ul></li>
<li><p>å…¨å±€å¸¸é‡æ­£è§„å†™æ³•:å¼€å‘ä¸­ä¾¿äºç®¡ç†æ‰€æœ‰çš„å…¨å±€å˜é‡ï¼Œé€šå¸¸æä¸€ä¸ªGlobeConstæ–‡ä»¶ï¼Œé‡Œé¢ä¸“é—¨å®šä¹‰å…¨å±€å˜é‡ï¼Œç»Ÿä¸€ç®¡ç†ï¼Œè¦ä¸ç„¶é¡¹ç›®æ–‡ä»¶å¤šä¸å¥½æ‰¾ã€‚</p></li>
<li><p>GlobeConst.h</p></li>
</ul>

<pre><code>/*******************************é¦–é¡µ****************************/

extern NSString * const nameKey = @&quot;name&quot;;

/*******************************é¦–é¡µ****************************/

</code></pre>

<ul>
<li>GlobeConst.m</li>
</ul>

<pre><code>#import 

/*******************************é¦–é¡µ****************************/

NSString * const nameKey = @&quot;name&quot;;

/*******************************é¦–é¡µ****************************/
</code></pre>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[runtimeå°ç»“]]></title>
    <link href="http://www.citynight.cn/Blog/14717809514175.html"/>
    <updated>2016-08-21T20:02:31+08:00</updated>
    <id>http://www.citynight.cn/Blog/14717809514175.html</id>
    <content type="html"><![CDATA[
<h3 id="toc_0">ä¸€ã€runtimeç®€ä»‹</h3>

<ul>
<li>runTimeç®€ç§°è¿è¡Œæ—¶ã€‚OCå°±æ˜¯<code>è¿è¡Œæ—¶æœºåˆ¶</code>ï¼Œä¹Ÿå°±æ˜¯åœ¨è¿è¡Œæ—¶å€™çš„ä¸€äº›æœºåˆ¶ï¼Œå…¶ä¸­æœ€ä¸»è¦çš„æ˜¯æ¶ˆæ¯æœºåˆ¶ã€‚</li>
<li>å¯¹äºCè¯­è¨€ï¼Œ<code>å‡½æ•°çš„è°ƒç”¨åœ¨ç¼–è¯‘çš„æ—¶å€™ä¼šå†³å®šè°ƒç”¨å“ªä¸ªå‡½æ•°</code>ã€‚</li>
<li>å¯¹äºOCçš„å‡½æ•°ï¼Œå±äº<code>åŠ¨æ€è°ƒç”¨è¿‡ç¨‹</code>ï¼Œåœ¨ç¼–è¯‘çš„æ—¶å€™å¹¶ä¸èƒ½å†³å®šçœŸæ­£è°ƒç”¨å“ªä¸ªå‡½æ•°ï¼Œåªæœ‰åœ¨çœŸæ­£è¿è¡Œçš„æ—¶å€™æ‰ä¼šæ ¹æ®å‡½æ•°çš„åç§°æ‰¾åˆ°å¯¹åº”çš„å‡½æ•°æ¥è°ƒç”¨ã€‚</li>
<li>äº‹å®è¯æ˜ï¼š

<ul>
<li>åœ¨ç¼–è¯‘é˜¶æ®µï¼ŒOCå¯ä»¥<code>è°ƒç”¨ä»»ä½•å‡½æ•°</code>ï¼Œå³ä½¿è¿™ä¸ªå‡½æ•°å¹¶æœªå®ç°ï¼Œåªè¦å£°æ˜è¿‡å°±ä¸ä¼šæŠ¥é”™ã€‚</li>
<li>åœ¨ç¼–è¯‘é˜¶æ®µï¼ŒCè¯­è¨€è°ƒç”¨<code>æœªå®ç°çš„å‡½æ•°</code>å°±ä¼šæŠ¥é”™ã€‚</li>
</ul></li>
</ul>

<h3 id="toc_1">äºŒã€runtimeä½œç”¨</h3>

<h4 id="toc_2">1.å‘é€æ¶ˆæ¯</h4>

<ul>
<li>æ–¹æ³•è°ƒç”¨çš„æœ¬è´¨ï¼Œå°±æ˜¯è®©å¯¹è±¡å‘é€æ¶ˆæ¯ã€‚</li>
<li>objc_msgSend,åªæœ‰å¯¹è±¡æ‰èƒ½å‘é€æ¶ˆæ¯ï¼Œå› æ­¤ä»¥objcå¼€å¤´.</li>
<li>ä½¿ç”¨<code>æ¶ˆæ¯æœºåˆ¶</code>å‰æï¼Œå¿…é¡»å¯¼å…¥#import </li>
<li>æ¶ˆæ¯æœºåˆ¶ç®€å•ä½¿ç”¨</li>
<li>clang -rewrite-objc main.m æŸ¥çœ‹æœ€ç»ˆç”Ÿæˆä»£ç </li>
</ul>

<pre><code>    // åˆ›å»ºpersonå¯¹è±¡
    Person *p = [[Person alloc] init];

    // è°ƒç”¨å¯¹è±¡æ–¹æ³•
    [p eat];

    // æœ¬è´¨ï¼šè®©å¯¹è±¡å‘é€æ¶ˆæ¯
    objc_msgSend(p, @selector(eat));

    // è°ƒç”¨ç±»æ–¹æ³•çš„æ–¹å¼ï¼šä¸¤ç§
    // ç¬¬ä¸€ç§é€šè¿‡ç±»åè°ƒç”¨
    [Person eat];
    // ç¬¬äºŒç§é€šè¿‡ç±»å¯¹è±¡è°ƒç”¨
    [[Person class] eat];

    // ç”¨ç±»åè°ƒç”¨ç±»æ–¹æ³•ï¼Œåº•å±‚ä¼šè‡ªåŠ¨æŠŠç±»åè½¬æ¢æˆç±»å¯¹è±¡è°ƒç”¨
    // æœ¬è´¨ï¼šè®©ç±»å¯¹è±¡å‘é€æ¶ˆæ¯
    objc_msgSend([Person class], @selector(eat));

</code></pre>

<ul>
<li>æ¶ˆæ¯æœºåˆ¶åŸç†:å¯¹è±¡æ ¹æ®æ–¹æ³•ç¼–å·SELå»æ˜ å°„è¡¨æŸ¥æ‰¾å¯¹åº”çš„æ–¹æ³•å®ç°
<img src="media/14717809514175/14717888515211.jpg" alt=""/></li>
</ul>

<h4 id="toc_3">2.äº¤æ¢æ–¹æ³•</h4>

<ul>
<li>å¼€å‘ä½¿ç”¨åœºæ™¯:ç³»ç»Ÿè‡ªå¸¦çš„æ–¹æ³•åŠŸèƒ½ä¸å¤Ÿï¼Œç»™ç³»ç»Ÿè‡ªå¸¦çš„æ–¹æ³•æ‰©å±•ä¸€äº›åŠŸèƒ½ï¼Œå¹¶ä¸”ä¿æŒåŸæœ‰çš„åŠŸèƒ½ã€‚</li>
<li>æ–¹å¼ä¸€:ç»§æ‰¿ç³»ç»Ÿçš„ç±»ï¼Œé‡å†™æ–¹æ³•.</li>
<li>æ–¹å¼äºŒ:ä½¿ç”¨runtime,äº¤æ¢æ–¹æ³•.</li>
</ul>

<pre><code>@implementation ViewController

- (void)viewDidLoad {
    [super viewDidLoad];
    // Do any additional setup after loading the view, typically from a nib.
    // éœ€æ±‚ï¼šç»™imageNamedæ–¹æ³•æä¾›åŠŸèƒ½ï¼Œæ¯æ¬¡åŠ è½½å›¾ç‰‡å°±åˆ¤æ–­ä¸‹å›¾ç‰‡æ˜¯å¦åŠ è½½æˆåŠŸã€‚
    // æ­¥éª¤ä¸€ï¼šå…ˆæä¸ªåˆ†ç±»ï¼Œå®šä¹‰ä¸€ä¸ªèƒ½åŠ è½½å›¾ç‰‡å¹¶ä¸”èƒ½æ‰“å°çš„æ–¹æ³•+ (instancetype)imageWithName:(NSString *)name;
    // æ­¥éª¤äºŒï¼šäº¤æ¢imageNamedå’ŒimageWithNameçš„å®ç°ï¼Œå°±èƒ½è°ƒç”¨imageWithNameï¼Œé—´æ¥è°ƒç”¨imageWithNameçš„å®ç°ã€‚
    UIImage *image = [UIImage imageNamed:@&quot;123&quot;];

}

@end

@implementation UIImage (Image)
// åŠ è½½åˆ†ç±»åˆ°å†…å­˜çš„æ—¶å€™è°ƒç”¨
+ (void)load
{
    // äº¤æ¢æ–¹æ³•

    // è·å–imageWithNameæ–¹æ³•åœ°å€
    Method imageWithName = class_getClassMethod(self, @selector(imageWithName:));

    // è·å–imageWithNameæ–¹æ³•åœ°å€
    Method imageName = class_getClassMethod(self, @selector(imageNamed:));

    // äº¤æ¢æ–¹æ³•åœ°å€ï¼Œç›¸å½“äºäº¤æ¢å®ç°æ–¹å¼
    method_exchangeImplementations(imageWithName, imageName);

}

// ä¸èƒ½åœ¨åˆ†ç±»ä¸­é‡å†™ç³»ç»Ÿæ–¹æ³•imageNamedï¼Œå› ä¸ºä¼šæŠŠç³»ç»Ÿçš„åŠŸèƒ½ç»™è¦†ç›–æ‰ï¼Œè€Œä¸”åˆ†ç±»ä¸­ä¸èƒ½è°ƒç”¨super.

// æ—¢èƒ½åŠ è½½å›¾ç‰‡åˆèƒ½æ‰“å°
+ (instancetype)imageWithName:(NSString *)name
{

    // è¿™é‡Œè°ƒç”¨imageWithNameï¼Œç›¸å½“äºè°ƒç”¨imageName
    UIImage *image = [self imageWithName:name];

    if (image == nil) {
        NSLog(@&quot;åŠ è½½ç©ºçš„å›¾ç‰‡&quot;);
    }

    return image;
}

@end

</code></pre>

<ul>
<li><p>äº¤æ¢åŸç†ï¼š</p>

<ul>
<li><p>äº¤æ¢ä¹‹å‰ï¼š <br/>
<img src="media/14717809514175/14717892191490.jpg" alt=""/></p></li>
<li><p>äº¤æ¢ä¹‹åï¼š <br/>
<img src="media/14717809514175/14717892801791.jpg" alt=""/></p></li>
</ul></li>
</ul>

<h4 id="toc_4">3.åŠ¨æ€æ·»åŠ æ–¹æ³•</h4>

<ul>
<li>å¼€å‘ä½¿ç”¨åœºæ™¯ï¼šå¦‚æœä¸€ä¸ªç±»æ–¹æ³•éå¸¸å¤šï¼ŒåŠ è½½ç±»åˆ°å†…å­˜çš„æ—¶å€™ä¹Ÿæ¯”è¾ƒè€—è´¹èµ„æºï¼Œéœ€è¦ç»™æ¯ä¸ªæ–¹æ³•ç”Ÿæˆæ˜ å°„è¡¨ï¼Œå¯ä»¥ä½¿ç”¨åŠ¨æ€ç»™æŸä¸ªç±»ï¼Œæ·»åŠ æ–¹æ³•è§£å†³ã€‚</li>
<li>ç»å…¸é¢è¯•é¢˜ï¼šæœ‰æ²¡æœ‰ä½¿ç”¨performSelectorï¼Œå…¶å®ä¸»è¦æƒ³é—®ä½ æœ‰æ²¡æœ‰åŠ¨æ€æ·»åŠ è¿‡æ–¹æ³•ã€‚</li>
<li>ç®€å•ä½¿ç”¨</li>
</ul>

<pre><code>@implementation ViewController

- (void)viewDidLoad {
    [super viewDidLoad];
    // Do any additional setup after loading the view, typically from a nib.

    Person *p = [[Person alloc] init];

    // é»˜è®¤personï¼Œæ²¡æœ‰å®ç°eatæ–¹æ³•ï¼Œå¯ä»¥é€šè¿‡performSelectorè°ƒç”¨ï¼Œä½†æ˜¯ä¼šæŠ¥é”™ã€‚
    // åŠ¨æ€æ·»åŠ æ–¹æ³•å°±ä¸ä¼šæŠ¥é”™
    [p performSelector:@selector(eat)];

}

@end

@implementation Person
// void(*)()
// é»˜è®¤æ–¹æ³•éƒ½æœ‰ä¸¤ä¸ªéšå¼å‚æ•°ï¼Œ
void eat(id self,SEL sel)
{
    NSLog(@&quot;%@ %@&quot;,self,NSStringFromSelector(sel));
}

// å½“ä¸€ä¸ªå¯¹è±¡è°ƒç”¨æœªå®ç°çš„æ–¹æ³•ï¼Œä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•å¤„ç†,å¹¶ä¸”ä¼šæŠŠå¯¹åº”çš„æ–¹æ³•åˆ—è¡¨ä¼ è¿‡æ¥.
// åˆšå¥½å¯ä»¥ç”¨æ¥åˆ¤æ–­ï¼Œæœªå®ç°çš„æ–¹æ³•æ˜¯ä¸æ˜¯æˆ‘ä»¬æƒ³è¦åŠ¨æ€æ·»åŠ çš„æ–¹æ³•
+ (BOOL)resolveInstanceMethod:(SEL)sel
{

    if (sel == @selector(eat)) {
        // åŠ¨æ€æ·»åŠ eatæ–¹æ³•

        // ç¬¬ä¸€ä¸ªå‚æ•°ï¼šç»™å“ªä¸ªç±»æ·»åŠ æ–¹æ³•
        // ç¬¬äºŒä¸ªå‚æ•°ï¼šæ·»åŠ æ–¹æ³•çš„æ–¹æ³•ç¼–å·
        // ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šæ·»åŠ æ–¹æ³•çš„å‡½æ•°å®ç°ï¼ˆå‡½æ•°åœ°å€ï¼‰
        // ç¬¬å››ä¸ªå‚æ•°ï¼šå‡½æ•°çš„ç±»å‹ï¼Œ(è¿”å›å€¼+å‚æ•°ç±»å‹) v:void @:å¯¹è±¡-&gt;self :è¡¨ç¤ºSEL-&gt;_cmd
        class_addMethod(self, @selector(eat), eat, &quot;v@:&quot;);

    }

    return [super resolveInstanceMethod:sel];
}
@end

</code></pre>

<h4 id="toc_5">4.ç»™åˆ†ç±»æ·»åŠ å±æ€§</h4>

<ul>
<li>åŸç†ï¼šç»™ä¸€ä¸ªç±»å£°æ˜å±æ€§ï¼Œå…¶å®æœ¬è´¨å°±æ˜¯ç»™è¿™ä¸ªç±»æ·»åŠ å…³è”ï¼Œå¹¶ä¸æ˜¯ç›´æ¥æŠŠè¿™ä¸ªå€¼çš„å†…å­˜ç©ºé—´æ·»åŠ åˆ°ç±»å­˜ç©ºé—´ã€‚</li>
</ul>

<pre><code>
@implementation ViewController

- (void)viewDidLoad {
    [super viewDidLoad];
    // Do any additional setup after loading the view, typically from a nib.

    // ç»™ç³»ç»ŸNSObjectç±»åŠ¨æ€æ·»åŠ å±æ€§name

    NSObject *objc = [[NSObject alloc] init];
    objc.name = @&quot;å¾®æŒ‡&quot;;
    NSLog(@&quot;%@&quot;,objc.name);

}

@end

// å®šä¹‰å…³è”çš„key
static const char *key = &quot;name&quot;;

@implementation NSObject (Property)

- (NSString *)name
{
    // æ ¹æ®å…³è”çš„keyï¼Œè·å–å…³è”çš„å€¼ã€‚
    return objc_getAssociatedObject(self, key);
}

- (void)setName:(NSString *)name
{
    // ç¬¬ä¸€ä¸ªå‚æ•°ï¼šç»™å“ªä¸ªå¯¹è±¡æ·»åŠ å…³è”
    // ç¬¬äºŒä¸ªå‚æ•°ï¼šå…³è”çš„keyï¼Œé€šè¿‡è¿™ä¸ªkeyè·å–
    // ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šå…³è”çš„value
    // ç¬¬å››ä¸ªå‚æ•°:å…³è”çš„ç­–ç•¥
    objc_setAssociatedObject(self, key, name, OBJC_ASSOCIATION_RETAIN_NONATOMIC);
}

@end

</code></pre>

<h4 id="toc_6">5.å­—å…¸è½¬æ¨¡å‹</h4>

<ul>
<li>è®¾è®¡æ¨¡å‹ï¼šå­—å…¸è½¬æ¨¡å‹çš„ç¬¬ä¸€æ­¥

<ul>
<li>æ¨¡å‹å±æ€§ï¼Œé€šå¸¸éœ€è¦è·Ÿå­—å…¸ä¸­çš„keyä¸€ä¸€å¯¹åº”</li>
<li>é—®é¢˜ï¼šä¸€ä¸ªä¸€ä¸ªçš„ç”Ÿæˆæ¨¡å‹å±æ€§ï¼Œå¾ˆæ…¢ï¼Ÿ</li>
<li>éœ€æ±‚ï¼šèƒ½ä¸èƒ½è‡ªåŠ¨æ ¹æ®ä¸€ä¸ªå­—å…¸ï¼Œç”Ÿæˆå¯¹åº”çš„å±æ€§ã€‚</li>
<li>è§£å†³ï¼šæä¾›ä¸€ä¸ªåˆ†ç±»ï¼Œä¸“é—¨æ ¹æ®å­—å…¸ç”Ÿæˆå¯¹åº”çš„å±æ€§å­—ç¬¦ä¸²ã€‚</li>
</ul></li>
</ul>

<pre><code>    @implementation NSObject (Log)

// è‡ªåŠ¨æ‰“å°å±æ€§å­—ç¬¦ä¸²
+ (void)resolveDict:(NSDictionary *)dict{

    // æ‹¼æ¥å±æ€§å­—ç¬¦ä¸²ä»£ç 
    NSMutableString *strM = [NSMutableString string];

    // 1.éå†å­—å…¸ï¼ŒæŠŠå­—å…¸ä¸­çš„æ‰€æœ‰keyå–å‡ºæ¥ï¼Œç”Ÿæˆå¯¹åº”çš„å±æ€§ä»£ç 
    [dict enumerateKeysAndObjectsUsingBlock:^(id  _Nonnull key, id  _Nonnull obj, BOOL * _Nonnull stop) {

        // ç±»å‹ç»å¸¸å˜ï¼ŒæŠ½å‡ºæ¥
         NSString *type;

        if ([obj isKindOfClass:NSClassFromString(@&quot;__NSCFString&quot;)]) {
            type = @&quot;NSString&quot;;
        }else if ([obj isKindOfClass:NSClassFromString(@&quot;__NSCFArray&quot;)]){
            type = @&quot;NSArray&quot;;
        }else if ([obj isKindOfClass:NSClassFromString(@&quot;__NSCFNumber&quot;)]){
            type = @&quot;int&quot;;
        }else if ([obj isKindOfClass:NSClassFromString(@&quot;__NSCFDictionary&quot;)]){
            type = @&quot;NSDictionary&quot;;
        }

        // å±æ€§å­—ç¬¦ä¸²
        NSString *str;
        if ([type containsString:@&quot;NS&quot;]) {
            str = [NSString stringWithFormat:@&quot;@property (nonatomic, strong) %@ *%@;&quot;,type,key];
        }else{
            str = [NSString stringWithFormat:@&quot;@property (nonatomic, assign) %@ %@;&quot;,type,key];
        }

        // æ¯ç”Ÿæˆå±æ€§å­—ç¬¦ä¸²ï¼Œå°±è‡ªåŠ¨æ¢è¡Œã€‚
        [strM appendFormat:@&quot;\n%@\n&quot;,str];

    }];

    // æŠŠæ‹¼æ¥å¥½çš„å­—ç¬¦ä¸²æ‰“å°å‡ºæ¥ï¼Œå°±å¥½äº†ã€‚
    NSLog(@&quot;%@&quot;,strM);

}

@end

</code></pre>

<ul>
<li>å­—å…¸è½¬æ¨¡å‹çš„æ–¹å¼ä¸€ï¼šKVC</li>
</ul>

<pre><code>@implementation Status

+ (instancetype)statusWithDict:(NSDictionary *)dict
{
    Status *status = [[self alloc] init];

    [status setValuesForKeysWithDictionary:dict];

    return status;

}

@end

</code></pre>

<ul>
<li>KVCå­—å…¸è½¬æ¨¡å‹å¼Šç«¯ï¼šå¿…é¡»ä¿è¯ï¼Œæ¨¡å‹ä¸­çš„å±æ€§å’Œå­—å…¸ä¸­çš„keyä¸€ä¸€å¯¹åº”ã€‚

<ul>
<li>å¦‚æœä¸ä¸€è‡´ï¼Œå°±ä¼šè°ƒç”¨<code>[ setValue:forUndefinedKey:]</code> æŠ¥<code>key</code>æ‰¾ä¸åˆ°çš„é”™ã€‚</li>
<li>åˆ†æ:æ¨¡å‹ä¸­çš„å±æ€§å’Œå­—å…¸çš„keyä¸ä¸€ä¸€å¯¹åº”ï¼Œç³»ç»Ÿå°±ä¼šè°ƒç”¨<code>setValue:forUndefinedKey:</code>æŠ¥é”™ã€‚</li>
<li>è§£å†³:é‡å†™å¯¹è±¡çš„<code>setValue:forUndefinedKey:</code>,æŠŠç³»ç»Ÿçš„æ–¹æ³•è¦†ç›–ï¼Œ å°±èƒ½ç»§ç»­ä½¿ç”¨KVCï¼Œå­—å…¸è½¬æ¨¡å‹äº†ã€‚</li>
</ul></li>
</ul>

<pre><code>- (void)setValue:(id)value forUndefinedKey:(NSString *)key
{

}

</code></pre>

<ul>
<li>å­—å…¸è½¬æ¨¡å‹çš„æ–¹å¼äºŒï¼šRuntime

<ul>
<li>æ€è·¯ï¼šåˆ©ç”¨è¿è¡Œæ—¶ï¼Œéå†æ¨¡å‹ä¸­æ‰€æœ‰å±æ€§ï¼Œæ ¹æ®æ¨¡å‹çš„å±æ€§åï¼Œå»å­—å…¸ä¸­æŸ¥æ‰¾keyï¼Œå–å‡ºå¯¹åº”çš„å€¼ï¼Œç»™æ¨¡å‹çš„å±æ€§èµ‹å€¼ã€‚</li>
<li>æ­¥éª¤ï¼šæä¾›ä¸€ä¸ªNSObjectåˆ†ç±»ï¼Œä¸“é—¨å­—å…¸è½¬æ¨¡å‹ï¼Œä»¥åæ‰€æœ‰æ¨¡å‹éƒ½å¯ä»¥é€šè¿‡è¿™ä¸ªåˆ†ç±»è½¬ã€‚</li>
</ul></li>
</ul>

<pre><code>
@implementation ViewController

- (void)viewDidLoad {
    [super viewDidLoad];
    // Do any additional setup after loading the view, typically from a nib.

    // è§£æPlistæ–‡ä»¶
    NSString *filePath = [[NSBundle mainBundle] pathForResource:@&quot;status.plist&quot; ofType:nil];

    NSDictionary *statusDict = [NSDictionary dictionaryWithContentsOfFile:filePath];

    // è·å–å­—å…¸æ•°ç»„
    NSArray *dictArr = statusDict[@&quot;statuses&quot;];

    // è‡ªåŠ¨ç”Ÿæˆæ¨¡å‹çš„å±æ€§å­—ç¬¦ä¸²
//    [NSObject resolveDict:dictArr[0][@&quot;user&quot;]];

    _statuses = [NSMutableArray array];

    // éå†å­—å…¸æ•°ç»„
    for (NSDictionary *dict in dictArr) {

        Status *status = [Status modelWithDict:dict];

        [_statuses addObject:status];

    }

    // æµ‹è¯•æ•°æ®
    NSLog(@&quot;%@ %@&quot;,_statuses,[_statuses[0] user]);

}

@end

@implementation NSObject (Model)

+ (instancetype)modelWithDict:(NSDictionary *)dict
{
    // æ€è·¯ï¼šéå†æ¨¡å‹ä¸­æ‰€æœ‰å±æ€§-ã€‹ä½¿ç”¨è¿è¡Œæ—¶

    // 0.åˆ›å»ºå¯¹åº”çš„å¯¹è±¡
    id objc = [[self alloc] init];

    // 1.åˆ©ç”¨runtimeç»™å¯¹è±¡ä¸­çš„æˆå‘˜å±æ€§èµ‹å€¼

    // class_copyIvarList:è·å–ç±»ä¸­çš„æ‰€æœ‰æˆå‘˜å±æ€§
    // Ivarï¼šæˆå‘˜å±æ€§çš„æ„æ€
    // ç¬¬ä¸€ä¸ªå‚æ•°ï¼šè¡¨ç¤ºè·å–å“ªä¸ªç±»ä¸­çš„æˆå‘˜å±æ€§
    // ç¬¬äºŒä¸ªå‚æ•°ï¼šè¡¨ç¤ºè¿™ä¸ªç±»æœ‰å¤šå°‘æˆå‘˜å±æ€§ï¼Œä¼ å…¥ä¸€ä¸ªIntå˜é‡åœ°å€ï¼Œä¼šè‡ªåŠ¨ç»™è¿™ä¸ªå˜é‡èµ‹å€¼
    // è¿”å›å€¼Ivar *ï¼šæŒ‡çš„æ˜¯ä¸€ä¸ªivaræ•°ç»„ï¼Œä¼šæŠŠæ‰€æœ‰æˆå‘˜å±æ€§æ”¾åœ¨ä¸€ä¸ªæ•°ç»„ä¸­ï¼Œé€šè¿‡è¿”å›çš„æ•°ç»„å°±èƒ½å…¨éƒ¨è·å–åˆ°ã€‚
    /* ç±»ä¼¼ä¸‹é¢è¿™ç§å†™æ³•

     Ivar ivar;
     Ivar ivar1;
     Ivar ivar2;
     // å®šä¹‰ä¸€ä¸ªivarçš„æ•°ç»„a
     Ivar a[] = {ivar,ivar1,ivar2};

     // ç”¨ä¸€ä¸ªIvar *æŒ‡é’ˆæŒ‡å‘æ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´ 
     Ivar *ivarList = a;

     // æ ¹æ®æŒ‡é’ˆè®¿é—®æ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´ 
     ivarList[0];

     */
    unsigned int count;

    // è·å–ç±»ä¸­çš„æ‰€æœ‰æˆå‘˜å±æ€§
    Ivar *ivarList = class_copyIvarList(self, &amp;count);

    for (int i = 0; i å­—å…¸ä¸­çš„key
        // ä»ç¬¬ä¸€ä¸ªè§’æ ‡å¼€å§‹æˆªå–
        NSString *key = [name substringFromIndex:1];

        // æ ¹æ®æˆå‘˜å±æ€§åå»å­—å…¸ä¸­æŸ¥æ‰¾å¯¹åº”çš„value
        id value = dict[key];

        // äºŒçº§è½¬æ¢:å¦‚æœå­—å…¸ä¸­è¿˜æœ‰å­—å…¸ï¼Œä¹Ÿéœ€è¦æŠŠå¯¹åº”çš„å­—å…¸è½¬æ¢æˆæ¨¡å‹
        // åˆ¤æ–­ä¸‹valueæ˜¯å¦æ˜¯å­—å…¸
        if ([value isKindOfClass:[NSDictionary class]]) {
            // å­—å…¸è½¬æ¨¡å‹
            // è·å–æ¨¡å‹çš„ç±»å¯¹è±¡ï¼Œè°ƒç”¨modelWithDict
            // æ¨¡å‹çš„ç±»åå·²çŸ¥ï¼Œå°±æ˜¯æˆå‘˜å±æ€§çš„ç±»å‹

            // è·å–æˆå‘˜å±æ€§ç±»å‹
           NSString *type = [NSString stringWithUTF8String:ivar_getTypeEncoding(ivar)];
          // ç”Ÿæˆçš„æ˜¯è¿™ç§@&quot;@\&quot;User\&quot;&quot; ç±»å‹ -ã€‹ @&quot;User&quot;  åœ¨OCå­—ç¬¦ä¸²ä¸­ \&quot; -&gt; &quot;ï¼Œ\æ˜¯è½¬ä¹‰çš„æ„æ€ï¼Œä¸å ç”¨å­—ç¬¦
            // è£å‰ªç±»å‹å­—ç¬¦ä¸²
            NSRange range = [type rangeOfString:@&quot;\&quot;&quot;];

           type = [type substringFromIndex:range.location + range.length];

            range = [type rangeOfString:@&quot;\&quot;&quot;];

            // è£å‰ªåˆ°å“ªä¸ªè§’æ ‡ï¼Œä¸åŒ…æ‹¬å½“å‰è§’æ ‡
          type = [type substringToIndex:range.location];

            // æ ¹æ®å­—ç¬¦ä¸²ç±»åç”Ÿæˆç±»å¯¹è±¡
            Class modelClass = NSClassFromString(type);

            if (modelClass) { // æœ‰å¯¹åº”çš„æ¨¡å‹æ‰éœ€è¦è½¬

                // æŠŠå­—å…¸è½¬æ¨¡å‹
                value  =  [modelClass modelWithDict:value];
            }

        }

        // ä¸‰çº§è½¬æ¢ï¼šNSArrayä¸­ä¹Ÿæ˜¯å­—å…¸ï¼ŒæŠŠæ•°ç»„ä¸­çš„å­—å…¸è½¬æ¢æˆæ¨¡å‹.
        // åˆ¤æ–­å€¼æ˜¯å¦æ˜¯æ•°ç»„
        if ([value isKindOfClass:[NSArray class]]) {
            // åˆ¤æ–­å¯¹åº”ç±»æœ‰æ²¡æœ‰å®ç°å­—å…¸æ•°ç»„è½¬æ¨¡å‹æ•°ç»„çš„åè®®
            if ([self respondsToSelector:@selector(arrayContainModelClass)]) {

                // è½¬æ¢æˆidç±»å‹ï¼Œå°±èƒ½è°ƒç”¨ä»»ä½•å¯¹è±¡çš„æ–¹æ³•
                id idSelf = self;

                // è·å–æ•°ç»„ä¸­å­—å…¸å¯¹åº”çš„æ¨¡å‹
                NSString *type =  [idSelf arrayContainModelClass][key];

                // ç”Ÿæˆæ¨¡å‹
               Class classModel = NSClassFromString(type);
                NSMutableArray *arrM = [NSMutableArray array];
                // éå†å­—å…¸æ•°ç»„ï¼Œç”Ÿæˆæ¨¡å‹æ•°ç»„
                for (NSDictionary *dict in value) {
                    // å­—å…¸è½¬æ¨¡å‹
                  id model =  [classModel modelWithDict:dict];
                    [arrM addObject:model];
                }

                // æŠŠæ¨¡å‹æ•°ç»„èµ‹å€¼ç»™value
                value = arrM;

            }
        }

        if (value) { // æœ‰å€¼ï¼Œæ‰éœ€è¦ç»™æ¨¡å‹çš„å±æ€§èµ‹å€¼
            // åˆ©ç”¨KVCç»™æ¨¡å‹ä¸­çš„å±æ€§èµ‹å€¼
            [objc setValue:value forKey:key];
        }

    }
    free(ivarList);
    return objc;
}

@end
</code></pre>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[iOSå¼€å‘-KVOçš„å¥¥ç§˜]]></title>
    <link href="http://www.citynight.cn/Blog/14714050181003.html"/>
    <updated>2016-08-17T11:36:58+08:00</updated>
    <id>http://www.citynight.cn/Blog/14714050181003.html</id>
    <content type="html"><![CDATA[
<blockquote>
<p>æ¥æºï¼š<a href="http://www.jianshu.com/p/742b4b248da9">Sindriçš„å°å·¢</a></p>
</blockquote>

<p><strong>å‰è¨€</strong></p>

<p>åœ¨iOSå¼€å‘ä¸­ï¼Œè‹¹æœæä¾›äº†è®¸å¤šæœºåˆ¶ç»™æˆ‘ä»¬è¿›è¡Œå›è°ƒã€‚KVO(key-value-observing)æ˜¯ä¸€ç§ååˆ†æœ‰è¶£çš„å›è°ƒæœºåˆ¶ï¼Œåœ¨æŸä¸ªå¯¹è±¡æ³¨å†Œç›‘å¬è€…åï¼Œåœ¨è¢«ç›‘å¬çš„å¯¹è±¡å‘ç”Ÿæ”¹å˜æ—¶ï¼Œå¯¹è±¡ä¼šå‘é€ä¸€ä¸ªé€šçŸ¥ç»™ç›‘å¬è€…ï¼Œä»¥ä¾¿ç›‘å¬è€…æ‰§è¡Œå›è°ƒæ“ä½œã€‚æœ€å¸¸è§çš„KVOè¿ç”¨æ˜¯ç›‘å¬scrollViewçš„contentOffsetå±æ€§ï¼Œæ¥å®Œæˆç”¨æˆ·æ»šåŠ¨æ—¶åŠ¨æ€æ”¹å˜æŸäº›æ§ä»¶çš„å±æ€§å®ç°æ•ˆæœï¼ŒåŒ…æ‹¬æ¸å˜å¯¼èˆªæ ã€ä¸‹æ‹‰åˆ·æ–°æ§ä»¶ç­‰æ•ˆæœã€‚</p>

<p><img src="http://mmbiz.qpic.cn/mmbiz/foPACGrddJ2RICbWq0ibOxfFDmygDGicuRRjLKzYTqMibXMxTiaNXIdeRT6s0aalp1ibbib7BxAYqUyPhHd1iahRY45uQ/0?wx_fmt=gif&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1" alt="" title="1450081725511768.gif"/></p>

<p>æ¸å˜å¯¼èˆªæ </p>

<p><strong>ä½¿ç”¨</strong></p>

<p>KVOçš„ä½¿ç”¨éå¸¸ç®€å•ï¼Œä½¿ç”¨KVOçš„è¦æ±‚æ˜¯å¯¹è±¡å¿…é¡»èƒ½æ”¯æŒkvcæœºåˆ¶â€”â€”æ‰€æœ‰NSObjectçš„å­ç±»éƒ½æ”¯æŒè¿™ä¸ªæœºåˆ¶ã€‚æ‹¿ä¸Šé¢çš„æ¸å˜å¯¼èˆªæ åš??ï¼Œæˆ‘ä»¬ä¸ºtableViewæ·»åŠ äº†ä¸€ä¸ªç›‘å¬è€…controllerï¼Œåœ¨æˆ‘ä»¬æ»‘åŠ¨åˆ—è¡¨çš„æ—¶å€™ï¼Œä¼šè®¡ç®—å½“å‰åˆ—è¡¨çš„æ»šåŠ¨åç§»é‡ï¼Œç„¶åæ”¹å˜å¯¼èˆªæ çš„èƒŒæ™¯è‰²é€æ˜åº¦ã€‚</p>

<pre><code>//æ·»åŠ ç›‘å¬è€…
[self.tableView addObserver: self forKeyPath: @&quot;contentOffset&quot; options: NSKeyValueObservingOptionNew context: nil];
/**
 * ç›‘å¬å±æ€§å€¼å‘ç”Ÿæ”¹å˜æ—¶å›è°ƒ
 */
- (void)observeValueForKeyPath:(NSString *)keyPath ofObject:(id)object change:(NSDictionary *)change context:(void *)context
{
    CGFloat offset = self.tableView.contentOffset.y;
    CGFloat delta = offset / 64.f + 1.f;
    delta = MAX(0, delta);
    [self alphaNavController].barAlpha = MIN(1, delta);
}
</code></pre>

<p>æ¯«æ— ç–‘é—®ï¼Œkvoæ˜¯ä¸€ç§éå¸¸ä¾¿æ·çš„å›è°ƒæ–¹å¼ï¼Œä½†æ˜¯ç¼–è¯‘å™¨æ˜¯æ€ä¹ˆå®Œæˆç›‘å¬è¿™ä¸ªä»»åŠ¡çš„å‘¢ï¼Ÿå…ˆæ¥çœ‹çœ‹è‹¹æœæ–‡æ¡£å¯¹äºKVOçš„å®ç°æè¿°</p>

<blockquote>
<p>Automatic key-value observing is implemented using a technique called isa-swizzling&hellip; When an observer is registered for an attribute of an object the isa pointer of the observed object is modified, pointing to an intermediate class rather than at the true class ..</p>
</blockquote>

<p>ç®€è¦çš„æ¥è¯´ï¼Œåœ¨æˆ‘ä»¬å¯¹æŸä¸ªå¯¹è±¡å®Œæˆç›‘å¬çš„æ³¨å†Œåï¼Œç¼–è¯‘å™¨ä¼šä¿®æ”¹ç›‘å¬å¯¹è±¡ï¼ˆä¸Šæ–‡ä¸­çš„tableViewï¼‰çš„isaæŒ‡é’ˆï¼Œè®©è¿™ä¸ªæŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªæ–°ç”Ÿæˆçš„ä¸­é—´ç±»ã€‚ä»æŸä¸ªæ„ä¹‰ä¸Šæ¥è¯´ï¼Œè¿™æ˜¯ä¸€åœºéª—å±€ã€‚</p>

<pre><code>typedef struct objc_class *Class;
typedef struct objc_object {
    Class isa;
} *id;
</code></pre>

<p>è¿™é‡Œè¦è¯´æ˜çš„æ˜¯isaè¿™ä¸ªæŒ‡é’ˆï¼Œisaæ˜¯ä¸€ä¸ªClassç±»å‹çš„æŒ‡é’ˆï¼Œç”¨æ¥æŒ‡å‘ç±»çš„ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡object_getClassæ–¹æ³•æ¥è·å–è¿™ä¸ªå€¼(æ­£å¸¸æ¥è¯´ï¼Œclassæ–¹æ³•å†…éƒ¨çš„å®ç°å°±æ˜¯è·å–è¿™ä¸ªisaæŒ‡é’ˆï¼Œä½†æ˜¯åœ¨kvoä¸­è‹¹æœå¯¹ç›‘å¬å¯¹è±¡çš„è¿™ä¸ªæ–¹æ³•è¿›è¡Œäº†é‡å†™ã€‚ä¹‹å‰è¿™é‡Œæè¿°æœ‰è¯¯ï¼Œè¯´æˆæ˜¯æŒ‡å‘çˆ¶ç±»ï¼Œå¤šè°¢<a href="http://www.jianshu.com/users/1498e495a4b1/timeline">å¤éƒ½</a>ä¸ºæˆ‘çº æ­£)ã€‚</p>

<p>åœ¨ocä¸­ï¼Œè§„å®šäº†åªè¦æ‹¥æœ‰isaæŒ‡é’ˆçš„å˜é‡ï¼Œé€šé€šéƒ½å±äºå¯¹è±¡ã€‚ä¸Šé¢çš„objc_objectè¡¨ç¤ºçš„æ˜¯NSObjectè¿™ä¸ªç±»çš„ç»“æ„ä½“è¡¨ç¤ºï¼Œå› æ­¤ocä¸å…è®¸å‡ºç°éNSObjectå­ç±»çš„å¯¹è±¡ï¼ˆblockæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ä¾‹å¤–ï¼‰</p>

<p>å½“ç„¶äº†ï¼Œè‹¹æœå¹¶ä¸æƒ³è®²è¿°æ›´å¤šçš„å®ç°ç»†èŠ‚ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿è¡Œæ—¶æœºåˆ¶æ¥å®Œæˆä¸€äº›æœ‰è¶£çš„è°ƒè¯•ã€‚</p>

<p><strong>è‹¹æœçš„é»‘é­”æ³•</strong></p>

<p>æ ¹æ®è‹¹æœçš„è¯´æ³•ï¼Œåœ¨å¯¹è±¡å®Œæˆç›‘å¬æ³¨å†Œåï¼Œä¿®æ”¹äº†è¢«ç›‘å¬å¯¹è±¡çš„æŸäº›å±æ€§ï¼Œå¹¶ä¸”æ”¹å˜äº†isaæŒ‡é’ˆï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åœ¨ç›‘å¬å‰åè¾“å‡ºè¢«ç›‘å¬å¯¹è±¡çš„ç›¸å…³å±æ€§æ¥è¿›ä¸€æ­¥æ¢ç´¢kvoçš„åŸç†ã€‚ä¸ºäº†ä¿è¯èƒ½å¤Ÿå¾—åˆ°å¯¹è±¡çš„çœŸå®ç±»å‹ï¼Œæˆ‘ä½¿ç”¨äº†object_getClassæ–¹æ³•ï¼ˆclassæ–¹æ³•æœ¬è´¨ä¸Šæ˜¯è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼‰ï¼Œè¿™ä¸ªæ–¹æ³•åœ¨runtime.hå¤´æ–‡ä»¶ä¸­</p>

<pre><code>NSLog(@&quot;address: %p&quot;, self.tableView);
NSLog(@&quot;class method: %@&quot;, self.tableView.class);
NSLog(@&quot;description method: %@&quot;, self.tableView);
NSLog(@&quot;use runtime to get class: %@&quot;, object_getClass(self.tableView));
[self.tableView addObserver: self forKeyPath: @&quot;contentOffset&quot; options: NSKeyValueObservingOptionNew context: nil];
NSLog(@&quot;===================================================&quot;);
NSLog(@&quot;address: %p&quot;, self.tableView);
NSLog(@&quot;class method: %@&quot;, self.tableView.class);
NSLog(@&quot;description method: %@&quot;, self.tableView);
NSLog(@&quot;use runtime to get class %@&quot;, object_getClass(self.tableView));
</code></pre>

<p>åœ¨çœ‹å®˜ä»¬è¿è¡Œè¿™æ®µä»£ç ä¹‹å‰ï¼Œå¯ä»¥å…ˆæ€è€ƒä¸€ä¸‹ä¸Šé¢çš„ä»£ç ä¼šè¾“å‡ºä»€ä¹ˆã€‚</p>

<pre><code>2015-12-12 23:02:33.216 LXDAlphaNavigationController[1487:63171] address: 0x7f927a81d200
2015-12-12 23:02:33.216 LXDAlphaNavigationController[1487:63171] class method: UITableView
2015-12-12 23:02:33.217 LXDAlphaNavigationController[1487:63171] description method: 2015-12-12 23:02:33.217 LXDAlphaNavigationController[1487:63171] use runtime to get class: UITableView
2015-12-12 23:02:33.217 LXDAlphaNavigationController[1487:63171] ===================================================
2015-12-12 23:02:33.218 LXDAlphaNavigationController[1487:63171] address: 0x7f927a81d200
2015-12-12 23:02:33.218 LXDAlphaNavigationController[1487:63171] class method: UITableView
2015-12-12 23:02:33.218 LXDAlphaNavigationController[1487:63171] description method: 2015-12-12 23:02:33.230 LXDAlphaNavigationController[1487:63171] use runtime to get class NSKVONotifying_UITableView
</code></pre>

<p>é™¤äº†é€šè¿‡object_getClassè·å–çš„ç±»å‹ä¹‹å¤–ï¼Œå…¶ä»–çš„è¾“å‡ºæ²¡æœ‰ä»»ä½•å˜åŒ–ã€‚classæ–¹æ³•è·Ÿdescriptionæ–¹æ³•å¯ä»¥é‡å†™å®ç°ä¸Šé¢çš„æ•ˆæœï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆè¿åœ°å€éƒ½æ˜¯ä¸€æ ·çš„ã€‚</p>

<p>è¿™é‡Œå¯ä»¥é€šè¿‡ä¸€å¥å°ä»£ç æ¥è¯´æ˜ä¸€ä¸‹ï¼š</p>

<pre><code>NSLog(@&quot;%@, %@&quot;, self.class, super.class);
</code></pre>

<p>ä¸Šé¢è¿™æ®µä»£ç ä¸ç®¡ä½ æ€ä¹ˆè¾“å‡ºï¼Œä¸¤ä¸ªç»“æœéƒ½æ˜¯ä¸€æ ·çš„ã€‚è¿™æ˜¯ç”±äºsuperæœ¬è´¨ä¸ŠæŒ‡å‘çš„æ˜¯çˆ¶ç±»å†…å­˜ã€‚è¿™è¯è¯´èµ·æ¥æœ‰ç‚¹ç»•å£ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡å¯¹è±¡å†…å­˜å›¾æ¥è¡¨ç¤ºï¼š</p>

<p><img src="http://mmbiz.qpic.cn/mmbiz/foPACGrddJ2RICbWq0ibOxfFDmygDGicuRn1E06HjV4SicWpj23ss5lIoibBxfyEKHxnx22HmZdMItVZa4ViaSlAU5A/640?wx_fmt=png" alt=""/></p>

<p>ç±»çš„å†…å­˜</p>

<p>æ¯ä¸€ä¸ªå¯¹è±¡å ç”¨çš„å†…å­˜ä¸­ï¼Œä¸€éƒ¨åˆ†æ˜¯çˆ¶ç±»å±æ€§å ç”¨çš„ï¼›åœ¨çˆ¶ç±»å ç”¨çš„å†…å­˜ä¸­ï¼Œåˆæœ‰ä¸€éƒ¨åˆ†æ˜¯çˆ¶ç±»çš„çˆ¶ç±»å ç”¨çš„ã€‚å‰æ–‡å·²ç»è¯´è¿‡isaæŒ‡é’ˆæŒ‡å‘çš„æ˜¯çˆ¶ç±»ï¼Œå› æ­¤åœ¨è¿™ä¸ªå›¾ä¸­ï¼ŒSonçš„åœ°å€ä»Fatherå¼€å§‹ï¼ŒFatherçš„åœ°å€ä»NSObjectå¼€å§‹ï¼Œè¿™ä¸‰ä¸ªå¯¹è±¡å†…å­˜çš„åœ°å€éƒ½æ˜¯ä¸€æ ·çš„ã€‚é€šè¿‡è¿™ä¸ªï¼Œæˆ‘ä»¬å¯ä»¥çŒœåˆ°è‹¹æœæ–‡æ¡£ä¸­æ‰€æåŠçš„ä¸­é—´ç±»å°±æ˜¯è¢«ç›‘å¬å¯¹è±¡çš„å­ç±»ã€‚å¹¶ä¸”ä¸ºäº†éšè—å®ç°ï¼Œè‹¹æœè¿˜é‡å†™äº†è¿™ä¸ªå­ç±»çš„classæ–¹æ³•è·Ÿdescriptionæ–¹æ³•æ¥æ©äººè€³ç›®ã€‚å¦å¤–ï¼Œæˆ‘ä»¬è¿˜çœ‹åˆ°äº†æ–°ç±»ç›¸å¯¹äºçˆ¶ç±»æ·»åŠ äº†ä¸€ä¸ªNSKVONotifying_å‰ç¼€ï¼Œæ·»åŠ è¿™ä¸ªå‰ç¼€æ˜¯ä¸ºäº†é¿å…å¤šæ¬¡åˆ›å»ºç›‘å¬å­ç±»ï¼ŒèŠ‚çœèµ„æº</p>

<p><strong>æ€ä¹ˆå®ç°ç±»ä¼¼æ•ˆæœ</strong></p>

<p>æ—¢ç„¶çŸ¥é“äº†è‹¹æœçš„å®ç°è¿‡ç¨‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è‡ªå·±åŠ¨æ‰‹é€šè¿‡è¿è¡Œæ—¶æœºåˆ¶æ¥å®ç°KVOã€‚runtimeå…è®¸æˆ‘ä»¬åœ¨ç¨‹åºè¿è¡Œæ—¶åŠ¨æ€çš„åˆ›å»ºæ–°ç±»ã€æ‹“å±•æ–¹æ³•ã€method-swizzlingã€ç»‘å®šå±æ€§ç­‰ç­‰è¿™äº›æœ‰è¶£çš„äº‹æƒ…ã€‚</p>

<p>åœ¨åˆ›å»ºæ–°ç±»ä¹‹å‰ï¼Œæˆ‘ä»¬åº”è¯¥å­¦ä¹ è‹¹æœçš„åšæ³•ï¼Œåˆ¤æ–­å½“å‰æ˜¯å¦å­˜åœ¨è¿™ä¸ªç±»ï¼Œå¦‚æœä¸å­˜åœ¨æˆ‘ä»¬å†è¿›è¡Œåˆ›å»ºï¼Œå¹¶ä¸”é‡æ–°å®ç°è¿™ä¸ªæ–°ç±»çš„classæ–¹æ³•æ¥æ©ç›–å…·ä½“å®ç°ã€‚åŸºäºè¿™äº›åŸåˆ™ï¼Œæˆ‘ä»¬ç”¨ä¸‹é¢çš„æ–¹æ³•æ¥è·å–æ–°ç±»</p>

<pre><code>- (Class)createKVOClassWithOriginalClassName: (NSString *)className
{
    NSString * kvoClassName = [kLXDkvoClassPrefix stringByAppendingString: className];
    Class observedClass = NSClassFromString(kvoClassName);
    if (observedClass) { return observedClass; }
    //åˆ›å»ºæ–°ç±»ï¼Œå¹¶ä¸”æ·»åŠ LXDObserver_ä¸ºç±»åæ–°å‰ç¼€
    Class originalClass = object_getClass(self);
    Class kvoClass = objc_allocateClassPair(originalClass, kvoClassName.UTF8String, 0);
    //è·å–ç›‘å¬å¯¹è±¡çš„classæ–¹æ³•å®ç°ä»£ç ï¼Œç„¶åæ›¿æ¢æ–°å»ºç±»çš„classå®ç°
    Method classMethod = class_getInstanceMethod(originalClass, @selector(class));
    const char * types = method_getTypeEncoding(classMethod);
    class_addMethod(kvoClass, @selector(class), (IMP)kvo_Class, types);
    objc_registerClassPair(kvoClass);
    return kvoClass;
}
</code></pre>

<p>å¦å¤–ï¼Œåœ¨åˆ¤æ–­æ˜¯å¦éœ€è¦ä¸­é—´ç±»æ¥å®Œæˆç›‘å¬çš„æ³¨å†Œå‰ï¼Œæˆ‘ä»¬è¿˜è¦åˆ¤æ–­ç›‘å¬çš„å±æ€§çš„æœ‰æ•ˆæ€§ã€‚é€šè¿‡è·å–å˜é‡çš„setteræ–¹æ³•åï¼ˆå°†é¦–å­—æ¯å¤§å†™å¹¶åŠ ä¸Šå‰ç¼€setï¼‰ï¼Œä»¥æ­¤æ¥è·å–setterå®ç°ï¼Œå¦‚æœä¸å­˜åœ¨å®ç°ä»£ç ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ä½¿ç¨‹åºå´©æºƒã€‚</p>

<pre><code>SEL setterSelector = NSSelectorFromString(setterForGetter(key));
Method setterMethod = class_getInstanceMethod([self class], setterSelector);
if (!setterMethod) {
    @throw [NSException exceptionWithName: NSInvalidArgumentException reason: [NSString stringWithFormat: @&quot;unrecognized selector sent to instance %p&quot;, self] userInfo: nil];
    return;
}
Class observedClass = object_getClass(self);
NSString * className = NSStringFromClass(observedClass);
//å¦‚æœè¢«ç›‘å¬è€…æ²¡æœ‰LXDObserver_ï¼Œé‚£ä¹ˆåˆ¤æ–­æ˜¯å¦éœ€è¦åˆ›å»ºæ–°ç±»
if (![className hasPrefix: kLXDkvoClassPrefix]) {
    observedClass = [self createKVOClassWithOriginalClassName: className];
    object_setClass(self, observedClass);
}
//é‡æ–°å®ç°setteræ–¹æ³•ï¼Œä½¿å…¶å®Œæˆ
const char * types = method_getTypeEncoding(setterMethod);
class_addMethod(observedClass, setterSelector, (IMP)KVO_setter, types);


</code></pre>

<p>åœ¨é‡æ–°å®ç°setteræ–¹æ³•çš„æ—¶å€™ï¼Œæœ‰ä¸¤ä¸ªé‡è¦çš„æ–¹æ³•ï¼šwillChangeValueForKeyå’ŒdidChangeValueForKeyï¼Œåˆ†åˆ«åœ¨èµ‹å€¼å‰åè¿›è¡Œè°ƒç”¨ã€‚æ­¤å¤–ï¼Œè¿˜è¦éå†æ‰€æœ‰çš„å›è°ƒç›‘å¬è€…ï¼Œç„¶åé€šçŸ¥è¿™äº›ç›‘å¬è€…ï¼š</p>

<pre><code>static void KVO_setter(id self, SEL _cmd, id newValue)
{
    NSString * setterName = NSStringFromSelector(_cmd);
    NSString * getterName = getterForSetter(setterName);
    if (!getterName) {
        @throw [NSException exceptionWithName: NSInvalidArgumentException reason: [NSString stringWithFormat: @&quot;unrecognized selector sent to instance %p&quot;, self] userInfo: nil];
        return;
    }
    id oldValue = [self valueForKey: getterName];
    struct objc_super superClass = {
        .receiver = self,
        .super_class = class_getSuperclass(object_getClass(self))
    };
    [self willChangeValueForKey: getterName];
    void (*objc_msgSendSuperKVO)(void *, SEL, id) = (void *)objc_msgSendSuper;
    objc_msgSendSuperKVO(&amp;superClass, _cmd, newValue);
    [self didChangeValueForKey: getterName];
    //è·å–æ‰€æœ‰ç›‘å¬å›è°ƒå¯¹è±¡è¿›è¡Œå›è°ƒ
    NSMutableArray * observers = objc_getAssociatedObject(self, (__bridge const void *)kLXDkvoAssiociateObserver);
    for (LXD_ObserverInfo * info in observers) {
        if ([info.key isEqualToString: getterName]) {
            dispatch_async(dispatch_queue_create(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{
                info.handler(self, getterName, oldValue, newValue);
            });
        }
    }
}
</code></pre>

<p>æ‰€æœ‰çš„ç›‘å¬è€…é€šè¿‡åŠ¨æ€ç»‘å®šçš„æ–¹å¼å°†å…¶å­˜å‚¨èµ·æ¥ï¼Œä½†è¿™æ ·ä¹Ÿä¼šäº§ç”Ÿå¼ºå¼•ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦æä¾›é‡Šæ”¾ç›‘å¬çš„æ–¹æ³•ï¼š</p>

<pre><code>- (void)LXD_removeObserver:(NSObject *)object forKey:(NSString *)key
{
    NSMutableArray * observers = objc_getAssociatedObject(self, (__bridge void *)kLXDkvoAssiociateObserver);
    LXD_ObserverInfo * observerRemoved = nil;
    for (LXD_ObserverInfo * observerInfo in observers) {
        if (observerInfo.observer == object &amp;&amp; [observerInfo.key isEqualToString: key]) {
            observerRemoved = observerInfo;
            break;
        }
    }
    [observers removeObject: observerRemoved];
}
</code></pre>

<p>è™½ç„¶ä¸Šé¢å·²ç»ç²—ç•¥çš„å®ç°äº†kvoï¼Œå¹¶ä¸”æˆ‘ä»¬è¿˜èƒ½è‡ªå®šä¹‰å›è°ƒæ–¹å¼ã€‚ä½¿ç”¨target-actionæˆ–è€…blockçš„æ–¹å¼è¿›è¡Œå›è°ƒä¼šæ¯”å•ä¸€çš„ç³»ç»Ÿå›è°ƒè¦å…¨é¢çš„å¤šã€‚ä½†kvoçœŸæ­£çš„å®ç°å¹¶æ²¡æœ‰è¿™ä¹ˆç®€å•ï¼Œä¸Šè¿°ä»£ç ç›®å‰åªèƒ½å®ç°å¯¹è±¡ç±»å‹çš„ç›‘å¬ï¼ŒåŸºæœ¬ç±»å‹æ— æ³•ç›‘å¬ï¼Œå†µä¸”è¿˜æœ‰keyPathå¯ä»¥ç›‘å¬å¯¹è±¡çš„æˆå‘˜å¯¹è±¡çš„å±æ€§è¿™ç§æ›´å¼ºå¤§çš„åŠŸèƒ½ã€‚</p>

<p><strong>å°¾è¨€</strong></p>

<p>å¯¹äºåŸºæœ¬ç±»å‹çš„ç›‘å¬ï¼Œè‹¹æœå¯èƒ½æ˜¯é€šè¿‡void *ç±»å‹å¯¹å¯¹è±¡è¿›è¡Œæ¡¥æ¥è½¬æ¢ï¼Œç„¶åç›´æ¥è·å–å†…å­˜ï¼Œé€šè¿‡type encodingæˆ‘ä»¬å¯ä»¥è·å–æ‰€æœ‰setterå¯¹è±¡çš„å…·ä½“ç±»å‹ï¼Œè™½ç„¶å®ç°æ¯”è¾ƒéº»çƒ¦ï¼Œä½†æ˜¯ç¡®å®èƒ½å¤Ÿè¾¾æˆç±»ä¼¼çš„æ•ˆæœã€‚</p>

<p>é’»ç ”kvoçš„å®ç°å¯ä»¥è®©æˆ‘ä»¬å¯¹è‹¹æœçš„ä»£ç å®ç°æœ‰æ›´æ·±å±‚æ¬¡çš„äº†è§£ï¼Œè¿™äº›çŸ¥è¯†æ¶‰åŠåˆ°äº†æ›´æ·±å±‚æ¬¡çš„æŠ€æœ¯ï¼Œæ¢ç©¶å®ƒä»¬å¯¹æˆ‘ä»¬çš„å¼€å‘è§†é‡æœ‰ç€å¾ˆé‡è¦çš„ä½œç”¨ã€‚åŒæ—¶ï¼Œå¯¹æ¯”å…¶ä»–çš„å›è°ƒæ–¹å¼ï¼ŒKVOçš„å®ç°åœ¨åˆ›å»ºå­ç±»ã€é‡å†™æ–¹æ³•ç­‰ç­‰æ–¹é¢çš„å†…å­˜æ¶ˆè€—æ˜¯å¾ˆå·¨å¤§çš„ï¼Œå› æ­¤åšä¸»æ›´åŠ æ¨èä½¿ç”¨delegateã€blockç­‰å›è°ƒæ–¹å¼ï¼Œç”šè‡³ç›´æ¥ä½¿ç”¨method-swizzlingæ¥æ›¿æ¢è¿™ç§é‡å†™setteræ–¹å¼ä¹Ÿæ˜¯å¯è¡Œçš„ã€‚</p>

<p>æ–‡ç« ä»£ç ï¼š<a href="https://github.com/JustKeepRunning/LXD_KeyValueObserveDemo">è‡ªå®ç°KVO</a></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[copy strong weak assign]]></title>
    <link href="http://www.citynight.cn/Blog/14714022507551.html"/>
    <updated>2016-08-17T10:50:50+08:00</updated>
    <id>http://www.citynight.cn/Blog/14714022507551.html</id>
    <content type="html"><![CDATA[
<h2 id="toc_0">weak &amp; strong</h2>

<p><strong>weak</strong><br/>
ä½ ä¹°äº†ä¸ªiPhone7ï¼Œä½ æœ‹å‹è§‰å¾—ä¸é”™ï¼Œç”±äºæ‰‹å¤´ç´§ï¼Œæ²¡ä¹°ï¼Œäºæ˜¯ä½ ä»¬å…¬ç”¨ä¸€å°iPhone7ï¼Œä½ æ–°è£…äº†QQéŸ³ä¹ï¼Œä½ æœ‹å‹ç”¨çš„æ—¶å€™ä¹Ÿä¼šæœ‰QQéŸ³ä¹<br/>
ç„¶åä½ çš„æ‰‹æœºä¸¢äº† ä½ æœ‹å‹ä¹Ÿæ²¡æœ‰ ä¸èƒ½ç”¨äº†</p>

<p><strong>stong</strong><br/>
ä½ ä¹°äº†ä¸ªiPhone7 ä½ æœ‹å‹ä¹Ÿä¹°äº†ä¸ªiPhone7  ä»–è§‰å¾—ä½ çš„app stroeè´¦å·é‡Œæœ‰å¥½å¤šè½¯ä»¶ ç„¶åä»–å°±ç”¨ä½ çš„app stroeè´¦å· == ä»–stongäº†ä½ çš„è´¦å·ï¼Œä½ ä¿©å°±å…¬ç”¨äº†ä¸€ä¸ªè´¦å·ã€‚<br/>
ä½ ä¸‹è½½è½¯ä»¶ ä»–ä¹Ÿæœ‰äº† ç„¶åä½ æ‰‹æœºè´¦å·æ²¡äº†ä¸¢äº† ä½†ä»–çš„æ‰‹æœºè¿˜åœ¨è´¦å·è¿˜èƒ½ç”¨ã€‚ </p>

<h2 id="toc_1">strong &amp; copy (æ·±æ‹·è´&amp;æµ…æ‹·è´)</h2>

<p>copyæ˜¯ç”¨æ¥ä¿æŠ¤æ•°æ®çš„,copyä¸€ä¸ªæ•°æ®ä¹‹å,æ›´æ”¹æºæ•°æ®ä¸ä¼šå¯¼è‡´copyçš„æ•°æ®æ›´æ”¹<br/>
strongæ˜¯å¯¹ä¸€ä¸ªæ•°æ®çš„å¼•ç”¨,æ›´æ”¹æºæ•°æ®ä¼šå¯¼è‡´strongçš„æ•°æ®æ›´æ”¹ </p>

<h2 id="toc_2">assign</h2>

<p>åŸºæœ¬æ•°æ®ç±»å‹</p>

<blockquote>
<p><a href="https://developer.apple.com/library/mac/documentation/CoreFoundation/Conceptual/CFMemoryMgmt/Concepts/CopyFunctions.html">è‹¹æœæ–‡æ¡£ä¸­å…³äºæµ…æ‹·è´&amp;æ·±æ‹·è´</a></p>
</blockquote>

<p><img src="media/14714022507551/Snip20160817_3.png" alt="Snip20160817_3"/></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ç½‘ç»œåˆ‡é¢åŒ–å¤„ç†]]></title>
    <link href="http://www.citynight.cn/Blog/14701034373615.html"/>
    <updated>2016-08-02T10:03:57+08:00</updated>
    <id>http://www.citynight.cn/Blog/14701034373615.html</id>
    <content type="html"><![CDATA[
<h2 id="toc_0">ä»€ä¹ˆæ˜¯é¢å‘åˆ‡ç‰‡ç¼–ç¨‹</h2>

<blockquote>
<p>çœ‹è€ƒ&lt;ç¦…ä¸Objective-C ç¼–ç è‰ºæœ¯&gt;ç¬¬11ç«   é¢å‘åˆ‡é¢ç¼–ç¨‹.  æœ¬æ–‡ä¸­æŠ€æœ¯éƒ¨åˆ†å‚è€ƒ<a href="https://github.com/yuantiku/YTKNetwork">YTKNetwork</a>å’Œ<a href="https://github.com/casatwy/RTNetworking">RTNetworking</a>ä»£ç å®ç°,æ‹œè¯»äº†<a href="http://casatwy.com/iosying-yong-jia-gou-tan-wang-luo-ceng-she-ji-fang-an.html">iOSåº”ç”¨æ¶æ„è°ˆ ç½‘ç»œå±‚è®¾è®¡æ–¹æ¡ˆ</a>å’ŒçŒ¿é¢˜åº“çš„ä¸¤ç¯‡ä½¿ç”¨ä»‹ç»å¹¶æ ¹æ®æ ¹æ®ä¸ªäººç†è§£ä¿®æ”¹éƒ¨åˆ†åŠŸèƒ½å®ç°,è¿™ç¯‡æ–‡ç« ä¸»è¦å°±æ˜¯è¿›è¡Œæ€è·¯çš„æ•´ç†,ä¸€æ­¥ä¸€æ­¥åˆ¶é€ è‡ªå·±æƒ³è¦çš„ç½‘ç»œè¯·æ±‚è½®å­.</p>
</blockquote>

<p>Aspect Oriented Programming (AOP,é¢å‘åˆ‡é¢ç¼–ç¨‹)åœ¨OCä¸­æ„å‘³ç€å¯ä»¥é€šè¿‡è¿è¡Œæ—¶çš„ç‰¹æ€§æ¥ä¸ºåˆ‡é¢æ·»åŠ åˆé€‚çš„ä»£ç .ç®€å•è¯´å¯ä»¥æ·»åŠ ç±»ä¼¼è¡Œä¸º:</p>

<ul>
<li>åœ¨ç±»çš„ç‰¹å®šæ–¹æ³•è°ƒç”¨å‰è¿è¡Œç‰¹å®šçš„ä»£ç </li>
<li>åœ¨ç±»çš„ç‰¹å®šæ–¹æ³•è°ƒç”¨åè¿è¡Œç‰¹å®šçš„ä»£ç </li>
<li>å¢åŠ ä»£ç æ¥ä»£æ›¿åŸæ¥çš„ç±»çš„æ–¹æ³•çš„å®ç°</li>
</ul>

<h2 id="toc_1">ç½‘ç»œæ€ä¹ˆåˆ‡é¢</h2>

<p>ä¸Šé¢å·²ç»è¯´äº†ä»€ä¹ˆæ˜¯é¢å‘åˆ‡é¢ç¼–ç¨‹,é‚£ä¹ˆç½‘ç»œä¸­æ€ä¹ˆåˆ‡é¢?æœ€ä¸»è¦çš„å°±æ˜¯æ‰¾åˆ°åˆé€‚çš„æ–¹æ³•,ç„¶ååœ¨å®ƒçš„å‰åéƒ½åˆ‡ä¸€åˆ€.ç”±äºé¡¹ç›®ä¸­ä½¿ç”¨çš„æ˜¯<a href="https://github.com/AFNetworking">AFNetworking</a>æ‰€ä»¥é€‚åˆæˆ‘ä»¬çš„ç‰¹å®šæ–¹æ³•åº”è¯¥æ˜¯è¿›è¡Œç½‘ç»œè¯·æ±‚çš„å…³é”®ä»£ç ,å¦‚ä¸‹:</p>

<pre><code>/**
 Creates an `NSURLSessionDataTask` with the specified request.

 @param request The HTTP request for the request.
 @param completionHandler A block object to be executed when the task finishes. This block has no return value and takes three arguments: the server response, the response object created by that serializer, and the error that occurred, if any.
 */
- (NSURLSessionDataTask *)dataTaskWithRequest:(NSURLRequest *)request
                            completionHandler:(nullable void (^)(NSURLResponse *response, id _Nullable responseObject,  NSError * _Nullable error))completionHandler;
</code></pre>

<p>å½“ç„¶,å¦‚æœéœ€è¦ä¸Šä¼ ä¸‹è½½è¿›åº¦çš„è¯</p>

<pre><code>/**
 Creates an `NSURLSessionDataTask` with the specified request.

 @param request The HTTP request for the request.
 @param uploadProgressBlock A block object to be executed when the upload progress is updated. Note this block is called on the session queue, not the main queue.
 @param downloadProgressBlock A block object to be executed when the download progress is updated. Note this block is called on the session queue, not the main queue.
 @param completionHandler A block object to be executed when the task finishes. This block has no return value and takes three arguments: the server response, the response object created by that serializer, and the error that occurred, if any.
 */
- (NSURLSessionDataTask *)dataTaskWithRequest:(NSURLRequest *)request
                               uploadProgress:(nullable void (^)(NSProgress *uploadProgress))uploadProgressBlock
                             downloadProgress:(nullable void (^)(NSProgress *downloadProgress))downloadProgressBlock
                            completionHandler:(nullable void (^)(NSURLResponse *response, id _Nullable responseObject,  NSError * _Nullable error))completionHandler;
</code></pre>

<p>è¿™ä¸ªåº”è¯¥æ˜¯ä½ çš„é€‰æ‹©,è¿™é‡Œåªè¯´ä¸‹ç½‘ç»œè¯·æ±‚,æ‰€ä»¥å°±ä»¥ç¬¬ä¸€ç§ä¸ºä¾‹äº†.</p>

<p>æˆ‘ä»¬èƒ½åœ¨ç½‘ç»œè¯·æ±‚ä¹‹å‰ä¸ä¹‹ååšäº›ä»€ä¹ˆå‘¢?</p>

<ul>
<li>æ“ä½œç½‘ç»œè¯·æ±‚ä¹‹å‰(å–æ¶ˆ,åˆ¤æ–­æ˜¯å¦é‡å¤&hellip;)</li>
<li>æ“ä½œç½‘ç»œè¯·æ±‚ä¹‹å(ç¼“å­˜,é”™è¯¯å¤„ç†&hellip;)</li>
<li>&hellip;</li>
</ul>

<h3 id="toc_2">è¿›è¡Œç½‘ç»œè¯·æ±‚æ ¸å¿ƒä»£ç </h3>

<pre><code>- (void)addRequest:(NSURLRequest *)request {
    NSLog(@&quot;\n==================================\n\nRequest Start: \n\n &quot;
          @&quot;%@\n\n==================================&quot;,
          request.URL);
    
    // è·‘åˆ°è¿™é‡Œçš„blockçš„æ—¶å€™ï¼Œå°±å·²ç»æ˜¯ä¸»çº¿ç¨‹äº†ã€‚
    __block NSURLSessionDataTask *dataTask = nil;
    dataTask = [_manager
                dataTaskWithRequest:request
                completionHandler:^(NSURLResponse *_Nonnull response,
                                    id _Nullable responseObject,
                                    NSError *_Nullable error) {
                    NSNumber *requestID = @([dataTask taskIdentifier]);
                    [_requestsRecord removeObjectForKey:requestID];
                    NSData *responseData = responseObject;
                    NSString *responseString =
                    [[NSString alloc] initWithData:responseData
                                          encoding:NSUTF8StringEncoding];
                    
                    NSLog(@&quot;responseString:%@&quot;,responseString);
                    if (error) {
                        NSLog(@&quot;error: %@&quot;,error);
                        
#warning TODO: å¤±è´¥å›æ‰
                        NSLog(@&quot;è¿™é‡Œåº”è¯¥è¿›è¡Œå¤±è´¥å›æ‰&quot;);
                    } else {
                        // æ£€æŸ¥http responseæ˜¯å¦æˆç«‹ã€‚
#warning TODO: æˆåŠŸå›æ‰
                        NSLog(@&quot;è¿™é‡Œåº”è¯¥è¿›è¡ŒæˆåŠŸå›æ‰&quot;);
                    }
                }];
    // æ·»åŠ åˆ°è¯·æ±‚åˆ—è¡¨
    NSNumber *requestId = @([dataTask taskIdentifier]);
    _requestsRecord[requestId] = dataTask;
    [dataTask resume];
}
</code></pre>

<h3 id="toc_3">åˆ›å»ºNSMutableURLRequest</h3>

<p>éœ€è¦NSMutableURLRequestå‚æ•°,æ‰€ä»¥åˆ›å»ºä¸€ä¸ª</p>

<pre><code>    AFHTTPRequestSerializer *httpRequestSerializer = [AFHTTPRequestSerializer serializer];
    httpRequestSerializer.timeoutInterval = 20.0f;
    httpRequestSerializer.cachePolicy = NSURLRequestUseProtocolCachePolicy;
    /// ç½‘ç»œè¯·æ±‚å¤´éƒ¨æ’å…¥ä¸€äº›å†…å®¹
    [httpRequestSerializer setValue:[[NSUUID UUID] UUIDString] forHTTPHeaderField:@&quot;xxxxxxxx&quot;];
    NSMutableURLRequest *request = [httpRequestSerializer requestWithMethod:@&quot;GET&quot;
                                                                  URLString:@&quot;http://www.baidu.com&quot;
                                                                      parameters:nil
                                                                           error:NULL];
</code></pre>

<p>å¯ä»¥çœ‹åˆ°,ä¸Šé¢æ³¨é‡Šçš„åœ°æ–¹è¯´æ˜æˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡Œæäº‹æƒ…å•Š,è¿™ä¸ªç¨åä¼šç”¨åˆ°</p>

<p>å¯¹äº†,ä¸è¦å¿˜è®°è®¾ç½®<code>info.plist</code></p>

<pre><code>&lt;key&gt;NSAppTransportSecurity&lt;/key&gt;
    &lt;dict&gt;
        &lt;key&gt;NSAllowsArbitraryLoads&lt;/key&gt;
        &lt;true/&gt;
    &lt;/dict&gt;

</code></pre>

<p>åˆ›å»ºrequestç„¶åè¯·æ±‚,<code>[[MKNetWorkAgent sharedInstance] addRequest:request];</code>ç»“æœå¦‚ä¸‹,ç™¾åº¦HTMLé¡µé¢å»é™¤äº†éƒ¨åˆ†ä»£ç :</p>

<pre><code>2016-08-02 15:36:13.721 NetWorkDemo[56429:4922365] 
==================================

Request Start: 

 http://www.baidu.com

==================================
2016-08-02 15:36:13.838 NetWorkDemo[56429:4922365] responseString:&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;!--STATUS OK--&gt;
    &lt;head&gt;
        &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt;
        &lt;title&gt;ç™¾åº¦ä¸€ä¸‹,ä½ å°±çŸ¥é“&lt;/title&gt;
        &lt;meta http-equiv=&quot;Cache-control&quot; content=&quot;no-cache&quot;&gt;
        &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no&quot;&gt;
        &lt;style type=&quot;text/css&quot;&gt;
            /*å»æ‰cssæ ·å¼*/
        &lt;/style&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;div class=&quot;wrap&quot;&gt;
            &lt;div class=&quot;lg&quot;&gt;
                &lt;img src=&quot;//m.baidu.com/static/index/u.png&quot; alt=&quot;ç™¾åº¦é¦–é¡µ&quot;&gt;
            &lt;/div&gt;
            &lt;form action=&quot;//m.baidu.com/s?&quot; method=&quot;get&quot;&gt;
                &lt;div class=&quot;word-wrap&quot;&gt;
                    &lt;input type=&quot;text&quot; name=&quot;word&quot; maxlength=&quot;64&quot; size=&quot;17&quot; id=&quot;word&quot;&gt;
                &lt;/div&gt;
                &lt;input type=&quot;submit&quot; value=&quot;ç™¾åº¦ä¸€ä¸‹&quot; class=&quot;bn&quot;&gt;
            &lt;/form&gt;
            &lt;div class=&quot;d&quot;&gt;
                &lt;!-- å»æ‰äº†å°¾éƒ¨ --&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/body&gt;
&lt;/html&gt;
2016-08-02 15:36:13.839 NetWorkDemo[56429:4922365] è¿™é‡Œåº”è¯¥è¿›è¡ŒæˆåŠŸå›æ‰
</code></pre>

<p>è¿™è¯´æ˜å·²ç»èƒ½å¤Ÿè¿›è¡Œç½‘ç»œè¯·æ±‚äº†.</p>

<p>&hellip;&hellip;&hellip;.. 2016.8.3æ›´æ–°&hellip;&hellip;&hellip;&hellip;.</p>

<blockquote>
<p>éšç€é¡¹ç›®çš„å¢é•¿,æœ‰äº›æ¥å£æˆ‘ä»¬å¯èƒ½éœ€è¦åœ¨ä¸åŒçš„åœ°æ–¹è°ƒç”¨,è¿™æ˜¯éœ€æ±‚æŠŠè¯·æ±‚å•ç‹¬æ‹¿å‡ºæ¥.åœ¨è¿™é‡Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªMKBaseRequest,æ‰€æœ‰çš„æ¥å£éƒ½ç»§æ‰¿è‡ªbase,è¿™æ ·å°±èƒ½å¤Ÿæ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚äº†.</p>
</blockquote>

<p>éœ€æ±‚å‡ºæ¥äº†,æ€ä¹ˆè§£å†³å‘¢?<br/>
é¦–å…ˆä¿®æ”¹è¿›è¡Œç½‘ç»œè¯·æ±‚æ ¸å¿ƒä»£ç ä¸º<code>- (void)addRequest:(MKBaseRequest *)request</code>,MKBaseRequesté‡Œé¢å¿…é¡»è¦æä¾›å¯ä¾›è®¿é—®çš„url,å› ä¸º<code>NSURLRequest</code>çš„åˆ›å»ºéœ€è¦url.</p>

<p>åœ¨<code>MKBaseRequest</code>ä¸­æ·»åŠ :</p>

<pre><code>/// è¯·æ±‚çš„URL
- (NSString *)requestUrl;
</code></pre>

<p>ä½¿ç”¨æ–¹æ³•è€Œä¸æ˜¯å±æ€§çš„åŸå› å°±æ˜¯ä¸ºäº†æ–¹ä¾¿å­ç±»çš„é‡å†™.<code>- (void)addRequest:(MKBaseRequest *)request</code>å®ç°ä¸­ç”±äºæ²¡æœ‰<code>NSURLRequest</code>æ‰€ä»¥éœ€è¦æ ¹æ®<code>MKBaseRequest</code>æä¾›çš„urlè¿›è¡Œåˆ›å»º,æ·»åŠ ä»£ç :</p>

<pre><code>NSURLRequest *requestTest = [NSURLRequest requestWithURL:[NSURL URLWithString:[request requestUrl]]];
</code></pre>

<p>åŒç†,æˆ‘ä»¬è¿˜å¯ä»¥åœ¨<code>MKBaseRequest</code>ä¸­æ·»åŠ å…¶ä»–é™åˆ¶é¡¹,ä¾‹å¦‚:</p>

<pre><code>/// è¯·æ±‚çš„BaseURL
- (NSString *)baseUrl;

/// è¯·æ±‚çš„cdnURL
- (NSString *)cdnUrl;

/// è¯·æ±‚çš„è¿æ¥è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤ä¸º60ç§’
- (NSTimeInterval)requestTimeoutInterval;

/// è¯·æ±‚çš„å‚æ•°åˆ—è¡¨
- (nullable id)requestArgument;

/// Httpè¯·æ±‚çš„æ–¹æ³•
- (MKRequestMethod)requestMethod;

/// æ˜¯å¦ä½¿ç”¨cdnçš„hoståœ°å€
- (BOOL)useCDN;
</code></pre>

<p>å†™åˆ°è¿™é‡Œ,å¦‚æœæˆ‘ä»¬å¾ˆå¤šæ¥å£éƒ½è®¾ç½®ç±»ä¼¼baseUrlä¹‹ç±»çš„å¯ä»¥æå–å‡ºæ¥è¿˜æœ‰äº›å¿…é¡»çš„å‚æ•°,åœ¨appè¿›å…¥çš„æ—¶å€™ä¸€èµ·è®¾ç½®.è¿™æ—¶æˆ‘ä»¬éœ€è¦åˆ›å»º<code>MKNetworkConfig</code>æ¥ç®¡ç†è¿™äº›å†…å®¹.</p>

<p>&hellip;&hellip;&hellip;.. 2016.8.4æ›´æ–°&hellip;&hellip;&hellip;&hellip;.</p>

<h3 id="toc_4">æœ¬åœ°æ¨¡æ‹Ÿç™»é™†</h3>

<p>åšä¸ªç®€å•çš„æ¨¡æ‹Ÿç™»é™†ç™»é™†é¡µé¢:</p>

<pre><code>&lt;form action=&quot;welcome.php&quot; method=&quot;get&quot;&gt;&lt;br&gt;
    Name: &lt;input type=&quot;text&quot; name=&quot;name&quot; /&gt;&lt;br&gt;
    PWD:  &lt;input type=&quot;text&quot; name=&quot;pwd&quot; /&gt;&lt;br&gt;
    &lt;input type=&quot;submit&quot; /&gt; &lt;/form&gt;
</code></pre>

<p>welecome.phpä¸­ç®€å•çš„è¾“å‡ºåˆšåˆšè¾“å…¥çš„å†…å®¹.</p>

<pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;title&gt;Citynight&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;

æ‚¨è¾“å…¥çš„è´¦å·æ˜¯:

&lt;?php echo $_GET[&quot;name&quot;]; ?&gt;
.&lt;br /&gt;

å¯†ç æ˜¯:

&lt;?php echo $_GET[&quot;pwd&quot;]; ?&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p>ç™»é™†ç•Œé¢çš„æ ·å­:<br/>
<img src="media/14701034373615/14703212142675.jpg" alt=""/></p>

<p>ç‚¹å‡»æäº¤å:<br/>
<img src="media/14701034373615/14703212477389.jpg" alt=""/><br/>
å·²ç»èƒ½å¤Ÿå¾—åˆ°æ­£ç¡®çš„ç»“æœäº†.</p>

<p>æ—¢ç„¶ç½‘é¡µç«¯æ²¡æœ‰é—®é¢˜,é‚£ä¹ˆå°±ä¿®æ”¹æˆè¿”å›jsonæ ¼å¼æ•°æ®ç»™å®¢æˆ·ç«¯</p>

<pre><code>&lt;?php
$map = array(
    &#39;name&#39; =&gt; $_GET[&quot;name&quot;],
    &#39;pwd&#39; =&gt; $_GET[&quot;pwd&quot;]
);
echo json_encode($map);
</code></pre>

<p>æµ‹è¯•å·²ç»èƒ½å¤Ÿæ­£å¸¸è¿”å›äº†:<br/>
<img src="media/14701034373615/14703247878224.jpg" alt=""/></p>

<h3 id="toc_5">æ€æ ·ä¼ é€’å‚æ•°</h3>

<pre><code>/// è¯·æ±‚çš„å‚æ•°åˆ—è¡¨
- (nullable id)requestArgument;
</code></pre>

<p>ä¸Šé¢æ˜¯åŸå…ˆè®¾ç½®çš„ä¼ é€’å‚æ•°çš„æ–¹å¼,æˆ‘æ„Ÿè§‰è¿™æ ·åšä¸æ˜¯å¾ˆæ–¹ä¾¿,æ¯”å¦‚éœ€è¦ä¼ é€’çš„å‚æ•°æ˜¯å˜åŒ–çš„,å¯èƒ½å°±éœ€è¦initçš„æ—¶å€™æ·»åŠ å‚æ•°,è¿™æ—¶å¦‚æœå‚æ•°çš„æ•°é‡è¿˜æ¯”è¾ƒå¤šå¯èƒ½å°±æ¯”è¾ƒéº»çƒ¦äº†.<br/>
æˆ‘ç°åœ¨é‡‡ç”¨çš„æ˜¯é€šè¿‡ä»£ç†çš„æ–¹æ³•å®ç°.</p>

<pre><code>/// æ•°æ®æº:è·å¾—æ‰€éœ€è¦çš„å‚æ•°
@protocol MKRequestParamSource &lt;NSObject&gt;
@required
- (NSDictionary *)paramsForRequest:(MKBaseRequest *)request;
@end
</code></pre>

<p>æˆ‘ä»¬åˆ›å»ºçš„æ—¶å€™å¦‚æœéœ€è¦å‚æ•°å¿…é¡»è®¾ç½®ä»£ç†,å¹¶å®ç°</p>

<pre><code>/// request paramSource
@property (nonatomic, weak, nullable) id&lt;MKRequestParamSource&gt; paramSource;
</code></pre>

<p>è¿™æ ·åšæ˜¯æ¨¡ä»¿æ•°æ®æºçš„ä»£ç†æ–¹æ³•,æ¯”è¾ƒå®¹æ˜“ç†è§£.</p>

<blockquote>
<p>2016.8.23æ›´</p>

<h3 id="toc_6">å¦‚ä½•è¿›è¡Œåˆ†é¡µ</h3>

<p>å¼€å‘ä¸­æˆ‘ä»¬ç»å¸¸é‡åˆ°éœ€è¦ä¸Šæ‹‰åŠ è½½æ›´å¤šçš„éœ€æ±‚,å‚æ•°ä¸­çš„pageæ˜¯åŠ¨æ€å˜åŒ–çš„.è¿™ä¸ªè½®å­ä¹Ÿå¯¹æ­¤ä½œäº†å¤„ç†,å¦‚ä¸‹:</p>
</blockquote>

<pre><code>/// MKNetWorkAgentä¸­æ·»åŠ å¸¦å‚æ•°çš„ç½‘ç»œè¯·æ±‚
- (void)addRequest:(MKBaseRequest *)baseRequest WithParams:(nullable id)params;
</code></pre>

<pre><code>//MKBaseRequest ä¸­æ·»åŠ æ–¹æ³•ç”¨äºè·å–å½“å‰çŠ¶æ€
/* å­ç±»é‡å†™å¿…é¡»å†™ super å¦åˆ™ isLoading çŠ¶æ€ä¸ä¼šæ›´æ”¹*/
- (void)beforePerformRequestState;
/// success: åˆ¤æ–­æˆåŠŸè¿˜æ˜¯å¤±è´¥
- (void)afterPerformResponseState:(BOOL)success;
</code></pre>

<p>å…·ä½“ä½¿ç”¨:<br/>
<img src="media/14701034373615/14719456603156.jpg" alt=""/></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[iOS Tips]]></title>
    <link href="http://www.citynight.cn/Blog/14700440944204.html"/>
    <updated>2016-08-01T17:34:54+08:00</updated>
    <id>http://www.citynight.cn/Blog/14700440944204.html</id>
    <content type="html"><![CDATA[
<p><strong>å¯¹è±¡é”€æ¯</strong><br/>
å¯¹è±¡çš„é”€æ¯è™½ç„¶æ¶ˆè€—èµ„æºä¸å¤šï¼Œä½†ç´¯ç§¯èµ·æ¥ä¹Ÿæ˜¯ä¸å®¹å¿½è§†çš„ã€‚é€šå¸¸å½“å®¹å™¨ç±»æŒæœ‰å¤§é‡å¯¹è±¡æ—¶ï¼Œå…¶é”€æ¯æ—¶çš„èµ„æºæ¶ˆè€—å°±éå¸¸æ˜æ˜¾ã€‚åŒæ ·çš„ï¼Œå¦‚æœå¯¹è±¡å¯ä»¥æ”¾åˆ°åå°çº¿ç¨‹å»é‡Šæ”¾ï¼Œé‚£å°±æŒªåˆ°åå°çº¿ç¨‹å»ã€‚è¿™é‡Œæœ‰ä¸ªå° Tipï¼šæŠŠå¯¹è±¡æ•è·åˆ° block ä¸­ï¼Œç„¶åæ‰”åˆ°åå°é˜Ÿåˆ—å»éšä¾¿å‘é€ä¸ªæ¶ˆæ¯ä»¥é¿å…ç¼–è¯‘å™¨è­¦å‘Šï¼Œå°±å¯ä»¥è®©å¯¹è±¡åœ¨åå°çº¿ç¨‹é”€æ¯äº†ã€‚</p>

<pre><code>NSArray *tmp = self.array;
self.array = nil;
dispatch_async(queue, ^{
    [tmp class];
});
</code></pre>

<blockquote>
<p>æ¥è‡ª:<a href="http://blog.ibireme.com/2015/11/12/smooth_user_interfaces_for_ios/">iOS ä¿æŒç•Œé¢æµç•…çš„æŠ€å·§</a></p>
</blockquote>

<p><strong>æ‹–æ‹½æ”¶èµ·é”®ç›˜</strong><br/>
UIScrollViewæœ‰ä¸ªkeyboardDismissModeå±æ€§ï¼Œè®¾ç½®æˆUIScrollViewKeyboardDismissModeOnDragå°±å¯ä»¥åœ¨æ‹–æ‹½ScrollViewçš„æ—¶å€™è‡ªåŠ¨ç¼©èµ·é”®ç›˜</p>

<pre><code>@property(nonatomic) UIScrollViewKeyboardDismissMode keyboardDismissMode NS_AVAILABLE_IOS(7_0); // default is UIScrollViewKeyboardDismissModeNone
</code></pre>

<p><strong>è®©viewçš„ä¸€éƒ¨åˆ†å“åº”æ‰‹åŠ¿ç‚¹å‡»</strong><br/>
è®©viewçš„ä¸€éƒ¨åˆ†å“åº”æ‰‹åŠ¿ç‚¹å‡»ï¼Œå…¶ä½™éƒ¨åˆ†å®ç°æ‰‹åŠ¿é€ä¼ ç»™ä¸‹æ–¹çš„viewçš„æ–¹æ³•</p>

<p>åœ¨Viewä¸­é‡å†™:</p>

<pre><code>-(UIView *)hitTest:(CGPoint)point withEvent:(UIEvent *)event {
    NSLog(@&quot;%@-------------&gt;&gt;&gt;&gt;&gt;&gt;&gt;point = %@&quot;,NSStringFromSelector(_cmd),NSStringFromCGPoint(point));
    
    // è®¾ç½®èƒ½å¤Ÿç‚¹å‡»çš„åŒºåŸŸ
    CGRect rect = CGRectMake(100, 100, 200, 200);
    if (CGRectContainsPoint(rect, point)) {
        // å¦‚æœç‚¹å‡»åœ¨è¯¥åŒºåŸŸ,åˆ™è®©View æˆä¸ºå“åº”é“¾ä¸­çš„ä¸€ä¸ªview,æ¥å—æ‰‹åŠ¿äº‹ä»¶
        // æ­¤æ—¶å¯é€šè¿‡touchBegan:æ–¹æ³•ç›‘å¬åˆ°æ‰‹åŠ¿
        return self;
    }
    return nil;
}

</code></pre>

<p>æ§åˆ¶æŒ‰é’®çš„ç‚¹å‡»èŒƒå›´å¯ä»¥å‚è§:<a href="https://github.com/Mekor/MKExtension">MKExtension</a>ä¸­çš„<code>UIButton+TapScope</code></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Android Studio ä¸­å¦‚ä½•æŸ¥çœ‹å¸®åŠ©æ–‡æ¡£]]></title>
    <link href="http://www.citynight.cn/Blog/14693652209160.html"/>
    <updated>2016-07-24T21:00:20+08:00</updated>
    <id>http://www.citynight.cn/Blog/14693652209160.html</id>
    <content type="html"><![CDATA[
<ol>
<li><p>é¦–å…ˆä¸‹è½½å¸®åŠ©æ–‡æ¡£<br/>
<img src="media/14693652209160/14693653611930.jpg" alt=""/></p></li>
<li><p>è·³è½¬åˆ°æ–‡ä»¶å¤¹<br/>
<img src="media/14693652209160/14693654229419.jpg" alt=""/></p></li>
<li><p>æ‰“å¼€å¸®åŠ©æ–‡æ¡£ index.html<br/>
<img src="media/14693652209160/14693655187234.jpg" alt=""/></p></li>
<li><p>ä¾‹å¦‚æŸ¥æ‰¾Activity ç”Ÿå‘½å‘¨æœŸå¯ä»¥è¿™æ ·èµ°<br/>
<img src="media/14693652209160/14693656858016.jpg" alt=""/><br/>
ç„¶åcommand + f æœç´¢Activityé€‰ä¸­ä¸€ä¸ªé«˜äº®çš„é€‰é¡¹ä¾‹å¦‚:<br/>
<img src="media/14693652209160/14693658027297.jpg" alt=""/><br/>
ç”±äºå®ƒæ˜¯ç»§æ‰¿è‡ªActivityçš„æ‰€ä»¥å¯ä»¥è¿™æ ·<br/>
<img src="media/14693652209160/14693659242489.jpg" alt=""/><br/>
ç„¶åå¾€ä¸‹ç¿»ä¸€ç¿»å°±èƒ½çœ‹åˆ°äº†<br/>
<img src="media/14693652209160/14693659705775.jpg" alt=""/></p></li>
</ol>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[å…³äºç­¾å(Certificate),Identifiers,Deviceå’ŒProvisioning Profile]]></title>
    <link href="http://www.citynight.cn/Blog/14689910761027.html"/>
    <updated>2016-07-20T13:04:36+08:00</updated>
    <id>http://www.citynight.cn/Blog/14689910761027.html</id>
    <content type="html"><![CDATA[
<p>ç›´æ¥ä¸Šå›¾:</p>

<p><img src="media/14689910761027/%E6%80%BB%E7%BB%93.png" alt="æ€»ç»“"/></p>

<p>åº”è¯¥å¾ˆè¯¦ç»†äº†</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Pythonçˆ¬ç½‘ç«™ä¸Šçš„å›¾ç‰‡]]></title>
    <link href="http://www.citynight.cn/Blog/14689829459214.html"/>
    <updated>2016-07-20T10:49:05+08:00</updated>
    <id>http://www.citynight.cn/Blog/14689829459214.html</id>
    <content type="html"><![CDATA[
<p>ä»¥<a href="http://ppt.geekbang.org">æå®¢é‚¦PPTå¤§å…¨</a>ä¸ºä¾‹,æ¯”å¦‚æˆ‘æƒ³ä¸‹è½½<a href="http://ppt.geekbang.org/slide/show/204">ç¾å›¢iOSå®¢æˆ·ç«¯çš„æ„å»ºæ€è€ƒä¸å®è·µ</a></p>

<ol>
<li>æŸ¥çœ‹å›¾ç‰‡url
<img src="media/14689829459214/14689832970971.jpg" alt=""/></li>
<li>å›¾ç‰‡urlçš„æ ¼å¼<a href="http://7xiox7.com2.z0.glb.qiniucdn.com/576e52fb28bf9-01.jpg">http://7xiox7.com2.z0.glb.qiniucdn.com/576e52fb28bf9-01.jpg</a>  æ€»å…±101å¼ å›¾ç‰‡</li>
<li>æ ¹æ®è¿™äº›ç¼–å†™Pythonæ–‡ä»¶</li>
</ol>

<pre><code>#!/usr/bin/python
#coding:utf-8

import urllib
import urllib2
import os

basepicurl=&quot;http://7xiox7.com2.z0.glb.qiniucdn.com/576e52fb28bf9-&quot;
save_path=&quot;/Users/mekor/Desktop/images/&quot;
for i in range(1,102,1):
    s = &quot;%02d&quot; % i
    picurl = basepicurl + s + &quot;.jpg&quot;
    imgData = urllib2.urlopen(picurl).read()
    # ç»™å®šå›¾ç‰‡å­˜æ”¾åç§°
    fileName = save_path + s + &quot;.jpg&quot;
    # æ–‡ä»¶åæ˜¯å¦å­˜åœ¨
    #if os.path.exists(fileName):
    output = open(fileName,&#39;wb+&#39;)
    output.write(imgData)
    output.close()
    print &quot;Finished download&quot;+ s

print &quot;è¿è¡Œå®Œæˆ&quot;
</code></pre>

<p>è¿™æ ·å°±èƒ½å¤ŸæŠŠæ‰€æœ‰çš„å›¾ç‰‡çˆ¬åˆ°æœ¬åœ°äº†.</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Mac ä¸‹é¢Python è‡ªåŠ¨è¡¥å…¨]]></title>
    <link href="http://www.citynight.cn/Blog/14685034880390.html"/>
    <updated>2016-07-14T21:38:08+08:00</updated>
    <id>http://www.citynight.cn/Blog/14685034880390.html</id>
    <content type="html"><![CDATA[
<p>ç½‘ä¸Šæœ‰å¾ˆå¤štabè‡ªåŠ¨è¡¥å…¨çš„è„šæœ¬,ä½†æ˜¯åœ¨Macä¸Šé¢éƒ½ä¸èƒ½æ­£å¸¸çš„è¿è¡Œ,åœ¨<a href="http://stackoverflow.com/questions/7116038/python-tab-completion-mac-osx-10-7-lion">stackoverflow</a>æ‰¾åˆ°ä¸€ä¸ªèƒ½ç”¨çš„.</p>

<pre><code>import readline
import rlcompleter
if &#39;libedit&#39; in readline.__doc__:
    readline.parse_and_bind(&quot;bind ^I rl_complete&quot;)
else:
    readline.parse_and_bind(&quot;tab: complete&quot;)

</code></pre>

<p>è¿›å…¥Pythonåç›´æ¥import tab å°±å¯ä»¥äº†</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[å¦‚ä½•ç»™Viewæ·»åŠ ç‚¹å‡»äº‹ä»¶]]></title>
    <link href="http://www.citynight.cn/Blog/14682407498601.html"/>
    <updated>2016-07-11T20:39:09+08:00</updated>
    <id>http://www.citynight.cn/Blog/14682407498601.html</id>
    <content type="html"><![CDATA[
<p>é¡¹ç›®ä¸­æœ‰å¾ˆå¤šåœ°æ–¹éœ€è¦æ·»åŠ ç‚¹å‡»äº‹ä»¶,é‡å¤ä»£ç å¾ˆå¤š,æ‰€ä»¥åšäº†ä¸€ä¸ªUIViewçš„åˆ†ç±»,ä¸“é—¨åšç‚¹å‡»äº‹ä»¶ä½¿ç”¨.<br/>
é¡¹ç›®åœ°å€:<a href="https://github.com/Mekor/UIView-Tap">UIView-Tap</a></p>

<p>ä»£ç å¾ˆç®€å•,ä¸»è¦æœ‰ä¸€ç‚¹å°±æ˜¯æ³¨æ„åˆ†ç±»ä¸èƒ½ç›´æ¥æ·»åŠ å±æ€§,éœ€è¦ç”¨åˆ°è¿è¡Œæ—¶ç›¸å…³å†…å®¹.</p>

<p>ä»£ç å¦‚ä¸‹:</p>

<pre><code>\\UIView+Tap.hæ–‡ä»¶
@interface UIView (Tap)
- (void)addTapBlock:(void(^)(id obj))tapAction;
@end

\\UIView+Tap.mæ–‡ä»¶
#import &lt;objc/runtime.h&gt;

static const void* tagValue = &amp;tagValue;

@interface UIView ()
@property (nonatomic, copy) void(^tapAction)(id);
@end

@implementation UIView (Tap)
- (void)tap{
    if (self.tapAction) {
        self.tapAction(self);
    }
}
- (void)addTapBlock:(void(^)(id obj))tapAction{
    self.tapAction = tapAction;
    if (![self gestureRecognizers]) {
        self.userInteractionEnabled = YES;
        UITapGestureRecognizer *tap = [[UITapGestureRecognizer alloc] initWithTarget:self action:@selector(tap)];
        [self addGestureRecognizer:tap];
    }
}

-(void)setTapAction:(void (^)(id))tapAction {
    objc_setAssociatedObject(self, tagValue, tapAction, OBJC_ASSOCIATION_COPY_NONATOMIC);
}
-(void (^)(id))tapAction {
    return objc_getAssociatedObject(self, tagValue);
}
@end
</code></pre>

<p>æ­£å¦‚å¤§å®¶æ‰€è§,å¦‚æœè¦æ¥æ”¶ç‚¹å‡»äº‹ä»¶,å¿…é¡»userInteractionEnabledè®¾ç½®ä¸ºYES,æ‰€ä»¥ä¸ç®¡æ€ä¹ˆåªè¦ç¡®è®¤è¦ç»™è§†å›¾æ·»åŠ ç‚¹å‡»äº‹ä»¶,éƒ½ä¼šè¢«è®¾ç½®ä¸º<code>userInteractionEnabled = YES</code></p>

<p>ç®€å•å®ç”¨:</p>

<pre><code>UIView *redView = [[UIView alloc]initWithFrame:CGRectMake(100, 100, 100, 100)];
redView.backgroundColor = [UIColor redColor];
[redView addTapBlock:^(UIView* obj) {
    NSLog(@&quot;redView%@&quot;,obj.backgroundColor);
}];
[self.view addSubview:redView];

UIImageView *imageView = [[UIImageView alloc]initWithFrame:CGRectMake(50, 250, 100, 100)];
imageView.image = [UIImage imageNamed:@&quot;icon&quot;];
[imageView addTapBlock:^(UIImageView* obj) {
    NSLog(@&quot;imageView:\n%@&quot;,obj.image);
}];
[self.view addSubview:imageView];

UILabel *label = [[UILabel alloc]initWithFrame:CGRectMake(150, 400, 100, 100)];
label.text = @&quot;è¿™æ˜¯label,ç‚¹å‡»è¿™é‡Œ...&quot;;
[label addTapBlock:^(UILabel* obj) {
    NSLog(@&quot;label:\n%@&quot;,obj.text);
}];
[self.view addSubview:label];

</code></pre>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[å…³äºtableViewCellåŠ è½½å›¾ç‰‡ä¼˜åŒ–]]></title>
    <link href="http://www.citynight.cn/Blog/14678597180657.html"/>
    <updated>2016-07-07T10:48:38+08:00</updated>
    <id>http://www.citynight.cn/Blog/14678597180657.html</id>
    <content type="html"><![CDATA[
<p>cellçš„åˆ›å»º</p>

<pre><code>- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath
</code></pre>

<p>æ•°æ®å¤„ç†å»ºè®®åœ¨è¿™é‡Œè¿›è¡Œ:</p>

<pre><code>-(void)tableView:(UITableView *)tableView willDisplayCell:(UITableViewCell *)cell forRowAtIndexPath:(NSIndexPath *)indexPath
</code></pre>

<p>cellå°†è¦æ˜¾ç¤ºçš„æ—¶å€™æˆ‘ä»¬è¿›è¡Œä¸€äº›å¤„ç†(æ¥è‡ªè‹¹æœDemo)</p>

<pre><code>// Only load cached images; defer new downloads until scrolling ends
if (!appRecord.appIcon)
{
    if (self.tableView.dragging == NO &amp;&amp; self.tableView.decelerating == NO)
    {
        [self startIconDownload:appRecord forIndexPath:indexPath];
    }
    // if a download is deferred or in progress, return a placeholder image
    cell.imageView.image = [UIImage imageNamed:@&quot;Placeholder.png&quot;];
}
else
{
    cell.imageView.image = appRecord.appIcon;
}
</code></pre>

<p>è¿™é‡Œå¯ä»¥çœ‹å‡º,æ‹–æ‹½å’Œæ»šåŠ¨çš„æ—¶å€™ä¸è¿›è¡Œå›¾ç‰‡ä¸‹è½½,åªæœ‰åœæ­¢çš„æ—¶å€™æ‰è¿›è¡Œ.å½“ç„¶æˆ‘ä»¬è¿˜éœ€è¦åœ¨scrollViewåœæ­¢æ»šåŠ¨å’Œæ‹–æ‹½çš„æ—¶å€™è¿›è¡Œä¸‹è½½</p>

<pre><code>#pragma mark - UIScrollViewDelegate

// -------------------------------------------------------------------------------
//  scrollViewDidEndDragging:willDecelerate:
//  Load images for all onscreen rows when scrolling is finished.
// -------------------------------------------------------------------------------
- (void)scrollViewDidEndDragging:(UIScrollView *)scrollView willDecelerate:(BOOL)decelerate
{
    if (!decelerate)
    {
        [self loadImagesForOnscreenRows];
    }
}

// -------------------------------------------------------------------------------
//  scrollViewDidEndDecelerating:scrollView
//  When scrolling stops, proceed to load the app icons that are on screen.
// -------------------------------------------------------------------------------
- (void)scrollViewDidEndDecelerating:(UIScrollView *)scrollView
{
    [self loadImagesForOnscreenRows];
}

</code></pre>

<p>ä¸‹è½½æ˜¾ç¤ºcellçš„å›¾ç‰‡</p>

<pre><code>// -------------------------------------------------------------------------------
//  loadImagesForOnscreenRows
//  This method is used in case the user scrolled into a set of cells that don&#39;t
//  have their app icons yet.
// -------------------------------------------------------------------------------
- (void)loadImagesForOnscreenRows
{
    if (self.entries.count &gt; 0)
    {
        NSArray *visiblePaths = [self.tableView indexPathsForVisibleRows];
        for (NSIndexPath *indexPath in visiblePaths)
        {
            AppRecord *appRecord = (self.entries)[indexPath.row];
            
            if (!appRecord.appIcon)
            // Avoid the app icon download if the app already has an icon
            {
                [self startIconDownload:appRecord forIndexPath:indexPath];
            }
        }
    }
}
</code></pre>

<p>å…·ä½“ä¸‹è½½:</p>

<pre><code>#pragma mark - Table cell image support

// -------------------------------------------------------------------------------
//  startIconDownload:forIndexPath:
// -------------------------------------------------------------------------------
- (void)startIconDownload:(AppRecord *)appRecord forIndexPath:(NSIndexPath *)indexPath
{
    NSLog(@&quot;ä¸‹è½½å›¾ç‰‡&quot;);
    IconDownloader *iconDownloader = (self.imageDownloadsInProgress)[indexPath];
    if (iconDownloader == nil) 
    {
        iconDownloader = [[IconDownloader alloc] init];
        iconDownloader.appRecord = appRecord;
        [iconDownloader setCompletionHandler:^{
            
            UITableViewCell *cell = [self.tableView cellForRowAtIndexPath:indexPath];
            
            // Display the newly loaded image
            cell.imageView.image = appRecord.appIcon;
            
            // Remove the IconDownloader from the in progress list.
            // This will result in it being deallocated.
            [self.imageDownloadsInProgress removeObjectForKey:indexPath];
            
        }];
        (self.imageDownloadsInProgress)[indexPath] = iconDownloader;
        [iconDownloader startDownload];  
    }
}
</code></pre>

<p>IconDownloaderæ–‡ä»¶</p>

<pre><code>//.hæ–‡ä»¶
@class AppRecord;

@interface IconDownloader : NSObject

@property (nonatomic, strong) AppRecord *appRecord;
@property (nonatomic, copy) void (^completionHandler)(void);

- (void)startDownload;
- (void)cancelDownload;

@end


//.mæ–‡ä»¶
#import &quot;IconDownloader.h&quot;
#import &quot;AppRecord.h&quot;

#define kAppIconSize 48


@interface IconDownloader ()

@property (nonatomic, strong) NSURLSessionDataTask *sessionTask;

@end


#pragma mark -

@implementation IconDownloader

// -------------------------------------------------------------------------------
//  startDownload
// -------------------------------------------------------------------------------
- (void)startDownload
{
    NSURLRequest *request = [NSURLRequest requestWithURL:[NSURL URLWithString:self.appRecord.imageURLString]];

    // create an session data task to obtain and download the app icon
    _sessionTask = [[NSURLSession sharedSession] dataTaskWithRequest:request
                                                   completionHandler:^(NSData *data, NSURLResponse *response, NSError *error) {
        
        // in case we want to know the response status code
        //NSInteger HTTPStatusCode = [(NSHTTPURLResponse *)response statusCode];

        if (error != nil)
        {
            if ([error code] == NSURLErrorAppTransportSecurityRequiresSecureConnection)
            {
                // if you get error NSURLErrorAppTransportSecurityRequiresSecureConnection (-1022),
                // then your Info.plist has not been properly configured to match the target server.
                //
                abort();
            }
        }
                                                       
        [[NSOperationQueue mainQueue] addOperationWithBlock: ^{
            
            // Set appIcon and clear temporary data/image
            UIImage *image = [[UIImage alloc] initWithData:data];
            
            if (image.size.width != kAppIconSize || image.size.height != kAppIconSize)
            {
                CGSize itemSize = CGSizeMake(kAppIconSize, kAppIconSize);
                UIGraphicsBeginImageContextWithOptions(itemSize, NO, 0.0f);
                CGRect imageRect = CGRectMake(0.0, 0.0, itemSize.width, itemSize.height);
                [image drawInRect:imageRect];
                self.appRecord.appIcon = UIGraphicsGetImageFromCurrentImageContext();
                UIGraphicsEndImageContext();
            }
            else
            {
                self.appRecord.appIcon = image;
            }
            
            // call our completion handler to tell our client that our icon is ready for display
            if (self.completionHandler != nil)
            {
                self.completionHandler();
            }
        }];
    }];
    
    [self.sessionTask resume];
}

// -------------------------------------------------------------------------------
//  cancelDownload
// -------------------------------------------------------------------------------
- (void)cancelDownload
{
    [self.sessionTask cancel];
    _sessionTask = nil;
}
</code></pre>

<blockquote>
<p><a href="https://developer.apple.com/library/ios/samplecode/LazyTableImages/Introduction/Intro.html">Apple Demo</a></p>
</blockquote>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[é”®ç›˜æ¶ˆå¤±ååˆå†æ¬¡æ˜¾ç¤ºå¹¶ç«‹å³æ¶ˆå¤±é—®é¢˜]]></title>
    <link href="http://www.citynight.cn/Blog/14677030322532.html"/>
    <updated>2016-07-05T15:17:12+08:00</updated>
    <id>http://www.citynight.cn/Blog/14677030322532.html</id>
    <content type="html"><![CDATA[
<p>Keyboard will appeared automatically while displaying alertview or alertcontroller</p>

<blockquote>
<p><a href="http://stackoverflow.com/questions/30498972/keyboard-will-appeared-automatically-in-ios-8-3-while-displaying-alertview-or-al">stackoverflow</a></p>
</blockquote>

<p>æˆ‘é‡‡ç”¨å…¶ä¸­</p>

<pre><code> [YOUR_TEXT resignFirstResponder];
            dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(.6 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^{


                    _alertVw = [[UIAlertView alloc] initWithTitle:@&quot;&quot; message:@&quot;message.&quot; delegate:self cancelButtonTitle:@&quot;Ok&quot; otherButtonTitles:nil, nil];

                    [_alertVw show];
});

</code></pre>

<p>è¿™ç§æ–¹æ¡ˆè§£å†³çš„</p>

]]></content>
  </entry>
  
</feed>
