<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>  
	  
  	runtime(å†…éƒ¨åˆ†äº«è‰ç¨¿) - 
  	
	</title>

  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="atom.xml" rel="alternate" title="" type="application/atom+xml">

	<link href="asset/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="asset/stylesheets/font-awesome.min.css" media="screen, projection" rel="stylesheet" type="text/css">
	<script src="asset/javascripts/jquery.min.js"></script>
	<script src="asset/highlightjs/highlight.pack.js"></script>
	<link href="asset/highlightjs/styles/solarized_dark.css" media="screen, projection" rel="stylesheet" type="text/css">
<script>hljs.initHighlightingOnLoad();</script>

	<!--[if lt IE 9]><script src="asset/javascripts/html5.js"></script><![endif]-->
	<!-- <link href='http://fonts.googleapis.com/css?family=Nunito:400,300,700' rel='stylesheet' type='text/css'> -->
	<style type="text/css">
/* latin */
@font-face {
  font-family: 'Nunito';
  font-style: normal;
  font-weight: 300;
  src: local('Nunito-Light'), url(asset/font/1TiHc9yag0wq3lDO9cw0voX0hVgzZQUfRDuZrPvH3D8.woff2) format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
}
/* latin */
@font-face {
  font-family: 'Nunito';
  font-style: normal;
  font-weight: 400;
  src: local('Nunito-Regular'), url(asset/font/6TbRXKWJjpj6V2v_WyRbMX-_kf6ByYO6CLYdB4HQE-Y.woff2) format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
}
/* latin */
@font-face {
  font-family: 'Nunito';
  font-style: normal;
  font-weight: 700;
  src: local('Nunito-Bold'), url(asset/font/TttUCfJ272GBgSKaOaD7KoX0hVgzZQUfRDuZrPvH3D8.woff2) format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
}
	</style>
	
	<style type="text/css">
	.container .left-col{ opacity: 1;}
	#pagenavi a{ font-size: 1.3em;}
	#pagenavi .next:before{ top: 3px;}
	#pagenavi .prev:before{ top: 3px;}
	.container .mid-col .mid-col-container #content .archives .title{ font-size: 1.5em;}
	.container .mid-col .mid-col-container #content article{ padding: 15px 0px;}
	#header .subtitle {
		line-height: 1.2em;
		padding-top: 8px;
	}
	article pre{ background: none; border: none; padding: 0;}
	article .entry-content{text-align: left;}
	.share-comment{ padding: 25px 0px; clear: both;}
	hr{ margin: 20px 0px;border: 0; border-top:solid 1px #ddd;}
	</style>
  

</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
				<header id="header" class="inner">
				 
				 	<div class="profilepic">
						<img src="https://raw.githubusercontent.com/Mekor/mekor.github.io/master/Blog/asset/icon.jpg" style="width:160px;">
					</div>
            	
					
					<h1><a href="index.html"></a></h1>
					<p class="subtitle"></p>
					<nav id="main-nav">
						<ul class="main">
						
						  <li id=""><a target="self" href="index.html">Home</a></li>
						
						  <li id=""><a target="_self" href="archives.html">Archives</a></li>
						
						</ul>
					</nav>

					<nav id="sub-nav">
						<div class="social">













								

								<a class="rss" href="atom.xml" title="RSS">RSS</a>
							
						</div>
					</nav>
				</header>				
			</div>
		</div>	
		<div class="mid-col">
			<div class="mid-col-container"> <div id="content" class="inner">

	<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
		<h1 class="title" itemprop="name">runtime(å†…éƒ¨åˆ†äº«è‰ç¨¿)</h1>
		<div class="entry-content" itemprop="articleBody">
			<h2 id="toc_0">ç†è§£self,super,class,superclass</h2>

<p>åˆ›å»ºä¸€ä¸ªPersoné‡Œé¢æœ‰ä¸€ä¸ªç±»æ–¹æ³•:</p>

<pre><code class="language-objc">#import &quot;Person.h&quot;

@implementation Person
+(void)study {
    NSLog(@&quot;%@ %@ %@ %@&quot;,[self class],[self superclass],[super class],[super superclass]);
}
@end
</code></pre>

<p>Studentç»§æ‰¿è‡ªPerson,é‡å†™çˆ¶ç±»æ–¹æ³•</p>

<pre><code class="language-objc">#import &quot;Student.h&quot;

@implementation Student
+(void)study {
    NSLog(@&quot;%@ %@ %@ %@&quot;,[self class],[self superclass],[super class],[super superclass]);
}
@end
</code></pre>

<p>è¿™ä¸¤ä¸ªè¾“å‡ºçš„éƒ½æ˜¯ä»€ä¹ˆ?<br/>
<img src="media/14727863232294/14729913552743.jpg" alt=""/></p>

<p>è¿™æ—¶,æˆ‘ä»¬åœ¨Studentä¸­ç”¨è¿™æ ·å†™:</p>

<pre><code class="language-objc">#import &quot;Student.h&quot;

@implementation Student
+(void)study {
//    NSLog(@&quot;%@ %@ %@ %@&quot;,[self class],[self superclass],[super class],[super superclass]);
    
    [super study];
}
@end
</code></pre>

<p>æ‰“æ–­ç‚¹æˆ‘ä»¬å¯ä»¥çœ‹åˆ°:<br/>
<img src="media/14727863232294/14729934417192.jpg" alt=""/></p>

<p>å¯ä»¥çœ‹å‡º:</p>

<pre><code class="language-objc">superï¼šæ˜¯ç¼–è¯‘å™¨æŒ‡ç¤ºç¬¦ï¼Œä»…ä»…æ˜¯ä¸€ä¸ªæ ‡å¿—,å¹¶ä¸æ˜¯æŒ‡é’ˆï¼Œä»…ä»…æ˜¯æ ‡å¿—çš„å½“å‰å¯¹è±¡å»è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•ï¼Œæœ¬è´¨è¿˜æ˜¯å½“å‰å¯¹è±¡è°ƒç”¨
super:å¹¶ä¸æ˜¯è®©çˆ¶ç±»å¯¹è±¡è°ƒç”¨æ–¹æ³•ï¼Œè°ƒç”¨è€…è¿˜æ˜¯æœ¬èº«
classï¼šè·å–æ–¹æ³•è°ƒç”¨è€…çš„ç±»
superclass:è·å–æ–¹æ³•è°ƒç”¨è€…çš„çˆ¶ç±»
</code></pre>

<h2 id="toc_1">selfæ˜¯ä»å“ªé‡Œæ¥çš„?</h2>

<blockquote>
<p>å®˜æ–¹è§£é‡Š:<a href="https://developer.apple.com/library/prerelease/content/documentation/Cocoa/Conceptual/ObjCRuntimeGuide/Articles/ocrtHowMessagingWorks.html">Objective-C Runtime Programming Guide</a><img src="media/14727863232294/14729941396965.jpg" alt=""/></p>
</blockquote>

<p>ç®€å•è¯´æ¯ä¸ªæ–¹æ³•éƒ½å­˜åœ¨å¹¶ä¸”éšè—çš„ä¸¤ä¸ªå‚æ•°(self,_cmd),éšä¾¿å†™ä¸ªæ–¹æ³•çœ‹ä¸‹:<br/>
Studentä¸­å†™ä¸ªtextæ–¹æ³•,ç„¶åæ‰“å°ä¸‹è¿™ä¸¤ä¸ªéšè—å‚æ•°.<br/>
<img src="media/14727863232294/14729960900273.jpg" alt=""/><br/>
<img src="media/14727863232294/14729961142923.jpg" alt=""/></p>

<h2 id="toc_2">åŠ¨æ€æ·»åŠ æ–¹æ³•</h2>

<p>ä¸Šé¢è¯´äº†ä¸€äº›è²Œä¼¼å’Œruntimeæ²¡æœ‰ä»€ä¹ˆå…³ç³»,runtimeåŸºç¡€çŸ¥è¯†ç±»ä¼¼ç±»çš„æ„æˆ,å¯¹è±¡çš„æ„æˆè¿™é‡Œä¸å†ä»‹ç»,å¯ä»¥è‡ªå·±å»çœ‹å®šä¹‰.å½“ç„¶ä¹Ÿå¯ä»¥å»<a href="http://opensource.apple.com/source/objc4/objc4-680/runtime/">è‹¹æœçš„å¼€æºç½‘ç«™</a>æŸ¥çœ‹,å¦‚æœç½‘ç«™ä¸æ–¹ä¾¿å¯ä»¥å»è‹¹æœçš„<a href="https://github.com/opensource-apple/objc4">github</a>ä¸‹è½½å¼€æºä»£ç ç ”ç©¶...  ...ç»§ç»­...é‚£ä¹ˆæ ¹æ®ä¸Šé¢æ‰€è¯´çš„æ–¹æ³•è¯´ä¸‹åŠ¨æ€æ·»åŠ æ–¹æ³•.</p>

<blockquote>
<p>æ€è€ƒä¸€ä¸‹,å’±ä»¬newé¡¹ç›®ä¸­å°†é‡‡ç”¨è·¯ç”±æ¨¡å¼è¿›è¡Œé¡µé¢è·³è½¬,ä»ç½‘é¡µè·³è½¬è¿›å…¥appè°ƒç”¨ä¸€ä¸ªæ–¹æ³•,ä¸€èˆ¬æƒ…å†µä¸‹éƒ½æ˜¯ç§»åŠ¨ç«¯å’Œåå°åè®®å¥½çš„å†…å®¹,è¿™æ ·è·³è½¬ä¸ä¼šå‡ºç°é—®é¢˜.ä½†æ˜¯å¦‚æœåå°å†™é”™äº†æˆ–è€…ä¼ è¾“ä¸­å‡ºç°é—®é¢˜å¯¼è‡´urlä¸­åŒ…å«çš„æ–¹æ³•åä¸æ˜¯è§„å®šçš„æ–¹æ³•å.è¿™æ—¶æ€ä¹ˆåŠ?</p>
</blockquote>

<pre><code class="language-objc">    Student *s = [Student new];
    
    // 1. æ¯”å¦‚æˆ‘ä»¬è¦è°ƒç”¨ Studentä¸­çš„eatæ–¹æ³•, é»˜è®¤è¿™æ ·å†™[s eat]; ä½†æ˜¯ä¸è¡Œ,å› ä¸ºæˆ‘ä»¬æ²¡æœ‰å®šä¹‰.
//    [s eat];
    // 2. ä¹Ÿå¯ä»¥è¿™æ ·è°ƒç”¨[s performSelector:@selector(eat)];è¿™æ ·æ²¡æœ‰é—®é¢˜,@selectorä¸­å‚æ•°æ˜¯å­—ç¬¦ä¸²,è¿™ä¸ªå‚è€ƒswift
//    [s performSelector:@selector(eat)];
    // 3. ä½¿ç”¨stringåˆ›å»ºSEL
    
#pragma clang diagnostic push
#pragma clang diagnostic ignored&quot;-Warc-performSelector-leaks&quot;
    [s performSelector:NSSelectorFromString(@&quot;eat&quot;)];
#pragma clang diagnostic pop
    
    // ä¸Šé¢è¿™æ ·è°ƒç”¨ä¼šæŠ¥é”™,æˆ‘ä»¬åœ¨å¯¹è±¡è°ƒç”¨æœªå®ç°æ–¹æ³•çš„æ—¶å€™åŠ¨æ€çš„åˆ›å»ºä¸€ä¸ªæ–¹æ³•,é¿å…æŠ›å‡ºå¼‚å¸¸.
</code></pre>

<p>æ€ä¹ˆå¿½ç•¥ç¼–è¯‘å™¨è­¦å‘Šå·²ç»åˆ†äº«è¿‡,å¯ä»¥å‚è€ƒ:<a href="http://www.citynight.cn/Blog/14676105703423.html">http://www.citynight.cn/Blog/14676105703423.html</a></p>

<h3 id="toc_3">æ€ä¹ˆåŠ¨æ€æ·»åŠ æ–¹æ³•å‘¢?</h3>

<p><img src="media/14727863232294/14729983827897.jpg" alt=""/><br/>
ä¸Šé¢æ˜¯åŠ¨æ€æ·»åŠ å¯¹è±¡æ–¹æ³•çš„ä¾‹å­,åŠ¨æ€æ·»åŠ ç±»æ–¹æ³•ä¹Ÿæ˜¯ä¸€æ ·çš„<code>+(BOOL)resolveClassMethod:(SEL)sel</code><br/>
<strong>æ³¨æ„</strong>ä¸Šé¢å‡½æ•°ç±»å‹,æœ‰äººå¯èƒ½å¥½å¥‡è¿™å—ä¸ºä»€ä¹ˆå†™æˆ&quot;v@:&quot;  ?å‚è§:å‡½æ•°ç±»å‹</p>

<h3 id="toc_4">å…³äºå‡½æ•°ç±»å‹</h3>

<p>å…ˆçœ‹æ–‡æ¡£:<br/>
<img src="media/14727863232294/14730056768742.jpg" alt=""/><br/>
æŸ¥çœ‹<code>Objective-C type encodings</code> <img src="media/14727863232294/14730058881001.jpg" alt=""/><br/>
æ‰€ä»¥ä¸Šé¢void eat(...)åº”è¯¥è¡¨è¿°æˆ <code>&quot;v@:&quot;</code></p>

<p><strong>è¡¥å……:</strong> åŠ¨æ€è°ƒç”¨æ–¹æ³•ç³»ç»Ÿé»˜è®¤æä¾›ä¸€åˆ°ä¸¤ä¸ªå‚æ•°çš„æ–¹æ³•è°ƒç”¨, <del>è¿™é‡Œå°è£…äº†ä¸€ä¸ªæ— é™å‚æ•°çš„æ–¹æ³•è°ƒç”¨.<a href="https://github.com/Mekor/NSObject-SEL">NSObject-SEL****</a></del>  æˆ‘æŠŠä¸€äº›æ‰©å±•è¿›è¡Œäº†æ€»ç»“,è¿˜ä¸å®Œå–„,åœ°å€<a href="https://github.com/Mekor/MKExtension">MKExtension</a></p>

<h3 id="toc_5">å…³äºIMP(å‡½æ•°æŒ‡é’ˆ)</h3>

<pre><code class="language-objc">/// A pointer to the function of a method implementation. 
#if !OBJC_OLD_DISPATCH_PROTOTYPES
typedef void (*IMP)(void /* id, SEL, ... */ ); 
#else
typedef id (*IMP)(id, SEL, ...); 
#endif
</code></pre>

<p>å½“å‰ç‰ˆæœ¬Xcodeå¦‚æœä½¿ç”¨IMPçš„è¯,é»˜è®¤æ˜¯é€‰æ‹©ç¬¬ä¸€ä¸ªä¹Ÿå°±æ˜¯æ— å‚æ— è¿”å›å€¼.å¦‚æœéœ€è¦å‚æ•°æœ‰è¿”å›å€¼çš„è¯,éœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶.å¦‚ä¸‹:</p>

<h2 id="toc_6">æ–¹æ³•äº¤æ¢(Method Swizzling:ä¼ è¯´ä¸­çš„é»‘é­”æ³•)</h2>

<p>ä¸€èˆ¬ä½¿ç”¨æ–¹æ³•äº¤æ¢éƒ½æ˜¯æƒ³ç»™ç³»ç»Ÿæä¾›çš„æ–¹æ³•æ·»åŠ ä¸€äº›å…¶ä»–çš„åŠŸèƒ½çš„æ—¶å€™ä½¿ç”¨.newä¸­ä½¿ç”¨æ–¹æ³•äº¤æ¢çš„ä¾‹å­:</p>

<pre><code class="language-objc">#import &quot;UIActionSheet+Front.h&quot;

#import &lt;objc/runtime.h&gt;

@implementation UIActionSheet (Front)
- (void)customShowInView:(UIView *)view{
    for(UIWindow * tmpWin in [[UIApplication sharedApplication] windows]){
        [tmpWin endEditing:NO];
    }
    [self customShowInView:view];
}
+ (void)load{
    swizzleAllActionSheet();
}
@end

void swizzleAllActionSheet(){
    Class c = [UIActionSheet class];
    SEL origSEL = @selector(showInView:);
    SEL newSEL = @selector(customShowInView:);
    Method origMethod = class_getInstanceMethod(c, origSEL);
    Method newMethod = class_getInstanceMethod(c, newSEL);
    method_exchangeImplementations(origMethod, newMethod);
}
</code></pre>

<p>å…³äºæ–¹æ³•äº¤æ¢,åœ¨newé¡¹ç›®ä¸­å·²ç»å°è£…å¥½äº†,ä»£ç å¦‚ä¸‹:</p>

<pre><code class="language-objc">// ObjcRuntime.hæ–‡ä»¶
void Swizzle(Class c, SEL origSEL, SEL newSEL);

//ObjcRuntime.mæ–‡ä»¶
//é™æ€å°±äº¤æ¢é™æ€ï¼Œå®ä¾‹æ–¹æ³•å°±äº¤æ¢å®ä¾‹æ–¹æ³•
void Swizzle(Class c, SEL origSEL, SEL newSEL)
{
    Method origMethod = class_getInstanceMethod(c, origSEL);
    Method newMethod = nil;
    if (!origMethod) {
        origMethod = class_getClassMethod(c, origSEL);
        if (!origMethod) {
            return;
        }
        newMethod = class_getClassMethod(c, newSEL);
        if (!newMethod) {
            return;
        }
    }else{
        newMethod = class_getInstanceMethod(c, newSEL);
        if (!newMethod) {
            return;
        }
    }
    
    //è‡ªèº«å·²ç»æœ‰äº†å°±æ·»åŠ ä¸æˆåŠŸï¼Œç›´æ¥äº¤æ¢å³å¯
    if(class_addMethod(c, origSEL, method_getImplementation(newMethod), method_getTypeEncoding(newMethod))){
        class_replaceMethod(c, newSEL, method_getImplementation(origMethod), method_getTypeEncoding(origMethod));
    }else{
        method_exchangeImplementations(origMethod, newMethod);
    }
}
</code></pre>

<p>ç”¨æ³•(è¿˜æ˜¯ä»¥Studentä¸ºä¾‹):<br/>
Studentä¸­æ·»åŠ ä¸¤ä¸ªå¯¹è±¡æ–¹æ³•,ä¸€ä¸ªrun,ä¸€ä¸ªsleep.æˆ‘ä»¬çš„ç›®çš„æ˜¯äº¤æ¢ä¸¤ä¸ªæ–¹æ³•çš„å®ç°</p>

<pre><code class="language-objc">-(void)run {
    NSLog(@&quot;è·‘ğŸƒ&quot;);
}
-(void)sleep {
    NSLog(@&quot;ç¡è§‰ğŸ˜´&quot;);
}
+(void)load {
    Swizzle(self, @selector(run), @selector(sleep));
}
</code></pre>

<p>æ§åˆ¶å™¨è°ƒç”¨çš„ç»“æœ:<br/>
<img src="media/14727863232294/14730042652865.jpg" alt=""/></p>

<h2 id="toc_7">æ·»åŠ å±æ€§</h2>

<p>åŠ¨æ€æ·»åŠ å±æ€§ç”¨çš„æœ€å¤šçš„åœ°æ–¹åº”è¯¥æ˜¯ç»™åˆ†ç±»æ·»åŠ å±æ€§.  <del>æˆ‘åœ¨é¡¹ç›®ä¸­æ·»åŠ è¿‡ä¸€ä¸ªåˆ†ç±»<code>UIView+Tap</code>è¿™ä¸ªä¹Ÿå¯ä»¥åœ¨è¿™é‡ŒæŸ¥çœ‹<a href="https://github.com/Mekor/UIView-Tap">UIView-Tap</a></del>  æˆ‘æŠŠä¸€äº›æ‰©å±•è¿›è¡Œäº†æ€»ç»“,è¿˜ä¸å®Œå–„,åœ°å€<a href="https://github.com/Mekor/MKExtension">MKExtension</a></p>

<pre><code class="language-objc">#import &quot;UIView+Tap.h&quot;
#import &lt;objc/runtime.h&gt;

static const void* tagValue = &amp;tagValue;

@interface UIView ()
@property (nonatomic, copy) void(^tapAction)(id);
@end

@implementation UIView (Tap)
- (void)tap{
    if (self.tapAction) {
        self.tapAction(self);
    }
}
- (void)addTapBlock:(void(^)(id obj))tapAction{
    self.tapAction = tapAction;
    if (![self gestureRecognizers]) {
        self.userInteractionEnabled = YES;
        UITapGestureRecognizer *tap = [[UITapGestureRecognizer alloc] initWithTarget:self action:@selector(tap)];
        [self addGestureRecognizer:tap];
    }
}

-(void)setTapAction:(void (^)(id))tapAction {
    objc_setAssociatedObject(self, tagValue, tapAction, OBJC_ASSOCIATION_COPY_NONATOMIC);
}
-(void (^)(id))tapAction {
    return objc_getAssociatedObject(self, tagValue);
}
@end
</code></pre>

<p>ä¸»è¦æ˜¯set&amp;getæ–¹æ³•,è¿™ç‚¹æ³¨æ„äº†ä¹Ÿå°±æ²¡å•¥äº†..</p>

<h2 id="toc_8">å…¶ä»–</h2>

<ol>
<li>ç³»ç»Ÿä¸­å¸¸è§çš„ä½¿ç”¨åˆ°runtimeçš„åœ°æ–¹:
<a href="http://www.citynight.cn/Blog/14726525723684.html">KVOå†…éƒ¨å®ç°åŸç†</a></li>
<li>æ—¥å¸¸å¼€å‘ä¸­ä½¿ç”¨åˆ°runtimeçš„åœ°æ–¹:</li>
<li>å­—å…¸è½¬æ¨¡å‹: å¯ä»¥å‚çœ‹<code>MJExtension</code> å®ƒçš„æ ¸å¿ƒä»£ç åœ¨:<code>NSObject+MJProperty.m</code>ç¬¬150è¡Œå¼€å§‹</li>
</ol>

<pre><code class="language-objc">#pragma mark - å…¬å…±æ–¹æ³•
+ (NSMutableArray *)properties
{
    NSMutableArray *cachedProperties = [self dictForKey:&amp;MJCachedPropertiesKey][NSStringFromClass(self)];
    
    if (cachedProperties == nil) {
        cachedProperties = [NSMutableArray array];
        
        [self mj_enumerateClasses:^(__unsafe_unretained Class c, BOOL *stop) {
            // 1.è·å¾—æ‰€æœ‰çš„æˆå‘˜å˜é‡
            unsigned int outCount = 0;
            objc_property_t *properties = class_copyPropertyList(c, &amp;outCount);
            
            // 2.éå†æ¯ä¸€ä¸ªæˆå‘˜å˜é‡
            for (unsigned int i = 0; i&lt;outCount; i++) {
                MJProperty *property = [MJProperty cachedPropertyWithProperty:properties[i]];
                // è¿‡æ»¤æ‰Foundationæ¡†æ¶ç±»é‡Œé¢çš„å±æ€§
                if ([MJFoundation isClassFromFoundation:property.srcClass]) continue;
                property.srcClass = c;
                [property setOriginKey:[self propertyKey:property.name] forClass:self];
                [property setObjectClassInArray:[self propertyObjectClassInArray:property.name] forClass:self];
                [cachedProperties addObject:property];
            }
            
            // 3.é‡Šæ”¾å†…å­˜
            free(properties);
        }];
        
        [self dictForKey:&amp;MJCachedPropertiesKey][NSStringFromClass(self)] = cachedProperties;
    }
    
    return cachedProperties;
}
</code></pre>

<p>è‡ªå®šä¹‰å­—å…¸è½¬æ¨¡å‹ä¸­logçš„è¾“å‡ºå¯ä»¥å‚è§Xcodeæ’ä»¶<code>ESJsonFormat</code>ä¸­<code>ESJsonFormatManager.m</code>ç¬¬47è¡Œ:</p>

<pre><code class="language-objc">/**
 *  æ ¼å¼åŒ–OCå±æ€§å­—ç¬¦ä¸²
 *
 *  @param key       JSONé‡Œé¢keyå­—æ®µ
 *  @param value     JSONé‡Œé¢keyå¯¹åº”çš„NSDictionæˆ–è€…NSArray
 *  @param classInfo ç±»ä¿¡æ¯
 *
 *  @return
 */
+ (NSString *)formatObjcWithKey:(NSString *)key value:(NSObject *)value classInfo:(ESClassInfo *)classInfo{
    NSString *qualifierStr = @&quot;copy&quot;;
    NSString *typeStr = @&quot;NSString&quot;;
    //åˆ¤æ–­å¤§å°å†™
    if ([ESUppercaseKeyWords containsObject:key] &amp;&amp; [ESJsonFormatSetting defaultSetting].uppercaseKeyWordForId) {
        key = [key uppercaseString];
    }
    if ([value isKindOfClass:[NSString class]]) {
        return [NSString stringWithFormat:@&quot;@property (nonatomic, %@) %@ *%@;&quot;,qualifierStr,typeStr,key];
    }else if([value isKindOfClass:[@(YES) class]]){
        //the &#39;NSCFBoolean&#39; is private subclass of &#39;NSNumber&#39;
        qualifierStr = @&quot;assign&quot;;
        typeStr = @&quot;BOOL&quot;;
        return [NSString stringWithFormat:@&quot;@property (nonatomic, %@) %@ %@;&quot;,qualifierStr,typeStr,key];
    }else if([value isKindOfClass:[NSNumber class]]){
        qualifierStr = @&quot;assign&quot;;
        NSString *valueStr = [NSString stringWithFormat:@&quot;%@&quot;,value];
        if ([valueStr rangeOfString:@&quot;.&quot;].location!=NSNotFound){
            typeStr = @&quot;CGFloat&quot;;
        }else{
            NSNumber *valueNumber = (NSNumber *)value;
            if ([valueNumber longValue]&lt;2147483648) {
                typeStr = @&quot;NSInteger&quot;;
            }else{
                typeStr = @&quot;long long&quot;;
            }
        }
        return [NSString stringWithFormat:@&quot;@property (nonatomic, %@) %@ %@;&quot;,qualifierStr,typeStr,key];
    }else if([value isKindOfClass:[NSArray class]]){
        NSArray *array = (NSArray *)value;
        
        //May be &#39;NSString&#39;ï¼Œwill crash
        NSString *genericTypeStr = @&quot;&quot;;
        NSObject *firstObj = [array firstObject];
        if ([firstObj isKindOfClass:[NSDictionary class]]) {
            ESClassInfo *childInfo = classInfo.propertyArrayDic[key];
            genericTypeStr = [NSString stringWithFormat:@&quot;&lt;%@ *&gt;&quot;,childInfo.className];
        }else if ([firstObj isKindOfClass:[NSString class]]){
            genericTypeStr = @&quot;&lt;NSString *&gt;&quot;;
        }else if ([firstObj isKindOfClass:[NSNumber class]]){
            genericTypeStr = @&quot;&lt;NSNumber *&gt;&quot;;
        }
        
        qualifierStr = @&quot;strong&quot;;
        typeStr = @&quot;NSArray&quot;;
        if ([ESJsonFormatSetting defaultSetting].useGeneric &amp;&amp; [ESUtils isXcode7AndLater]) {
            return [NSString stringWithFormat:@&quot;@property (nonatomic, %@) %@%@ *%@;&quot;,qualifierStr,typeStr,genericTypeStr,key];
        }
        return [NSString stringWithFormat:@&quot;@property (nonatomic, %@) %@ *%@;&quot;,qualifierStr,typeStr,key];
    }else if ([value isKindOfClass:[NSDictionary class]]){
        qualifierStr = @&quot;strong&quot;;
        ESClassInfo *childInfo = classInfo.propertyClassDic[key];
        typeStr = childInfo.className;
        if (!typeStr) {
            typeStr = [key capitalizedString];
        }
        return [NSString stringWithFormat:@&quot;@property (nonatomic, %@) %@ *%@;&quot;,qualifierStr,typeStr,key];
    }
    return [NSString stringWithFormat:@&quot;@property (nonatomic, %@) %@ *%@;&quot;,qualifierStr,typeStr,key];
}

</code></pre>

		</div>
	</article>
	<div class="share-comment">
	 

	  

	  

	</div>
</div>        </div>
			<footer id="footer" class="inner">Copyright &copy; 2014
Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a> &nbsp;&nbsp; 
Theme by <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a>
      </footer>
		</div>
	</div>

  
    



</body>
</html>