
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>
    
  åŸç†æ¢ç©¶ - æå°äº‰
  

  </title>
  <meta name="author" content="">
  <meta name="description" content="è®°å½•å¼€å‘ä¸­é‡åˆ°çš„ä¸€äº›é—®é¢˜">

  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link href="asset/css/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="atom.xml" rel="alternate" title="æå°äº‰" type="application/atom+xml">
  <script src="asset/js/modernizr-2.0.js"></script>
  <script src="asset/js/jquery.min.js"></script>
  <style type="text/css">
  .cat-children-p{ padding: 6px 0px;}
  .hljs{background: none;}
  </style>
  <script type="text/javascript">
  var isAddSildbar = true;
  </script>
  <script src="asset/js/octopress.js" type="text/javascript"></script>
</head>
<script type="text/javascript">
//é“¾æ¥æ–°å¼€çª—å£
function addBlankTargetForLinks () {
  $('a[href^="http"]').each(function(){
      $(this).attr('target', '_blank');
  });
}
$(document).ready(function(event) {
  addBlankTargetForLinks();
});
</script>
<body   >
  <header role="banner"><hgroup>
  <h1><a href="index.html">æå°äº‰</a></h1>
  
    <h2>è®°å½•å¼€å‘ä¸­é‡åˆ°çš„ä¸€äº›é—®é¢˜</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:www.citynight.cn/blog" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">

  <li id=""><a target="self" href="index.html">Home</a></li>

  <li id=""><a target="_self" href="archives.html">Archives</a></li>

</ul>

</nav>
  <div id="main">
    <div id="content"> 
<div class="blog-index">

	<article>
		 <header>
		  	<h1 class="entry-title"><a href="14727863232294.html">runtime(å†…éƒ¨åˆ†äº«è‰ç¨¿)</a></h1>
			<p class="meta"><time datetime="2016-09-02T11:18:43+08:00" 
			pubdate data-updated="true">2016/9/2</time></p>
		 </header>
	  	<div class="entry-content">
		  	
		  	<blockquote>
<p>æœ¬æ–‡æ¶‰åŠåˆ°çš„Demoåœ°å€ <a href="https://github.com/Mekor/runtimeDemo">https://github.com/Mekor/runtimeDemo</a></p>
</blockquote>
<p>##ç†è§£self,super,class,superclass</p>
<p>åˆ›å»ºä¸€ä¸ªPersoné‡Œé¢æœ‰ä¸€ä¸ªç±»æ–¹æ³•:</p>
<pre><code class="language-objc">#import &quot;Person.h&quot;

@implementation Person
+(void)study {
    NSLog(@&quot;%@ %@ %@ %@&quot;,[self class],[self superclass],[super class],[super superclass]);
}
@end
</code></pre>
<p>Studentç»§æ‰¿è‡ªPerson,é‡å†™çˆ¶ç±»æ–¹æ³•</p>
<pre><code class="language-objc">#import &quot;Student.h&quot;

@implementation Student
+(void)study {
    NSLog(@&quot;%@ %@ %@ %@&quot;,[self class],[self superclass],[super class],[super superclass]);
}
@end
</code></pre>
<!--more-->
<p>è¿™ä¸¤ä¸ªè¾“å‡ºçš„éƒ½æ˜¯ä»€ä¹ˆ?<br />
<img src="media/14727863232294/14729913552743.jpg" alt="" /></p>
<p>è¿™æ—¶,æˆ‘ä»¬åœ¨Studentä¸­ç”¨è¿™æ ·å†™:</p>
<pre><code class="language-objc">#import &quot;Student.h&quot;

@implementation Student
+(void)study {
//    NSLog(@&quot;%@ %@ %@ %@&quot;,[self class],[self superclass],[super class],[super superclass]);
    
    [super study];
}
@end
</code></pre>
<p>æ‰“æ–­ç‚¹æˆ‘ä»¬å¯ä»¥çœ‹åˆ°:<br />
<img src="media/14727863232294/14729934417192.jpg" alt="" /></p>
<p>å¯ä»¥çœ‹å‡º:</p>
<pre><code class="language-objc">superï¼šæ˜¯ç¼–è¯‘å™¨æŒ‡ç¤ºç¬¦ï¼Œä»…ä»…æ˜¯ä¸€ä¸ªæ ‡å¿—,å¹¶ä¸æ˜¯æŒ‡é’ˆï¼Œä»…ä»…æ˜¯æ ‡å¿—çš„å½“å‰å¯¹è±¡å»è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•ï¼Œæœ¬è´¨è¿˜æ˜¯å½“å‰å¯¹è±¡è°ƒç”¨
super:å¹¶ä¸æ˜¯è®©çˆ¶ç±»å¯¹è±¡è°ƒç”¨æ–¹æ³•ï¼Œè°ƒç”¨è€…è¿˜æ˜¯æœ¬èº«
classï¼šè·å–æ–¹æ³•è°ƒç”¨è€…çš„ç±»
superclass:è·å–æ–¹æ³•è°ƒç”¨è€…çš„çˆ¶ç±»
</code></pre>
<p>æ¶ˆæ¯æœºåˆ¶:(æ¥è‡ª:<a href="https://developer.apple.com/library/prerelease/content/documentation/Cocoa/Conceptual/ObjCRuntimeGuide/Articles/ocrtHowMessagingWorks.html">å®˜æ–¹æ–‡æ¡£</a>)<br />
<img src="media/14727863232294/messaging1.gif" alt="æ¶ˆæ¯æ¡†æ¶" /></p>
<p>å½“å¯¹è±¡æ”¶åˆ°æ¶ˆæ¯æ—¶,æ¶ˆæ¯å‡½æ•°é¦–å…ˆæ ¹æ®è¯¥å¯¹è±¡çš„ isa æŒ‡é’ˆæ‰¾åˆ°è¯¥å¯¹è±¡æ‰€å¯¹åº”çš„ç±»çš„æ–¹æ³•è¡¨,å¹¶ä»è¡¨ä¸­å¯»æ‰¾ è¯¥æ¶ˆæ¯å¯¹åº”çš„æ–¹æ³•é€‰æ ‡ã€‚å¦‚æœæ‰¾ä¸åˆ°,objc_msgSend å°†ç»§ç»­ä»çˆ¶ç±»ä¸­å¯»æ‰¾,ç›´åˆ° NSObject ç±»ã€‚ä¸€æ—¦æ‰¾åˆ°äº†æ–¹æ³•é€‰æ ‡, objc_msgSend åˆ™ä»¥æ¶ˆæ¯æ¥æ”¶è€…å¯¹è±¡ä¸ºå‚æ•°è°ƒç”¨,è°ƒç”¨è¯¥é€‰æ ‡å¯¹åº”çš„æ–¹æ³•å®ç°ã€‚</p>
<p>##selfæ˜¯ä»å“ªé‡Œæ¥çš„?</p>
<blockquote>
<p>å®˜æ–¹è§£é‡Š:<a href="https://developer.apple.com/library/prerelease/content/documentation/Cocoa/Conceptual/ObjCRuntimeGuide/Articles/ocrtHowMessagingWorks.html">Objective-C Runtime Programming Guide</a><img src="media/14727863232294/14729941396965.jpg" alt="" /></p>
</blockquote>
<p>ç®€å•è¯´æ¯ä¸ªæ–¹æ³•éƒ½å­˜åœ¨å¹¶ä¸”éšè—çš„ä¸¤ä¸ªå‚æ•°(self,_cmd),éšä¾¿å†™ä¸ªæ–¹æ³•çœ‹ä¸‹:<br />
Studentä¸­å†™ä¸ªtextæ–¹æ³•,ç„¶åæ‰“å°ä¸‹è¿™ä¸¤ä¸ªéšè—å‚æ•°.<br />
<img src="media/14727863232294/14729960900273.jpg" alt="" /><br />
<img src="media/14727863232294/14729961142923.jpg" alt="" /></p>
<p>##åŠ¨æ€æ·»åŠ æ–¹æ³•<br />
ä¸Šé¢è¯´äº†ä¸€äº›è²Œä¼¼å’Œruntimeæ²¡æœ‰ä»€ä¹ˆå…³ç³»,runtimeåŸºç¡€çŸ¥è¯†ç±»ä¼¼ç±»çš„æ„æˆ,å¯¹è±¡çš„æ„æˆè¿™é‡Œä¸å†ä»‹ç»,å¯ä»¥è‡ªå·±å»çœ‹å®šä¹‰.å½“ç„¶ä¹Ÿå¯ä»¥å»<a href="http://opensource.apple.com/source/objc4/objc4-680/runtime/">è‹¹æœçš„å¼€æºç½‘ç«™</a>æŸ¥çœ‹,å¦‚æœç½‘ç«™ä¸æ–¹ä¾¿å¯ä»¥å»è‹¹æœçš„<a href="https://github.com/opensource-apple/objc4">github</a>ä¸‹è½½å¼€æºä»£ç ç ”ç©¶...  ...ç»§ç»­...é‚£ä¹ˆæ ¹æ®ä¸Šé¢æ‰€è¯´çš„æ–¹æ³•è¯´ä¸‹åŠ¨æ€æ·»åŠ æ–¹æ³•.</p>
<blockquote>
<p>æ€è€ƒä¸€ä¸‹,å’±ä»¬newé¡¹ç›®ä¸­å°†é‡‡ç”¨è·¯ç”±æ¨¡å¼è¿›è¡Œé¡µé¢è·³è½¬,ä»ç½‘é¡µè·³è½¬è¿›å…¥appè°ƒç”¨ä¸€ä¸ªæ–¹æ³•,ä¸€èˆ¬æƒ…å†µä¸‹éƒ½æ˜¯ç§»åŠ¨ç«¯å’Œåå°åè®®å¥½çš„å†…å®¹,è¿™æ ·è·³è½¬ä¸ä¼šå‡ºç°é—®é¢˜.ä½†æ˜¯å¦‚æœåå°å†™é”™äº†æˆ–è€…ä¼ è¾“ä¸­å‡ºç°é—®é¢˜å¯¼è‡´urlä¸­åŒ…å«çš„æ–¹æ³•åä¸æ˜¯è§„å®šçš„æ–¹æ³•å.è¿™æ—¶æ€ä¹ˆåŠ?</p>
</blockquote>
<pre><code class="language-objc">    Student *s = [Student new];
    
    // 1. æ¯”å¦‚æˆ‘ä»¬è¦è°ƒç”¨ Studentä¸­çš„eatæ–¹æ³•, é»˜è®¤è¿™æ ·å†™[s eat]; ä½†æ˜¯ä¸è¡Œ,å› ä¸ºæˆ‘ä»¬æ²¡æœ‰å®šä¹‰.
//    [s eat];
    // 2. ä¹Ÿå¯ä»¥è¿™æ ·è°ƒç”¨[s performSelector:@selector(eat)];è¿™æ ·æ²¡æœ‰é—®é¢˜,@selectorä¸­å‚æ•°æ˜¯å­—ç¬¦ä¸²,è¿™ä¸ªå‚è€ƒswift
//    [s performSelector:@selector(eat)];
    // 3. ä½¿ç”¨stringåˆ›å»ºSEL
    
#pragma clang diagnostic push
#pragma clang diagnostic ignored&quot;-Warc-performSelector-leaks&quot;
    [s performSelector:NSSelectorFromString(@&quot;eat&quot;)];
#pragma clang diagnostic pop
    
    // ä¸Šé¢è¿™æ ·è°ƒç”¨ä¼šæŠ¥é”™,æˆ‘ä»¬åœ¨å¯¹è±¡è°ƒç”¨æœªå®ç°æ–¹æ³•çš„æ—¶å€™åŠ¨æ€çš„åˆ›å»ºä¸€ä¸ªæ–¹æ³•,é¿å…æŠ›å‡ºå¼‚å¸¸.
</code></pre>
<p>æ€ä¹ˆå¿½ç•¥ç¼–è¯‘å™¨è­¦å‘Šå·²ç»åˆ†äº«è¿‡,å¯ä»¥å‚è€ƒ:<a href="http://www.citynight.cn/Blog/14676105703423.html">http://www.citynight.cn/Blog/14676105703423.html</a></p>
<p>###æ€ä¹ˆåŠ¨æ€æ·»åŠ æ–¹æ³•å‘¢?<br />
<img src="media/14727863232294/14729983827897.jpg" alt="" /><br />
ä¸Šé¢æ˜¯åŠ¨æ€æ·»åŠ å¯¹è±¡æ–¹æ³•çš„ä¾‹å­,åŠ¨æ€æ·»åŠ ç±»æ–¹æ³•ä¹Ÿæ˜¯ä¸€æ ·çš„<code>+(BOOL)resolveClassMethod:(SEL)sel</code><br />
**æ³¨æ„:**ä¸Šé¢å‡½æ•°ç±»å‹,æœ‰äººå¯èƒ½å¥½å¥‡è¿™å—ä¸ºä»€ä¹ˆå†™æˆ&quot;v@:&quot;  ?å‚è§:å‡½æ•°ç±»å‹, æ›´å¤šå…³äºè½¬å‘æœºåˆ¶å‚è§:<a href="http://www.citynight.cn/Blog/14733118707964.html">è½¬å‘æœºåˆ¶</a></p>
<h3><a id="%E5%85%B3%E4%BA%8E%E5%87%BD%E6%95%B0%E7%B1%BB%E5%9E%8B" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>å…³äºå‡½æ•°ç±»å‹</h3>
<p>å…ˆçœ‹æ–‡æ¡£:<br />
<img src="media/14727863232294/14730056768742.jpg" alt="" /><br />
æŸ¥çœ‹<code>Objective-C type encodings</code> <img src="media/14727863232294/14730058881001.jpg" alt="" /><br />
æ‰€ä»¥ä¸Šé¢void eat(...)åº”è¯¥è¡¨è¿°æˆ <code>&quot;v@:&quot;</code></p>
<p><strong>è¡¥å……:</strong> åŠ¨æ€è°ƒç”¨æ–¹æ³•ç³»ç»Ÿé»˜è®¤æä¾›ä¸€åˆ°ä¸¤ä¸ªå‚æ•°çš„æ–¹æ³•è°ƒç”¨, <del>è¿™é‡Œå°è£…äº†ä¸€ä¸ªæ— é™å‚æ•°çš„æ–¹æ³•è°ƒç”¨.<a href="https://github.com/Mekor/NSObject-SEL">NSObject-SEL****</a></del>  æˆ‘æŠŠä¸€äº›æ‰©å±•è¿›è¡Œäº†æ€»ç»“,è¿˜ä¸å®Œå–„,åœ°å€<a href="https://github.com/Mekor/MKExtension">MKExtension</a></p>
<p>###å…³äºIMP(å‡½æ•°æŒ‡é’ˆ)</p>
<pre><code class="language-objc">/// A pointer to the function of a method implementation. 
#if !OBJC_OLD_DISPATCH_PROTOTYPES
typedef void (*IMP)(void /* id, SEL, ... */ ); 
#else
typedef id (*IMP)(id, SEL, ...); 
#endif
</code></pre>
<p>å½“å‰ç‰ˆæœ¬Xcodeå¦‚æœä½¿ç”¨IMPçš„è¯,é»˜è®¤æ˜¯é€‰æ‹©ç¬¬ä¸€ä¸ªä¹Ÿå°±æ˜¯æ— å‚æ— è¿”å›å€¼.å¦‚æœéœ€è¦å‚æ•°æœ‰è¿”å›å€¼çš„è¯,éœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶.å¦‚ä¸‹:</p>
<h2><a id="%E6%96%B9%E6%B3%95%E4%BA%A4%E6%8D%A2method-swizzling%E4%BC%A0%E8%AF%B4%E4%B8%AD%E7%9A%84%E9%BB%91%E9%AD%94%E6%B3%95" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>æ–¹æ³•äº¤æ¢(Method Swizzling:ä¼ è¯´ä¸­çš„é»‘é­”æ³•)</h2>
<p>ä¸€èˆ¬ä½¿ç”¨æ–¹æ³•äº¤æ¢éƒ½æ˜¯æƒ³ç»™ç³»ç»Ÿæä¾›çš„æ–¹æ³•æ·»åŠ ä¸€äº›å…¶ä»–çš„åŠŸèƒ½çš„æ—¶å€™ä½¿ç”¨.newä¸­ä½¿ç”¨æ–¹æ³•äº¤æ¢çš„ä¾‹å­:</p>
<pre><code class="language-objc">#import &quot;UIActionSheet+Front.h&quot;

#import &lt;objc/runtime.h&gt;

@implementation UIActionSheet (Front)
- (void)customShowInView:(UIView *)view{
    for(UIWindow * tmpWin in [[UIApplication sharedApplication] windows]){
        [tmpWin endEditing:NO];
    }
    [self customShowInView:view];
}
+ (void)load{
    swizzleAllActionSheet();
}
@end

void swizzleAllActionSheet(){
    Class c = [UIActionSheet class];
    SEL origSEL = @selector(showInView:);
    SEL newSEL = @selector(customShowInView:);
    Method origMethod = class_getInstanceMethod(c, origSEL);
    Method newMethod = class_getInstanceMethod(c, newSEL);
    method_exchangeImplementations(origMethod, newMethod);
}
</code></pre>
<p>å…³äºæ–¹æ³•äº¤æ¢,åœ¨newé¡¹ç›®ä¸­å·²ç»å°è£…å¥½äº†,ä»£ç å¦‚ä¸‹:</p>
<pre><code class="language-objc">// ObjcRuntime.hæ–‡ä»¶
void Swizzle(Class c, SEL origSEL, SEL newSEL);

//ObjcRuntime.mæ–‡ä»¶
//é™æ€å°±äº¤æ¢é™æ€ï¼Œå®ä¾‹æ–¹æ³•å°±äº¤æ¢å®ä¾‹æ–¹æ³•
void Swizzle(Class c, SEL origSEL, SEL newSEL)
{
    Method origMethod = class_getInstanceMethod(c, origSEL);
    Method newMethod = nil;
    if (!origMethod) {
        origMethod = class_getClassMethod(c, origSEL);
        if (!origMethod) {
            return;
        }
        newMethod = class_getClassMethod(c, newSEL);
        if (!newMethod) {
            return;
        }
    }else{
        newMethod = class_getInstanceMethod(c, newSEL);
        if (!newMethod) {
            return;
        }
    }
    
    //è‡ªèº«å·²ç»æœ‰äº†å°±æ·»åŠ ä¸æˆåŠŸï¼Œç›´æ¥äº¤æ¢å³å¯
    if(class_addMethod(c, origSEL, method_getImplementation(newMethod), method_getTypeEncoding(newMethod))){
        class_replaceMethod(c, newSEL, method_getImplementation(origMethod), method_getTypeEncoding(origMethod));
    }else{
        method_exchangeImplementations(origMethod, newMethod);
    }
}
</code></pre>
<p>ç”¨æ³•(è¿˜æ˜¯ä»¥Studentä¸ºä¾‹):<br />
Studentä¸­æ·»åŠ ä¸¤ä¸ªå¯¹è±¡æ–¹æ³•,ä¸€ä¸ªrun,ä¸€ä¸ªsleep.æˆ‘ä»¬çš„ç›®çš„æ˜¯äº¤æ¢ä¸¤ä¸ªæ–¹æ³•çš„å®ç°</p>
<pre><code class="language-objc">-(void)run {
    NSLog(@&quot;è·‘ğŸƒ&quot;);
}
-(void)sleep {
    NSLog(@&quot;ç¡è§‰ğŸ˜´&quot;);
}
+(void)load {
    Swizzle(self, @selector(run), @selector(sleep));
}
</code></pre>
<p>æ§åˆ¶å™¨è°ƒç”¨çš„ç»“æœ:<br />
<img src="media/14727863232294/14730042652865.jpg" alt="" /></p>
<p>##æ·»åŠ å±æ€§<br />
åŠ¨æ€æ·»åŠ å±æ€§ç”¨çš„æœ€å¤šçš„åœ°æ–¹åº”è¯¥æ˜¯ç»™åˆ†ç±»æ·»åŠ å±æ€§.  <del>æˆ‘åœ¨é¡¹ç›®ä¸­æ·»åŠ è¿‡ä¸€ä¸ªåˆ†ç±»<code> UIView+Tap</code>è¿™ä¸ªä¹Ÿå¯ä»¥åœ¨è¿™é‡ŒæŸ¥çœ‹<a href="https://github.com/Mekor/UIView-Tap">UIView-Tap</a></del>  æˆ‘æŠŠä¸€äº›æ‰©å±•è¿›è¡Œäº†æ€»ç»“,è¿˜ä¸å®Œå–„,åœ°å€<a href="https://github.com/Mekor/MKExtension">MKExtension</a></p>
<pre><code class="language-objc">#import &quot;UIView+Tap.h&quot;
#import &lt;objc/runtime.h&gt;

static const void* tagValue = &amp;tagValue;

@interface UIView ()
@property (nonatomic, copy) void(^tapAction)(id);
@end

@implementation UIView (Tap)
- (void)tap{
    if (self.tapAction) {
        self.tapAction(self);
    }
}
- (void)addTapBlock:(void(^)(id obj))tapAction{
    self.tapAction = tapAction;
    if (![self gestureRecognizers]) {
        self.userInteractionEnabled = YES;
        UITapGestureRecognizer *tap = [[UITapGestureRecognizer alloc] initWithTarget:self action:@selector(tap)];
        [self addGestureRecognizer:tap];
    }
}

-(void)setTapAction:(void (^)(id))tapAction {
    objc_setAssociatedObject(self, tagValue, tapAction, OBJC_ASSOCIATION_COPY_NONATOMIC);
}
-(void (^)(id))tapAction {
    return objc_getAssociatedObject(self, tagValue);
}
@end
</code></pre>
<p>ä¸»è¦æ˜¯set&amp;getæ–¹æ³•,è¿™ç‚¹æ³¨æ„äº†ä¹Ÿå°±æ²¡å•¥äº†..</p>
<p>##å…¶ä»–</p>
<ol>
<li>ç³»ç»Ÿä¸­å¸¸è§çš„ä½¿ç”¨åˆ°runtimeçš„åœ°æ–¹:<br />
<a href="http://www.citynight.cn/Blog/14726525723684.html">KVOå†…éƒ¨å®ç°åŸç†</a></li>
<li>æ—¥å¸¸å¼€å‘ä¸­ä½¿ç”¨åˆ°runtimeçš„åœ°æ–¹:</li>
</ol>
<ul>
<li>å­—å…¸è½¬æ¨¡å‹: å¯ä»¥å‚çœ‹<code>MJExtension</code> å®ƒçš„æ ¸å¿ƒä»£ç åœ¨:<code>NSObject+MJProperty.m</code>ç¬¬150è¡Œå¼€å§‹</li>
</ul>
<pre><code class="language-objc">#pragma mark - å…¬å…±æ–¹æ³•
+ (NSMutableArray *)properties
{
    NSMutableArray *cachedProperties = [self dictForKey:&amp;MJCachedPropertiesKey][NSStringFromClass(self)];
    
    if (cachedProperties == nil) {
        cachedProperties = [NSMutableArray array];
        
        [self mj_enumerateClasses:^(__unsafe_unretained Class c, BOOL *stop) {
            // 1.è·å¾—æ‰€æœ‰çš„æˆå‘˜å˜é‡
            unsigned int outCount = 0;
            objc_property_t *properties = class_copyPropertyList(c, &amp;outCount);
            
            // 2.éå†æ¯ä¸€ä¸ªæˆå‘˜å˜é‡
            for (unsigned int i = 0; i&lt;outCount; i++) {
                MJProperty *property = [MJProperty cachedPropertyWithProperty:properties[i]];
                // è¿‡æ»¤æ‰Foundationæ¡†æ¶ç±»é‡Œé¢çš„å±æ€§
                if ([MJFoundation isClassFromFoundation:property.srcClass]) continue;
                property.srcClass = c;
                [property setOriginKey:[self propertyKey:property.name] forClass:self];
                [property setObjectClassInArray:[self propertyObjectClassInArray:property.name] forClass:self];
                [cachedProperties addObject:property];
            }
            
            // 3.é‡Šæ”¾å†…å­˜
            free(properties);
        }];
        
        [self dictForKey:&amp;MJCachedPropertiesKey][NSStringFromClass(self)] = cachedProperties;
    }
    
    return cachedProperties;
}
</code></pre>
<p>è‡ªå®šä¹‰å­—å…¸è½¬æ¨¡å‹ä¸­logçš„è¾“å‡ºå¯ä»¥å‚è§Xcodeæ’ä»¶<code>ESJsonFormat</code>ä¸­<code>ESJsonFormatManager.m</code>ç¬¬47è¡Œ:</p>
<pre><code class="language-objc">/**
 *  æ ¼å¼åŒ–OCå±æ€§å­—ç¬¦ä¸²
 *
 *  @param key       JSONé‡Œé¢keyå­—æ®µ
 *  @param value     JSONé‡Œé¢keyå¯¹åº”çš„NSDictionæˆ–è€…NSArray
 *  @param classInfo ç±»ä¿¡æ¯
 *
 *  @return
 */
+ (NSString *)formatObjcWithKey:(NSString *)key value:(NSObject *)value classInfo:(ESClassInfo *)classInfo{
    NSString *qualifierStr = @&quot;copy&quot;;
    NSString *typeStr = @&quot;NSString&quot;;
    //åˆ¤æ–­å¤§å°å†™
    if ([ESUppercaseKeyWords containsObject:key] &amp;&amp; [ESJsonFormatSetting defaultSetting].uppercaseKeyWordForId) {
        key = [key uppercaseString];
    }
    if ([value isKindOfClass:[NSString class]]) {
        return [NSString stringWithFormat:@&quot;@property (nonatomic, %@) %@ *%@;&quot;,qualifierStr,typeStr,key];
    }else if([value isKindOfClass:[@(YES) class]]){
        //the 'NSCFBoolean' is private subclass of 'NSNumber'
        qualifierStr = @&quot;assign&quot;;
        typeStr = @&quot;BOOL&quot;;
        return [NSString stringWithFormat:@&quot;@property (nonatomic, %@) %@ %@;&quot;,qualifierStr,typeStr,key];
    }else if([value isKindOfClass:[NSNumber class]]){
        qualifierStr = @&quot;assign&quot;;
        NSString *valueStr = [NSString stringWithFormat:@&quot;%@&quot;,value];
        if ([valueStr rangeOfString:@&quot;.&quot;].location!=NSNotFound){
            typeStr = @&quot;CGFloat&quot;;
        }else{
            NSNumber *valueNumber = (NSNumber *)value;
            if ([valueNumber longValue]&lt;2147483648) {
                typeStr = @&quot;NSInteger&quot;;
            }else{
                typeStr = @&quot;long long&quot;;
            }
        }
        return [NSString stringWithFormat:@&quot;@property (nonatomic, %@) %@ %@;&quot;,qualifierStr,typeStr,key];
    }else if([value isKindOfClass:[NSArray class]]){
        NSArray *array = (NSArray *)value;
        
        //May be 'NSString'ï¼Œwill crash
        NSString *genericTypeStr = @&quot;&quot;;
        NSObject *firstObj = [array firstObject];
        if ([firstObj isKindOfClass:[NSDictionary class]]) {
            ESClassInfo *childInfo = classInfo.propertyArrayDic[key];
            genericTypeStr = [NSString stringWithFormat:@&quot;&lt;%@ *&gt;&quot;,childInfo.className];
        }else if ([firstObj isKindOfClass:[NSString class]]){
            genericTypeStr = @&quot;&lt;NSString *&gt;&quot;;
        }else if ([firstObj isKindOfClass:[NSNumber class]]){
            genericTypeStr = @&quot;&lt;NSNumber *&gt;&quot;;
        }
        
        qualifierStr = @&quot;strong&quot;;
        typeStr = @&quot;NSArray&quot;;
        if ([ESJsonFormatSetting defaultSetting].useGeneric &amp;&amp; [ESUtils isXcode7AndLater]) {
            return [NSString stringWithFormat:@&quot;@property (nonatomic, %@) %@%@ *%@;&quot;,qualifierStr,typeStr,genericTypeStr,key];
        }
        return [NSString stringWithFormat:@&quot;@property (nonatomic, %@) %@ *%@;&quot;,qualifierStr,typeStr,key];
    }else if ([value isKindOfClass:[NSDictionary class]]){
        qualifierStr = @&quot;strong&quot;;
        ESClassInfo *childInfo = classInfo.propertyClassDic[key];
        typeStr = childInfo.className;
        if (!typeStr) {
            typeStr = [key capitalizedString];
        }
        return [NSString stringWithFormat:@&quot;@property (nonatomic, %@) %@ *%@;&quot;,qualifierStr,typeStr,key];
    }
    return [NSString stringWithFormat:@&quot;@property (nonatomic, %@) %@ *%@;&quot;,qualifierStr,typeStr,key];
}

</code></pre>


		</div>

		

	</article>
 
	<article>
		 <header>
		  	<h1 class="entry-title"><a href="14726525723684.html">KVOå†…éƒ¨å®ç°åŸç†</a></h1>
			<p class="meta"><time datetime="2016-08-31T22:09:32+08:00" 
			pubdate data-updated="true">2016/8/31</time></p>
		 </header>
	  	<div class="entry-content">
		  	
		  	<ol>
<li>KVOæ˜¯åŸºäºruntimeæœºåˆ¶å®ç°çš„</li>
<li>å½“æŸä¸ªç±»çš„å¯¹è±¡ç¬¬ä¸€æ¬¡è¢«è§‚å¯Ÿæ—¶,ç³»ç»Ÿå°±ä¼šåœ¨è¿è¡ŒæœŸåŠ¨æ€åœ°åˆ›å»ºè¯¥ç±»çš„ä¸€ä¸ªæ´¾ç”Ÿç±»,åœ¨è¿™ä¸ªæ´¾ç”Ÿç±»ä¸­é‡å†™åŸºç±»ä¸­ä»»ä½•è¢«è§‚å¯Ÿå±æ€§çš„setteræ–¹æ³•.æ´¾ç”Ÿç±»åœ¨è¢«é‡å†™çš„setteræ–¹æ³•å®ç°çœŸæ­£çš„é€šçŸ¥æœºåˆ¶.</li>
</ol>
<p>æ·»åŠ ç›‘å¬å‰:<br />
<img src="media/14726525723684/14726530320712.jpg" alt="" /></p>
<p>æ·»åŠ ç›‘å¬å:(æ´¾ç”Ÿå‡º:NSKVONotifying_Person)<br />
<img src="media/14726525723684/14726532061641.jpg" alt="" /></p>
<p>æŠŠå‰åä¸¤ä»½ä»£ç å…¨éƒ¨è½¬æ¢æˆcppæ–‡ä»¶,è¿™æ—¶æˆ‘ä»¬æŸ¥æ‰¾ä¸¤ä¸ªæ–‡ä»¶ä¸åŒçš„åœ°æ–¹.</p>
<p><img src="media/14726525723684/14726564797185.jpg" alt="" /></p>
<p>ç»è¿‡ç®€å•æ•´ç†çš„ä¸¤ä»½ä»£ç :<br />
<img src="media/14726525723684/14726568603743.jpg" alt="" /></p>
<p>å¯ä»¥çœ‹å‡ºmi_0 &amp; mi_1ä¹‹é—´å°±æ˜¯Person &amp; NSKVONotifying_Personä¹‹é—´çš„å…³ç³».</p>
<p>-------------------2018.1.20æ›´æ–°(è¯»&lt;ç¼–å†™é«˜è´¨é‡ä»£ç &gt;)--------------------<br />
KVC é€šè¿‡å®ç°åä¸ºNSKeyValueCodingçš„éæ­£å¼åè®®,ä½¿å¼€å‘è€…å¯ä»¥é€šè¿‡é”®ç›´æ¥è®¾ç½®å’Œè·å–å¯¹è±¡å±æ€§,è€Œä¸éœ€è¦è°ƒç”¨å¯¹è±¡çš„å­˜å–æ–¹æ³•(Cocoaä¸ºè¯¥åè®®æä¾›äº†é»˜è®¤çš„å®ç°).é”®é€šå¸¸å’Œè¢«è®¿é—®å¯¹è±¡ä¸­çš„å®ä¾‹å˜é‡æˆ–å­˜å–æ–¹æ³•çš„åç§°ç›¸å¯¹åº”.</p>
<p>KVCä¸»è¦åˆ©ç”¨ä¸€ç§ä½¿ç”¨å­—ç¬¦ä¸²æ ‡è¯†ç¬¦,ç®€ä»‹è®¿é—®å±æ€§çš„æœºåˆ¶,ä»–æ˜¯å¾ˆå¤šæŠ€æœ¯çš„åŸºç¡€.ä¸»è¦æœ‰<code>setValue: forKey</code>,<code>valueForKey</code>å’Œ<code>setValue: forKeyPath</code>,<code>valueForKeyPath</code></p>
<p>key ä¸keyPath åŸºæœ¬ä¸€æ ·,åªæ˜¯keyPathçš„å€¼æ˜¯ä¸€ä¸ªè·¯å¾„,è·¯å¾„ä¹‹é—´ç”¨<code>.</code>åˆ†å‰²,æ¯”å¦‚æ•°æ®æˆå‘˜å°±æ˜¯å¯¹è±¡è‡ªå·±,å¯»å€¼è¿‡ç¨‹å°±ä¼šå‘ä¸‹æ·±å…¥ä¸‹å».<img src="media/14726525723684/WechatIMG26.png" alt="WechatIMG26" /></p>


		</div>

		

	</article>
 
	<article>
		 <header>
		  	<h1 class="entry-title"><a href="14717809514175.html">runtimeå°ç»“</a></h1>
			<p class="meta"><time datetime="2016-08-21T20:02:31+08:00" 
			pubdate data-updated="true">2016/8/21</time></p>
		 </header>
	  	<div class="entry-content">
		  	
		  	<h3><a id="%E4%B8%80%E3%80%81runtime%E7%AE%80%E4%BB%8B" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>ä¸€ã€runtimeç®€ä»‹</h3>
<ul>
<li>runTimeç®€ç§°è¿è¡Œæ—¶ã€‚OCå°±æ˜¯<code>è¿è¡Œæ—¶æœºåˆ¶</code>ï¼Œä¹Ÿå°±æ˜¯åœ¨è¿è¡Œæ—¶å€™çš„ä¸€äº›æœºåˆ¶ï¼Œå…¶ä¸­æœ€ä¸»è¦çš„æ˜¯æ¶ˆæ¯æœºåˆ¶ã€‚</li>
<li>å¯¹äºCè¯­è¨€ï¼Œ<code>å‡½æ•°çš„è°ƒç”¨åœ¨ç¼–è¯‘çš„æ—¶å€™ä¼šå†³å®šè°ƒç”¨å“ªä¸ªå‡½æ•°</code>ã€‚</li>
<li>å¯¹äºOCçš„å‡½æ•°ï¼Œå±äº<code>åŠ¨æ€è°ƒç”¨è¿‡ç¨‹</code>ï¼Œåœ¨ç¼–è¯‘çš„æ—¶å€™å¹¶ä¸èƒ½å†³å®šçœŸæ­£è°ƒç”¨å“ªä¸ªå‡½æ•°ï¼Œåªæœ‰åœ¨çœŸæ­£è¿è¡Œçš„æ—¶å€™æ‰ä¼šæ ¹æ®å‡½æ•°çš„åç§°æ‰¾åˆ°å¯¹åº”çš„å‡½æ•°æ¥è°ƒç”¨ã€‚</li>
<li>äº‹å®è¯æ˜ï¼š
<ul>
<li>åœ¨ç¼–è¯‘é˜¶æ®µï¼ŒOCå¯ä»¥<code>è°ƒç”¨ä»»ä½•å‡½æ•°</code>ï¼Œå³ä½¿è¿™ä¸ªå‡½æ•°å¹¶æœªå®ç°ï¼Œåªè¦å£°æ˜è¿‡å°±ä¸ä¼šæŠ¥é”™ã€‚</li>
<li>åœ¨ç¼–è¯‘é˜¶æ®µï¼ŒCè¯­è¨€è°ƒç”¨<code>æœªå®ç°çš„å‡½æ•°</code>å°±ä¼šæŠ¥é”™ã€‚</li>
</ul>
</li>
</ul>
<h3><a id="%E4%BA%8C%E3%80%81runtime%E4%BD%9C%E7%94%A8" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>äºŒã€runtimeä½œç”¨</h3>
<h4><a id="1%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>1.å‘é€æ¶ˆæ¯</h4>
<ul>
<li>æ–¹æ³•è°ƒç”¨çš„æœ¬è´¨ï¼Œå°±æ˜¯è®©å¯¹è±¡å‘é€æ¶ˆæ¯ã€‚</li>
<li>objc_msgSend,åªæœ‰å¯¹è±¡æ‰èƒ½å‘é€æ¶ˆæ¯ï¼Œå› æ­¤ä»¥objcå¼€å¤´.</li>
<li>ä½¿ç”¨<code>æ¶ˆæ¯æœºåˆ¶</code>å‰æï¼Œå¿…é¡»å¯¼å…¥#import</li>
<li>æ¶ˆæ¯æœºåˆ¶ç®€å•ä½¿ç”¨</li>
<li>clang -rewrite-objc main.m æŸ¥çœ‹æœ€ç»ˆç”Ÿæˆä»£ç </li>
</ul>
<pre><code>    // åˆ›å»ºpersonå¯¹è±¡
    Person *p = [[Person alloc] init];

    // è°ƒç”¨å¯¹è±¡æ–¹æ³•
    [p eat];

    // æœ¬è´¨ï¼šè®©å¯¹è±¡å‘é€æ¶ˆæ¯
    objc_msgSend(p, @selector(eat));

    // è°ƒç”¨ç±»æ–¹æ³•çš„æ–¹å¼ï¼šä¸¤ç§
    // ç¬¬ä¸€ç§é€šè¿‡ç±»åè°ƒç”¨
    [Person eat];
    // ç¬¬äºŒç§é€šè¿‡ç±»å¯¹è±¡è°ƒç”¨
    [[Person class] eat];

    // ç”¨ç±»åè°ƒç”¨ç±»æ–¹æ³•ï¼Œåº•å±‚ä¼šè‡ªåŠ¨æŠŠç±»åè½¬æ¢æˆç±»å¯¹è±¡è°ƒç”¨
    // æœ¬è´¨ï¼šè®©ç±»å¯¹è±¡å‘é€æ¶ˆæ¯
    objc_msgSend([Person class], @selector(eat));

</code></pre>
<ul>
<li>æ¶ˆæ¯æœºåˆ¶åŸç†:å¯¹è±¡æ ¹æ®æ–¹æ³•ç¼–å·SELå»æ˜ å°„è¡¨æŸ¥æ‰¾å¯¹åº”çš„æ–¹æ³•å®ç°<br />
<img src="media/14717809514175/14717888515211.jpg" alt="" /></li>
</ul>
<h4><a id="2%E4%BA%A4%E6%8D%A2%E6%96%B9%E6%B3%95" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>2.äº¤æ¢æ–¹æ³•</h4>
<ul>
<li>å¼€å‘ä½¿ç”¨åœºæ™¯:ç³»ç»Ÿè‡ªå¸¦çš„æ–¹æ³•åŠŸèƒ½ä¸å¤Ÿï¼Œç»™ç³»ç»Ÿè‡ªå¸¦çš„æ–¹æ³•æ‰©å±•ä¸€äº›åŠŸèƒ½ï¼Œå¹¶ä¸”ä¿æŒåŸæœ‰çš„åŠŸèƒ½ã€‚</li>
<li>æ–¹å¼ä¸€:ç»§æ‰¿ç³»ç»Ÿçš„ç±»ï¼Œé‡å†™æ–¹æ³•.</li>
<li>æ–¹å¼äºŒ:ä½¿ç”¨runtime,äº¤æ¢æ–¹æ³•.</li>
</ul>
<pre><code>@implementation ViewController

- (void)viewDidLoad {
    [super viewDidLoad];
    // Do any additional setup after loading the view, typically from a nib.
    // éœ€æ±‚ï¼šç»™imageNamedæ–¹æ³•æä¾›åŠŸèƒ½ï¼Œæ¯æ¬¡åŠ è½½å›¾ç‰‡å°±åˆ¤æ–­ä¸‹å›¾ç‰‡æ˜¯å¦åŠ è½½æˆåŠŸã€‚
    // æ­¥éª¤ä¸€ï¼šå…ˆæä¸ªåˆ†ç±»ï¼Œå®šä¹‰ä¸€ä¸ªèƒ½åŠ è½½å›¾ç‰‡å¹¶ä¸”èƒ½æ‰“å°çš„æ–¹æ³•+ (instancetype)imageWithName:(NSString *)name;
    // æ­¥éª¤äºŒï¼šäº¤æ¢imageNamedå’ŒimageWithNameçš„å®ç°ï¼Œå°±èƒ½è°ƒç”¨imageWithNameï¼Œé—´æ¥è°ƒç”¨imageWithNameçš„å®ç°ã€‚
    UIImage *image = [UIImage imageNamed:@&quot;123&quot;];

}

@end

@implementation UIImage (Image)
// åŠ è½½åˆ†ç±»åˆ°å†…å­˜çš„æ—¶å€™è°ƒç”¨
+ (void)load
{
    // äº¤æ¢æ–¹æ³•

    // è·å–imageWithNameæ–¹æ³•åœ°å€
    Method imageWithName = class_getClassMethod(self, @selector(imageWithName:));

    // è·å–imageWithNameæ–¹æ³•åœ°å€
    Method imageName = class_getClassMethod(self, @selector(imageNamed:));

    // äº¤æ¢æ–¹æ³•åœ°å€ï¼Œç›¸å½“äºäº¤æ¢å®ç°æ–¹å¼
    method_exchangeImplementations(imageWithName, imageName);

}

// ä¸èƒ½åœ¨åˆ†ç±»ä¸­é‡å†™ç³»ç»Ÿæ–¹æ³•imageNamedï¼Œå› ä¸ºä¼šæŠŠç³»ç»Ÿçš„åŠŸèƒ½ç»™è¦†ç›–æ‰ï¼Œè€Œä¸”åˆ†ç±»ä¸­ä¸èƒ½è°ƒç”¨super.

// æ—¢èƒ½åŠ è½½å›¾ç‰‡åˆèƒ½æ‰“å°
+ (instancetype)imageWithName:(NSString *)name
{

    // è¿™é‡Œè°ƒç”¨imageWithNameï¼Œç›¸å½“äºè°ƒç”¨imageName
    UIImage *image = [self imageWithName:name];

    if (image == nil) {
        NSLog(@&quot;åŠ è½½ç©ºçš„å›¾ç‰‡&quot;);
    }

    return image;
}

@end

</code></pre>
<ul>
<li>äº¤æ¢åŸç†ï¼š
<ul>
<li>
<p>äº¤æ¢ä¹‹å‰ï¼š<br />
<img src="media/14717809514175/14717892191490.jpg" alt="" /></p>
</li>
<li>
<p>äº¤æ¢ä¹‹åï¼š<br />
<img src="media/14717809514175/14717892801791.jpg" alt="" /></p>
</li>
</ul>
</li>
</ul>
<h4><a id="3%E5%8A%A8%E6%80%81%E6%B7%BB%E5%8A%A0%E6%96%B9%E6%B3%95" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>3.åŠ¨æ€æ·»åŠ æ–¹æ³•</h4>
<ul>
<li>å¼€å‘ä½¿ç”¨åœºæ™¯ï¼šå¦‚æœä¸€ä¸ªç±»æ–¹æ³•éå¸¸å¤šï¼ŒåŠ è½½ç±»åˆ°å†…å­˜çš„æ—¶å€™ä¹Ÿæ¯”è¾ƒè€—è´¹èµ„æºï¼Œéœ€è¦ç»™æ¯ä¸ªæ–¹æ³•ç”Ÿæˆæ˜ å°„è¡¨ï¼Œå¯ä»¥ä½¿ç”¨åŠ¨æ€ç»™æŸä¸ªç±»ï¼Œæ·»åŠ æ–¹æ³•è§£å†³ã€‚</li>
<li>ç»å…¸é¢è¯•é¢˜ï¼šæœ‰æ²¡æœ‰ä½¿ç”¨performSelectorï¼Œå…¶å®ä¸»è¦æƒ³é—®ä½ æœ‰æ²¡æœ‰åŠ¨æ€æ·»åŠ è¿‡æ–¹æ³•ã€‚</li>
<li>ç®€å•ä½¿ç”¨</li>
</ul>
<pre><code>@implementation ViewController

- (void)viewDidLoad {
    [super viewDidLoad];
    // Do any additional setup after loading the view, typically from a nib.

    Person *p = [[Person alloc] init];

    // é»˜è®¤personï¼Œæ²¡æœ‰å®ç°eatæ–¹æ³•ï¼Œå¯ä»¥é€šè¿‡performSelectorè°ƒç”¨ï¼Œä½†æ˜¯ä¼šæŠ¥é”™ã€‚
    // åŠ¨æ€æ·»åŠ æ–¹æ³•å°±ä¸ä¼šæŠ¥é”™
    [p performSelector:@selector(eat)];

}

@end

@implementation Person
// void(*)()
// é»˜è®¤æ–¹æ³•éƒ½æœ‰ä¸¤ä¸ªéšå¼å‚æ•°ï¼Œ
void eat(id self,SEL sel)
{
    NSLog(@&quot;%@ %@&quot;,self,NSStringFromSelector(sel));
}

// å½“ä¸€ä¸ªå¯¹è±¡è°ƒç”¨æœªå®ç°çš„æ–¹æ³•ï¼Œä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•å¤„ç†,å¹¶ä¸”ä¼šæŠŠå¯¹åº”çš„æ–¹æ³•åˆ—è¡¨ä¼ è¿‡æ¥.
// åˆšå¥½å¯ä»¥ç”¨æ¥åˆ¤æ–­ï¼Œæœªå®ç°çš„æ–¹æ³•æ˜¯ä¸æ˜¯æˆ‘ä»¬æƒ³è¦åŠ¨æ€æ·»åŠ çš„æ–¹æ³•
+ (BOOL)resolveInstanceMethod:(SEL)sel
{

    if (sel == @selector(eat)) {
        // åŠ¨æ€æ·»åŠ eatæ–¹æ³•

        // ç¬¬ä¸€ä¸ªå‚æ•°ï¼šç»™å“ªä¸ªç±»æ·»åŠ æ–¹æ³•
        // ç¬¬äºŒä¸ªå‚æ•°ï¼šæ·»åŠ æ–¹æ³•çš„æ–¹æ³•ç¼–å·
        // ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šæ·»åŠ æ–¹æ³•çš„å‡½æ•°å®ç°ï¼ˆå‡½æ•°åœ°å€ï¼‰
        // ç¬¬å››ä¸ªå‚æ•°ï¼šå‡½æ•°çš„ç±»å‹ï¼Œ(è¿”å›å€¼+å‚æ•°ç±»å‹) v:void @:å¯¹è±¡-&gt;self :è¡¨ç¤ºSEL-&gt;_cmd
        class_addMethod(self, @selector(eat), eat, &quot;v@:&quot;);

    }

    return [super resolveInstanceMethod:sel];
}
@end

</code></pre>
<h4><a id="4%E7%BB%99%E5%88%86%E7%B1%BB%E6%B7%BB%E5%8A%A0%E5%B1%9E%E6%80%A7" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>4.ç»™åˆ†ç±»æ·»åŠ å±æ€§</h4>
<ul>
<li>åŸç†ï¼šç»™ä¸€ä¸ªç±»å£°æ˜å±æ€§ï¼Œå…¶å®æœ¬è´¨å°±æ˜¯ç»™è¿™ä¸ªç±»æ·»åŠ å…³è”ï¼Œå¹¶ä¸æ˜¯ç›´æ¥æŠŠè¿™ä¸ªå€¼çš„å†…å­˜ç©ºé—´æ·»åŠ åˆ°ç±»å­˜ç©ºé—´ã€‚</li>
</ul>
<pre><code>
@implementation ViewController

- (void)viewDidLoad {
    [super viewDidLoad];
    // Do any additional setup after loading the view, typically from a nib.

    // ç»™ç³»ç»ŸNSObjectç±»åŠ¨æ€æ·»åŠ å±æ€§name

    NSObject *objc = [[NSObject alloc] init];
    objc.name = @&quot;å¾®æŒ‡&quot;;
    NSLog(@&quot;%@&quot;,objc.name);

}

@end

// å®šä¹‰å…³è”çš„key
static const char *key = &quot;name&quot;;

@implementation NSObject (Property)

- (NSString *)name
{
    // æ ¹æ®å…³è”çš„keyï¼Œè·å–å…³è”çš„å€¼ã€‚
    return objc_getAssociatedObject(self, key);
}

- (void)setName:(NSString *)name
{
    // ç¬¬ä¸€ä¸ªå‚æ•°ï¼šç»™å“ªä¸ªå¯¹è±¡æ·»åŠ å…³è”
    // ç¬¬äºŒä¸ªå‚æ•°ï¼šå…³è”çš„keyï¼Œé€šè¿‡è¿™ä¸ªkeyè·å–
    // ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šå…³è”çš„value
    // ç¬¬å››ä¸ªå‚æ•°:å…³è”çš„ç­–ç•¥
    objc_setAssociatedObject(self, key, name, OBJC_ASSOCIATION_RETAIN_NONATOMIC);
}

@end

</code></pre>
<h4><a id="5%E5%AD%97%E5%85%B8%E8%BD%AC%E6%A8%A1%E5%9E%8B" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>5.å­—å…¸è½¬æ¨¡å‹</h4>
<ul>
<li>è®¾è®¡æ¨¡å‹ï¼šå­—å…¸è½¬æ¨¡å‹çš„ç¬¬ä¸€æ­¥
<ul>
<li>æ¨¡å‹å±æ€§ï¼Œé€šå¸¸éœ€è¦è·Ÿå­—å…¸ä¸­çš„keyä¸€ä¸€å¯¹åº”</li>
<li>é—®é¢˜ï¼šä¸€ä¸ªä¸€ä¸ªçš„ç”Ÿæˆæ¨¡å‹å±æ€§ï¼Œå¾ˆæ…¢ï¼Ÿ</li>
<li>éœ€æ±‚ï¼šèƒ½ä¸èƒ½è‡ªåŠ¨æ ¹æ®ä¸€ä¸ªå­—å…¸ï¼Œç”Ÿæˆå¯¹åº”çš„å±æ€§ã€‚</li>
<li>è§£å†³ï¼šæä¾›ä¸€ä¸ªåˆ†ç±»ï¼Œä¸“é—¨æ ¹æ®å­—å…¸ç”Ÿæˆå¯¹åº”çš„å±æ€§å­—ç¬¦ä¸²ã€‚</li>
</ul>
</li>
</ul>
<pre><code>    @implementation NSObject (Log)

// è‡ªåŠ¨æ‰“å°å±æ€§å­—ç¬¦ä¸²
+ (void)resolveDict:(NSDictionary *)dict{

    // æ‹¼æ¥å±æ€§å­—ç¬¦ä¸²ä»£ç 
    NSMutableString *strM = [NSMutableString string];

    // 1.éå†å­—å…¸ï¼ŒæŠŠå­—å…¸ä¸­çš„æ‰€æœ‰keyå–å‡ºæ¥ï¼Œç”Ÿæˆå¯¹åº”çš„å±æ€§ä»£ç 
    [dict enumerateKeysAndObjectsUsingBlock:^(id  _Nonnull key, id  _Nonnull obj, BOOL * _Nonnull stop) {

        // ç±»å‹ç»å¸¸å˜ï¼ŒæŠ½å‡ºæ¥
         NSString *type;

        if ([obj isKindOfClass:NSClassFromString(@&quot;__NSCFString&quot;)]) {
            type = @&quot;NSString&quot;;
        }else if ([obj isKindOfClass:NSClassFromString(@&quot;__NSCFArray&quot;)]){
            type = @&quot;NSArray&quot;;
        }else if ([obj isKindOfClass:NSClassFromString(@&quot;__NSCFNumber&quot;)]){
            type = @&quot;int&quot;;
        }else if ([obj isKindOfClass:NSClassFromString(@&quot;__NSCFDictionary&quot;)]){
            type = @&quot;NSDictionary&quot;;
        }

        // å±æ€§å­—ç¬¦ä¸²
        NSString *str;
        if ([type containsString:@&quot;NS&quot;]) {
            str = [NSString stringWithFormat:@&quot;@property (nonatomic, strong) %@ *%@;&quot;,type,key];
        }else{
            str = [NSString stringWithFormat:@&quot;@property (nonatomic, assign) %@ %@;&quot;,type,key];
        }

        // æ¯ç”Ÿæˆå±æ€§å­—ç¬¦ä¸²ï¼Œå°±è‡ªåŠ¨æ¢è¡Œã€‚
        [strM appendFormat:@&quot;\n%@\n&quot;,str];

    }];

    // æŠŠæ‹¼æ¥å¥½çš„å­—ç¬¦ä¸²æ‰“å°å‡ºæ¥ï¼Œå°±å¥½äº†ã€‚
    NSLog(@&quot;%@&quot;,strM);

}

@end

</code></pre>
<ul>
<li>å­—å…¸è½¬æ¨¡å‹çš„æ–¹å¼ä¸€ï¼šKVC</li>
</ul>
<pre><code>@implementation Status

+ (instancetype)statusWithDict:(NSDictionary *)dict
{
    Status *status = [[self alloc] init];

    [status setValuesForKeysWithDictionary:dict];

    return status;

}

@end

</code></pre>
<ul>
<li>KVCå­—å…¸è½¬æ¨¡å‹å¼Šç«¯ï¼šå¿…é¡»ä¿è¯ï¼Œæ¨¡å‹ä¸­çš„å±æ€§å’Œå­—å…¸ä¸­çš„keyä¸€ä¸€å¯¹åº”ã€‚
<ul>
<li>å¦‚æœä¸ä¸€è‡´ï¼Œå°±ä¼šè°ƒç”¨<code>[ setValue:forUndefinedKey:]</code> æŠ¥<code>key</code>æ‰¾ä¸åˆ°çš„é”™ã€‚</li>
<li>åˆ†æ:æ¨¡å‹ä¸­çš„å±æ€§å’Œå­—å…¸çš„keyä¸ä¸€ä¸€å¯¹åº”ï¼Œç³»ç»Ÿå°±ä¼šè°ƒç”¨<code>setValue:forUndefinedKey:</code>æŠ¥é”™ã€‚</li>
<li>è§£å†³:é‡å†™å¯¹è±¡çš„<code>setValue:forUndefinedKey:</code>,æŠŠç³»ç»Ÿçš„æ–¹æ³•è¦†ç›–ï¼Œ å°±èƒ½ç»§ç»­ä½¿ç”¨KVCï¼Œå­—å…¸è½¬æ¨¡å‹äº†ã€‚</li>
</ul>
</li>
</ul>
<pre><code>- (void)setValue:(id)value forUndefinedKey:(NSString *)key
{

}

</code></pre>
<ul>
<li>å­—å…¸è½¬æ¨¡å‹çš„æ–¹å¼äºŒï¼šRuntime
<ul>
<li>æ€è·¯ï¼šåˆ©ç”¨è¿è¡Œæ—¶ï¼Œéå†æ¨¡å‹ä¸­æ‰€æœ‰å±æ€§ï¼Œæ ¹æ®æ¨¡å‹çš„å±æ€§åï¼Œå»å­—å…¸ä¸­æŸ¥æ‰¾keyï¼Œå–å‡ºå¯¹åº”çš„å€¼ï¼Œç»™æ¨¡å‹çš„å±æ€§èµ‹å€¼ã€‚</li>
<li>æ­¥éª¤ï¼šæä¾›ä¸€ä¸ªNSObjectåˆ†ç±»ï¼Œä¸“é—¨å­—å…¸è½¬æ¨¡å‹ï¼Œä»¥åæ‰€æœ‰æ¨¡å‹éƒ½å¯ä»¥é€šè¿‡è¿™ä¸ªåˆ†ç±»è½¬ã€‚</li>
</ul>
</li>
</ul>
<pre><code>
@implementation ViewController

- (void)viewDidLoad {
    [super viewDidLoad];
    // Do any additional setup after loading the view, typically from a nib.

    // è§£æPlistæ–‡ä»¶
    NSString *filePath = [[NSBundle mainBundle] pathForResource:@&quot;status.plist&quot; ofType:nil];

    NSDictionary *statusDict = [NSDictionary dictionaryWithContentsOfFile:filePath];

    // è·å–å­—å…¸æ•°ç»„
    NSArray *dictArr = statusDict[@&quot;statuses&quot;];

    // è‡ªåŠ¨ç”Ÿæˆæ¨¡å‹çš„å±æ€§å­—ç¬¦ä¸²
//    [NSObject resolveDict:dictArr[0][@&quot;user&quot;]];

    _statuses = [NSMutableArray array];

    // éå†å­—å…¸æ•°ç»„
    for (NSDictionary *dict in dictArr) {

        Status *status = [Status modelWithDict:dict];

        [_statuses addObject:status];

    }

    // æµ‹è¯•æ•°æ®
    NSLog(@&quot;%@ %@&quot;,_statuses,[_statuses[0] user]);

}

@end

@implementation NSObject (Model)

+ (instancetype)modelWithDict:(NSDictionary *)dict
{
    // æ€è·¯ï¼šéå†æ¨¡å‹ä¸­æ‰€æœ‰å±æ€§-ã€‹ä½¿ç”¨è¿è¡Œæ—¶

    // 0.åˆ›å»ºå¯¹åº”çš„å¯¹è±¡
    id objc = [[self alloc] init];

    // 1.åˆ©ç”¨runtimeç»™å¯¹è±¡ä¸­çš„æˆå‘˜å±æ€§èµ‹å€¼

    // class_copyIvarList:è·å–ç±»ä¸­çš„æ‰€æœ‰æˆå‘˜å±æ€§
    // Ivarï¼šæˆå‘˜å±æ€§çš„æ„æ€
    // ç¬¬ä¸€ä¸ªå‚æ•°ï¼šè¡¨ç¤ºè·å–å“ªä¸ªç±»ä¸­çš„æˆå‘˜å±æ€§
    // ç¬¬äºŒä¸ªå‚æ•°ï¼šè¡¨ç¤ºè¿™ä¸ªç±»æœ‰å¤šå°‘æˆå‘˜å±æ€§ï¼Œä¼ å…¥ä¸€ä¸ªIntå˜é‡åœ°å€ï¼Œä¼šè‡ªåŠ¨ç»™è¿™ä¸ªå˜é‡èµ‹å€¼
    // è¿”å›å€¼Ivar *ï¼šæŒ‡çš„æ˜¯ä¸€ä¸ªivaræ•°ç»„ï¼Œä¼šæŠŠæ‰€æœ‰æˆå‘˜å±æ€§æ”¾åœ¨ä¸€ä¸ªæ•°ç»„ä¸­ï¼Œé€šè¿‡è¿”å›çš„æ•°ç»„å°±èƒ½å…¨éƒ¨è·å–åˆ°ã€‚
    /* ç±»ä¼¼ä¸‹é¢è¿™ç§å†™æ³•

     Ivar ivar;
     Ivar ivar1;
     Ivar ivar2;
     // å®šä¹‰ä¸€ä¸ªivarçš„æ•°ç»„a
     Ivar a[] = {ivar,ivar1,ivar2};

     // ç”¨ä¸€ä¸ªIvar *æŒ‡é’ˆæŒ‡å‘æ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´ 
     Ivar *ivarList = a;

     // æ ¹æ®æŒ‡é’ˆè®¿é—®æ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´ 
     ivarList[0];

     */
    unsigned int count;

    // è·å–ç±»ä¸­çš„æ‰€æœ‰æˆå‘˜å±æ€§
    Ivar *ivarList = class_copyIvarList(self, &amp;count);

    for (int i = 0; i å­—å…¸ä¸­çš„key
        // ä»ç¬¬ä¸€ä¸ªè§’æ ‡å¼€å§‹æˆªå–
        NSString *key = [name substringFromIndex:1];

        // æ ¹æ®æˆå‘˜å±æ€§åå»å­—å…¸ä¸­æŸ¥æ‰¾å¯¹åº”çš„value
        id value = dict[key];

        // äºŒçº§è½¬æ¢:å¦‚æœå­—å…¸ä¸­è¿˜æœ‰å­—å…¸ï¼Œä¹Ÿéœ€è¦æŠŠå¯¹åº”çš„å­—å…¸è½¬æ¢æˆæ¨¡å‹
        // åˆ¤æ–­ä¸‹valueæ˜¯å¦æ˜¯å­—å…¸
        if ([value isKindOfClass:[NSDictionary class]]) {
            // å­—å…¸è½¬æ¨¡å‹
            // è·å–æ¨¡å‹çš„ç±»å¯¹è±¡ï¼Œè°ƒç”¨modelWithDict
            // æ¨¡å‹çš„ç±»åå·²çŸ¥ï¼Œå°±æ˜¯æˆå‘˜å±æ€§çš„ç±»å‹

            // è·å–æˆå‘˜å±æ€§ç±»å‹
           NSString *type = [NSString stringWithUTF8String:ivar_getTypeEncoding(ivar)];
          // ç”Ÿæˆçš„æ˜¯è¿™ç§@&quot;@\&quot;User\&quot;&quot; ç±»å‹ -ã€‹ @&quot;User&quot;  åœ¨OCå­—ç¬¦ä¸²ä¸­ \&quot; -&gt; &quot;ï¼Œ\æ˜¯è½¬ä¹‰çš„æ„æ€ï¼Œä¸å ç”¨å­—ç¬¦
            // è£å‰ªç±»å‹å­—ç¬¦ä¸²
            NSRange range = [type rangeOfString:@&quot;\&quot;&quot;];

           type = [type substringFromIndex:range.location + range.length];

            range = [type rangeOfString:@&quot;\&quot;&quot;];

            // è£å‰ªåˆ°å“ªä¸ªè§’æ ‡ï¼Œä¸åŒ…æ‹¬å½“å‰è§’æ ‡
          type = [type substringToIndex:range.location];

            // æ ¹æ®å­—ç¬¦ä¸²ç±»åç”Ÿæˆç±»å¯¹è±¡
            Class modelClass = NSClassFromString(type);

            if (modelClass) { // æœ‰å¯¹åº”çš„æ¨¡å‹æ‰éœ€è¦è½¬

                // æŠŠå­—å…¸è½¬æ¨¡å‹
                value  =  [modelClass modelWithDict:value];
            }

        }

        // ä¸‰çº§è½¬æ¢ï¼šNSArrayä¸­ä¹Ÿæ˜¯å­—å…¸ï¼ŒæŠŠæ•°ç»„ä¸­çš„å­—å…¸è½¬æ¢æˆæ¨¡å‹.
        // åˆ¤æ–­å€¼æ˜¯å¦æ˜¯æ•°ç»„
        if ([value isKindOfClass:[NSArray class]]) {
            // åˆ¤æ–­å¯¹åº”ç±»æœ‰æ²¡æœ‰å®ç°å­—å…¸æ•°ç»„è½¬æ¨¡å‹æ•°ç»„çš„åè®®
            if ([self respondsToSelector:@selector(arrayContainModelClass)]) {

                // è½¬æ¢æˆidç±»å‹ï¼Œå°±èƒ½è°ƒç”¨ä»»ä½•å¯¹è±¡çš„æ–¹æ³•
                id idSelf = self;

                // è·å–æ•°ç»„ä¸­å­—å…¸å¯¹åº”çš„æ¨¡å‹
                NSString *type =  [idSelf arrayContainModelClass][key];

                // ç”Ÿæˆæ¨¡å‹
               Class classModel = NSClassFromString(type);
                NSMutableArray *arrM = [NSMutableArray array];
                // éå†å­—å…¸æ•°ç»„ï¼Œç”Ÿæˆæ¨¡å‹æ•°ç»„
                for (NSDictionary *dict in value) {
                    // å­—å…¸è½¬æ¨¡å‹
                  id model =  [classModel modelWithDict:dict];
                    [arrM addObject:model];
                }

                // æŠŠæ¨¡å‹æ•°ç»„èµ‹å€¼ç»™value
                value = arrM;

            }
        }

        if (value) { // æœ‰å€¼ï¼Œæ‰éœ€è¦ç»™æ¨¡å‹çš„å±æ€§èµ‹å€¼
            // åˆ©ç”¨KVCç»™æ¨¡å‹ä¸­çš„å±æ€§èµ‹å€¼
            [objc setValue:value forKey:key];
        }

    }
    free(ivarList);
    return objc;
}

@end
</code></pre>


		</div>

		

	</article>
  
	<div class="pagination">
	
<a href="archives.html">Blog Archives</a>
	 <a class="next" href="åŸç†æ¢ç©¶.html">Newer &rarr;</a>  
	    
	</div>
</div>
 <aside class="sidebar"> 

	<section>
	  <h1>Categories</h1>
	  <ul id="recent_posts">
	  
	      <li class="post">
	        <a href="%E5%8E%9F%E7%90%86%E6%8E%A2%E7%A9%B6.html"><strong>åŸç†æ¢ç©¶&nbsp;(8)</strong></a>
	        
	        
	        
	      </li>
	  
	      <li class="post">
	        <a href="%E6%8A%80%E5%B7%A7.html"><strong>æŠ€å·§&nbsp;(34)</strong></a>
	        
	        
	        
	      </li>
	  
	      <li class="post">
	        <a href="%E6%95%99%E7%A8%8B.html"><strong>æ•™ç¨‹&nbsp;(23)</strong></a>
	        
	        
	        
	      </li>
	  
	      <li class="post">
	        <a href="%E9%81%87%E5%88%B0Bug.html"><strong>é‡åˆ°Bug&nbsp;(12)</strong></a>
	        
	        
	        
	      </li>
	  
	      <li class="post">
	        <a href="%E6%9D%82%E8%AE%B0.html"><strong>æ‚è®°&nbsp;(16)</strong></a>
	        
	        
	        
	      </li>
	  
	      <li class="post">
	        <a href="Swift.html"><strong>Swift&nbsp;(23)</strong></a>
	        
	        
	        
	      </li>
	  
	      <li class="post">
	        <a href="C/C++.html"><strong>C/C++&nbsp;(4)</strong></a>
	        
	        
	        
	      </li>
	  
	      <li class="post">
	        <a href="Linux.html"><strong>Linux&nbsp;(3)</strong></a>
	        
	        
	        
	      </li>
	  
	      <li class="post">
	        <a href="Documentation.html"><strong>Documentation&nbsp;(8)</strong></a>
	        
	        
	        
	      </li>
	  
	      <li class="post">
	        <a href="Java.html"><strong>Java&nbsp;(7)</strong></a>
	        
	        
	        
	      </li>
	  
	      <li class="post">
	        <a href="LeetCode.html"><strong>LeetCode&nbsp;(3)</strong></a>
	        
	        
	        
	      </li>
	  
	      <li class="post">
	        <a href="Flutter.html"><strong>Flutter&nbsp;(3)</strong></a>
	        
	        
	        
	      </li>
	   
	  </ul>
	</section>
	<section>
	  <h1>Recent Posts</h1>
	  <ul id="recent_posts">
	  
	      
		      <li class="post">
		        <a href="16293384343104.html">äº†è§£Scrollable</a>
		      </li>
	     
	  
	      
		      <li class="post">
		        <a href="16292522945585.html">é¿å…å’ŒWillPopScopeä¸iOSæ‰‹åŠ¿å†²çª</a>
		      </li>
	     
	  
	      
		      <li class="post">
		        <a href="16291783311992.html">æ–¹ä¾¿å®ç”¨çš„å°ç»„ä»¶</a>
		      </li>
	     
	  
	      
		      <li class="post">
		        <a href="16267829476143.html">Flutter ä¸­ TabBarView ç‚¹å‡»åˆ‡æ¢ï¼Œç›‘å¬ä¼šè°ƒç”¨å¤šå‡º</a>
		      </li>
	     
	  
	      
		      <li class="post">
		        <a href="16267690953146.html">Flutter ä¸­ listView åµŒå¥— listView</a>
		      </li>
	     
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	   
	  </ul>
	</section>
	
</aside> </div></div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 -  -
  <span class="credit">Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a> &nbsp;&nbsp; Theme by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>



  














<style type="text/css">
  
/* PrismJS 1.14.0
https://prismjs.com/download.html#themes=prism-solarizedlight&languages=markup+css+clike+javascript */
/*
 Solarized Color Schemes originally by Ethan Schoonover
 http://ethanschoonover.com/solarized

 Ported for PrismJS by Hector Matos
 Website: https://krakendev.io
 Twitter Handle: https://twitter.com/allonsykraken)
*/

/*
SOLARIZED HEX
--------- -------
base03    #002b36
base02    #073642
base01    #586e75
base00    #657b83
base0     #839496
base1     #93a1a1
base2     #eee8d5
base3     #fdf6e3
yellow    #b58900
orange    #cb4b16
red       #dc322f
magenta   #d33682
violet    #6c71c4
blue      #268bd2
cyan      #2aa198
green     #859900
*/

code[class*="language-"],
pre[class*="language-"] {
  color: #657b83; /* base00 */
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;

  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

pre[class*="language-"]::-moz-selection, pre[class*="language-"] ::-moz-selection,
code[class*="language-"]::-moz-selection, code[class*="language-"] ::-moz-selection {
  background: #073642; /* base02 */
}

pre[class*="language-"]::selection, pre[class*="language-"] ::selection,
code[class*="language-"]::selection, code[class*="language-"] ::selection {
  background: #073642; /* base02 */
}

/* Code blocks */
pre[class*="language-"] {
  padding: 1em;
  margin: .5em 0;
  overflow: auto;
  border-radius: 0.3em;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
  background-color: #fdf6e3; /* base3 */
}

/* Inline code */
:not(pre) > code[class*="language-"] {
  padding: .1em;
  border-radius: .3em;
}

.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
  color: #93a1a1; /* base1 */
}

.token.punctuation {
  color: #586e75; /* base01 */
}

.namespace {
  opacity: .7;
}

.token.property,
.token.tag,
.token.boolean,
.token.number,
.token.constant,
.token.symbol,
.token.deleted {
  color: #268bd2; /* blue */
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.url,
.token.inserted {
  color: #2aa198; /* cyan */
}

.token.entity {
  color: #657b83; /* base00 */
  background: #eee8d5; /* base2 */
}

.token.atrule,
.token.attr-value,
.token.keyword {
  color: #859900; /* green */
}

.token.function,
.token.class-name {
  color: #b58900; /* yellow */
}

.token.regex,
.token.important,
.token.variable {
  color: #cb4b16; /* orange */
}

.token.important,
.token.bold {
  font-weight: bold;
}
.token.italic {
  font-style: italic;
}

.token.entity {
  cursor: help;
}


pre[class*="language-"].line-numbers {
    position: relative;
    padding-left: 3.8em;
    counter-reset: linenumber;
}

pre[class*="language-"].line-numbers > code {
    position: relative;
    white-space: inherit;
}

.line-numbers .line-numbers-rows {
    position: absolute;
    pointer-events: none;
    top: 0;
    font-size: 100%;
    left: -3.8em;
    width: 3em; /* works for line-numbers below 1000 lines */
    letter-spacing: -1px;
    border-right: 1px solid #999;

    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;

}

    .line-numbers-rows > span {
        pointer-events: none;
        display: block;
        counter-increment: linenumber;
    }

        .line-numbers-rows > span:before {
            content: counter(linenumber);
            color: #999;
            display: block;
            padding-right: 0.8em;
            text-align: right;
        }

</style>
  
    


</body>
</html>