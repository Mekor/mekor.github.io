
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>
    
  æå°äº‰
  

  </title>
  <meta name="author" content="">
  <meta name="description" content="è®°å½•å¼€å‘ä¸­é‡åˆ°çš„ä¸€äº›é—®é¢˜">

  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link href="asset/css/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="atom.xml" rel="alternate" title="æå°äº‰" type="application/atom+xml">
  <script src="asset/js/modernizr-2.0.js"></script>
  <script src="asset/js/jquery.min.js"></script>
  <style type="text/css">
  .cat-children-p{ padding: 6px 0px;}
  .hljs{background: none;}
  </style>
  <script type="text/javascript">
  var isAddSildbar = true;
  </script>
  <script src="asset/js/octopress.js" type="text/javascript"></script>
</head>
<script type="text/javascript">
//é“¾æ¥æ–°å¼€çª—å£
function addBlankTargetForLinks () {
  $('a[href^="http"]').each(function(){
      $(this).attr('target', '_blank');
  });
}
$(document).ready(function(event) {
  addBlankTargetForLinks();
});
</script>
<body   >
  <header role="banner"><hgroup>
  <h1><a href="index.html">æå°äº‰</a></h1>
  
    <h2>è®°å½•å¼€å‘ä¸­é‡åˆ°çš„ä¸€äº›é—®é¢˜</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:www.citynight.cn/Blog" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">

  <li id=""><a target="self" href="index.html">Home</a></li>

  <li id=""><a target="_self" href="archives.html">Archives</a></li>

</ul>

</nav>
  <div id="main">
    <div id="content"> 
<div class="blog-index">

	<article>
		 <header>
		  	<h1 class="entry-title"><a href="15966161528946.html">setProperty åº”ç”¨</a></h1>
			<p class="meta"><time datetime="2020-08-05T16:29:12+08:00" 
			pubdate data-updated="true">2020/8/5</time></p>
		 </header>
	  	<div class="entry-content">
		  	
		  	<p>é¡¹ç›®ä¸­ä½¿ç”¨<code>Nacos</code>,æƒ³è¦†ç›–nacosçš„é»˜è®¤é…ç½®,é…ç½®ä¿¡æ¯å¦‚ä¸‹:</p>

<pre><code class="language-text">/**
 * @author cloud
 * @date 2019-10-31
 * &lt;p&gt;
 * è¦†ç›–nacos é»˜è®¤é…ç½®
 */
public interface ConfigConstants {
    /**
     * The System property name of  Standalone mode
     */
    String STANDALONE_MODE = &quot;nacos.standalone&quot;;

    /**
     * tomcat ç›®å½•
     */
    String TOMCAT_DIR = &quot;server.tomcat.basedir&quot;;

    /**
     * tomcat æ—¥å¿—é…ç½®
     */
    String TOMCAT_ACCESS_LOG = &quot;server.tomcat.accesslog.enabled&quot;;

    /**
     * æ˜¯å¦å¼€å¯è®¤è¯
     */
    String AUTH_ENABLED = &quot;nacos.core.auth.enabled&quot;;
}
</code></pre>

<p>åœ¨å¯åŠ¨ç±»ä¸­è®¾ç½®æƒ³è¦è¦†ç›–é…ç½®çš„å€¼</p>

<pre><code class="language-text">/**
 * @author nacos
 * &lt;p&gt;
 * nacos console æºç è¿è¡Œï¼Œæ–¹ä¾¿å¼€å‘
 * ç”Ÿäº§å»ºè®®ä»å®˜ç½‘ä¸‹è½½æœ€æ–°ç‰ˆé…ç½®è¿è¡Œ
 */
@EnableScheduling
@SpringBootApplication
public class CloudNacosApplication {

    public static void main(String[] args) {
        System.setProperty(ConfigConstants.TOMCAT_DIR, &quot;logs&quot;);
        System.setProperty(ConfigConstants.TOMCAT_ACCESS_LOG, &quot;false&quot;);
        System.setProperty(ConfigConstants.STANDALONE_MODE, &quot;true&quot;);
        System.setProperty(ConfigConstants.AUTH_ENABLED, &quot;false&quot;);
        SpringApplication.run(CloudNacosApplication.class, args);
    }
}

</code></pre>


		</div>

		

	</article>
 
	<article>
		 <header>
		  	<h1 class="entry-title"><a href="15965236438323.html">devtools çƒ­å¯åŠ¨</a></h1>
			<p class="meta"><time datetime="2020-08-04T14:47:23+08:00" 
			pubdate data-updated="true">2020/8/4</time></p>
		 </header>
	  	<div class="entry-content">
		  	
		  	<p>ç¬¬ä¸€æ­¥:æ·»åŠ pom</p>

<pre><code class="language-text">        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;
            &lt;scope&gt;runtime&lt;/scope&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;
</code></pre>

<p>ç¬¬äºŒæ­¥ æ·»åŠ æ’ä»¶åˆ°çˆ¶pomä¸­</p>

<pre><code class="language-text">  &lt;build&gt;
    &lt;plugins&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
        &lt;configuration&gt;
          &lt;fork&gt;true&lt;/fork&gt;
          &lt;addResources&gt;true&lt;/addResources&gt;
        &lt;/configuration&gt;
      &lt;/plugin&gt;
    &lt;/plugins&gt;
  &lt;/build&gt;
</code></pre>

<p>ç¬¬ä¸‰æ­¥ å¼€å¯è‡ªåŠ¨ç¼–è¯‘é€‰é¡¹<br/>
Setting-&gt;Build-&gt;Compiler<br/>
<img src="media/15965236438323/15965240806182.jpg" alt="" style="width:475px;"/></p>

<p>ç¬¬å››æ­¥: ä¿®æ”¹Registry</p>

<p>åŒå‡» Shift é€‰ä¸­Action è¾“å…¥ Registry æ‰“å¼€<br/>
<img src="media/15965236438323/15965244242502.jpg" alt="" style="width:655px;"/><br/>
ä¿®æ”¹ä¸ºé€‰ä¸­<br/>
<img src="media/15965236438323/15965245587023.jpg" alt="" style="width:950px;"/><br/>
ç¬¬äº”æ­¥: é‡å¯IDEA</p>


		</div>

		

	</article>
 
	<article>
		 <header>
		  	<h1 class="entry-title"><a href="15965198984201.html">@Slf4jæ³¨è§£å®ç°æ—¥å¿—è¾“å‡º</a></h1>
			<p class="meta"><time datetime="2020-08-04T13:44:58+08:00" 
			pubdate data-updated="true">2020/8/4</time></p>
		 </header>
	  	<div class="entry-content">
		  	
		  	<p>æœ€è¿‘çœ‹åˆ°Bç«™ä¸Šæœ‰äººå†™ä»£ç æ²¡æœ‰å®šä¹‰log(<code>private final Logger log = LoggerFactory.getLogger(XXX.class);</code>)å°±èƒ½ç›´æ¥ç”¨<code>log</code></p>

<p>æŸ¥äº†ä¸‹å¯èƒ½çš„æ–¹æ¡ˆ:</p>

<ol>
<li>pomå¼•å…¥ <code>lombok</code></li>
</ol>

<pre><code class="language-text">            &lt;dependency&gt;
                &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
                &lt;artifactId&gt;lombok&lt;/artifactId&gt;
                &lt;version&gt;${lombok.version}&lt;/version&gt;
                &lt;optional&gt;true&lt;/optional&gt;
            &lt;/dependency&gt;
</code></pre>

<ol>
<li>åœ¨ç›®æ ‡ç±»ä¸Šæ·»åŠ <code>@Slf4j</code>æ³¨è§£</li>
<li>ç„¶åç›´æ¥åœ¨æ–¹æ³•ä¸­ä½¿ç”¨<code>log.info(&quot;*****æ’å…¥ç»“æœï¼š&quot;+result);</code></li>
<li>å¦‚æœä½¿ç”¨çš„æ—¶å€™æ²¡æœ‰æ‰¾åˆ°å˜é‡<code>log</code>,IDEAéœ€è¦å®‰è£…lombokæ’ä»¶</li>
</ol>


		</div>

		

	</article>
 
	<article>
		 <header>
		  	<h1 class="entry-title"><a href="15962945237035.html">632. Smallest Range Covering Elements from K Lists</a></h1>
			<p class="meta"><time datetime="2020-08-01T23:08:43+08:00" 
			pubdate data-updated="true">2020/8/1</time></p>
		 </header>
	  	<div class="entry-content">
		  	
		  	<p>é¢˜ç›®åœ°å€:<a href="https://leetcode-cn.com/problems/smallest-range-covering-elements-from-k-lists/">632. æœ€å°åŒºé—´</a><br/>
You have <code>k</code> lists of sorted integers in ascending order. Find the smallest range that includes at least one number from each of the <code>k</code> lists. </p>

<p>We define the range <code>[a,b]</code> is smaller than range <code>[c,d]</code> if <code>b-a &lt; d-c</code> or <code>a &lt; c</code> if <code>b-a == d-c</code>.</p>

<ul>
<li><strong>Example 1:</strong></li>
</ul>

<pre><code class="language-text">Input: [[4,10,15,24,26], [0,9,12,20], [5,18,22,30]]
Output: [20,24]
Explanation: 
List 1: [4, 10, 15, 24,26], 24 is in range [20,24].
List 2: [0, 9, 12, 20], 20 is in range [20,24].
List 3: [5, 18, 22, 30], 22 is in range [20,24].
</code></pre>

<p>Note: </p>

<ol>
<li>The given list may contain duplicates, so ascending order means &gt;= here.</li>
<li>1 &lt;= k &lt;= 3500</li>
<li>-10<sup>5</sup> &lt;= value of elements &lt;= 10<sup>5.</sup></li>
</ol>

<p>è§£é¢˜æ€è·¯ï¼š<br/>
å…ˆçœ‹ğŸŒ°</p>

<pre><code class="language-text">4,10,15,24,26
0, 9,12,20
5,18,22,30
</code></pre>

<p>å› ä¸ºæ¯ä¸ªæ•°ç»„ä¸­å¿…é¡»æœ‰ä¸€ä¸ªæ•°å­—åŒ…å«åœ¨å…¶ä¸­ï¼Œä¸€å¼€å§‹æˆ‘ä»¬å–æ¯ä¸ªæ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªæ•°å­—</p>

<pre><code class="language-text">*4*,10,15,24,26
*0*, 9,12,20
*5*,18,22,30
</code></pre>

<p><code>4,0,5</code>æœ€å°çš„æ˜¯<code>0</code>,æœ€å¤§å€¼æ˜¯<code>5</code>åŒºé—´æ˜¯<code>5-0=5</code><br/>
æŠŠç¬¬ä¸€ä¸ªæœ€å°åŒºé—´5çš„åæ ‡è®°å½•ä¸‹æ¥å°±æ˜¯<code>[0,5]</code><br/>
å»æ‰æœ€å°çš„å€¼,ç„¶åæœ€å°å€¼æ‰€åœ¨çš„æ•°ç»„å‘åå–ä¸€ä½å³</p>

<pre><code class="language-text">*4*,10,15,24,26
0, *9*,12,20
*5*,18,22,30
</code></pre>

<p><code>4,9,5</code>æœ€å°çš„æ˜¯<code>4</code>,æœ€å¤§å€¼æ˜¯<code>9</code>åŒºé—´æ˜¯<code>9-4=5</code>æœ€å°åŒºé—´ä¸å˜è¿˜æ˜¯5,æ‰€ä»¥å»æ‰æœ€å°çš„å€¼,ç„¶åæœ€å°å€¼æ‰€åœ¨çš„æ•°ç»„å‘åå–ä¸€ä½å³</p>

<pre><code class="language-text">4,*10*,15,24,26
0, *9*,12,20
*5*,18,22,30
</code></pre>

<p><code>10,9,5</code>æœ€å°çš„æ˜¯<code>5</code>,æœ€å¤§å€¼æ˜¯<code>10</code>åŒºé—´æ˜¯<code>10-5=5</code>æœ€å°åŒºé—´ä¸å˜è¿˜æ˜¯5,æ‰€ä»¥å»æ‰æœ€å°çš„å€¼,ç„¶åæœ€å°å€¼æ‰€åœ¨çš„æ•°ç»„å‘åå–ä¸€ä½å³</p>

<pre><code class="language-text">4,*10*,15,24,26
0, *9*,12,20
5,*18*,22,30
</code></pre>

<p><code>10,9,18</code>æœ€å°çš„æ˜¯<code>9</code>,æœ€å¤§å€¼æ˜¯<code>18</code>åŒºé—´æ˜¯<code>18-9=9</code>,å› ä¸º<code>9&gt;5</code>ä¸ç¬¦åˆè§„åˆ™,æœ€å°åŒºé—´ä¸å˜è¿˜æ˜¯5,æ‰€ä»¥å»æ‰æœ€å°çš„å€¼,ç„¶åæœ€å°å€¼æ‰€åœ¨çš„æ•°ç»„å‘åå–ä¸€ä½å³</p>

<pre><code class="language-text">4,*10*,15,24,26
0, 9,*12*,20
5,*18*,22,30
</code></pre>

<p><code>10,12,18</code>æœ€å°çš„æ˜¯<code>10</code>,æœ€å¤§å€¼æ˜¯<code>18</code>åŒºé—´æ˜¯<code>18-10=8</code>,å› ä¸º<code>8&gt;5</code>ä¸ç¬¦åˆè§„åˆ™,æœ€å°åŒºé—´ä¸å˜è¿˜æ˜¯5,æ‰€ä»¥å»æ‰æœ€å°çš„å€¼,ç„¶åæœ€å°å€¼æ‰€åœ¨çš„æ•°ç»„å‘åå–ä¸€ä½å³</p>

<pre><code class="language-text">4,10,*15*,24,26
0, 9,*12*,20
5,*18*,22,30
</code></pre>

<p><code>15,12,18</code>æœ€å°çš„æ˜¯<code>12</code>,æœ€å¤§å€¼æ˜¯<code>18</code>åŒºé—´æ˜¯<code>18-12=6</code>,å› ä¸º<code>6&gt;5</code>ä¸ç¬¦åˆè§„åˆ™,æœ€å°åŒºé—´ä¸å˜è¿˜æ˜¯5,æ‰€ä»¥å»æ‰æœ€å°çš„å€¼,ç„¶åæœ€å°å€¼æ‰€åœ¨çš„æ•°ç»„å‘åå–ä¸€ä½å³</p>

<pre><code class="language-text">4,10,*15*,24,26
0, 9,12,*20*
5,*18*,22,30
</code></pre>

<p><code>15,20,18</code>æœ€å°çš„æ˜¯<code>15</code>,æœ€å¤§å€¼æ˜¯<code>20</code>åŒºé—´æ˜¯<code>20-15=5</code>,æœ€å°åŒºé—´ä¸å˜è¿˜æ˜¯5,æ‰€ä»¥å»æ‰æœ€å°çš„å€¼,ç„¶åæœ€å°å€¼æ‰€åœ¨çš„æ•°ç»„å‘åå–ä¸€ä½å³</p>

<pre><code class="language-text">4,10,15,*24*,26
0, 9,12,*20*
5,*18*,22,30
</code></pre>

<p><code>24,20,18</code>æœ€å°çš„æ˜¯<code>18</code>,æœ€å¤§å€¼æ˜¯<code>24</code>åŒºé—´æ˜¯<code>24-18=6</code>,å› ä¸º<code>6&gt;5</code>ä¸ç¬¦åˆè§„åˆ™,æœ€å°åŒºé—´ä¸å˜è¿˜æ˜¯5,æ‰€ä»¥å»æ‰æœ€å°çš„å€¼,ç„¶åæœ€å°å€¼æ‰€åœ¨çš„æ•°ç»„å‘åå–ä¸€ä½å³</p>

<pre><code class="language-text">4,10,15,*24*,26
0, 9,12,*20*
5,18,*22*,30
</code></pre>

<p><code>24,20,22</code>æœ€å°çš„æ˜¯<code>20</code>,æœ€å¤§å€¼æ˜¯<code>24</code>åŒºé—´æ˜¯<code>24-20=4</code>,å› ä¸º<code>4&lt;5</code>ç¬¦åˆè§„åˆ™,æœ€å°åŒºé—´å˜æ›´ä¸º4,æŠŠæœ€å°åŒºé—´4çš„åæ ‡è®°å½•ä¸‹æ¥å°±æ˜¯<code>[20,24]</code>,è¿™æ—¶ç»§ç»­å‘åèµ°,ç”±äºæœ€å°å€¼æ˜¯<code>20</code>è€Œ<code>20</code>æ‰€åœ¨çš„æ•°ç»„å·²ç»èµ°åˆ°äº†ç»“å°¾,ä¸èƒ½ç»§ç»­èµ°,å†èµ°å°±ä¸èƒ½æ»¡è¶³æ¯ä¸ªæ•°ç»„ä¸­å¿…é¡»æœ‰ä¸€ä¸ªæ•°åŒ…å«åœ¨å…¶ä¸­.<br/>
æ‰€ä»¥è¿”å›æœ€å°åŒºé—´<code>[20,24</code></p>

<p>å‚è€ƒä»£ç :</p>

<pre><code class="language-java">class Solution {
    public int[] smallestRange(List&lt;List&lt;Integer&gt;&gt; nums) {
        // é‡Œé¢å­˜å‚¨çš„æ˜¯è¡Œåˆ—æ•°æ®ä½ç½®ï¼Œä¼˜å…ˆçº§æ˜¯åˆ—ä¸­æ•°æ®å¤§å°
        PriorityQueue&lt;int[]&gt; q = new PriorityQueue&lt;&gt;(Comparator.comparingInt(o -&gt; nums.get(o[0]).get(o[1])));
        int max = Integer.MIN_VALUE, start = 0, end = Integer.MAX_VALUE;
        // å…ˆè®©æ¯ä¸ªæ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªæ•°è¿›å…¥ q
        for (int i = 0; i &lt; nums.size(); i++) {
            q.offer(new int[]{i, 0});
            max = Math.max(max, nums.get(i).get(0));
        }
        while (q.size() == nums.size()) {
            // å–å‡ºæœ€å°çš„å…ƒç´ è·å¾—åˆ°è¡Œåˆ—ä¿¡æ¯
            int e[] = q.poll(), row = e[0], col = e[1];
            // æ¯”è¾ƒï¼Œå¦‚æœç¬¦åˆæ¡ä»¶å°±æ›´æ–°æœ€å°åŒºé—´ä¿¡æ¯
            if (end - start &gt; max - nums.get(row).get(col)) {
                start = nums.get(row).get(col);
                end = max;
            }
            // é˜²æ­¢è¶Šç•Œ
            if (col + 1 &lt; nums.get(row).size()) {
                q.offer(new int[]{row, col + 1});
                max = Math.max(max, nums.get(row).get(col + 1));
            }
        }
        return new int[]{start, end};
    }
}
</code></pre>


		</div>

		

	</article>
 
	<article>
		 <header>
		  	<h1 class="entry-title"><a href="15654059537017.html"># æ·±å…¥ç†è§£ iOS äº‹ä»¶æœºåˆ¶</a></h1>
			<p class="meta"><time datetime="2019-08-10T10:59:13+08:00" 
			pubdate data-updated="true">2019/8/10</time></p>
		 </header>
	  	<div class="entry-content">
		  	
		  	<blockquote>
<p>åŸæ–‡æ¥è‡ª<a href="https://juejin.im/post/5d396ef7518825453b605afa">æ˜é‡‘</a></p>
</blockquote>

<h2 id="toc_0">å‰è¨€</h2>

<p>è¿™ç¯‡æ–‡ç« å§‹äºä¸€ä¸ªéœ€æ±‚ï¼šæˆ‘ä»¬åœ¨ SDK æä¾›çš„æŸä¸ª View çš„ Subview ä¸­å®ç°äº†å•å‡»åŒå‡»ç­‰å¤šä¸ª Gesture Recognizerï¼Œè€Œå®¢æˆ·å¸Œæœ›è‡ªå·±åœ¨è¿™ä¸ª View ä¸Šçš„å•å‡»æ‰‹åŠ¿ä¸ä¼šå†²çªï¼ŒåŒæ—¶æ²¡æœ‰å»¶è¿Ÿã€‚</p>

<p>å€Ÿæ­¤æœºä¼šï¼Œæˆ‘ä»¬æ¥é‡æ¸©ä¸‹ iOS çš„äº‹ä»¶æœºåˆ¶å’Œæ‰‹åŠ¿å†²çªï¼Œé‡ç‚¹ä»‹ç»ä¸‹ UIGestureRecognizer ä¹‹é—´ä»¥åŠä¸åŸç”Ÿè§¦æ‘¸äº‹ä»¶çš„ç›¸äº’å…³ç³»ã€‚</p>

<h2 id="toc_1">äº‹ä»¶çš„ç”Ÿå‘½å‘¨æœŸ</h2>

<p>å½“æŒ‡å°–è§¦ç¢°å±å¹•æ—¶ï¼Œä¸€ä¸ªè§¦æ‘¸äº‹ä»¶å°±åœ¨ç³»ç»Ÿä¸­ç”Ÿæˆäº†ã€‚ç»è¿‡ IPC è¿›ç¨‹é—´é€šä¿¡ï¼Œäº‹ä»¶æœ€ç»ˆè¢«ä¼ é€’åˆ°äº†åˆé€‚çš„åº”ç”¨ã€‚åœ¨åº”ç”¨å†…å†ç»å³°å›è·¯è½¬çš„å¥‡å¹»ä¹‹æ—…åï¼Œæœ€ç»ˆè¢«é‡Šæ”¾ã€‚å¤§è‡´ç»è¿‡å¦‚ä¸‹å›¾ï¼š</p>

<p><img src="media/15654059537017/15654060901311.jpg" alt=""/></p>

<h3 id="toc_2">ç³»ç»Ÿå“åº”é˜¶æ®µ</h3>

<ol>
<li><p>æ‰‹æŒ‡è§¦ç¢°å±å¹•ï¼Œå±å¹•æ„Ÿåº”åˆ°è§¦ç¢°åï¼Œå°†äº‹ä»¶äº¤ç”± IOKit å¤„ç†ã€‚</p></li>
<li><p>IOKit å°†è§¦æ‘¸äº‹ä»¶å°è£…æˆä¸€ä¸ª IOHIDEvent å¯¹è±¡ï¼Œå¹¶é€šè¿‡ mach port ä¼ é€’ç»™ SpringBoard è¿›ç¨‹ã€‚</p></li>
</ol>

<blockquote>
<p>mach port è¿›ç¨‹ç«¯å£ï¼Œå„è¿›ç¨‹ä¹‹é—´é€šè¿‡å®ƒè¿›è¡Œé€šä¿¡ã€‚</p>

<p>SpringBoad.app æ˜¯ä¸€ä¸ªç³»ç»Ÿè¿›ç¨‹ï¼Œå¯ä»¥ç†è§£ä¸ºæ¡Œé¢ç³»ç»Ÿï¼Œå¯ä»¥ç»Ÿä¸€ç®¡ç†å’Œåˆ†å‘ç³»ç»Ÿæ¥æ”¶åˆ°çš„è§¦æ‘¸äº‹ä»¶ã€‚</p>
</blockquote>

<ol>
<li>SpringBoard è¿›ç¨‹å› æ¥æ”¶åˆ°è§¦æ‘¸äº‹ä»¶ï¼Œè§¦å‘äº†ä¸»çº¿ç¨‹ runloop çš„ source1 äº‹ä»¶æºçš„å›è°ƒã€‚æ­¤æ—¶ SpringBoard ä¼šæ ¹æ®å½“å‰æ¡Œé¢çš„çŠ¶æ€ï¼Œåˆ¤æ–­åº”è¯¥ç”±è°å¤„ç†æ­¤æ¬¡è§¦æ‘¸äº‹ä»¶ã€‚å› ä¸ºäº‹ä»¶å‘ç”Ÿæ—¶ï¼Œä½ å¯èƒ½æ­£åœ¨æ¡Œé¢ä¸Šç¿»é¡µï¼Œä¹Ÿå¯èƒ½æ­£åœ¨åˆ·å¾®åšã€‚è‹¥æ˜¯å‰è€…ï¼ˆå³å‰å°æ—  APP è¿è¡Œï¼‰ï¼Œåˆ™è§¦å‘ SpringBoard æœ¬èº«ä¸»çº¿ç¨‹ runloop çš„ source0 äº‹ä»¶æºçš„å›è°ƒï¼Œå°†äº‹ä»¶äº¤ç”±æ¡Œé¢ç³»ç»Ÿå»æ¶ˆè€—ï¼›è‹¥æ˜¯åè€…ï¼ˆå³æœ‰ APP æ­£åœ¨å‰å°è¿è¡Œï¼‰ï¼Œåˆ™å°†è§¦æ‘¸äº‹ä»¶é€šè¿‡ IPC ä¼ é€’ç»™å‰å° APP è¿›ç¨‹ï¼Œæ¥ä¸‹æ¥çš„äº‹æƒ…ä¾¿æ˜¯ APP å†…éƒ¨å¯¹äºè§¦æ‘¸äº‹ä»¶çš„å“åº”äº†ã€‚</li>
</ol>

<h3 id="toc_3">APPå“åº”é˜¶æ®µ</h3>

<ol>
<li><p>APP è¿›ç¨‹çš„ mach port æ¥å—åˆ° SpringBoard è¿›ç¨‹ä¼ é€’æ¥çš„è§¦æ‘¸äº‹ä»¶ï¼Œä¸»çº¿ç¨‹çš„ runloop è¢«å”¤é†’ï¼Œè§¦å‘äº† source1 å›è°ƒã€‚</p></li>
<li><p>source1 å›è°ƒåˆè§¦å‘äº†ä¸€ä¸ª source0 å›è°ƒï¼Œå°†æ¥æ”¶åˆ°çš„ IOHIDEvent å¯¹è±¡å°è£…æˆ UIEvent å¯¹è±¡ï¼Œæ­¤æ—¶ APP å°†æ­£å¼å¼€å§‹å¯¹äºè§¦æ‘¸äº‹ä»¶çš„å“åº”ã€‚</p></li>
<li><p>source0 å›è°ƒå†…éƒ¨å°†è§¦æ‘¸äº‹ä»¶æ·»åŠ åˆ° UIApplication å¯¹è±¡çš„äº‹ä»¶é˜Ÿåˆ—ä¸­ã€‚äº‹ä»¶å‡ºé˜Ÿåï¼ŒUIApplication å¼€å§‹ä¸€ä¸ªå¯»æ‰¾æœ€ä½³å“åº”è€…çš„è¿‡ç¨‹ï¼Œè¿™ä¸ªè¿‡ç¨‹åˆç§° Hit-Testingï¼Œç»†èŠ‚å°†åœ¨ä¸‹ä¸€èŠ‚é˜è¿°ã€‚å¦å¤–ï¼Œæ­¤å¤„å¼€å§‹ä¾¿æ˜¯ä¸æˆ‘ä»¬å¹³æ—¶å¼€å‘ç›¸å…³çš„å·¥ä½œäº†ã€‚</p></li>
<li><p>å¯»æ‰¾åˆ°æœ€ä½³å“åº”è€…åï¼Œæ¥ä¸‹æ¥çš„äº‹æƒ…ä¾¿æ˜¯äº‹ä»¶åœ¨å“åº”é“¾ä¸­çš„ä¼ é€’åŠå“åº”äº†ã€‚äº‹å®ä¸Šï¼Œäº‹ä»¶é™¤äº†è¢«å“åº”è€…æ¶ˆè€—ï¼Œè¿˜èƒ½è¢«æ‰‹åŠ¿è¯†åˆ«å™¨æˆ–æ˜¯ Target-Action æ¨¡å¼æ•æ‰å¹¶æ¶ˆè€—æ‰ã€‚å…¶ä¸­æ¶‰åŠå¯¹è§¦æ‘¸äº‹ä»¶çš„å“åº”ä¼˜å…ˆçº§ã€‚</p></li>
<li><p>è§¦æ‘¸äº‹ä»¶å†ç»åå·åè¦ä¹ˆè¢«æŸä¸ªå“åº”å¯¹è±¡æ•è·åé‡Šæ”¾ï¼Œè¦ä¹ˆè‡³æ­»ä¹Ÿæ²¡èƒ½æ‰¾åˆ°èƒ½å¤Ÿå“åº”çš„å¯¹è±¡ï¼Œæœ€ç»ˆé‡Šæ”¾ã€‚è‡³æ­¤ï¼Œè¿™ä¸ªè§¦æ‘¸äº‹ä»¶çš„ä½¿å‘½å°±ç®—ç»ˆç»“äº†ã€‚runloop è‹¥æ²¡æœ‰å…¶ä»–äº‹ä»¶éœ€è¦å¤„ç†ï¼Œä¹Ÿå°†é‡å½’äºçœ ï¼Œç­‰å¾…æ–°çš„äº‹ä»¶åˆ°æ¥åå”¤é†’ã€‚</p></li>
</ol>

<h2 id="toc_4">æ¢æµ‹é“¾ä¸å“åº”é“¾</h2>

<h3 id="toc_5">Hit-Testing</h3>

<p>ä»é€»è¾‘ä¸Šæ¥è¯´ï¼Œæ¢æµ‹é“¾æ˜¯æœ€å…ˆå‘ç”Ÿçš„æœºåˆ¶ï¼Œå½“è§¦æ‘¸äº‹ä»¶å‘ç”Ÿåï¼ŒiOS ç³»ç»Ÿæ ¹æ® Hit-Testing æ¥ç¡®å®šè§¦æ‘¸äº‹ä»¶å‘ç”Ÿåœ¨å“ªä¸ªè§†å›¾å¯¹è±¡ä¸Šã€‚å…¶ä¸­ä¸»è¦ç”¨åˆ°äº†ä¸¤ä¸ª UIView ä¸­çš„æ–¹æ³•ï¼š</p>

<pre><code class="language-text">// recursively calls -pointInside:withEvent:. point is in the receiver&#39;s coordinate system
- (nullable UIView *)hitTest:(CGPoint)point withEvent:(nullable UIEvent *)event;

// default returns YES if point is in bounds
- (BOOL)pointInside:(CGPoint)point withEvent:(nullable UIEvent *)event;
å¤åˆ¶ä»£ç 
</code></pre>

<p>å‰è€…ä¼šé€šè¿‡é€’å½’è°ƒç”¨åè€…æ¥è¿”å›ä¸€ä¸ªé€‚åˆå“åº”è§¦æ‘¸äº‹ä»¶çš„è§†å›¾ï¼Œä¸‹é¢è¿™å¼ å›¾æè¿°äº†è¿™ä¸ªè¿‡ç¨‹ï¼š</p>

<p><img src="media/15654059537017/15654061281073.jpg" alt=""/></p>

<h3 id="toc_6">Responder Chain</h3>

<p>Hit-Testing æ‰¾åˆ°çš„è§†å›¾æ‹¥æœ‰æœ€å…ˆå¯¹è§¦æ‘¸äº‹ä»¶è¿›è¡Œå¤„ç†çš„æœºä¼šï¼Œå¦‚æœè¯¥è§†å›¾æ— æ³•å¤„ç†è¿™ä¸ªäº‹ä»¶ï¼Œé‚£ä¹ˆäº‹ä»¶å¯¹è±¡å°±ä¼šæ²¿ç€å“åº”å™¨çš„è§†å›¾é“¾å‘ä¸Šä¼ é€’ï¼Œç›´åˆ°æ‰¾åˆ°å¯ä»¥å¤„ç†è¯¥äº‹ä»¶çš„å¯¹è±¡ä¸ºæ­¢ã€‚ä¸‹é¢è¿™å¼ å›¾æè¿°äº†è¿™ä¸ªè¿‡ç¨‹ï¼š</p>

<p><img src="media/15654059537017/15654061526891.jpg" alt=""/></p>

<h3 id="toc_7">Demo éªŒè¯</h3>

<p>æ¥ä¸‹æ¥æˆ‘ä»¬é€šè¿‡å®˜æ–¹æ–‡æ¡£çš„ Demo ä»¥ä»£ç çš„æ–¹å¼æ¥è¿›è¡ŒéªŒè¯ï¼š</p>

<p><img src="media/15654059537017/15654061728509.jpg" alt=""/></p>

<p>å¯¹äºæ¯ä¸ª Viewï¼Œæˆ‘ä»¬é‡è½½çˆ¶ç±»çš„æ–¹æ³•ï¼š</p>

<pre><code class="language-text">- (UIView *)hitTest:(CGPoint)point withEvent:(UIEvent *)event
{
    NSLog(@&quot;è¿›å…¥A_View---hitTest withEvent ---&quot;);
    UIView * view = [super hitTest:point withEvent:event];
    NSLog(@&quot;ç¦»å¼€A_View--- hitTest withEvent ---hitTestView:%@&quot;,view);
    return view;
}

- (BOOL)pointInside:(CGPoint)point withEvent:(nullable UIEvent *)event
{
    NSLog(@&quot;A_view--- pointInside withEvent ---&quot;);
    BOOL isInside = [super pointInside:point withEvent:event];
    NSLog(@&quot;A_view--- pointInside withEvent --- isInside:%d&quot;,isInside);
    return isInside;
}

- (void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event
{
    NSLog(@&quot;A_touchesBegan&quot;);
    [super touchesBegan:touches withEvent:event];
}

- (void)touchesMoved:(NSSet&lt;UITouch *&gt; *)touches withEvent:(nullable UIEvent *)event
{
    NSLog(@&quot;A_touchesMoved&quot;);
    [super touchesMoved:touches withEvent:event];
}

- (void)touchesEnded:(NSSet&lt;UITouch *&gt; *)touches withEvent:(nullable UIEvent *)event
{
    NSLog(@&quot;A_touchesEnded&quot;);
    [super touchesEnded:touches withEvent:event];
}

-(void)touchesCancelled:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event
{
    NSLog(@&quot;A_touchesCancelled&quot;);
    [super touchesCancelled:touches withEvent:event];
}
å¤åˆ¶ä»£ç 
</code></pre>

<p>ç‚¹å‡» View Dï¼Œlog æ˜¾ç¤ºå¦‚ä¸‹ï¼Œè¿™ä¸æ¢æµ‹é“¾ä¸å“åº”é“¾çš„æœºåˆ¶çš„æè¿°ç›¸åŒã€‚</p>

<pre><code class="language-text">è¿›å…¥A_View---hitTest withEvent ---
A_view--- pointInside withEvent ---
A_view--- pointInside withEvent --- isInside:1
è¿›å…¥C_View---hitTest withEvent ---
C_view---pointInside withEvent ---
C_view---pointInside withEvent --- isInside:1
è¿›å…¥E_View---hitTest withEvent ---
E_view---pointInside withEvent ---
E_view---pointInside withEvent --- isInside:0
ç¦»å¼€E_View---hitTest withEvent ---hitTestView:(null)
è¿›å…¥D_View---hitTest withEvent ---
D_view---pointInside withEvent ---
D_view---pointInside withEvent --- isInside:1
ç¦»å¼€D_View---hitTest withEvent ---hitTestView:&lt;DView: 0x12dd11e50; frame = (0 37; 240 61); autoresize = RM+BM; layer = &lt;CALayer: 0x283f87b40&gt;&gt;
ç¦»å¼€C_View---hitTest withEvent ---hitTestView:&lt;DView: 0x12dd11e50; frame = (0 37; 240 61); autoresize = RM+BM; layer = &lt;CALayer: 0x283f87b40&gt;&gt;
ç¦»å¼€A_View--- hitTest withEvent ---hitTestView:&lt;DView: 0x12dd11e50; frame = (0 37; 240 61); autoresize = RM+BM; layer = &lt;CALayer: 0x283f87b40&gt;&gt;
è¿›å…¥A_View---hitTest withEvent ---
A_view--- pointInside withEvent ---
A_view--- pointInside withEvent --- isInside:1
è¿›å…¥C_View---hitTest withEvent ---
C_view---pointInside withEvent ---
C_view---pointInside withEvent --- isInside:1
è¿›å…¥E_View---hitTest withEvent ---
E_view---pointInside withEvent ---
E_view---pointInside withEvent --- isInside:0
ç¦»å¼€E_View---hitTest withEvent ---hitTestView:(null)
è¿›å…¥D_View---hitTest withEvent ---
D_view---pointInside withEvent ---
D_view---pointInside withEvent --- isInside:1
ç¦»å¼€D_View---hitTest withEvent ---hitTestView:&lt;DView: 0x12dd11e50; frame = (0 37; 240 61); autoresize = RM+BM; layer = &lt;CALayer: 0x283f87b40&gt;&gt;
ç¦»å¼€C_View---hitTest withEvent ---hitTestView:&lt;DView: 0x12dd11e50; frame = (0 37; 240 61); autoresize = RM+BM; layer = &lt;CALayer: 0x283f87b40&gt;&gt;
ç¦»å¼€A_View--- hitTest withEvent ---hitTestView:&lt;DView: 0x12dd11e50; frame = (0 37; 240 61); autoresize = RM+BM; layer = &lt;CALayer: 0x283f87b40&gt;&gt;
D_touchesBegan
C_touchesBegan
A_touchesBegan
D_touchesEnded
C_touchesEnded
A_touchesEnded
å¤åˆ¶ä»£ç 
</code></pre>

<p>ï¼ˆè¿™é‡Œå…¶å® Hit-Testing è¿›è¡Œäº†ä¸¤æ¬¡ï¼Œå…³äºè¿™ä¸ªé—®é¢˜ï¼Œè‹¹æœå®˜æ–¹æœ‰ç›¸åº”çš„å›å¤ï¼‰</p>

<blockquote>
<p>Yes, itâ€™s normal. The system may tweak the point being hit tested between the calls. Since hitTest should be a pure function with no side-effects, this should be fine.</p>
</blockquote>

<h3 id="toc_8">å°ç»“</h3>

<p><strong>1. ç³»ç»Ÿé€šè¿‡Â <code>hitTest:withEvent:</code>Â æ–¹æ³•æ²¿è§†å›¾å±‚çº§æ ‘ä»åº•å‘ä¸Šï¼ˆä»æ ¹è§†å›¾å¼€å§‹ï¼‰ä»åå‘å‰ï¼ˆä»é€»è¾‘ä¸Šæ›´é è¿‘å±å¹•çš„è§†å›¾å¼€å§‹ï¼‰è¿›è¡Œéå†ï¼Œæœ€ç»ˆè¿”å›ä¸€ä¸ªé€‚åˆå“åº”è§¦æ‘¸äº‹ä»¶çš„ Viewã€‚</strong></p>

<p><strong>2. åŸç”Ÿè§¦æ‘¸äº‹ä»¶ä» Hit-Testing è¿”å›çš„ View å¼€å§‹ï¼Œæ²¿ç€å“åº”é“¾ä»ä¸Šå‘ä¸‹è¿›è¡Œä¼ é€’ã€‚</strong></p>

<p>æ¢æµ‹é“¾ä¸å“åº”é“¾çš„æœºåˆ¶æ€»ä½“æ¯”è¾ƒæ¸…æ™°ï¼Œä¸å†èµ˜è¿°ï¼Œä½†ç†Ÿæ‚‰è¿™ä¸¤ä¸ªæœºåˆ¶å¹¶ä¸èƒ½å¸®æˆ‘ä»¬è§£å†³ä»»ä½•é—®é¢˜ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ç»§ç»­æ·±å…¥æ¢ç©¶ä¸‹æ‰‹åŠ¿è¯†åˆ«å™¨ã€‚</p>

<h2 id="toc_9">æ‰‹åŠ¿è¯†åˆ«å™¨</h2>

<p>æˆ‘ä»¬é¦–å…ˆæ€è€ƒä¸€ä¸ªé—®é¢˜ï¼Œå¯¹äºå®˜æ–¹æ–‡æ¡£é‡Œçš„ Demoï¼Œæˆ‘ä»¬åœ¨æ¯ä¸ª View ä¸Šæ·»åŠ ä¸€ä¸ª UITapGestureRecognizerï¼Œå½“ç‚¹å‡» View D æ—¶ï¼ŒUITapGestureRecognizer ä¹‹é—´çš„å“åº”é¡ºåºæ˜¯ä»€ä¹ˆæ ·çš„ï¼Œå“ªä¸ª View ä¸Šçš„ UITapGestureRecognizer åˆä¼šæœ€ç»ˆå“åº”è¿™ä¸ªäº‹ä»¶ï¼Ÿ</p>

<h3 id="toc_10">å®˜æ–¹æ–‡æ¡£</h3>

<p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹å®˜æ–¹æ–‡æ¡£æ˜¯æ€ä¹ˆè¯´çš„ï¼š</p>

<blockquote>
<p>When a view has multiple gesture recognizers attached to it, you may want to alter how the competing gesture recognizers receive and analyze touch events. By default, there is no set order for which gesture recognizers receive a touch first, and for this reason touches can be passed to gesture recognizers in a different order each time. You can override this default behavior to:</p>

<ul>
<li><p>Specify that one gesture recognizer should analyze a touch before another gesture recognizer.</p></li>
<li><p>Allow two gesture recognizers to operate simultaneously.</p></li>
<li><p>Prevent a gesture recognizer from analyzing a touch.</p></li>
</ul>

<p>Use the UIGestureRecognizer class methods, delegate methods, and methods overridden by subclasses to effect these behaviors.</p>
</blockquote>

<p>æ ¹æ®æ–‡æ¡£çš„è¯´æ³•ï¼Œå½“è§¦æ‘¸äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œå“ªä¸ª UIGestureRecognizer å…ˆæ”¶åˆ°è¿™ä¸ªäº‹ä»¶å¹¶æ²¡æœ‰å›ºå®šçš„é¡ºåºï¼Œå¹¶ä¸”æ–‡æ¡£å»ºè®®æˆ‘ä»¬ä½¿ç”¨ UIGestureRecognizer æä¾›çš„æ–¹æ³•æ¥æ§åˆ¶å®ƒä»¬ä¹‹é—´çš„é¡ºåºå’Œç›¸äº’å…³ç³»ã€‚</p>

<h3 id="toc_11">UIGestureRecognizer Methods</h3>

<p>æ‰€ä»¥æˆ‘ä»¬ä¾æ¬¡çœ‹ä¸‹ç³»ç»Ÿçš„ UIGestureRecognizer éƒ½æä¾›äº†å“ªäº›ä¸å®ƒä»¬ä¹‹é—´ç›¸äº’å…³ç³»æœ‰å…³çš„æ–¹æ³•ï¼š</p>

<pre><code class="language-text">// create a relationship with another gesture recognizer that will prevent this gesture&#39;s actions from being called until otherGestureRecognizer transitions to UIGestureRecognizerStateFailed
// if otherGestureRecognizer transitions to UIGestureRecognizerStateRecognized or UIGestureRecognizerStateBegan then this recognizer will instead transition to UIGestureRecognizerStateFailed
// example usage: a single tap may require a double tap to fail
- (void)requireGestureRecognizerToFail:(UIGestureRecognizer *)otherGestureRecognizer;

// called once per attempt to recognize, so failure requirements can be determined lazily and may be set up between recognizers across view hierarchies
// return YES to set up a dynamic failure requirement between gestureRecognizer and otherGestureRecognizer
//
// note: returning YES is guaranteed to set up the failure requirement. returning NO does not guarantee that there will not be a failure requirement as the other gesture&#39;s counterpart delegate or subclass methods may return YES
- (BOOL)gestureRecognizer:(UIGestureRecognizer *)gestureRecognizer shouldRequireFailureOfGestureRecognizer:(UIGestureRecognizer *)otherGestureRecognizer NS_AVAILABLE_IOS(7_0);
- (BOOL)gestureRecognizer:(UIGestureRecognizer *)gestureRecognizer shouldBeRequiredToFailByGestureRecognizer:(UIGestureRecognizer *)otherGestureRecognizer NS_AVAILABLE_IOS(7_0);
å¤åˆ¶ä»£ç 
</code></pre>

<p>è¿™ä¸‰ä¸ªæ–¹æ³•æ¯”è¾ƒå¸¸ç”¨ï¼Œå®ƒä»¬å¯ä»¥æŒ‡å®š UIGestureRecognizer ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼ŒåŒºåˆ«åœ¨äºç¬¬ä¸€ä¸ªä¸€èˆ¬é€‚ç”¨äºåœ¨åŒä¸€ä¸ª View ä¸­åˆ›å»ºçš„å¤šä¸ª UIGestureRecognizer çš„åœºæ™¯ï¼Œå½“ View å±‚çº§æ¯”è¾ƒå¤æ‚æˆ–è€… UIGestureRecognizer å¤„äº Framework å†…éƒ¨æ—¶å¯ä»¥ç”¨åä¸¤ä¸ªæ–¹æ³•åŠ¨æ€æŒ‡å®šã€‚</p>

<pre><code class="language-text">// called when the recognition of one of gestureRecognizer or otherGestureRecognizer would be blocked by the other
// return YES to allow both to recognize simultaneously. the default implementation returns NO (by default no two gestures can be recognized simultaneously)
//
// note: returning YES is guaranteed to allow simultaneous recognition. returning NO is not guaranteed to prevent simultaneous recognition, as the other gesture&#39;s delegate may return YES
- (BOOL)gestureRecognizer:(UIGestureRecognizer *)gestureRecognizer shouldRecognizeSimultaneouslyWithGestureRecognizer:(UIGestureRecognizer *)otherGestureRecognizer;
å¤åˆ¶ä»£ç 
</code></pre>

<p>è¿™ä¸ªæ–¹æ³•å¯ä»¥æ§åˆ¶ä¸¤ä¸ª UIGestureRecognizer ä¹‹é—´æ˜¯å¦å¯ä»¥åŒæ—¶å¼‚æ­¥è¿›è¡Œï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå‡è®¾å­˜åœ¨ä¸¤ä¸ªå¯èƒ½ä¼šäº’ç›¸ block çš„ UIGestureRecognizerï¼Œç³»ç»Ÿä¼šåˆ†åˆ«å¯¹å®ƒä»¬çš„ delegate è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œåªè¦æœ‰ä¸€ä¸ªè¿”å› YESï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ª UIGestureRecognizer å°±å¯ä»¥åŒæ—¶è¿›è¡Œè¯†åˆ«ï¼Œè¿™ä¸Â <code>shouldRequireFailureOfGestureRecognizer</code>Â æ˜¯ç±»ä¼¼çš„ã€‚</p>

<pre><code class="language-text">// called before touchesBegan:withEvent: is called on the gesture recognizer for a new touch. return NO to prevent the gesture recognizer from seeing this touch
- (BOOL)gestureRecognizer:(UIGestureRecognizer *)gestureRecognizer shouldReceiveTouch:(UITouch *)touch;

// called when a gesture recognizer attempts to transition out of UIGestureRecognizerStatePossible. returning NO causes it to transition to UIGestureRecognizerStateFailed
- (BOOL)gestureRecognizerShouldBegin:(UIGestureRecognizer *)gestureRecognizer;
å¤åˆ¶ä»£ç 
</code></pre>

<p>è¿™ä¸¤ä¸ªæ–¹æ³•éƒ½æ˜¯ç”¨æ¥ç¦æ­¢ UIGestureRecognizer å“åº”è§¦æ‘¸äº‹ä»¶çš„ï¼ŒåŒºåˆ«åœ¨äºï¼Œå½“è§¦æ‘¸äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œä½¿ç”¨ç¬¬ä¸€ä¸ªæ–¹æ³•å¯ä»¥ç«‹å³æ§åˆ¶ UIGestureRecognizer æ˜¯å¦å¯¹å…¶å¤„ç†ï¼Œä¸”ä¸ä¼šä¿®æ”¹ UIGestureRecognizer çš„çŠ¶æ€æœºï¼ˆå› ä¸ºåœ¨è°ƒç”¨è‡ªèº«çš„Â <code>touchesBegan:withEvent:</code>Â ä¹‹å‰ï¼Œè¯¦è§ä¸‹ï¼‰ï¼Œè€Œç¬¬äºŒä¸ªæ–¹æ³•ä¼šç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œåœ¨ UIGestureRecognizer è¯†åˆ«æ‰‹åŠ¿è½¬æ¢çŠ¶æ€æ—¶è°ƒç”¨ï¼Œè¿”å› NO ä¼šæ”¹å˜å…¶çŠ¶æ€æœºï¼Œä½¿å…¶ state å˜ä¸ºÂ <code>UIGestureRecognizerStateFailed</code>ã€‚</p>

<p>æˆ‘ä»¬çœ‹ä¸‹å®˜æ–¹æ–‡æ¡£å¯¹è¿™ä¸¤ä¸ªæ–¹æ³•çš„è¯´æ˜ï¼š</p>

<blockquote>
<p>When a touch begins, if you can immediately determine whether or not your gesture recognizer should consider that touch, use thegestureRecognizer:shouldReceiveTouch: method. This method is called every time there is a new touch. Returning NO prevents the gesture recognizer from being notified that a touch occurred. The default value is YES. This method does not alter the state of the gesture recognizer.</p>

<p>If you need to wait as long as possible before deciding whether or not a gesture recognizer should analyze a touch, use thegestureRecognizerShouldBegin: delegate method. Generally, you use this method if you have a UIView or UIControl subclass with custom touch-event handling that competes with a gesture recognizer. Returning NO causes the gesture recognizer to immediately fail, which allows the other touch handling to proceed. This method is called when a gesture recognizer attempts to transition out of the Possible state, if the gesture recognition would prevent a view or control from receiving a touch.</p>

<p>You can use the gestureRecognizerShouldBegin:UIView method if your view or view controller cannot be the gesture recognizerâ€™s delegate. The method signature and implementation is the same.</p>
</blockquote>

<p>ç¬¬äºŒæ®µä»‹ç»äº†é€šå¸¸æƒ…å†µä¸‹ï¼Œå½“æˆ‘ä»¬çš„å­ç±» UIView æˆ– UIControl æœ‰å’Œ UIGestureRecognizer å†²çªçš„è‡ªå®šä¹‰è§¦æ‘¸äº‹ä»¶æ—¶ï¼Œå¯ä»¥ä½¿ç”¨Â <code>gestureRecognizerShouldBegin:</code>Â æ–¹æ³•è®© UIGestureRecognizer å¤±æ•ˆæ¥ä½¿è‡ªå®šä¹‰çš„è§¦æ‘¸äº‹ä»¶è¿›è¡Œå“åº”ã€‚ç¬¬ä¸‰æ®µè¯´æ˜äº†å½“æˆ‘ä»¬çš„ View ä¸æ˜¯ UIGestureRecognizer çš„ delegate æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ UIView ä¸­çš„Â <code>gestureRecognizerShouldBegin:</code>Â æ–¹æ³•ã€‚å…³äºè¿™ä¸¤æ®µçš„æ„æ€æˆ‘ä»¬ä¼šåœ¨åä¸¤èŠ‚å»è¯¦ç»†è§£é‡Šã€‚</p>

<pre><code class="language-text">// mirror of the touch-delivery methods on UIResponder
// UIGestureRecognizers aren&#39;t in the responder chain, but observe touches hit-tested to their view and their view&#39;s subviews
// UIGestureRecognizers receive touches before the view to which the touch was hit-tested
- (void)touchesBegan:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event;
- (void)touchesMoved:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event;
- (void)touchesEnded:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event;
- (void)touchesCancelled:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event;
- (void)touchesEstimatedPropertiesUpdated:(NSSet&lt;UITouch *&gt; *)touches NS_AVAILABLE_IOS(9_1);
å¤åˆ¶ä»£ç 
</code></pre>

<p>ä¸ UIResponder ä¸­çš„è§¦æ‘¸äº‹ä»¶ç›¸å…³çš„æ–¹æ³•ç›¸åŒï¼ŒUIGestureRecognizer æœ‰ä¸€å¥—è‡ªå·±çš„è§¦æ‘¸äº‹ä»¶çš„æ–¹æ³•ï¼ŒåŒºåˆ«åœ¨äºï¼ŒUIGestureRecognizer å¹¶ä¸åœ¨å“åº”é“¾ä¸­ï¼Œè¿™äº›æ–¹æ³•ä¸€èˆ¬æ˜¯å†™ç”¨æ¥å¯¹ç‰¹å®šçš„æ‰‹åŠ¿è¿›è¡Œåˆ¤æ–­å’Œè¯†åˆ«çš„é€»è¾‘ï¼Œä¾‹å¦‚æˆ‘ä»¬å¯ä»¥åœ¨å­ç±»ä¸­é‡å†™è¿™äº›æ–¹æ³•æ¥åˆ›å»ºè‡ªå·±çš„ UIGestureRecognizerã€‚ä½¿ç”¨Â <code>gestureRecognizer:shouldReceiveTouch:</code>Â å¯ä»¥è®©è¿™äº›æ–¹æ³•ä¸è¢«è°ƒç”¨ã€‚</p>

<p>è‡³æ­¤ï¼ŒUIGestureRecognizer å·²ç»ä¸ºæˆ‘ä»¬æä¾›äº†è¶³å¤Ÿå¤šçš„æ–¹æ³•æ¥æ§åˆ¶å®ƒä»¬ä¹‹é—´çš„ç›¸äº’å…³ç³»äº†ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥åœ¨ Demo ä¸­è¯•è¯•çœ‹ã€‚</p>

<h3 id="toc_12">Demo éªŒè¯</h3>

<p>å¯¹äºå®˜æ–¹æ–‡æ¡£ä¸­çš„ Demo çš„æ¯ä¸ª Viewï¼Œæˆ‘ä»¬å¢åŠ ä¸€ä¸ªç»§æ‰¿è‡ª UITapGestureRecognizer çš„ ZTTapGestureRecognizer å¹¶å®ç°ç›¸åº”çš„å›è°ƒï¼š</p>

<pre><code class="language-text">- (void)singleTapGesture
{
    NSLog(@&quot;A_singleTapGesture&quot;);
}

- (BOOL)gestureRecognizerShouldBegin:(UIGestureRecognizer *)gestureRecognizer
{
    NSLog(@&quot;A_view--- gestureRecognizerShouldBegin: %@ ---&quot;, gestureRecognizer.name);
    return YES;
}

- (BOOL)gestureRecognizer:(UIGestureRecognizer *)gestureRecognizer shouldReceiveTouch:(UITouch *)touch
{
    NSLog(@&quot;A_view--- gestureRecognizer shouldReceiveTouch: %@ ---&quot;, gestureRecognizer.name);
    return YES;
}

- (BOOL)gestureRecognizer:(UIGestureRecognizer *)gestureRecognizer shouldRecognizeSimultaneouslyWithGestureRecognizer:(UIGestureRecognizer *)otherGestureRecognizer
{
    NSLog(@&quot;A_view--- gestureRecognizer: %@ otherGestureRecognizer: %@ ---&quot;, gestureRecognizer.name, otherGestureRecognizer.name);
    return YES;
}

- (instancetype)initWithCoder:(NSCoder *)coder
{
    self = [super initWithCoder:coder];

    if (self)
    {
        ZTTapGestureRecognizer *tapGestureRecognizer = [[ZTTapGestureRecognizer alloc] initWithTarget:self action:@selector(singleTapGesture)];
        tapGestureRecognizer.name = @&quot;A_view_tapGestureRecognizer&quot;;
        tapGestureRecognizer.delegate = self;
        [self addGestureRecognizer:tapGestureRecognizer];
    }

    return self;
}
å¤åˆ¶ä»£ç 
</code></pre>

<p>åœ¨æˆ‘ä»¬å­ç±» ZTTapGestureRecognizer ä¸­é‡å†™çˆ¶ç±»å…³äºè§¦æ‘¸äº‹ä»¶çš„æ–¹æ³•ï¼š</p>

<pre><code class="language-text">@implementation ZTTapGestureRecognizer

- (void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event
{
    NSLog(@&quot;%@_touchesBegan&quot;, self.name);
    [super touchesBegan:touches withEvent:event];
}

- (void)touchesMoved:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event
{
    NSLog(@&quot;%@_touchesMoved&quot;, self.name);
    [super touchesMoved:touches withEvent:event];
}

// NSLog è¦å†™åœ¨ super åé¢æ¥è¯»å– state
- (void)touchesEnded:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event
{
    [super touchesEnded:touches withEvent:event];
    NSLog(@&quot;%@_touchesEndedWithState: %d&quot;, self.name, (int)self.state);
}

// NSLog è¦å†™åœ¨ super åé¢æ¥è¯»å– state
-(void)touchesCancelled:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event
{
    [super touchesCancelled:touches withEvent:event];
    NSLog(@&quot;%@_touchesCancelledWithState: %d&quot;, self.name, (int)self.state);
}

@end
å¤åˆ¶ä»£ç 
</code></pre>

<p>ç‚¹å‡» View Dï¼Œlog æ˜¾ç¤ºå¦‚ä¸‹ï¼š</p>

<pre><code class="language-text">è¿›å…¥A_View---hitTest withEvent ---
A_view--- pointInside withEvent ---
A_view--- pointInside withEvent --- isInside:1
è¿›å…¥C_View---hitTest withEvent ---
C_view---pointInside withEvent ---
C_view---pointInside withEvent --- isInside:1
è¿›å…¥E_View---hitTest withEvent ---
E_view---pointInside withEvent ---
E_view---pointInside withEvent --- isInside:0
ç¦»å¼€E_View---hitTest withEvent ---hitTestView:(null)
è¿›å…¥D_View---hitTest withEvent ---
D_view---pointInside withEvent ---
D_view---pointInside withEvent --- isInside:1
ç¦»å¼€D_View---hitTest withEvent ---hitTestView:&lt;DView: 0x104d31050; frame = (0 37; 240 61); autoresize = RM+BM; gestureRecognizers = &lt;NSArray: 0x281b77fc0&gt;; layer = &lt;CALayer: 0x2815e6ca0&gt;&gt;
ç¦»å¼€C_View---hitTest withEvent ---hitTestView:&lt;DView: 0x104d31050; frame = (0 37; 240 61); autoresize = RM+BM; gestureRecognizers = &lt;NSArray: 0x281b77fc0&gt;; layer = &lt;CALayer: 0x2815e6ca0&gt;&gt;
ç¦»å¼€A_View--- hitTest withEvent ---hitTestView:&lt;DView: 0x104d31050; frame = (0 37; 240 61); autoresize = RM+BM; gestureRecognizers = &lt;NSArray: 0x281b77fc0&gt;; layer = &lt;CALayer: 0x2815e6ca0&gt;&gt;
è¿›å…¥A_View---hitTest withEvent ---
A_view--- pointInside withEvent ---
A_view--- pointInside withEvent --- isInside:1
è¿›å…¥C_View---hitTest withEvent ---
C_view---pointInside withEvent ---
C_view---pointInside withEvent --- isInside:1
è¿›å…¥E_View---hitTest withEvent ---
E_view---pointInside withEvent ---
E_view---pointInside withEvent --- isInside:0
ç¦»å¼€E_View---hitTest withEvent ---hitTestView:(null)
è¿›å…¥D_View---hitTest withEvent ---
D_view---pointInside withEvent ---
D_view---pointInside withEvent --- isInside:1
ç¦»å¼€D_View---hitTest withEvent ---hitTestView:&lt;DView: 0x104d31050; frame = (0 37; 240 61); autoresize = RM+BM; gestureRecognizers = &lt;NSArray: 0x281b77fc0&gt;; layer = &lt;CALayer: 0x2815e6ca0&gt;&gt;
ç¦»å¼€C_View---hitTest withEvent ---hitTestView:&lt;DView: 0x104d31050; frame = (0 37; 240 61); autoresize = RM+BM; gestureRecognizers = &lt;NSArray: 0x281b77fc0&gt;; layer = &lt;CALayer: 0x2815e6ca0&gt;&gt;
ç¦»å¼€A_View--- hitTest withEvent ---hitTestView:&lt;DView: 0x104d31050; frame = (0 37; 240 61); autoresize = RM+BM; gestureRecognizers = &lt;NSArray: 0x281b77fc0&gt;; layer = &lt;CALayer: 0x2815e6ca0&gt;&gt;
D_view--- gestureRecognizer shouldReceiveTouch: D_view_tapGestureRecognizer ---
C_view--- gestureRecognizer shouldReceiveTouch: C_view_tapGestureRecognizer ---
A_view--- gestureRecognizer shouldReceiveTouch: A_view_tapGestureRecognizer ---
D_view_tapGestureRecognizer_touchesBegan
A_view_tapGestureRecognizer_touchesBegan
C_view_tapGestureRecognizer_touchesBegan
D_touchesBegan
C_touchesBegan
A_touchesBegan
D_view--- gestureRecognizerShouldBegin: D_view_tapGestureRecognizer ---
D_view_tapGestureRecognizer_touchesEndedWithState: 3
D_view--- gestureRecognizerShouldBegin: A_view_tapGestureRecognizer ---
A_view--- gestureRecognizerShouldBegin: A_view_tapGestureRecognizer ---
A_view_tapGestureRecognizer_touchesEndedWithState: 3
D_view--- gestureRecognizerShouldBegin: C_view_tapGestureRecognizer ---
C_view--- gestureRecognizerShouldBegin: C_view_tapGestureRecognizer ---
C_view_tapGestureRecognizer_touchesEndedWithState: 3
A_view--- gestureRecognizer: A_view_tapGestureRecognizer otherGestureRecognizer: (null) ---
C_view--- gestureRecognizer: C_view_tapGestureRecognizer otherGestureRecognizer: (null) ---
D_view--- gestureRecognizer: D_view_tapGestureRecognizer otherGestureRecognizer: (null) ---
A_view--- gestureRecognizer: A_view_tapGestureRecognizer otherGestureRecognizer: C_view_tapGestureRecognizer ---
A_view--- gestureRecognizer: A_view_tapGestureRecognizer otherGestureRecognizer: D_view_tapGestureRecognizer ---
C_view--- gestureRecognizer: C_view_tapGestureRecognizer otherGestureRecognizer: A_view_tapGestureRecognizer ---
C_view--- gestureRecognizer: C_view_tapGestureRecognizer otherGestureRecognizer: D_view_tapGestureRecognizer ---
D_view--- gestureRecognizer: D_view_tapGestureRecognizer otherGestureRecognizer: A_view_tapGestureRecognizer ---
D_view--- gestureRecognizer: D_view_tapGestureRecognizer otherGestureRecognizer: C_view_tapGestureRecognizer ---
A_singleTapGesture
D_touchesCancelled
C_touchesCancelled
A_touchesCancelled
C_singleTapGesture
D_singleTapGesture
å¤åˆ¶ä»£ç 
</code></pre>

<p>ä¿¡æ¯é‡æœ‰ç‚¹å¤§ï¼Œæˆ‘ä»¬ä¸€ç‚¹ä¸€ç‚¹æ¥åˆ†æï¼ˆ<strong>å…ˆå¿½ç•¥ View å“åº”é“¾é‡Œ UIResponder ç›¸å…³çš„è§¦æ‘¸äº‹ä»¶æ–¹æ³•ï¼Œè¿™äº›ä¼šåœ¨ä¸‹ä¸€èŠ‚è¿›è¡Œæ¢è®¨</strong>ï¼‰ï¼Œé¦–å…ˆç³»ç»Ÿé€šè¿‡ Hit-Testing æœºåˆ¶æ‰¾åˆ°äº†é€‚åˆå“åº”çš„ View Dï¼Œæ¥ä¸‹æ¥è°ƒç”¨äº†æ–¹æ³•ï¼š</p>

<pre><code class="language-text">D_view--- gestureRecognizer shouldReceiveTouch: D_view_tapGestureRecognizer ---
C_view--- gestureRecognizer shouldReceiveTouch: C_view_tapGestureRecognizer ---
A_view--- gestureRecognizer shouldReceiveTouch: A_view_tapGestureRecognizer ---
å¤åˆ¶ä»£ç 
</code></pre>

<p>ä¸Šæ–‡å·²ç»å¯¹Â <code>gestureRecognizer:shouldReceiveTouch:</code>Â è§£é‡Šè¿‡ï¼Œå…ˆè°ƒç”¨å®ƒæ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œä½†æ˜¯åœ¨å¤šæ¬¡å®éªŒä¸­ï¼Œä¸€ç›´éƒ½æ˜¯ D C A çš„é¡ºåºï¼Œè€Œ UIGestureRecognizer å…¶ä»–çš„ Delegate Method å´æœ‰å¯èƒ½æ˜¯ä¸åŒçš„é¡ºåºï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p>

<p>æˆ‘ä»¬æ¥çœ‹ä¸‹ View D è¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨æ ˆï¼š</p>

<p><img src="media/15654059537017/15654062505074.jpg" alt=""/></p>

<p>å¯ä»¥çœ‹åˆ°ï¼ŒUITouchesEvent éå†äº†ä¸€ä¸ª View æ•°ç»„ï¼Œç³»ç»Ÿé€šè¿‡ Hit-Testing è¿‡ç¨‹å¾—åˆ°äº†é€‚åˆå“åº”è§¦æ‘¸äº‹ä»¶çš„ View Dï¼Œéšåä¼šæ ¹æ®è¿™ä¸ª View çš„å±‚çº§å…³ç³»å¾—åˆ°ä¸€ä¸ªå“åº”é“¾ View æ•°ç»„ [D_view, C_view, A_view, ..., ZTWindow] ç„¶åéå†è¿™ä¸ªæ•°ç»„å»ä¾æ¬¡åˆ¤æ–­æ¯ä¸ª View ä¸Šçš„ UIGestureRecognizer æ˜¯å¦è¦æ¥æ”¶è§¦æ‘¸äº‹ä»¶ï¼Œæ²¡æœ‰ç»‘å®šåˆ°è¿™ä¸ªå“åº”é“¾ View æ•°ç»„ä¸Šçš„ UIGestureRecognizer ä¸å†æœ‰æœºä¼šå»å¤„ç†è§¦æ‘¸äº‹ä»¶ï¼Œå…³äºåŸå› åé¢ä¼šè§£é‡Šã€‚</p>

<p>æ¥ä¸‹æ¥è°ƒç”¨äº†æ–¹æ³•ï¼š</p>

<pre><code class="language-text">D_view_tapGestureRecognizer_touchesBegan
A_view_tapGestureRecognizer_touchesBegan
C_view_tapGestureRecognizer_touchesBegan

D_view--- gestureRecognizerShouldBegin: D_view_tapGestureRecognizer ---
D_view_tapGestureRecognizer_touchesEndedWithState: 3
D_view--- gestureRecognizerShouldBegin: A_view_tapGestureRecognizer ---
A_view--- gestureRecognizerShouldBegin: A_view_tapGestureRecognizer ---
A_view_tapGestureRecognizer_touchesEndedWithState: 3
D_view--- gestureRecognizerShouldBegin: C_view_tapGestureRecognizer ---
C_view--- gestureRecognizerShouldBegin: C_view_tapGestureRecognizer ---
C_view_tapGestureRecognizer_touchesEndedWithState: 3
å¤åˆ¶ä»£ç 
</code></pre>

<p>View A ä¸­Â <code>gestureRecognizerShouldBegin:</code>Â æ–¹æ³•çš„è°ƒç”¨æ ˆï¼š</p>

<p><img src="media/15654059537017/15654062776619.jpg" alt=""/></p>

<p>ç”±äºæˆ‘ä»¬çš„Â <code>gestureRecognizer:shouldReceiveTouch:</code>Â éƒ½è¿”å›äº† YESï¼Œ3ä¸ª View ä¸Šçš„ UIGestureRecognizer åˆ†åˆ«æ”¶åˆ°äº†Â <code>touchesBegan</code>Â å’ŒÂ <code>touchesEnd</code>Â ç­‰è§¦æ‘¸äº‹ä»¶ç›¸å…³çš„ æ–¹æ³•å¹¶å¼€å§‹å¯¹è§¦æ‘¸æ‰‹åŠ¿è¿›è¡Œè¯†åˆ«ã€‚ä»è°ƒç”¨æ ˆä¸­å¯ä»¥çœ‹å‡ºï¼Œåœ¨Â <code>touchesEnd</code>Â æ–¹æ³•ä¸­æ‰‹åŠ¿è¯†åˆ«å®Œæˆä¹‹åå³å°†è¿›è¡ŒçŠ¶æ€è½¬æ¢ä¹‹å‰è°ƒç”¨äº†Â <code>gestureRecognizerShouldBegin:</code>Â æ–¹æ³•åˆ¤æ–­æ˜¯å¦åº”è¯¥è¿›è¡Œæ‰‹åŠ¿è¯†åˆ«æˆåŠŸçš„çŠ¶æ€è½¬æ¢ï¼Œç”±äºæˆ‘ä»¬çš„æ–¹æ³•éƒ½è¿”å›äº† YESï¼Œå¯ä»¥çœ‹åˆ°åœ¨Â <code>touchesEnd</code>Â æ–¹æ³•å®Œæˆä¹‹å3ä¸ª UIGestureRecognizer éƒ½æˆåŠŸè¯†åˆ«äº†æ‰‹åŠ¿å¹¶ä¸”è‡ªèº«çš„ state éƒ½å˜æˆäº†Â <code>UIGestureRecognizerStateEnded</code>ï¼Œè¿™äº›ä¸æˆ‘ä»¬ä¸Šä¸€å°èŠ‚çš„æè¿°æ˜¯ç›¸ç¬¦çš„ã€‚</p>

<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¯¹äº A_view_tapGestureRecognizer å’Œ C_view_tapGestureRecognizer æ¥è¯´ï¼Œé™¤äº†å®ƒä»¬å„è‡ªçš„ delegateï¼Œæœ€ä¸Šå±‚çš„ View D ä¹Ÿæ”¶åˆ°äº†ä»–ä»¬çš„Â <code>gestureRecognizerShouldBegin:</code>Â å›è°ƒï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå›é¡¾ä¸Šä¸€å°èŠ‚å…³äºè¿™ä¸ªæ–¹æ³•å®˜æ–¹æ–‡æ¡£çš„è§£é‡Šï¼ŒUIView è‡ªèº«ä¹Ÿæœ‰ä¸€ä¸ªÂ <code>gestureRecognizerShouldBegin:</code>Â æ–¹æ³•ï¼Œå½“ View ä¸æ˜¯ UIGestureRecognizer çš„ delegate æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–¹æ³•æ¥ä½¿ UIGestureRecognizer å¤±æ•ˆã€‚å¯¹äºæ‰€æœ‰ç»‘å®šåˆ°çˆ¶ View ä¸Šçš„ UIGestureRecognizerï¼Œé™¤äº†å®ƒä»¬æœ¬èº«çš„ delegate ä¹‹å¤–ï¼ŒHit-Testing è¿”å›çš„ View ä¹Ÿä¼šæ”¶åˆ°è¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨ï¼Œå…³äºåŸå› æˆ‘ä»¬ä¼šåœ¨ä¸‹ä¸€èŠ‚è¿›è¡Œè§£é‡Šã€‚</p>

<p>æ¥ä¸‹æ¥çš„ log æ˜¯ UIGestureRecognizer æ˜¯å¦å¯ä»¥åŒæ—¶å¤„ç†è§¦æ‘¸äº‹ä»¶çš„å›è°ƒæ–¹æ³•ï¼Œå…¶ä¸­çš„ null æ˜¯ç³»ç»Ÿçš„æ‰‹åŠ¿ UIScreenEdgePanGestureRecognizerï¼Œç”±äº Demo ä½¿ç”¨äº† UINavigationController ç³»ç»Ÿä¼šé¦–å…ˆåˆ¤æ–­è¿™ä¸ªæ‰‹åŠ¿æ³•æ˜¯å¦èƒ½åŒæ—¶å“åº”ã€‚å¯ä»¥çœ‹åˆ°ï¼Œç”±äºè¿™3ä¸ª View ä¸Šä¸€å…±å­˜åœ¨3ä¸ª UIGestureRecognizerï¼Œç³»ç»Ÿä¸€å…±è°ƒç”¨äº†6æ¬¡å›è°ƒæ–¹æ³•æ‰å¯ä»¥ç¡®å®šå®ƒä»¬ä¹‹é—´çš„å…³ç³»ï¼Œè¿™å’Œæˆ‘ä»¬ä¸Šæ–‡å¯¹è¯¥æ–¹æ³•çš„æè¿°ç›¸ç¬¦ã€‚</p>

<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒUIGestureRecognizer è§¦æ‘¸äº‹ä»¶ç›¸å…³çš„æ–¹æ³•Â <code>touchesBegan</code>Â ç­‰å’ŒÂ <code>gestureRecognizerShouldBegin:</code>Â å¯¹äº View A C D æ¥è¯´æ¯æ¬¡è¿è¡Œé¡ºåºæ˜¯ä¸ä¸€æ ·çš„ï¼ˆ<code>gestureRecognizer:shouldReceiveTouch:</code>Â æ¯æ¬¡éƒ½æ˜¯ D C Aï¼‰ï¼Œä½†æœ€ç»ˆ UIGestureRecognizer çš„ Action Method çš„é¡ºåºå´ä¸€å®šæ˜¯ A C Dï¼š</p>

<pre><code class="language-text">A_singleTapGesture
C_singleTapGesture
D_singleTapGesture
å¤åˆ¶ä»£ç 
</code></pre>

<p>åŒæ—¶ï¼Œå½“Â <code>shouldRecognizeSimultaneouslyWithGestureRecognizer</code>Â éƒ½è¿”å› NO æ—¶ï¼ŒView D ä¸Šçš„ UIGestureRecognizer å¯ä»¥å“åº”æˆåŠŸã€‚è¿™åˆæ˜¯ä»€ä¹ˆåŸå› å‘¢ï¼Ÿ</p>

<p>æˆ‘ä»¬åœ¨ä¸Šä¸€æ­¥ UITouchesEvent éå†å“åº”é“¾ View æ•°ç»„çš„è¿‡ç¨‹ä¸­å¾—åˆ°äº†ä¸€ä¸ª UIGestureRecognizer æ•°ç»„ [D_view_tapGestureRecognizer, C_view_tapGestureRecognizer, A_view_tapGestureRecognizer] éšåç³»ç»Ÿéå†äº†è¿™ä¸ªæ•°ç»„æ¥è¿›è¡Œå¤„ç†ï¼Œè¿™é‡ŒçŒœæµ‹å®ƒä»¬çš„Â <code>touchesBegan</code>Â ç­‰æ–¹æ³•çš„é¡ºåºåº”è¯¥ä¸å…·ä½“çš„å®ç°æœ‰å…³ï¼ˆä¸ªäººçŒœæµ‹å¯èƒ½ä¸ UIGestureEnvironment é‡Œä¿å­˜çš„ UIGestureRecognizer çš„æ•°æ®ç»“æ„å®é™…ä¸Šä¸æ˜¯æ•°ç»„è€Œæ˜¯å›¾æœ‰å…³ç³»ï¼‰ï¼Œè€Œ Action Method çš„é¡ºåºä»¥åŠæœ€åç¡®ä¿ View D ä¸Šçš„ UIGestureRecognizer èƒ½å¤Ÿå“åº”æˆåŠŸåº”è¯¥ä¹Ÿæ˜¯ç›®å‰å®˜æ–¹æœªè¯´æ˜çš„æŸç§æœºåˆ¶ã€‚</p>

<p>è¿˜æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>gestureRecognizer:shouldReceiveTouch:</code>Â ä¸å…¶ä»–çš„æ–¹æ³•ä¸å±äºç›¸åŒçš„è°ƒç”¨æ ˆï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹å…¶ä»–æ–¹æ³•çš„è°ƒç”¨æ ˆï¼š</p>

<p><img src="media/15654059537017/15654062975213.jpg" alt=""/></p>

<p><img src="media/15654059537017/15654063204292.jpg" alt=""/></p>

<p>å¯ä»¥çœ‹åˆ°ï¼Œæœ€å…ˆç”± UIApplication é€šè¿‡Â <code>sendEvent:</code>Â å‘é€äº† UIEvent äº‹ä»¶ï¼Œç„¶åè¢« UIWindow è½¬å‘ç»™äº† UIGestureEnvironmentï¼Œè€Œ UIGestureEnvironment é€šè¿‡éå†ä¸€ä¸ª UIGestureRecognizer æ•°ç»„æ¥è°ƒèµ·ç›¸å…³çš„ UIGestureRecognizer æ–¹æ³•ã€‚</p>

<p>åˆ°æ­¤ä¸ºæ­¢ï¼Œæ•´ä¸ªè¿‡ç¨‹ä»ç„¶æœ‰å¾ˆå¤šç–‘ç‚¹ï¼Œæˆ‘ä»¬é‡æ–°è¿›è¡Œä¸‹æ¢³ç†ã€‚</p>

<h3 id="toc_13">UIEvent ä¸ UIGestureEnvironment</h3>

<p>å®é™…ä¸Šï¼Œç³»ç»Ÿæœ€å…ˆé€šè¿‡ Hit-Testing æœºåˆ¶æ¥å¯¹ UIEvent è¿›è¡Œäº†åŒ…è£…ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸‹ UIEvent è¿™ä¸ªç±»ï¼š</p>

<pre><code class="language-text">NS_CLASS_AVAILABLE_IOS(2_0) @interface UIEvent : NSObject

@property(nonatomic,readonly) UIEventType     type NS_AVAILABLE_IOS(3_0);
@property(nonatomic,readonly) UIEventSubtype  subtype NS_AVAILABLE_IOS(3_0);

@property(nonatomic,readonly) NSTimeInterval  timestamp;

#if UIKIT_DEFINE_AS_PROPERTIES
@property(nonatomic, readonly, nullable) NSSet &lt;UITouch *&gt; *allTouches;
#else
- (nullable NSSet &lt;UITouch *&gt; *)allTouches;
#endif
- (nullable NSSet &lt;UITouch *&gt; *)touchesForWindow:(UIWindow *)window;
- (nullable NSSet &lt;UITouch *&gt; *)touchesForView:(UIView *)view;
- (nullable NSSet &lt;UITouch *&gt; *)touchesForGestureRecognizer:(UIGestureRecognizer *)gesture NS_AVAILABLE_IOS(3_2);

@end
å¤åˆ¶ä»£ç 
</code></pre>

<p>å¯ä»¥çœ‹åˆ° UIEvent æ‰€æœ‰çš„å±æ€§éƒ½æ˜¯åªè¯»ä»¥é˜²æ­¢è¢«ä¿®æ”¹ï¼Œåœ¨ View A çš„Â <code>hitTest:withEvent:</code>Â æ–¹æ³•ä¸­ï¼Œå®é™…ä¼ é€’çš„æ˜¯å®ƒçš„å­ç±» UITouchesEventï¼š</p>

<p><img src="media/15654059537017/15654063416976.jpg" alt=""/></p>

<p>åœ¨ Hit-Testing é˜¶æ®µï¼ŒUIEvent åªåŒ…å«äº†ä¸€ä¸ªæ—¶é—´æˆ³ä¿¡æ¯ï¼Œæˆ‘ä»¬åœ¨ View A çš„Â <code>hitTest:withEvent:</code>æ–¹æ³•ä¸­æ‰“æ–­ç‚¹æ¥æŸ¥çœ‹ä¸‹ UITouchesEvent çš„å†…å®¹ï¼š</p>

<p><img src="media/15654059537017/15654063597676.jpg" alt=""/></p>

<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç»§æ‰¿ UIWindow æ¥æˆªè·Â <code>sendEvent:</code>Â äº‹ä»¶ï¼Œå¹¶æ‰“æ–­ç‚¹æ¥æŸ¥çœ‹æ­¤æ—¶ UIEvent çš„ä¿¡æ¯ï¼Œæ­¤æ—¶ UIEvent ä¸­å¤šäº† UITouchï¼š</p>

<p><img src="media/15654059537017/15654063714528.jpg" alt=""/></p>

<pre><code class="language-text">Printing description of event:
&lt;UITouchesEvent: 0x2819a8120&gt; timestamp: 875742 touches: {(
    &lt;UITouch: 0x11bd35960&gt; phase: Began tap count: 1 force: 0.000 window: &lt;UIWindow: 0x11bd1c610; frame = (0 0; 414 736); gestureRecognizers = &lt;NSArray: 0x2825c94d0&gt;; layer = &lt;UIWindowLayer: 0x282bb5900&gt;&gt; view: &lt;DView: 0x11be2faa0; frame = (0 37; 240 61); autoresize = RM+BM; gestureRecognizers = &lt;NSArray: 0x2825f2a60&gt;; layer = &lt;CALayer: 0x282b894a0&gt;&gt; location in window: {234.66665649414062, 482.66665649414062} previous location in window: {234.66665649414062, 482.66665649414062} location in view: {147.66665649414062, 35.666656494140625} previous location in view: {147.66665649414062, 35.666656494140625}
)}
å¤åˆ¶ä»£ç 
</code></pre>

<p>æ ¹æ® UIEvent å’Œ UITouchesEvent çš„ API å’Œä»¥ä¸Šä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥æ¨æ–­ï¼Œç³»ç»Ÿé€šè¿‡ Hit-Testing è®°å½•äº†é€‚åˆå“åº”è§¦æ‘¸äº‹ä»¶çš„ View ä¸ Window ç­‰ä¿¡æ¯ï¼Œåœ¨ Hit-Testing å®Œæˆä¹‹åï¼Œåˆ›å»ºäº† UITouch å¹¶å°†å…¶ä¿å­˜åœ¨ UIEvent ä¸­è¿›è¡Œå‘é€ã€‚UIApplication èƒ½å¤Ÿé€šè¿‡Â <code>sendEvent:</code>Â æ–¹æ³•å‘é€äº‹ä»¶ç»™æ­£ç¡®çš„ UIWindow æ­£æ˜¯ç”±äºåœ¨ Hit-Testing è¿‡ç¨‹ä¸­ç³»ç»Ÿè®°å½•äº†èƒ½å¤Ÿå“åº”è§¦æ‘¸äº‹ä»¶çš„ Windowã€‚</p>

<p>è€Œ UITouch ä¸­çš„ UIGestureRecognizer æ•°ç»„æ­£æ˜¯é€šè¿‡å‰é¢æåˆ°çš„Â <code>gestureRecognizer:shouldReceiveTouch:</code>Â æ¥ç”Ÿæˆçš„ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹åœ¨ Hit-Testing å®Œæˆä¹‹åï¼Œ<code>sendEvent:</code>Â è°ƒç”¨ä¹‹å‰ï¼ŒView D çš„Â <code>gestureRecognizer:shouldReceiveTouch:</code>Â æ–¹æ³•ä¸­çš„ UITouchï¼š</p>

<p><img src="media/15654059537017/15654063890469.jpg" alt=""/></p>

<p>æ­¤æ—¶ï¼ŒWindow å’Œ DView å·²ç»é€šè¿‡ Hit-Testing æ‰¾åˆ°ï¼Œä½†æ˜¯Â <code>_gestureRecognizers</code>Â ä»ç„¶ä¸ºç©ºï¼Œè€Œåœ¨è¯¥æ–¹æ³•è¿”å› YES ä¹‹åï¼Œæˆ‘ä»¬åœ¨ View C çš„Â <code>gestureRecognizer:shouldReceiveTouch:</code>Â æ–¹æ³•ä¸­å¯ä»¥çœ‹åˆ°ï¼š</p>

<p><img src="media/15654059537017/15654064024881.jpg" alt=""/></p>

<p>æ­¤æ—¶ D_view_tapGestureRecognizer å·²ç»è¢«æ·»åŠ åˆ°äº†æ•°ç»„ä¸­ï¼ŒåŒæ ·çš„ï¼Œåœ¨ View A çš„æ–¹æ³•ä¸­ï¼ŒC_view_tapGestureRecognizer è¢«æ·»åŠ åˆ°äº†æ•°ç»„ä¸­ï¼Œåœ¨æœ€ç»ˆçš„ UIEvent ä¸­çš„ UITouch é‡Œï¼Œ3ä¸ª UIGestureRecognizer éƒ½è¢«ä¿å­˜äº†èµ·æ¥ï¼Œæ‰€ä»¥ UIApplication æ‰çŸ¥é“å¦‚ä½•å‘æ­£ç¡®çš„ UIGestureRecognizer å‘é€è§¦æ‘¸äº‹ä»¶ã€‚</p>

<p>æ¥ä¸‹æ¥è¯´ä¸‹ UIGestureEnvironmentï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºå®ƒæ˜¯ç®¡ç†æ‰€æœ‰æ‰‹åŠ¿çš„ä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œå½“è°ƒç”¨Â <code>addGestureRecognizer:</code>Â æ–¹æ³•æ—¶ä¼šå°† UIGestureRecognizer åŠ å…¥åˆ°å…¶ä¸­ã€‚ä¸‹é¢æ˜¯ UIGestureEnvironment çš„ç»“æ„ï¼š</p>

<pre><code class="language-text">@interface UIApplication : UIResponder  {
    UIGestureEnvironment * __gestureEnvironment;
    }
@end

@interface UIGestureRecognizer : NSObject {
    UIGestureEnvironment * _gestureEnvironment;
    }
@end

@interface UIGestureEnvironment : NSObject {

    CFRunLoopObserverRef _gestureEnvironmentUpdateObserver;
    NSMutableSet* _gestureRecognizersNeedingUpdate;
    NSMutableSet* _gestureRecognizersNeedingReset;
    NSMutableSet* _gestureRecognizersNeedingRemoval;
    NSMutableArray* _dirtyGestureRecognizers;
    NSMutableArray* _delayedTouches;
    NSMutableArray* _delayedTouchesToSend;
    NSMutableArray* _delayedPresses;
    NSMutableArray* _delayedPressesToSend;
    NSMutableArray* _preUpdateActions;
    bool _dirtyGestureRecognizersUnsorted;
    bool _updateExclusivity;
    UIGestureGraph* _dependencyGraph;
    NSMapTable* _nodesByGestureRecognizer;

}

-(void)addGestureRecognizer:(id)arg1 ;
-(void)removeGestureRecognizer:(id)arg1 ;
-(void)_cancelGestureRecognizers:(id)arg1 ;
-(void)_updateGesturesForEvent:(id)arg1 window:(id)arg2 ;
ï¼ˆçœç•¥äº†å¾ˆå¤š APIï¼‰
-(void)_cancelTouches:(id)arg1 event:(id)arg2 ;
-(void)_cancelPresses:(id)arg1 event:(id)arg2 ;
@end
å¤åˆ¶ä»£ç 
</code></pre>

<p>UIApplication å’Œ UIGestureRecognizer ä¸­ä¿å­˜äº†åŒä¸€ä¸ª UIGestureEnvironment å¯¹è±¡ï¼Œæ ¹æ®ä¸Šé¢ UIGestureRecognizer çš„ Action Method çš„è°ƒç”¨æ ˆï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒUIWindow é€šè¿‡Â <code>sendEvent:</code>å‘é€äº‹ä»¶ä¹‹åï¼ŒUIGestureEnvironment æ¥æ”¶äº†è¿™ä¸ªäº‹ä»¶å¹¶ä¸”æœ€ç»ˆé€šè¿‡æ–¹æ³•ï¼š</p>

<pre><code class="language-text">-[UIGestureEnvironment _updateForEvent:window:] ()
-[UIGestureEnvironment _deliverEvent:toGestureRecognizers:usingBlock:] ()
å¤åˆ¶ä»£ç 
</code></pre>

<p>æ¥å¯¹ UIGestureRecognizer ç›¸å…³æ–¹æ³•è¿›è¡Œè°ƒç”¨ï¼š</p>

<ol>
<li>å¯¹èƒ½å¤Ÿå¤„ç†äº‹ä»¶çš„ UIGestureRecognizer å‘é€Â <code>touchesBegan:withEvent:</code>Â ç­‰è§¦æ‘¸äº‹ä»¶çš„æ–¹æ³•</li>
<li>é€šè¿‡Â <code>gestureRecognizerShouldBegin</code>Â æ–¹æ³•åˆ¤æ–­æ˜¯å¦åº”è¯¥è¿›è¡ŒçŠ¶æ€è½¬æ¢</li>
<li>è¯¢é—® UIGestureRecognizer çš„ delegate æ˜¯å¦åº”è¯¥å¤±æ•ˆæˆ–è€…æ˜¯å¦èƒ½å¤ŸåŒæ—¶å¤„ç†äº‹ä»¶<code>gestureRecognizer:shouldRequireFailureOfGestureRecognizer:</code><code>gestureRecognizer:shouldRecognizeSimultaneouslyWithGestureRecognizer:</code></li>
<li>UIGestureRecognizer è¯†åˆ«äº‹ä»¶ä¹‹åæœ€ç»ˆè°ƒç”¨äº† Action Method</li>
</ol>

<h3 id="toc_14">å°ç»“</h3>

<p><strong>1. ç³»ç»Ÿåœ¨æ¢æµ‹é˜¶æ®µç»“æŸååˆ›å»ºäº† UITouchï¼Œå¹¶å°è£…äº† UIEvent å°†å…¶ä¼ é€’ã€‚</strong></p>

<p><strong>2. æ‰‹åŠ¿ä¸Šä¸‹æ–‡ UIGestureEnvironment æœ€å…ˆæ”¶åˆ° UIEventï¼Œå¹¶è´Ÿè´£é€šçŸ¥ç»™ç›¸å…³çš„ UIGestureRecognizerã€‚</strong></p>

<p><strong>3. UIGestureEnvironment æ ¹æ® UIGestureRecognizer çš„ delegate æ–¹æ³•æ¥åˆ¤æ–­å…¶æ˜¯å¦èƒ½å¤Ÿå¯¹è§¦æ‘¸äº‹ä»¶è¿›è¡Œå“åº”ã€‚</strong></p>

<p>è‡³æ­¤ï¼ŒUIGestureRecognizer å¯¹äº‹ä»¶çš„å¤„ç†ä»¥åŠå®ƒä»¬ä¹‹é—´çš„ç›¸äº’å…³ç³»å‘Šä¸€æ®µè½ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå»ºè®®æœ€å¥½ä½¿ç”¨å®˜æ–¹æ–‡æ¡£æ¨èçš„æ–¹æ³•å¯¹ UIGestureRecognizer è¿›è¡Œæ§åˆ¶ï¼Œè€Œä¸è¦ä¾èµ–ä¸Šæ–‡ä¸­æ²¡æœ‰å­˜åœ¨äºæ–‡æ¡£ä¸­çš„å…·ä½“å®ç°ç»†èŠ‚å’Œç»“è®ºï¼Œè‹¹æœæ²¡æœ‰å¯¹å¤–æš´éœ²è¿™äº›ï¼Œæœ‰å¯èƒ½ä¼šåœ¨æ¥ä¸‹æ¥çš„ç‰ˆæœ¬ä¸­ä¿®æ”¹å…·ä½“å®ç°ã€‚</p>

<h2 id="toc_15">æ‰‹åŠ¿è¯†åˆ«å™¨ä¸åŸç”Ÿè§¦æ‘¸äº‹ä»¶</h2>

<p>æ¥ä¸‹æ¥æˆ‘ä»¬ç»ˆäºå¯ä»¥å¯¹ä¸Šä¸€èŠ‚ä¸­ UIResponder ç›¸å…³çš„ç³»ç»ŸåŸç”Ÿè§¦æ‘¸äº‹ä»¶æ–¹æ³•è¿›è¡Œæ¢è®¨äº†ï¼Œæˆ‘ä»¬å»æ‰ Hit-Testing ä¸ UIGestureRecognizer çš„ delegate ç­‰ç›¸å…³æ–¹æ³•ï¼Œé‡æ–°è¿è¡Œ Demoï¼Œç‚¹å‡» View Dï¼Œlog æ˜¾ç¤ºå¦‚ä¸‹ï¼š</p>

<pre><code class="language-text">A_view_tapGestureRecognizer_touchesBegan
D_view_tapGestureRecognizer_touchesBegan
C_view_tapGestureRecognizer_touchesBegan
D_touchesBegan
C_touchesBegan
A_touchesBegan
A_singleTapGesture
D_touchesCancelled
C_touchesCancelled
A_touchesCancelled
C_singleTapGesture
D_singleTapGesture
å¤åˆ¶ä»£ç 
</code></pre>

<h3 id="toc_16">å®˜æ–¹æ–‡æ¡£</h3>

<p>æŒ‰ç…§æƒ¯ä¾‹ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹å®˜æ–¹æ–‡æ¡£æ˜¯æ€ä¹ˆè¯´çš„ï¼š</p>

<blockquote>
<p>There may be times when you want a view to receive a touch before a gesture recognizer. But, before you can alter the delivery path of touches to views, you need to understand the default behavior. In the simple case, when a touch occurs, the touch object is passed from the UIApplication object to the UIWindow object. Then, the window first sends touches to any gesture recognizers attached the view where the touches occurred (or to that viewâ€™s superviews), before it passes the touch to the view object itself.</p>

<p>Gesture Recognizers Get the First Opportunity to Recognize a Touch</p>

<p>A window delays the delivery of touch objects to the view so that the gesture recognizer can analyze the touch first. During the delay, if the gesture recognizer recognizes a touch gesture, then the window never delivers the touch object to the view, and also cancels any touch objects it previously sent to the view that were part of that recognized sequence.</p>
</blockquote>

<p><img src="media/15654059537017/15654064332119.jpg" alt=""/></p>

<p>æ–‡æ¡£å®é™…ä¸Šè¯´çš„æ¯”è¾ƒæ¸…æ¥šï¼šUIWindow ä¼šå…ˆå°†è§¦æ‘¸äº‹ä»¶å‘é€ç»™ Hit-Testing è¿”å›çš„ View å’Œå®ƒçš„çˆ¶ View ä¸Šçš„ UIGestureRecognizerï¼Œç„¶åæ‰ä¼šå‘é€ç»™è¿™ä¸ª View æœ¬èº«ï¼Œå¦‚æœ UIGestureRecognizer æˆåŠŸè¯†åˆ«äº†è¿™ä¸ªæ‰‹åŠ¿ï¼Œä¹‹å UIWindow ä¸ä¼šå†å‘ View å‘é€è§¦æ‘¸äº‹ä»¶ï¼Œå¹¶ä¸”ä¼šå–æ¶ˆä¹‹å‰å‘é€çš„è§¦æ‘¸äº‹ä»¶ã€‚</p>

<p>ä¸‹é¢è®©æˆ‘ä»¬å›åˆ° Demo æ¥è¿›è¡ŒéªŒè¯ã€‚</p>

<h3 id="toc_17">Demo éªŒè¯</h3>

<p>ä» log ä¸Šçœ‹ï¼Œç°è±¡ä¸å®˜æ–¹æ–‡æ¡£çš„è¯´æ³•å»åˆï¼Œæˆ‘ä»¬ç”¨å‡ ä¸ªè°ƒç”¨æ ˆæ¥å¯¹å…¶è¿›è¡Œè¿›ä¸€æ­¥è¯æ˜ï¼š</p>

<p>ZTTapGestureRecognizer çš„Â <code>touchesBegan:withEvent:</code>Â çš„è°ƒç”¨æ ˆ:</p>

<p><img src="media/15654059537017/15654064509943.jpg" alt=""/></p>

<p>View D çš„Â <code>touchesBegan:withEvent:</code>Â çš„è°ƒç”¨æ ˆï¼š</p>

<p><img src="media/15654059537017/15654064661803.jpg" alt=""/></p>

<p>View D çš„Â <code>touchesCancelled:withEvent:</code>Â çš„è°ƒç”¨æ ˆï¼š</p>

<p><img src="media/15654059537017/15654064771703.jpg" alt=""/></p>

<p>å¯ä»¥çœ‹åˆ°ï¼ŒUIWindow é¦–å…ˆé€šè¿‡Â <code>sendEvent:</code>Â æ–¹æ³•ç»è¿‡ UIGestureEnvironment å‘é€è§¦æ‘¸äº‹ä»¶ç»™äº† ZTTapGestureRecognizerï¼Œéšåé€šè¿‡Â <code>sendTouchesForEvent:</code>Â æ–¹æ³•å‘é€è§¦æ‘¸äº‹ä»¶ç»™ View D å¹¶æ²¿ç€å“åº”é“¾ä¼ é€’ï¼Œè€Œå½“ A_view_tapGestureRecognizer ç¬¬ä¸€ä¸ªæˆåŠŸè¯†åˆ«æ‰‹åŠ¿ä¹‹åï¼ŒUIGestureEnvironment å‘èµ·å“åº”é“¾çš„ cancel å¹¶ç»è¿‡ UIApplication å‘é€ç»™ View D å¹¶æ²¿ç€å“åº”é“¾å–æ¶ˆã€‚</p>

<h3 id="toc_18">UIGestureRecognizer Properties</h3>

<p>UIGestureRecognizer æœ‰ä¸€äº›ä¸å“åº”é“¾è§¦æ‘¸äº‹ä»¶ç›¸å…³çš„å±æ€§ï¼Œè¿™é‡Œç®€å•è¯´æ˜ä¸€ä¸‹ï¼š</p>

<pre><code class="language-text">// default is YES. causes touchesCancelled:withEvent: or pressesCancelled:withEvent: to be sent to the view for all touches or presses recognized as part of this gesture immediately before the action method is called.
@property(nonatomic) BOOL cancelsTouchesInView;
å¤åˆ¶ä»£ç 
</code></pre>

<p>è¿™ä¸ªå±æ€§å¯ä»¥æ§åˆ¶å½“ UIGestureRecognizer æˆåŠŸè¯†åˆ«æ‰‹åŠ¿ä¹‹åæ˜¯å¦è¦å–æ¶ˆå“åº”é“¾å¯¹è§¦æ‘¸äº‹ä»¶çš„å“åº”ï¼Œé»˜è®¤ä¸º YESï¼Œè®¾ç½®ä¸º NO ä¹‹åï¼Œå³ä½¿ UIGestureRecognizer è¯†åˆ«äº†æ‰‹åŠ¿ï¼ŒUIGestureEnvironment ä¹Ÿä¸ä¼šå‘èµ·å¯¹å“åº”é“¾çš„ cancelã€‚</p>

<pre><code class="language-text">// default is NO.  causes all touch or press events to be delivered to the target view only after this gesture has failed recognition. set to YES to prevent views from processing any touches or presses that may be recognized as part of this gesture
@property(nonatomic) BOOL delaysTouchesBegan;
å¤åˆ¶ä»£ç 
</code></pre>

<p>è®¾ç½®ä¸º YES æ—¶ï¼Œè¿™ä¸ªå±æ€§å¯ä»¥æ§åˆ¶åœ¨ UIGestureRecognizer è¯†åˆ«æ‰‹åŠ¿æœŸé—´æˆªæ–­äº‹ä»¶ï¼Œè¯†åˆ«å¤±è´¥åå“åº”é“¾æ‰èƒ½æ”¶åˆ°è§¦æ‘¸äº‹ä»¶ã€‚</p>

<pre><code class="language-text">// default is YES. causes touchesEnded or pressesEnded events to be delivered to the target view only after this gesture has failed recognition. this ensures that a touch or press that is part of the gesture can be cancelled if the gesture is recognized
@property(nonatomic) BOOL delaysTouchesEnded;
å¤åˆ¶ä»£ç 
</code></pre>

<p>é»˜è®¤ä¸º YESï¼Œå½“æ‰‹åŠ¿è¯†åˆ«å¤±è´¥æ—¶ï¼Œè‹¥æ­¤æ—¶è§¦æ‘¸äº‹ä»¶å·²ç»ç»“æŸï¼Œä¼šå»¶è¿Ÿä¸€å°æ®µæ—¶é—´ï¼ˆ0.15sï¼‰å†è°ƒç”¨å“åº”è€…çš„Â <code>touchesEnded:withEvent:</code>ï¼Œè‹¥è®¾ç½®æˆNOï¼Œåˆ™åœ¨æ‰‹åŠ¿è¯†åˆ«å¤±è´¥æ—¶ä¼šç«‹å³é€šçŸ¥ UIApplication å‘é€çŠ¶æ€ä¸º end çš„ è§¦æ‘¸äº‹ä»¶ç»™ Hit-Testing è¿”å›çš„ View ä»¥è°ƒç”¨Â <code>touchesEnded:withEvent:</code>Â ç»“æŸäº‹ä»¶å“åº”ã€‚</p>

<h3 id="toc_19">å°ç»“</h3>

<p><strong>1. UIGestureRecognizer é¦–å…ˆæ”¶åˆ°è§¦æ‘¸äº‹ä»¶ï¼ŒHit-Testing è¿”å›çš„ View å»¶è¿Ÿæ”¶åˆ°ï¼Œä¸¤è€…çš„è°ƒèµ·æ–¹æ³•ä¸åŒã€‚</strong></p>

<p><strong>2. ç¬¬ä¸€ä¸ª UIGestureRecognizer è¯†åˆ«æˆåŠŸåï¼ŒUIGestureEnvironment ä¼šå‘èµ·å“åº”é“¾çš„ cancelã€‚</strong></p>

<p><strong>3. å¯ä»¥é€šè¿‡è®¾ç½® UIGestureRecognizer çš„ Properties æ¥æ§åˆ¶å¯¹å“åº”é“¾çš„å½±å“ã€‚</strong></p>

<h2 id="toc_20">UIControl ç‰¹ä¾‹</h2>

<p>æˆ‘ä»¬ç°åœ¨ç»™ Demo ä¸­çš„ View D ä¸ŠåŠ ä¸€ä¸ª UIButtonï¼š</p>

<p><img src="media/15654059537017/15654064977862.jpg" alt=""/></p>

<pre><code class="language-text">- (void)buttonTapped
{
    NSLog(@&quot;D_buttonTapped&quot;);
}

- (instancetype)initWithCoder:(NSCoder *)coder
{
    self = [super initWithCoder:coder];

    if (self)
    {
        ZTTapGestureRecognizer *tapGestureRecognizer = [[ZTTapGestureRecognizer alloc] initWithTarget:self action:@selector(singleTapGesture)];
        tapGestureRecognizer.name = @&quot;D_view_tapGestureRecognizer&quot;;
        tapGestureRecognizer.delegate = self;
        [self addGestureRecognizer:tapGestureRecognizer];

        FButton *button = [[FButton alloc] initWithFrame:CGRectMake(80, 10, 100, 40)];
        button.backgroundColor = [UIColor blueColor];
        [button addTarget:self action:@selector(buttonTapped) forControlEvents:UIControlEventTouchUpInside];
        [self addSubview:button];
    }

    return self;
}
å¤åˆ¶ä»£ç 
</code></pre>

<p>ç‚¹å‡» Buttonï¼Œlog æ˜¾ç¤ºå¦‚ä¸‹ï¼š</p>

<pre><code class="language-text">D_view--- gestureRecognizer shouldReceiveTouch: D_view_tapGestureRecognizer ---
C_view--- gestureRecognizer shouldReceiveTouch: C_view_tapGestureRecognizer ---
A_view--- gestureRecognizer shouldReceiveTouch: A_view_tapGestureRecognizer ---
C_view_tapGestureRecognizer_touchesBegan
A_view_tapGestureRecognizer_touchesBegan
D_view_tapGestureRecognizer_touchesBegan
C_view_tapGestureRecognizer_touchesEndedWithState: 5
A_view_tapGestureRecognizer_touchesEndedWithState: 5
D_view_tapGestureRecognizer_touchesEndedWithState: 5
D_buttonTapped
å¤åˆ¶ä»£ç 
</code></pre>

<p>è¿™ä¸æˆ‘ä»¬æƒ³è±¡çš„å®Œå…¨ä¸åŒï¼š</p>

<ol>
<li>UIGestureRecognizer æ²¡æœ‰å“åº”è§¦æ‘¸äº‹ä»¶ä¸”é™¤äº†Â <code>shouldReceiveTouch</code>Â ä¹‹å¤–çš„å›è°ƒæ²¡æœ‰è¢«è°ƒç”¨ã€‚</li>
<li>è§¦æ‘¸äº‹ä»¶æ²¡æœ‰æ²¿ç€å“åº”é“¾è¿›è¡Œä¼ é€’ã€‚</li>
<li>UIButton æˆåŠŸçš„å“åº”äº†è§¦æ‘¸äº‹ä»¶ã€‚</li>
</ol>

<p>è¿™åˆæ˜¯ä»€ä¹ˆåŸå› å¯¼è‡´çš„å‘¢ï¼Ÿ</p>

<h3 id="toc_21">å®˜æ–¹æ–‡æ¡£</h3>

<p>æƒ¯ä¾‹ï¼Œå…ˆçœ‹å®˜æ–¹æ–‡æ¡£ï¼š</p>

<blockquote>
<p>Interacting with Other User Interface Controls</p>

<p>In iOS 6.0 and later, default control actions prevent overlapping gesture recognizer behavior. For example, the default action for a button is a single tap. If you have a single tap gesture recognizer attached to a buttonâ€™s parent view, and the user taps the button, then the buttonâ€™s action method receives the touch event instead of the gesture recognizer. This applies only to gesture recognition that overlaps the default action for a control, which includes:</p>

<ul>
<li><p>A single finger single tap on a UIButton, UISwitch, UIStepper, UISegmentedControl, and UIPageControl.</p></li>
<li><p>A single finger swipe on the knob of a UISlider, in a direction parallel to the slider.</p></li>
<li><p>A single finger pan gesture on the knob of a UISwitch, in a direction parallel to the switch.</p></li>
</ul>

<p>If you have a custom subclass of one of these controls and you want to change the default action, attach a gesture recognizer directly to the control instead of to the parent view. Then, the gesture recognizer receives the touch event first. As always, be sure to read the iOS Human Interface Guidelines to ensure that your app offers an intuitive user experience, especially when overriding the default behavior of a standard control.</p>
</blockquote>

<p>è¿™æ¬¡æ–‡æ¡£è§£é‡Šæ¸…æ¥šäº†æ‰€æœ‰çš„åŸå› ï¼šå¯¹äºÂ <strong>éƒ¨åˆ† UIControl</strong>Â æ¥è¯´ï¼ˆè‡ªå·±å®ç°çš„ä¸è¡Œï¼‰ï¼Œä¸ºäº†é˜²æ­¢ UIControl é»˜è®¤çš„æ‰‹åŠ¿ä¸å…¶çˆ¶ View ä¸Šçš„ UIGestureRecognizer çš„å†²çªï¼ŒUIControl æœ€åä¼šå“åº”è§¦æ‘¸äº‹ä»¶ï¼Œå¦‚æœæƒ³è¦ UIGestureRecognizer å¤„ç†è§¦æ‘¸äº‹ä»¶ï¼Œåˆ™éœ€è¦å°†å…¶ç›´æ¥ä¸ UIControl è¿›è¡Œç»‘å®šã€‚</p>

<p>åŸå› æ¸…æ¥šäº†ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯å›åˆ° Demo ä¹‹ä¸­æ¥çœ‹çœ‹ç³»ç»Ÿå…·ä½“æ˜¯æ€ä¹ˆåšçš„ã€‚</p>

<h3 id="toc_22">Demo éªŒè¯</h3>

<p>æˆ‘ä»¬å»æ‰ View A C D ä¸­çš„ logï¼Œå®ç°ä¸€ä¸ª UIButton çš„å­ç±» FButtonï¼Œå¯¹ FButton æ·»åŠ ä¸€ä¸ª ZTTapGestureRecognizerï¼Œå¹¶ä¸”å®ç°æ–¹æ³•Â <code>gestureRecognizerShouldBeginï¼š</code>ï¼š</p>

<pre><code class="language-text">@implementation FButton

- (void)singleTapGesture
{
    NSLog(@&quot;F_singleTapGesture&quot;);
}

- (BOOL)gestureRecognizerShouldBegin:(UIGestureRecognizer *)gestureRecognizer
{
    if ([super gestureRecognizerShouldBegin:gestureRecognizer])
    {
        NSLog(@&quot;F_Button--- gestureRecognizerShouldBegin: %@ YES ---&quot;, gestureRecognizer.name);
    }
    else
    {
        NSLog(@&quot;F_Button--- gestureRecognizerShouldBegin: %@ NO ---&quot;, gestureRecognizer.name);
    }

    return [super gestureRecognizerShouldBegin:gestureRecognizer];
}

- (instancetype)initWithFrame:(CGRect)frame
{
    self = [super initWithFrame:frame];

    if (self)
    {
        ZTTapGestureRecognizer *tapGestureRecognizer = [[ZTTapGestureRecognizer alloc] initWithTarget:self action:@selector(singleTapGesture)];
        tapGestureRecognizer.name = @&quot;F_Button_tapGestureRecognizer&quot;;
        tapGestureRecognizer.delegate = self;
        [self addGestureRecognizer:tapGestureRecognizer];
    }

    return self;
}

@end
å¤åˆ¶ä»£ç 
</code></pre>

<p>è¿è¡Œ Demoï¼Œç‚¹å‡» Buttonï¼Œlog å¦‚ä¸‹æ‰€ç¤ºï¼š</p>

<pre><code class="language-text">D_view_tapGestureRecognizer_touchesBegan
F_Button_tapGestureRecognizer_touchesBegan
C_view_tapGestureRecognizer_touchesBegan
A_view_tapGestureRecognizer_touchesBegan

F_Button--- gestureRecognizerShouldBegin: D_view_tapGestureRecognizer NO ---
D_view_tapGestureRecognizer_touchesEndedWithState: 5
F_Button--- gestureRecognizerShouldBegin: F_Button_tapGestureRecognizer YES ---
F_Button_tapGestureRecognizer_touchesEndedWithState: 3
F_Button--- gestureRecognizerShouldBegin: C_view_tapGestureRecognizer NO ---
C_view_tapGestureRecognizer_touchesEndedWithState: 5
F_Button--- gestureRecognizerShouldBegin: A_view_tapGestureRecognizer NO ---
A_view_tapGestureRecognizer_touchesEndedWithState: 5

F_singleTapGesture
å¤åˆ¶ä»£ç 
</code></pre>

<p>å¯ä»¥çœ‹åˆ° View A C D å’Œ Button F ä¸Šçš„ ZTTapGestureRecognizer éƒ½æ”¶åˆ°äº†Â <code>touchesBegan</code>Â æ–¹æ³•ï¼Œä½†æ˜¯æœ€ååªæœ‰ F_Button_tapGestureRecognizer æœ€ç»ˆæˆåŠŸè¿›è¡Œäº†çŠ¶æ€è½¬æ¢ï¼Œå…¶åŸå› å°±åœ¨äºæ–¹æ³•Â <code>gestureRecognizerShouldBegin:</code>ã€‚</p>

<p>è¿˜è®°å¾—å‰ä¸¤èŠ‚æˆ‘ä»¬å¯¹äºÂ <code>gestureRecognizerShouldBegin:</code>Â çš„æ¢è®¨å—ï¼Œæˆ‘ä»¬ç»ˆäºèƒ½å¤Ÿè¿›ä¸€æ­¥å¯¹å…¶è¿›è¡Œè§£é‡Šäº†ï¼Œè¿™ä¸ªæœºä¼šè¿˜æ˜¯ç•™ç»™å®˜æ–¹æ–‡æ¡£ï¼š</p>

<blockquote>
<p>Subclasses may override this method and use it to prevent the recognition of particular gestures. For example, the UISlider class uses this method to prevent swipes parallel to the sliderâ€™s travel direction and that start in the thumb.</p>

<p>At the time this method is called, the gesture recognizer is in the UIGestureRecognizerStatePossible state and thinks it has the events needed to move to the UIGestureRecognizerStateBegan state.</p>

<p>The default implementation of this method returns YES.</p>
</blockquote>

<p>æ‰€ä»¥ï¼Œä¸Šæ–‡æåˆ°çš„éƒ¨åˆ† UIControl é‡å†™äº†è¯¥æ–¹æ³•ï¼Œè™½ç„¶ UIGestureRecognizer ä¼šé¦–å…ˆå—åˆ°è§¦æ‘¸äº‹ä»¶ï¼Œä½†æ˜¯åœ¨çŠ¶æ€è½¬æ¢ä¹‹å‰ï¼Œè°ƒç”¨äº† Hit-Testing è¿”å›çš„ View ä¹Ÿå°±æ˜¯ UIControl çš„Â <code>gestureRecognizerShouldBegin:</code>Â æ–¹æ³•ï¼ŒUIControl ä¼šä½¿çˆ¶ View ä¸Šçš„ UIGestureRecognizer å¤±æ•ˆï¼Œè€Œè‡ªå·±çš„ UIGestureRecognizer å´ä¸ä¼šå¤±æ•ˆï¼Œè¿™å°±æ˜¯ç³»ç»Ÿå®ç°è¿™ä¸ªæœºåˆ¶çš„æ–¹æ³•ã€‚</p>

<p>è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œä¸ºä»€ä¹ˆè§¦æ‘¸æ²¡æœ‰æ²¿ç€å“åº”é“¾è¿›è¡Œä¼ é€’å‘¢ï¼Ÿæƒ¯ä¾‹ï¼Œå…ˆçœ‹æ–‡æ¡£ï¼š</p>

<blockquote>
<p>Controls communicate directly with their associated target object using action messages. When the user interacts with a control, the control sends an action message to its target object. Action messages are not events, but they may still take advantage of the responder chain. When the target object of a control is nil, UIKit starts from the target object and traverses the responder chain until it finds an object that implements the appropriate action method. For example, the UIKit editing menu uses this behavior to search for responder objects that implement methods with names like cut:, copy:, or paste:.</p>
</blockquote>

<p>ç„¶åæˆ‘ä»¬çœ‹ä¸‹ FButton çš„å“åº”æ–¹æ³•çš„è°ƒç”¨æ ˆï¼ˆå»æ‰ FButton ä¸Šçš„ UIGestureRecognizerï¼‰ï¼š</p>

<p><img src="media/15654059537017/15654065324630.jpg" alt=""/></p>

<p>è¿™é‡Œæ–‡æ¡£æ²¡æœ‰è¯´å…¨ï¼Œå®é™…ä¸Šï¼ŒFButton é‡å†™äº†Â <code>touchesBegan:withEvent:</code>Â æ–¹æ³•ï¼Œåœ¨æ”¶åˆ°è§¦æ‘¸äº‹ä»¶åå°†å…¶æˆªæ–­ä¸å†æ²¿å“åº”é“¾è¿›è¡Œä¼ é€’ï¼›åœ¨å“åº”è§¦æ‘¸äº‹ä»¶æ—¶ï¼ŒFButton ä½¿ç”¨ Target-Action æœºåˆ¶é€šè¿‡Â <code>sendAction:to:forEvent:</code>Â æ–¹æ³•é€šçŸ¥ UIApplicationï¼ŒUIApplication åœ¨é€šè¿‡Â <code>sendAction:to:from:forEvent:</code>Â æ–¹æ³•å‘ target å‘é€ actionï¼Œè€Œå½“ target ä¸º nil æ—¶å°±ä¼šæ²¿ç€å“åº”é“¾è¿›è¡Œå¯»æ‰¾ï¼ŒçŸ¥é“æ‰¾åˆ°äº†å®ç°äº†ç›¸åº”æ–¹æ³•çš„å¯¹è±¡ã€‚</p>

<h3 id="toc_23">å°ç»“</h3>

<p><strong>1. UIGestureRecognizer ä»ç„¶ä¼šå…ˆäº UIControl æ¥æ”¶åˆ°è§¦æ‘¸äº‹ä»¶ã€‚</strong></p>

<p><strong>2. UIButton ç­‰éƒ¨åˆ† UIControl ä¼šæ‹¦æˆªå…¶çˆ¶ View ä¸Šçš„ UIGestureRecognizerï¼Œä½†ä¸ä¼šæ‹¦æˆªè‡ªå·±å’Œå­ View ä¸Šçš„ UIGestureRecognizerã€‚</strong></p>

<p><strong>3. UIButton ä¼šæˆªæ–­å“åº”é“¾çš„äº‹ä»¶ä¼ é€’ï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨å“åº”é“¾æ¥å¯»æ‰¾ Action Methodã€‚</strong></p>

<h2 id="toc_24">UITableView ä¸ UIScrollView</h2>

<p>å½“åœºæ™¯ä¸­å­˜åœ¨ UITableView å’Œ UIScrollView æ—¶ï¼Œåˆä¼šæœ‰ä¸ä¸€æ ·çš„æƒ…å†µï¼Œæ„Ÿå…´è¶£çš„è¯»è€…å¯ä»¥è¯•ç€è‡ªå·±ç ”ç©¶ä¸€ä¸‹ã€‚</p>

<h2 id="toc_25">é—®é¢˜è§£å†³</h2>

<p>ç°åœ¨ï¼Œæˆ‘ä»¬å›è¿‡å¤´çœ‹çœ‹æœ€åˆçš„é—®é¢˜ï¼Œè§£å†³èµ·æ¥åº”è¯¥å°±æ¯”è¾ƒç®€å•äº†ã€‚</p>

<p>é¦–å…ˆåœ¨æˆ‘ä»¬å¯¹å¤–çš„ View ä¸Šæ·»åŠ ä¸€ä¸ª UITapGestureRecognizerï¼Œé€šè¿‡å›è°ƒä½¿å…¶èƒ½ä¸å†…éƒ¨çš„ UIGestureRecognizer åŒæ—¶å¤„ç†è§¦æ‘¸äº‹ä»¶ï¼Œå¹¶ä¸”ä¸å†…éƒ¨åŒå‡»æ‰‹åŠ¿ä¸ä¼šå†²çªï¼š</p>

<pre><code class="language-text">- (BOOL)gestureRecognizer:(UIGestureRecognizer *)gestureRecognizer shouldRecognizeSimultaneouslyWithGestureRecognizer:(UIGestureRecognizer *)otherGestureRecognizer
{
    if (gestureRecognizer == self.tapGestureRecognizer)
    {
        return YES;
    }

    return NO;
}

- (BOOL)gestureRecognizer:(UIGestureRecognizer *)gestureRecognizer shouldRequireFailureOfGestureRecognizer:(UIGestureRecognizer *)otherGestureRecognizer
{
    if (gestureRecognizer == self.tapGestureRecognizer &amp;&amp; [otherGestureRecognizer isKindOfClass:[UITapGestureRecognizer class]] &amp;&amp; ((UITapGestureRecognizer *)otherGestureRecognizer).numberOfTapsRequired == 2)
    {
        return YES;
    }

    return NO;
}
å¤åˆ¶ä»£ç 
</code></pre>

<p>ç”±äºå•å‡»æ‰‹åŠ¿è¦åœ¨åŒå‡»æ‰‹åŠ¿åˆ¤æ–­å¤±è´¥åæ‰èƒ½è§¦å‘ï¼Œæ‰€ä»¥ä¼šæœ‰ä¸€å®šçš„å»¶è¿Ÿï¼Œè¿™é‡Œæœ€å¥½çš„åŠæ³•æ˜¯åœ¨å†…éƒ¨è‡ªå®šä¹‰ä¸€ä¸ª UIGestureRecognizer æ¥å®ç°åŒå‡»æ‰‹åŠ¿ä»¥ç¼©çŸ­ç­‰å¾…æ—¶é—´ï¼š</p>

<pre><code class="language-text">#import &lt;UIKit/UIGestureRecognizerSubclass.h&gt;

#define UISHORT_TAP_MAX_DELAY 0.2
@interface UIShortTapGestureRecognizer : UITapGestureRecognizer

@end

@implementation UIShortTapGestureRecognizer

- (void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event
{
    [super touchesBegan:touches withEvent:event];
    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(UISHORT_TAP_MAX_DELAY * NSEC_PER_SEC)), dispatch_get_main_queue(), ^
    {
        // Enough time has passed and the gesture was not recognized -&gt; It has failed.
        if  (self.state != UIGestureRecognizerStateRecognized)
        {
            self.state = UIGestureRecognizerStateFailed;
        }
    });
}
@end
å¤åˆ¶ä»£ç 
</code></pre>

<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹Â <code>UISHORT_TAP_MAX_DELAY</code>Â å‚æ•°æ¥æ§åˆ¶ç­‰å¾…çš„æ—¶é—´ã€‚</p>

<h2 id="toc_26">æ€»ç»“</h2>

<p><strong>1. è§¦æ‘¸äº‹ä»¶å‘ç”Ÿåï¼ŒIOKit ä¼šé€šè¿‡ mach port ä¼ é€’ç»™ SpringBoad è¿›ç¨‹ï¼Œå¹¶æœ€ç»ˆä¼ é€’ç»™äº† UIApplicationã€‚</strong></p>

<p><strong>2. UIApplication é€šè¿‡ Hit-Testing å¯»æ‰¾åˆ°äº†æœ€ä½³å“åº”è€…ï¼Œéå†å¾—åˆ°æ‰€æœ‰çš„ UIGestureRecognizerï¼Œç„¶åæ ¹æ®æœ€ä½³å“åº”è€…ã€UIGestureRecognizerã€Window åˆ›å»º UITouch å¹¶å°†å…¶ä¿å­˜åœ¨ UIEvent ä¸­ã€‚</strong></p>

<p><strong>3. UIApplication å°† UIEvent å‘é€ç»™ UIWindowï¼ŒUIWindow é¦–å…ˆå‘é€äº‹ä»¶ç»™ UIGestureRecognizerï¼Œç„¶åå‘é€ç»™æœ€ä½³å“åº”è€…ï¼Œäº‹ä»¶æ²¿å“åº”é“¾ä¼ é€’ã€‚</strong></p>

<p><strong>4. UIGestureRecognizer æ ¹æ® Delegate ä»¥åŠæœ€ä½³å“åº”è€…æ¥åˆ¤æ–­æ˜¯å¦èƒ½å¤ŸæˆåŠŸè¿›è¡ŒçŠ¶æ€è½¬æ¢å¹¶å–æ¶ˆå“åº”é“¾çš„è§¦æ‘¸äº‹ä»¶ã€‚</strong></p>

<p><strong>5. ç³»ç»Ÿå®ç°çš„éƒ¨åˆ† UIControl ä¼šæˆªæ–­å“åº”é“¾ï¼Œå¹¶ä½¿çˆ¶ View ä¸Šçš„ UIGestureRecognizer å¤±æ•ˆã€‚</strong></p>

<h2 id="toc_27">å‚è€ƒèµ„æ–™</h2>

<p><a href="https://link.juejin.im/?target=https%3A%2F%2Fgithub.com%2FBladeTail%2FEvent-Handling-Guide-for-iOS%2Fblob%2Fmaster%2FEvent%2520Handling%2520Guide%2520for%2520iOS.pdf">Event Handling Guide for iOS</a></p>

<p><a href="https://link.juejin.im/?target=https%3A%2F%2Fwww.jianshu.com%2Fp%2Fd8512dff2b3e">iOS äº‹ä»¶å“åº”é“¾ä¸­ Hit-Test View çš„åº”ç”¨</a></p>

<p><a href="https://link.juejin.im/?target=https%3A%2F%2Fwww.jianshu.com%2Fp%2Fc294d1bd963d">iOS è§¦æ‘¸äº‹ä»¶å…¨å®¶æ¡¶</a></p>

<p><a href="https://link.juejin.im/?target=https%3A%2F%2Fwww.jianshu.com%2Fp%2F53e03e558cbd">iOS ç‚¹å‡»äº‹ä»¶å’Œæ‰‹åŠ¿å†²çª</a></p>

<p><a href="https://link.juejin.im/?target=http%3A%2F%2Fzhoon.github.io%2Fios%2F2015%2F04%2F12%2Fios-event.html">æ·±å…¥æµ…å‡ºiOSäº‹ä»¶æœºåˆ¶</a></p>


		</div>

		

	</article>
  
	<div class="pagination">
	 <a class="prev" href="all_3.html">&larr; Older</a> 
<a href="archives.html">Blog Archives</a>
	 <a class="next" href="all_1.html">Newer &rarr;</a>  
	    
	</div>
</div>
 <aside class="sidebar"> 

	<section>
	  <h1>Categories</h1>
	  <ul id="recent_posts">
	  
	      <li class="post">
	        <a href="%E5%8E%9F%E7%90%86%E6%8E%A2%E7%A9%B6.html"><strong>åŸç†æ¢ç©¶&nbsp;(8)</strong></a>
	        
	        
	        
	      </li>
	  
	      <li class="post">
	        <a href="%E6%8A%80%E5%B7%A7.html"><strong>æŠ€å·§&nbsp;(34)</strong></a>
	        
	        
	        
	      </li>
	  
	      <li class="post">
	        <a href="%E6%95%99%E7%A8%8B.html"><strong>æ•™ç¨‹&nbsp;(22)</strong></a>
	        
	        
	        
	      </li>
	  
	      <li class="post">
	        <a href="%E9%81%87%E5%88%B0Bug.html"><strong>é‡åˆ°Bug&nbsp;(12)</strong></a>
	        
	        
	        
	      </li>
	  
	      <li class="post">
	        <a href="%E6%9D%82%E8%AE%B0.html"><strong>æ‚è®°&nbsp;(15)</strong></a>
	        
	        
	        
	      </li>
	  
	      <li class="post">
	        <a href="Swift.html"><strong>Swift&nbsp;(23)</strong></a>
	        
	        
	        
	      </li>
	  
	      <li class="post">
	        <a href="C/C++.html"><strong>C/C++&nbsp;(4)</strong></a>
	        
	        
	        
	      </li>
	  
	      <li class="post">
	        <a href="Linux.html"><strong>Linux&nbsp;(3)</strong></a>
	        
	        
	        
	      </li>
	  
	      <li class="post">
	        <a href="Documentation.html"><strong>Documentation&nbsp;(8)</strong></a>
	        
	        
	        
	      </li>
	  
	      <li class="post">
	        <a href="Java.html"><strong>Java&nbsp;(7)</strong></a>
	        
	        
	        
	      </li>
	  
	      <li class="post">
	        <a href="LeetCode.html"><strong>LeetCode&nbsp;(3)</strong></a>
	        
	        
	        
	      </li>
	   
	  </ul>
	</section>
	<section>
	  <h1>Recent Posts</h1>
	  <ul id="recent_posts">
	  
	      
		      <li class="post">
		        <a href="16158207840706.html">AR æ¨¡å‹æ ¼å¼è½¬æ¢å’Œå¯¼å…¥</a>
		      </li>
	     
	  
	      
		      <li class="post">
		        <a href="16158207797865.html">èŠ‚æµé˜²æŠ–</a>
		      </li>
	     
	  
	      
		      <li class="post">
		        <a href="16154734553187.html">Flutter ç¯å¢ƒå˜é‡è®¾ç½®</a>
		      </li>
	     
	  
	      
		      <li class="post">
		        <a href="16153819894563.html">SSH å…å¯†ç™»å½•è®¾ç½®</a>
		      </li>
	     
	  
	      
		      <li class="post">
		        <a href="16152544377232.html">Flutter ç›¸å…³ç½‘ç«™</a>
		      </li>
	     
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	   
	  </ul>
	</section>
	
</aside> </div></div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 -  -
  <span class="credit">Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a> &nbsp;&nbsp; Theme by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>



  














<style type="text/css">
  
/* PrismJS 1.14.0
https://prismjs.com/download.html#themes=prism-solarizedlight&languages=markup+css+clike+javascript */
/*
 Solarized Color Schemes originally by Ethan Schoonover
 http://ethanschoonover.com/solarized

 Ported for PrismJS by Hector Matos
 Website: https://krakendev.io
 Twitter Handle: https://twitter.com/allonsykraken)
*/

/*
SOLARIZED HEX
--------- -------
base03    #002b36
base02    #073642
base01    #586e75
base00    #657b83
base0     #839496
base1     #93a1a1
base2     #eee8d5
base3     #fdf6e3
yellow    #b58900
orange    #cb4b16
red       #dc322f
magenta   #d33682
violet    #6c71c4
blue      #268bd2
cyan      #2aa198
green     #859900
*/

code[class*="language-"],
pre[class*="language-"] {
  color: #657b83; /* base00 */
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;

  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

pre[class*="language-"]::-moz-selection, pre[class*="language-"] ::-moz-selection,
code[class*="language-"]::-moz-selection, code[class*="language-"] ::-moz-selection {
  background: #073642; /* base02 */
}

pre[class*="language-"]::selection, pre[class*="language-"] ::selection,
code[class*="language-"]::selection, code[class*="language-"] ::selection {
  background: #073642; /* base02 */
}

/* Code blocks */
pre[class*="language-"] {
  padding: 1em;
  margin: .5em 0;
  overflow: auto;
  border-radius: 0.3em;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
  background-color: #fdf6e3; /* base3 */
}

/* Inline code */
:not(pre) > code[class*="language-"] {
  padding: .1em;
  border-radius: .3em;
}

.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
  color: #93a1a1; /* base1 */
}

.token.punctuation {
  color: #586e75; /* base01 */
}

.namespace {
  opacity: .7;
}

.token.property,
.token.tag,
.token.boolean,
.token.number,
.token.constant,
.token.symbol,
.token.deleted {
  color: #268bd2; /* blue */
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.url,
.token.inserted {
  color: #2aa198; /* cyan */
}

.token.entity {
  color: #657b83; /* base00 */
  background: #eee8d5; /* base2 */
}

.token.atrule,
.token.attr-value,
.token.keyword {
  color: #859900; /* green */
}

.token.function,
.token.class-name {
  color: #b58900; /* yellow */
}

.token.regex,
.token.important,
.token.variable {
  color: #cb4b16; /* orange */
}

.token.important,
.token.bold {
  font-weight: bold;
}
.token.italic {
  font-style: italic;
}

.token.entity {
  cursor: help;
}


pre[class*="language-"].line-numbers {
    position: relative;
    padding-left: 3.8em;
    counter-reset: linenumber;
}

pre[class*="language-"].line-numbers > code {
    position: relative;
    white-space: inherit;
}

.line-numbers .line-numbers-rows {
    position: absolute;
    pointer-events: none;
    top: 0;
    font-size: 100%;
    left: -3.8em;
    width: 3em; /* works for line-numbers below 1000 lines */
    letter-spacing: -1px;
    border-right: 1px solid #999;

    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;

}

    .line-numbers-rows > span {
        pointer-events: none;
        display: block;
        counter-increment: linenumber;
    }

        .line-numbers-rows > span:before {
            content: counter(linenumber);
            color: #999;
            display: block;
            padding-right: 0.8em;
            text-align: right;
        }

</style>
  
    


</body>
</html>